<!DOCTYPE html>
<html lang="zh_CN">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<meta name="theme-color" content="#494f5c">
	<meta name="msapplication-TileColor" content="#494f5c">
<meta itemprop="name" content="实现收到IBMMQ的数据之后存储到数据库(微服务系列第五天)">
<meta itemprop="description" content="前言 今天的目标是： 实现收到MQ队列消息，实现收到IBMMQ的数据之后存储到数据库。
 注意!!! 这是个学习使用mybatis的示例工程,正式项目则不应该如此做,耦合很严重.正确的做法是把消息发送到topic上面,由存储服务去topic上面取数据再做保存,这样就可以解耦了.
 修改mqserver项目 pom.xml 添加依赖 此处用的是阿里的连接池 druid
&lt;dependency&gt; &lt;groupId&gt;org.mybatis.spring.boot&lt;/groupId&gt; &lt;artifactId&gt;mybatis-spring-boot-starter&lt;/artifactId&gt; &lt;version&gt;2.1.4&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;mysql&lt;/groupId&gt; &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt; &lt;scope&gt;runtime&lt;/scope&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba&lt;/groupId&gt; &lt;artifactId&gt;druid&lt;/artifactId&gt; &lt;version&gt;1.2.4&lt;/version&gt; &lt;/dependency&gt; JDBC 配置 这个是从官网例子上拿来的配置数据
# 只有下面三个是必填项（使用内嵌数据库的话这三个也可以不用填，会使用默认配置），其他配置不是必须的 spring.datasource.url=jdbc:mysql://172.25.0.2:3306/db1 spring.datasource.username=root spring.datasource.password=123456 # driver-class-name 非必填可根据url推断 spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver # Druid 数据源配置，继承spring.datasource.* 配置，相同则覆盖 spring.datasource.initial-size=2 spring.datasource.max-active=30 spring.datasource.min-idle=2 spring.datasource.max-wait=1234 spring.datasource.pool-prepared-statements=true spring.datasource.max-pool-prepared-statement-per-connection-size=5 # spring.datasource.max-open-prepared-statements= #等价于上面的max-pool-prepared-statement-per-connection-size spring.datasource.validation-query=select 1 spring.datasource.validation-query-timeout=1 spring.datasource.test-on-borrow=true spring.datasource.test-on-return=true spring.datasource.test-while-idle=true spring.datasource.time-between-eviction-runs-millis=10000 spring.datasource.min-evictable-idle-time-millis=30001 spring.datasource.async-close-connection-enable=true # spring.datasource.aop-patterns=com.alibaba.spring.boot.demo.service.* # 自定义StatFilter 配置 其他 Filter 不再演示 spring.datasource.filter.stat.db-type=h2 spring.">
<meta itemprop="datePublished" content="2021-02-01T18:14:10+08:00" />
<meta itemprop="dateModified" content="2021-02-01T18:14:10+08:00" />
<meta itemprop="wordCount" content="519">



<meta itemprop="keywords" content="java,docker,mq,jms,tars,micro serivce,微服务," />
<meta property="og:title" content="实现收到IBMMQ的数据之后存储到数据库(微服务系列第五天)" />
<meta property="og:description" content="前言 今天的目标是： 实现收到MQ队列消息，实现收到IBMMQ的数据之后存储到数据库。
 注意!!! 这是个学习使用mybatis的示例工程,正式项目则不应该如此做,耦合很严重.正确的做法是把消息发送到topic上面,由存储服务去topic上面取数据再做保存,这样就可以解耦了.
 修改mqserver项目 pom.xml 添加依赖 此处用的是阿里的连接池 druid
&lt;dependency&gt; &lt;groupId&gt;org.mybatis.spring.boot&lt;/groupId&gt; &lt;artifactId&gt;mybatis-spring-boot-starter&lt;/artifactId&gt; &lt;version&gt;2.1.4&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;mysql&lt;/groupId&gt; &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt; &lt;scope&gt;runtime&lt;/scope&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba&lt;/groupId&gt; &lt;artifactId&gt;druid&lt;/artifactId&gt; &lt;version&gt;1.2.4&lt;/version&gt; &lt;/dependency&gt; JDBC 配置 这个是从官网例子上拿来的配置数据
# 只有下面三个是必填项（使用内嵌数据库的话这三个也可以不用填，会使用默认配置），其他配置不是必须的 spring.datasource.url=jdbc:mysql://172.25.0.2:3306/db1 spring.datasource.username=root spring.datasource.password=123456 # driver-class-name 非必填可根据url推断 spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver # Druid 数据源配置，继承spring.datasource.* 配置，相同则覆盖 spring.datasource.initial-size=2 spring.datasource.max-active=30 spring.datasource.min-idle=2 spring.datasource.max-wait=1234 spring.datasource.pool-prepared-statements=true spring.datasource.max-pool-prepared-statement-per-connection-size=5 # spring.datasource.max-open-prepared-statements= #等价于上面的max-pool-prepared-statement-per-connection-size spring.datasource.validation-query=select 1 spring.datasource.validation-query-timeout=1 spring.datasource.test-on-borrow=true spring.datasource.test-on-return=true spring.datasource.test-while-idle=true spring.datasource.time-between-eviction-runs-millis=10000 spring.datasource.min-evictable-idle-time-millis=30001 spring.datasource.async-close-connection-enable=true # spring.datasource.aop-patterns=com.alibaba.spring.boot.demo.service.* # 自定义StatFilter 配置 其他 Filter 不再演示 spring.datasource.filter.stat.db-type=h2 spring." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://aomi.run/posts/java/hello-java-5-day/" />
<meta property="article:published_time" content="2021-02-01T18:14:10+08:00" />
<meta property="article:modified_time" content="2021-02-01T18:14:10+08:00" /><meta property="og:see_also" content="https://aomi.run/posts/java/hello-java-4-day/" /><meta property="og:see_also" content="https://aomi.run/posts/java/hello-java-3-day/" /><meta property="og:see_also" content="https://aomi.run/posts/java/hello-java-2-day/" /><meta property="og:see_also" content="https://aomi.run/posts/java/hello-java-1-day/" />

<meta property="og:see_also" content="https://aomi.run/posts/java/hello-java-4-day/" /><meta property="og:see_also" content="https://aomi.run/posts/java/hello-java-3-day/" /><meta property="og:see_also" content="https://aomi.run/posts/java/hello-java-2-day/" /><meta property="og:see_also" content="https://aomi.run/posts/java/hello-java-1-day/" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="实现收到IBMMQ的数据之后存储到数据库(微服务系列第五天)"/>
<meta name="twitter:description" content="前言 今天的目标是： 实现收到MQ队列消息，实现收到IBMMQ的数据之后存储到数据库。
 注意!!! 这是个学习使用mybatis的示例工程,正式项目则不应该如此做,耦合很严重.正确的做法是把消息发送到topic上面,由存储服务去topic上面取数据再做保存,这样就可以解耦了.
 修改mqserver项目 pom.xml 添加依赖 此处用的是阿里的连接池 druid
&lt;dependency&gt; &lt;groupId&gt;org.mybatis.spring.boot&lt;/groupId&gt; &lt;artifactId&gt;mybatis-spring-boot-starter&lt;/artifactId&gt; &lt;version&gt;2.1.4&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;mysql&lt;/groupId&gt; &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt; &lt;scope&gt;runtime&lt;/scope&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba&lt;/groupId&gt; &lt;artifactId&gt;druid&lt;/artifactId&gt; &lt;version&gt;1.2.4&lt;/version&gt; &lt;/dependency&gt; JDBC 配置 这个是从官网例子上拿来的配置数据
# 只有下面三个是必填项（使用内嵌数据库的话这三个也可以不用填，会使用默认配置），其他配置不是必须的 spring.datasource.url=jdbc:mysql://172.25.0.2:3306/db1 spring.datasource.username=root spring.datasource.password=123456 # driver-class-name 非必填可根据url推断 spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver # Druid 数据源配置，继承spring.datasource.* 配置，相同则覆盖 spring.datasource.initial-size=2 spring.datasource.max-active=30 spring.datasource.min-idle=2 spring.datasource.max-wait=1234 spring.datasource.pool-prepared-statements=true spring.datasource.max-pool-prepared-statement-per-connection-size=5 # spring.datasource.max-open-prepared-statements= #等价于上面的max-pool-prepared-statement-per-connection-size spring.datasource.validation-query=select 1 spring.datasource.validation-query-timeout=1 spring.datasource.test-on-borrow=true spring.datasource.test-on-return=true spring.datasource.test-while-idle=true spring.datasource.time-between-eviction-runs-millis=10000 spring.datasource.min-evictable-idle-time-millis=30001 spring.datasource.async-close-connection-enable=true # spring.datasource.aop-patterns=com.alibaba.spring.boot.demo.service.* # 自定义StatFilter 配置 其他 Filter 不再演示 spring.datasource.filter.stat.db-type=h2 spring."/>

	<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
	<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
	<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
	<link rel="manifest" href="/site.webmanifest">
	<link rel="mask-icon" href="/safari-pinned-tab.svg" color="">
	<link rel="shortcut icon" href="/favicon.ico">

	<title>实现收到IBMMQ的数据之后存储到数据库(微服务系列第五天)</title>
	<link rel="stylesheet" href="https://aomi.run/css/style.min.eac77496566fd7d5768fd650ddb0b2b181ca6a2d7c5fdd6fe6b8ba4bf47e566f.css" integrity="sha256-6sd0llZv19V2j9ZQ3bCysYHKai18X91v5ri6S/R+Vm8=" crossorigin="anonymous">
	
</head>

<body id="page">
	
	<header id="site-header" class="animated slideInUp">
		<div class="hdr-wrapper section-inner">
			<div class="hdr-left">
				<div class="site-branding">
					<a href="https://aomi.run">Aomi</a>
				</div>
				<nav class="site-nav hide-in-mobile">
					
				<a href="https://aomi.run/about/">关于</a>
				<a href="https://aomi.run/posts/">日志</a>
				<a href="https://aomi.run/categories/">分类</a>
				<a href="https://aomi.run/series">专栏</a>
				<a href="https://aomi.run/series/hello-java">微服务</a>
				<a href="https://aomi.run/tags/">TAGS</a>

				</nav>
			</div>
			<div class="hdr-right hdr-icons">
				<button id="toc-btn" class="hdr-btn desktop-only-ib" title="目录"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-list"><line x1="8" y1="6" x2="21" y2="6"></line><line x1="8" y1="12" x2="21" y2="12"></line><line x1="8" y1="18" x2="21" y2="18"></line><line x1="3" y1="6" x2="3" y2="6"></line><line x1="3" y1="12" x2="3" y2="12"></line><line x1="3" y1="18" x2="3" y2="18"></line></svg></button><button id="menu-btn" class="hdr-btn" title="菜单"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg></button>
			</div>
		</div>
	</header>
	<div id="mobile-menu" class="animated fast">
		<ul>
			<li><a href="https://aomi.run/about/">关于</a></li>
			<li><a href="https://aomi.run/posts/">日志</a></li>
			<li><a href="https://aomi.run/categories/">分类</a></li>
			<li><a href="https://aomi.run/series">专栏</a></li>
			<li><a href="https://aomi.run/series/hello-java">微服务</a></li>
			<li><a href="https://aomi.run/tags/">TAGS</a></li>
		</ul>
	</div>


	<main class="site-main section-inner animated fadeIn faster">
		<article class="thin">
			<header class="post-header">
				<div class="post-meta"><span>2021-02-01</span></div>
				<h1>实现收到IBMMQ的数据之后存储到数据库(微服务系列第五天)</h1>
			</header>
			<div class="content">
				<h2 id="前言">前言<a href="#前言" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>
<p>今天的目标是： 实现收到MQ队列消息，实现收到IBMMQ的数据之后存储到数据库。</p>
<blockquote>
<p>注意!!! 这是个学习使用mybatis的示例工程,正式项目则不应该如此做,耦合很严重.正确的做法是把消息发送到topic上面,由存储服务去topic上面取数据再做保存,这样就可以解耦了.</p>
</blockquote>
<h2 id="修改mqserver项目">修改mqserver项目<a href="#修改mqserver项目" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>
<h3 id="pomxml">pom.xml<a href="#pomxml" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<h4 id="添加依赖">添加依赖<a href="#添加依赖" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h4>
<p>此处用的是阿里的连接池 druid</p>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml">		<span class="nt">&lt;dependency&gt;</span>
			<span class="nt">&lt;groupId&gt;</span>org.mybatis.spring.boot<span class="nt">&lt;/groupId&gt;</span>
			<span class="nt">&lt;artifactId&gt;</span>mybatis-spring-boot-starter<span class="nt">&lt;/artifactId&gt;</span>
			<span class="nt">&lt;version&gt;</span>2.1.4<span class="nt">&lt;/version&gt;</span>
		<span class="nt">&lt;/dependency&gt;</span>
		<span class="nt">&lt;dependency&gt;</span>
			<span class="nt">&lt;groupId&gt;</span>mysql<span class="nt">&lt;/groupId&gt;</span>
			<span class="nt">&lt;artifactId&gt;</span>mysql-connector-java<span class="nt">&lt;/artifactId&gt;</span>
			<span class="nt">&lt;scope&gt;</span>runtime<span class="nt">&lt;/scope&gt;</span>
		<span class="nt">&lt;/dependency&gt;</span>
		<span class="nt">&lt;dependency&gt;</span>
			<span class="nt">&lt;groupId&gt;</span>com.alibaba<span class="nt">&lt;/groupId&gt;</span>
			<span class="nt">&lt;artifactId&gt;</span>druid<span class="nt">&lt;/artifactId&gt;</span>
			<span class="nt">&lt;version&gt;</span>1.2.4<span class="nt">&lt;/version&gt;</span>
		<span class="nt">&lt;/dependency&gt;</span>
</code></pre></div><h3 id="jdbc-配置">JDBC 配置<a href="#jdbc-配置" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<p>这个是从官网例子上拿来的配置数据</p>
<div class="highlight"><pre class="chroma"><code class="language-ini" data-lang="ini">
<span class="c1"># 只有下面三个是必填项（使用内嵌数据库的话这三个也可以不用填，会使用默认配置），其他配置不是必须的</span>
<span class="na">spring.datasource.url</span><span class="o">=</span><span class="s">jdbc:mysql://172.25.0.2:3306/db1</span>
<span class="na">spring.datasource.username</span><span class="o">=</span><span class="s">root</span>
<span class="na">spring.datasource.password</span><span class="o">=</span><span class="s">123456</span>
<span class="c1"># driver-class-name 非必填可根据url推断</span>
<span class="na">spring.datasource.driver-class-name</span><span class="o">=</span><span class="s">com.mysql.cj.jdbc.Driver</span>

<span class="c1"># Druid 数据源配置，继承spring.datasource.* 配置，相同则覆盖</span>
<span class="na">spring.datasource.initial-size</span><span class="o">=</span><span class="s">2</span>
<span class="na">spring.datasource.max-active</span><span class="o">=</span><span class="s">30</span>
<span class="na">spring.datasource.min-idle</span><span class="o">=</span><span class="s">2</span>
<span class="na">spring.datasource.max-wait</span><span class="o">=</span><span class="s">1234</span>
<span class="na">spring.datasource.pool-prepared-statements</span><span class="o">=</span><span class="s">true</span>
<span class="na">spring.datasource.max-pool-prepared-statement-per-connection-size</span><span class="o">=</span><span class="s">5</span>
<span class="c1"># spring.datasource.max-open-prepared-statements= #等价于上面的max-pool-prepared-statement-per-connection-size</span>
<span class="na">spring.datasource.validation-query</span><span class="o">=</span><span class="s">select 1</span>
<span class="na">spring.datasource.validation-query-timeout</span><span class="o">=</span><span class="s">1</span>
<span class="na">spring.datasource.test-on-borrow</span><span class="o">=</span><span class="s">true</span>
<span class="na">spring.datasource.test-on-return</span><span class="o">=</span><span class="s">true</span>
<span class="na">spring.datasource.test-while-idle</span><span class="o">=</span><span class="s">true</span>
<span class="na">spring.datasource.time-between-eviction-runs-millis</span><span class="o">=</span><span class="s">10000</span>
<span class="na">spring.datasource.min-evictable-idle-time-millis</span><span class="o">=</span><span class="s">30001</span>
<span class="na">spring.datasource.async-close-connection-enable</span><span class="o">=</span><span class="s">true</span>


<span class="c1"># spring.datasource.aop-patterns=com.alibaba.spring.boot.demo.service.*</span>

<span class="c1"># 自定义StatFilter 配置 其他 Filter 不再演示</span>
<span class="na">spring.datasource.filter.stat.db-type</span><span class="o">=</span><span class="s">h2</span>
<span class="na">spring.datasource.filter.stat.log-slow-sql</span><span class="o">=</span><span class="s">true</span>
<span class="na">spring.datasource.filter.stat.slow-sql-millis</span><span class="o">=</span><span class="s">2000</span>

<span class="c1"># JPA</span>
<span class="na">spring.jpa.show-sql</span><span class="o">=</span> <span class="s">true</span>
<span class="na">spring.jpa.hibernate.ddl-auto</span><span class="o">=</span><span class="s">create-drop</span>

<span class="c1"># 配置下面参数用于启动监控页面，考虑安全问题，默认是关闭的，按需开启</span>
<span class="na">spring.datasource.stat-view-servlet.enabled</span><span class="o">=</span><span class="s">true</span>
<span class="na">spring.datasource.filter.stat.enabled</span><span class="o">=</span><span class="s">true</span>
<span class="na">spring.datasource.web-stat-filter.enabled</span><span class="o">=</span><span class="s">true</span>

<span class="c1"># 更多配置属性见 DruidDataSource 内成员变量（只要有set方法便支持），或者根据IDE提示，或者查看官方文档</span>
</code></pre></div><h3 id="druid类">Druid类<a href="#druid类" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<p>src/main/java/com/example/dbserver/DruidConfig.java</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Configuration</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">DruidConfig</span> <span class="o">{</span>

    <span class="cm">/**
</span><span class="cm">     * 数据源
</span><span class="cm">     * 
</span><span class="cm">     * @return
</span><span class="cm">     */</span>
    <span class="nd">@Bean</span>
    <span class="nd">@ConfigurationProperties</span><span class="o">(</span><span class="n">prefix</span> <span class="o">=</span> <span class="s">&#34;spring.datasource&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">DataSource</span> <span class="nf">druid</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="n">DruidDataSource</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div><h4 id="测试代码">测试代码<a href="#测试代码" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h4>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java">    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">testDataSourceExists</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="n">assertThat</span><span class="o">(</span><span class="n">dataSource</span><span class="o">).</span><span class="na">isNotNull</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">testDataSourcePropertiesOverridden</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="n">assertThat</span><span class="o">(</span><span class="n">dataSource</span><span class="o">.</span><span class="na">getUrl</span><span class="o">()).</span><span class="na">isEqualTo</span><span class="o">(</span><span class="s">&#34;jdbc:mysql://172.25.0.2:3306/db1&#34;</span><span class="o">);</span>
        <span class="n">assertThat</span><span class="o">(</span><span class="n">dataSource</span><span class="o">.</span><span class="na">getInitialSize</span><span class="o">()).</span><span class="na">isEqualTo</span><span class="o">(</span><span class="n">2</span><span class="o">);</span>
        <span class="n">assertThat</span><span class="o">(</span><span class="n">dataSource</span><span class="o">.</span><span class="na">getMaxActive</span><span class="o">()).</span><span class="na">isEqualTo</span><span class="o">(</span><span class="n">30</span><span class="o">);</span>
        <span class="n">assertThat</span><span class="o">(</span><span class="n">dataSource</span><span class="o">.</span><span class="na">getMinIdle</span><span class="o">()).</span><span class="na">isEqualTo</span><span class="o">(</span><span class="n">2</span><span class="o">);</span>
        <span class="n">assertThat</span><span class="o">(</span><span class="n">dataSource</span><span class="o">.</span><span class="na">getMaxWait</span><span class="o">()).</span><span class="na">isEqualTo</span><span class="o">(</span><span class="n">1234</span><span class="o">);</span>
        <span class="n">assertThat</span><span class="o">(</span><span class="n">dataSource</span><span class="o">.</span><span class="na">isPoolPreparedStatements</span><span class="o">()).</span><span class="na">isTrue</span><span class="o">();</span>
        <span class="c1">//assertThat(dataSource.getMaxOpenPreparedStatements()).isEqualTo(5); //Duplicated with following
</span><span class="c1"></span>        <span class="n">assertThat</span><span class="o">(</span><span class="n">dataSource</span><span class="o">.</span><span class="na">getMaxPoolPreparedStatementPerConnectionSize</span><span class="o">()).</span><span class="na">isEqualTo</span><span class="o">(</span><span class="n">5</span><span class="o">);</span>
        <span class="n">assertThat</span><span class="o">(</span><span class="n">dataSource</span><span class="o">.</span><span class="na">getValidationQuery</span><span class="o">()).</span><span class="na">isEqualTo</span><span class="o">(</span><span class="s">&#34;select 1&#34;</span><span class="o">);</span>
        <span class="n">assertThat</span><span class="o">(</span><span class="n">dataSource</span><span class="o">.</span><span class="na">getValidationQueryTimeout</span><span class="o">()).</span><span class="na">isEqualTo</span><span class="o">(</span><span class="n">1</span><span class="o">);</span>
        <span class="n">assertThat</span><span class="o">(</span><span class="n">dataSource</span><span class="o">.</span><span class="na">isTestWhileIdle</span><span class="o">()).</span><span class="na">isTrue</span><span class="o">();</span>
        <span class="n">assertThat</span><span class="o">(</span><span class="n">dataSource</span><span class="o">.</span><span class="na">isTestOnBorrow</span><span class="o">()).</span><span class="na">isTrue</span><span class="o">();</span>
        <span class="n">assertThat</span><span class="o">(</span><span class="n">dataSource</span><span class="o">.</span><span class="na">isTestOnReturn</span><span class="o">()).</span><span class="na">isTrue</span><span class="o">();</span>
        <span class="n">assertThat</span><span class="o">(</span><span class="n">dataSource</span><span class="o">.</span><span class="na">getTimeBetweenEvictionRunsMillis</span><span class="o">()).</span><span class="na">isEqualTo</span><span class="o">(</span><span class="n">10000</span><span class="o">);</span>
        <span class="n">assertThat</span><span class="o">(</span><span class="n">dataSource</span><span class="o">.</span><span class="na">getMinEvictableIdleTimeMillis</span><span class="o">()).</span><span class="na">isEqualTo</span><span class="o">(</span><span class="n">30001</span><span class="o">);</span>
        <span class="n">assertThat</span><span class="o">(</span><span class="n">dataSource</span><span class="o">.</span><span class="na">isAsyncCloseConnectionEnable</span><span class="o">()).</span><span class="na">isEqualTo</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
    <span class="o">}</span>
</code></pre></div><h3 id="创建消息实体">创建消息实体<a href="#创建消息实体" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<p>这个写法，有点把类当结构体用的感觉
src/main/java/com/example/tarsmqserver/domain/MessageModel.java</p>
<h4 id="正常写法">正常写法<a href="#正常写法" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h4>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MessageModel</span> <span class="o">{</span>
    <span class="cm">/**
</span><span class="cm">     * 消息ID
</span><span class="cm">     */</span>
    <span class="kd">private</span> <span class="kt">long</span> <span class="n">msgid</span><span class="o">;</span>

    <span class="cm">/**
</span><span class="cm">     * 消息内容
</span><span class="cm">     */</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">content</span><span class="o">;</span>

    <span class="cm">/**
</span><span class="cm">     * 消息保存到数据库的时间
</span><span class="cm">     */</span>
    <span class="kd">private</span> <span class="kt">long</span> <span class="n">created</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setContent</span><span class="o">(</span><span class="n">String</span> <span class="n">content</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">content</span> <span class="o">=</span> <span class="n">content</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setCreated</span><span class="o">(</span><span class="kt">long</span> <span class="n">created</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">created</span> <span class="o">=</span> <span class="n">created</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setMsgid</span><span class="o">(</span><span class="kt">long</span> <span class="n">msgid</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">msgid</span> <span class="o">=</span> <span class="n">msgid</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getContent</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">content</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">long</span> <span class="nf">getCreated</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">created</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">long</span> <span class="nf">getMsgid</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">msgid</span><span class="o">;</span>
    <span class="o">}</span>

<span class="o">}</span>
</code></pre></div><h4 id="data-注解写法">@data 注解写法<a href="#data-注解写法" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h4>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Data</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MessageData</span> <span class="o">{</span>
    <span class="cm">/**
</span><span class="cm">     * 消息ID
</span><span class="cm">     */</span>
    <span class="kd">private</span> <span class="kt">long</span> <span class="n">msgid</span><span class="o">;</span>

    <span class="cm">/**
</span><span class="cm">     * 消息内容
</span><span class="cm">     */</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">content</span><span class="o">;</span>

    <span class="cm">/**
</span><span class="cm">     * 消息保存到数据库的时间
</span><span class="cm">     */</span>
    <span class="kd">private</span> <span class="kt">long</span> <span class="n">created</span><span class="o">;</span>

<span class="o">}</span>
</code></pre></div><p>两种方法都能通过测试</p>
<h3 id="创建-mapper">创建 mapper<a href="#创建-mapper" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<p>src/main/java/com/example/tarsmqserver/dao/MessageMapper.java</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Repository</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">MessageMapper</span> <span class="o">{</span>
    <span class="cm">/**
</span><span class="cm">     * 从nsq的topic获取到数据保存到db中存储
</span><span class="cm">     * @param msg
</span><span class="cm">     */</span>
    <span class="nd">@Insert</span><span class="o">(</span><span class="s">&#34;insert into message (content,created) values (#{content},#{created})&#34;</span><span class="o">)</span>
    <span class="kt">void</span> <span class="nf">save</span><span class="o">(</span><span class="n">Message</span> <span class="n">msg</span><span class="o">);</span>

    <span class="cm">/**
</span><span class="cm">     * 从nsq的topic获取到数据保存到db中存储       测试@data写法数据的提交
</span><span class="cm">     * @param msg
</span><span class="cm">     */</span>
    <span class="nd">@Insert</span><span class="o">(</span><span class="s">&#34;insert into message (content,created) values (#{content},#{created})&#34;</span><span class="o">)</span>
    <span class="kt">void</span> <span class="nf">saveData</span><span class="o">(</span><span class="n">MessageData</span> <span class="n">msg</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div><h3 id="创建服务">创建服务<a href="#创建服务" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<h4 id="服务接口">服务接口<a href="#服务接口" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h4>
<p>src/main/java/com/example/tarsmqserver/service/MessageService.java</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">MessageService</span> <span class="o">{</span>
    <span class="cm">/**
</span><span class="cm">     * 从nsq的topic获取到数据保存到db中存储
</span><span class="cm">     */</span>
    <span class="kt">void</span> <span class="nf">save</span><span class="o">(</span><span class="n">Message</span> <span class="n">msg</span><span class="o">);</span>
    <span class="kt">void</span> <span class="nf">saveData</span><span class="o">(</span><span class="n">MessageData</span> <span class="n">msg</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div><h4 id="接口实现">接口实现<a href="#接口实现" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h4>
<p>src/main/java/com/example/tarsmqserver/service/MessageServiceImpl.java</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Component</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MessageServiceImpl</span> <span class="kd">implements</span> <span class="n">MessageService</span> <span class="o">{</span>

    <span class="nd">@Autowired</span>
    <span class="n">MessageMapper</span> <span class="n">messageMapper</span><span class="o">;</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">save</span><span class="o">(</span><span class="n">Message</span> <span class="n">msg</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// TODO Auto-generated method stub
</span><span class="c1"></span>        <span class="n">messageMapper</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">msg</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">saveData</span><span class="o">(</span><span class="n">MessageData</span> <span class="n">msg</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// TODO Auto-generated method stub
</span><span class="c1"></span>        <span class="n">messageMapper</span><span class="o">.</span><span class="na">saveData</span><span class="o">(</span><span class="n">msg</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div><h3 id="修改-main">修改 main<a href="#修改-main" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<p>主要是添加注解 <code>@MapperScan(&quot;com.example.dbserver.dao&quot;)</code> 意思是让 mybatis 怎么去找到这个文件，然后产生绑定关系</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@SpringBootApplication</span>
<span class="nd">@EnableTarsServer</span>
<span class="nd">@MapperScan</span><span class="o">(</span><span class="s">&#34;com.example.tarsmqserver.dao&#34;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TarsMqServerApplication</span> <span class="o">{</span>

	<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
		<span class="c1">// 关闭 spring boot 自带的web服务 目前场景只用到了rpc服务
</span><span class="c1"></span>		<span class="n">SpringApplication</span> <span class="n">app</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SpringApplication</span><span class="o">(</span><span class="n">TarsMqServerApplication</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
		<span class="n">app</span><span class="o">.</span><span class="na">setWebApplicationType</span><span class="o">(</span><span class="n">WebApplicationType</span><span class="o">.</span><span class="na">NONE</span><span class="o">);</span>
		<span class="n">app</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="n">args</span><span class="o">);</span>
	<span class="o">}</span>

<span class="o">}</span>
</code></pre></div><h3 id="测试用例">测试用例<a href="#测试用例" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java">    <span class="nd">@Autowired</span>
    <span class="n">MessageServiceImpl</span> <span class="n">imp</span><span class="o">;</span>

    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">saveMessage</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">Message</span> <span class="n">message</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Message</span><span class="o">();</span>
        <span class="n">message</span><span class="o">.</span><span class="na">setContent</span><span class="o">(</span><span class="s">&#34;abcdefg&#34;</span><span class="o">);</span>
        <span class="n">message</span><span class="o">.</span><span class="na">setCreated</span><span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">());</span>
        <span class="n">imp</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">message</span><span class="o">);</span>
    <span class="o">}</span>
</code></pre></div><h3 id="修改-mqserver">修改 mqserver<a href="#修改-mqserver" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<p>src/main/java/com/example/tarsmqserver/service/mqserver/ConsumerListener.java</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java">    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="n">NsqConfig</span> <span class="n">nsqConfig</span><span class="o">;</span>

    <span class="cm">/**
</span><span class="cm">     * 使用JmsListener配置消费者监听的队列
</span><span class="cm">     * 
</span><span class="cm">     * @param receivedMsg 接收到的消息
</span><span class="cm">     */</span>
    <span class="nd">@JmsListener</span><span class="o">(</span><span class="n">destination</span> <span class="o">=</span> <span class="s">&#34;#{@conf.recvQueueName}&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">receiveQueue</span><span class="o">(</span><span class="n">String</span> <span class="n">receivedMsg</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">JMS_LISTENER</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&#34;RECEIVE: {}&#34;</span><span class="o">,</span> <span class="n">receivedMsg</span><span class="o">);</span>

        <span class="n">MessageModel</span> <span class="n">messagObject</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MessageModel</span><span class="o">();</span>
        <span class="n">messagObject</span><span class="o">.</span><span class="na">setContent</span><span class="o">(</span><span class="n">receivedMsg</span><span class="o">);</span>
        <span class="n">messagObject</span><span class="o">.</span><span class="na">setCreated</span><span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">());</span>

        <span class="k">try</span> <span class="o">{</span>
            <span class="n">imp</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">messagObject</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
            <span class="n">JMS_LISTENER</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="n">e</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
            <span class="c1">//TODO: handle exception
</span><span class="c1"></span>        <span class="o">}</span>
    <span class="o">}</span>
</code></pre></div><h3 id="打包上传测试观察">打包/上传/测试/观察<a href="#打包上传测试观察" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">$ make build-upload
</code></pre></div><p>随意发了一个消息，返回如下</p>
<pre><code class="language-log" data-lang="log">2021-02-01 19:38:57.002 INFO 3376 --- [ageObjAdapter-1] MQSERVER : send: DEV.QUEUE.1 -&gt; qqqqqqqqqq
2021-02-01 19:38:57.148 INFO 3376 --- [enerContainer-1] JMS_LISTENER : RECEIVE: qqqqqqqqqq
2021-02-01 19:38:57.465 INFO 3376 --- [ nsq-batch-0] com.sproutsocial.nsq.Connection : connected 172.25.0.213:4150 msgTimeout:60000 heartbeatInterval:30000 maxRdyCount:2500
2021-02-01 19:38:57.467 INFO 3376 --- [ nsq-batch-0] com.sproutsocial.nsq.Publisher : publisher connected:172.25.0.213:4150
</code></pre><p>服务正常收到消息,查看数据库,也能看到数据正常被添加上,数据库表自行创建即可.</p>
<h2 id="源代码">源代码<a href="#源代码" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>
<p><a href="https://github.com/aomirun/demo/tree/main/day-5/tars-mq-server">实现收到IBMMQ的数据之后存储到数据库(微服务系列第五天)</a></p>
<h2 id="结语">结语<a href="#结语" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>
<p>spring boot 2.x 对于快餐使用,还是很友好的,封装了很多东西,很多东西拿来就可以直接用.但对于真正去掌控,估计会很复杂.这个只有等技术深入后,再慢慢探究.
不过Java是真的吃内存,可能是用JVM的原因吧.这个时候我就比较想念GO了,相同的功能,对资源占用少得多.</p>

			</div>

<div class="related-posts thin">
	<h2>相关推荐</h2>
	<ul>
	
	<li><a href="/posts/java/hello-java-4-day/">实现java的rsa加解密与签名并调用RPC微服务(微服务系列第四天)</a></li>
	
	<li><a href="/posts/java/hello-java-3-day/">实现客户端同步和异步调用RPC微服务(微服务系列第三天)</a></li>
	
	<li><a href="/posts/java/hello-java-2-day/">实现tars-springboot-ibm-mq的微服务(微服务系列第二天)</a></li>
	
	<li><a href="/posts/java/hello-java-1-day/">通过docker-springboot-tars构建微服务环境(微服务系列第一天)</a></li>
	
	<li><a href="/posts/wsl2-vscode-openjdk-install/">Wsl2 Vscode Openjdk Install</a></li>
	
	</ul>
</div>

			<hr class="post-end">
			<footer class="post-info">
				<p>
					<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7" y2="7"></line></svg><span class="tag"><a href="https://aomi.run/tags/java">java</a></span><span class="tag"><a href="https://aomi.run/tags/docker">docker</a></span><span class="tag"><a href="https://aomi.run/tags/mq">mq</a></span><span class="tag"><a href="https://aomi.run/tags/jms">jms</a></span><span class="tag"><a href="https://aomi.run/tags/tars">tars</a></span><span class="tag"><a href="https://aomi.run/tags/micro-serivce">micro serivce</a></span><span class="tag"><a href="https://aomi.run/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1">微服务</a></span>
				</p>
				<p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>519 字</p>
				<p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>2021-02-01 18:14 &#43;0800</p>
			</footer>
		</article>
		<aside id="toc">
			<div class="toc-title">目录</div>
			<nav id="TableOfContents">
  <ul>
    <li><a href="#前言">前言</a></li>
    <li><a href="#修改mqserver项目">修改mqserver项目</a>
      <ul>
        <li><a href="#pomxml">pom.xml</a></li>
        <li><a href="#jdbc-配置">JDBC 配置</a></li>
        <li><a href="#druid类">Druid类</a></li>
        <li><a href="#创建消息实体">创建消息实体</a></li>
        <li><a href="#创建-mapper">创建 mapper</a></li>
        <li><a href="#创建服务">创建服务</a></li>
        <li><a href="#修改-main">修改 main</a></li>
        <li><a href="#测试用例">测试用例</a></li>
        <li><a href="#修改-mqserver">修改 mqserver</a></li>
        <li><a href="#打包上传测试观察">打包/上传/测试/观察</a></li>
      </ul>
    </li>
    <li><a href="#源代码">源代码</a></li>
    <li><a href="#结语">结语</a></li>
  </ul>
</nav>
		</aside>
		<div class="post-nav thin">
			<a class="next-post" href="https://aomi.run/posts/micro/kind-k8s-ubuntu2004-wsl/">
				<span class="post-nav-label"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-left"><line x1="19" y1="12" x2="5" y2="12"></line><polyline points="12 19 5 12 12 5"></polyline></svg>&nbsp;新</span><br><span>基于Wsl Ubuntu20.04上安装Kuberneters</span>
			</a>
			<a class="prev-post" href="https://aomi.run/posts/java/hello-java-4-day/">
				<span class="post-nav-label">旧&nbsp;<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><br><span>实现java的rsa加解密与签名并调用RPC微服务(微服务系列第四天)</span>
			</a>
		</div>
		<div id="comments" class="thin">

<script src="https://utteranc.es/client.js"
        repo="aomirun/aomirun.github.io"
        issue-term="title"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script>
<style>
    .utterances {
        max-width:none
    }
</style>


</div>
	</main>

	<footer id="site-footer" class="section-inner thin animated fadeIn faster">
		<p>&copy; 2021 <a href="https://aomi.run">Aomi</a> &#183; <a href="https://aomi.run/about/" target="_blank" rel="noopener">run</a></p>
		<p> &#183; <a href="https://aomi.run/posts/index.xml" target="_blank" title="rss"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a>
		</p>
	</footer>



	<script src="https://aomi.run/js/bundle.min.4a9a0ac3d2217822c7865b4161e6c2a71de1d70492264337755427898dd718f6.js" integrity="sha256-SpoKw9IheCLHhltBYebCpx3h1wSSJkM3dVQniY3XGPY=" crossorigin="anonymous"></script>
	

</body>

</html>
