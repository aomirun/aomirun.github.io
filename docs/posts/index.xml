<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
	<channel>
		<title>æ–‡ç« åˆ—è¡¨ on Aomi</title>
		<link>https://aomi.run/posts/</link>
		<description>Recent content in æ–‡ç« åˆ—è¡¨ on Aomi</description>
		<generator>Hugo -- gohugo.io</generator>
		<language>zh_CN</language>
		<copyright>aomi.run</copyright>
		<lastBuildDate>Mon, 17 May 2021 00:07:31 +0800</lastBuildDate>
		<atom:link href="https://aomi.run/posts/index.xml" rel="self" type="application/rss+xml" />
		
		<item>
			<title>å­¦ä¹  servicecomb gochassis ç¬¬ä¸€å¤©</title>
			<link>https://aomi.run/posts/servicecomb/go/first_day/</link>
			<pubDate>Mon, 17 May 2021 00:07:31 +0800</pubDate>
			
			<guid>https://aomi.run/posts/servicecomb/go/first_day/</guid>
			<description>å­¦ä¹  servicecomb gochassis ç¬¬ä¸€å¤© 1. æœ¬åœ°å®‰è£… &amp;lt;æœåŠ¡ä¸­å¿ƒ ServiceCenter&amp;gt; æˆ‘çš„å­¦ä¹ ç¬”è®¡æ˜¯åŸºäºDockerç¯å¢ƒ,ä½¿ç”¨Docker-composeæ¥ç¼–æ’,å„å¹³å°å¦‚ä½•å®‰è£…Dockerå’Œdocker-composeå¯è‡ªè¡Œæœç´¢å­¦ä¹ .
åˆ›å»º Docker ç½‘ç»œ
$ docker network create -d bridge --subnet=172.27.0.0/16 --gateway=172.27.0.1 aomi åˆ›å»º docker-compose.yml æ–‡ä»¶
version:&amp;#34;3&amp;#34;services:service-center:image:servicecomb/service-centercontainer_name:service-centerports:- &amp;#34;30100:30100&amp;#34;restart:alwaysvolumes:- /etc/localtime:/etc/localtimenetworks:aomi:ipv4_address:172.27.0.2service-frontend:image:servicecomb/scfrontendcontainer_name:service-frontendenvironment:SC_ADDRESS:&amp;#34;service-center&amp;#34;ports:- &amp;#34;30103:30103&amp;#34;restart:alwaysvolumes:- /etc/localtime:/etc/localtimenetworks:aomi:ipv4_address:172.27.0.3networks:aomi:external:trueå¯åŠ¨ç¯å¢ƒ
$ docker-compose up -d è®¿é—®æœ¬åœ°Webç«¯å£ http://127.0.0.1:30103 è§åˆ°å¦‚ä¸‹å›¾,å³å®‰è£…æˆåŠŸ å› ä¹‹å‰åšè¿‡æµ‹è¯•,ä¸Šé¢è·‘äº†ä¸¤ä¸ªæµ‹è¯•æœåŠ¡,è¿™ä¸ªä¸å½±å“.
åˆ›å»ºé¡¹ç›® ç›®å½•å¦‚ä¸‹,é¡¹ç›®å¯ä»¥å»æˆ‘çš„Githubä¸Šé¢ä¸‹è½½ https://github.com/aomirun/gochassis-start
$ tree . â”œâ”€â”€ Makefile â”œâ”€â”€ README.md â”œâ”€â”€ client â”‚ â”œâ”€â”€ Dockerfile â”‚ â”œâ”€â”€ conf â”‚ â”‚ â”œâ”€â”€ chassis.yaml â”‚ â”‚ â””â”€â”€ microservice.yaml â”‚ â””â”€â”€ main.go â”œâ”€â”€ docker-compose.yml â”œâ”€â”€ go.mod â”œâ”€â”€ go.</description>
			<content type="html"><![CDATA[<h2 id="å­¦ä¹ -servicecomb-gochassis-ç¬¬ä¸€å¤©">å­¦ä¹  servicecomb gochassis ç¬¬ä¸€å¤©</h2>
<h3 id="1-æœ¬åœ°å®‰è£…-æœåŠ¡ä¸­å¿ƒ-servicecenter">1. æœ¬åœ°å®‰è£… &lt;æœåŠ¡ä¸­å¿ƒ ServiceCenter&gt;</h3>
<p>æˆ‘çš„å­¦ä¹ ç¬”è®¡æ˜¯åŸºäºDockerç¯å¢ƒ,ä½¿ç”¨Docker-composeæ¥ç¼–æ’,å„å¹³å°å¦‚ä½•å®‰è£…Dockerå’Œdocker-composeå¯è‡ªè¡Œæœç´¢å­¦ä¹ .</p>
<p>åˆ›å»º Docker ç½‘ç»œ</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">$ docker network create -d bridge --subnet<span class="o">=</span>172.27.0.0/16 --gateway<span class="o">=</span>172.27.0.1 aomi
</code></pre></div><p>åˆ›å»º docker-compose.yml æ–‡ä»¶</p>
<div class="highlight"><pre class="chroma"><code class="language-yml" data-lang="yml"><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;3&#34;</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="nt">services</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">service-center</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">servicecomb/service-center</span><span class="w">
</span><span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l">service-center</span><span class="w">
</span><span class="w">    </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- <span class="s2">&#34;30100:30100&#34;</span><span class="w">
</span><span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="l">always</span><span class="w">
</span><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- <span class="l">/etc/localtime:/etc/localtime</span><span class="w">
</span><span class="w">    </span><span class="nt">networks</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="nt">aomi</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="nt">ipv4_address</span><span class="p">:</span><span class="w"> </span><span class="m">172.27.0.2</span><span class="w">
</span><span class="w">  
</span><span class="w">  </span><span class="nt">service-frontend</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">servicecomb/scfrontend</span><span class="w">
</span><span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l">service-frontend</span><span class="w">
</span><span class="w">    </span><span class="nt">environment</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="nt">SC_ADDRESS</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;service-center&#34;</span><span class="w">
</span><span class="w">    </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- <span class="s2">&#34;30103:30103&#34;</span><span class="w">
</span><span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="l">always</span><span class="w">
</span><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- <span class="l">/etc/localtime:/etc/localtime</span><span class="w">
</span><span class="w">    </span><span class="nt">networks</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="nt">aomi</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="nt">ipv4_address</span><span class="p">:</span><span class="w"> </span><span class="m">172.27.0.3</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="nt">networks</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">aomi</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">external</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></code></pre></div><p>å¯åŠ¨ç¯å¢ƒ</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">$ docker-compose up -d
</code></pre></div><p>è®¿é—®æœ¬åœ°Webç«¯å£ http://127.0.0.1:30103
è§åˆ°å¦‚ä¸‹å›¾,å³å®‰è£…æˆåŠŸ
<img src="/images/posts/servicecomb/servicecomb_dashboard.png" alt="servicecomb_dashboard" title="servicecomb_dashboard">
å› ä¹‹å‰åšè¿‡æµ‹è¯•,ä¸Šé¢è·‘äº†ä¸¤ä¸ªæµ‹è¯•æœåŠ¡,è¿™ä¸ªä¸å½±å“.</p>
<h3 id="åˆ›å»ºé¡¹ç›®">åˆ›å»ºé¡¹ç›®</h3>
<p>ç›®å½•å¦‚ä¸‹,é¡¹ç›®å¯ä»¥å»æˆ‘çš„Githubä¸Šé¢ä¸‹è½½ <a href="https://github.com/aomirun/gochassis-start">https://github.com/aomirun/gochassis-start</a></p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">$ tree
.
â”œâ”€â”€ Makefile
â”œâ”€â”€ README.md
â”œâ”€â”€ client
â”‚   â”œâ”€â”€ Dockerfile
â”‚   â”œâ”€â”€ conf
â”‚   â”‚   â”œâ”€â”€ chassis.yaml
â”‚   â”‚   â””â”€â”€ microservice.yaml
â”‚   â””â”€â”€ main.go
â”œâ”€â”€ docker-compose.yml
â”œâ”€â”€ go.mod
â”œâ”€â”€ go.sum
â””â”€â”€ server
    â”œâ”€â”€ Dockerfile
    â”œâ”€â”€ conf
    â”‚   â”œâ”€â”€ chassis.yaml
    â”‚   â””â”€â”€ microservice.yaml
    â””â”€â”€ main.go

<span class="m">4</span> directories, <span class="m">13</span> files

</code></pre></div><ol>
<li>clone</li>
</ol>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">$ git clone https://github.com/aomirun/gochassis-start
</code></pre></div><ol start="2">
<li>start</li>
</ol>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">$ <span class="nb">cd</span> gochassis-start
$ make bd
$ docker-compose up -d
</code></pre></div><ol start="3">
<li>check</li>
</ol>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">$ curl http://127.0.0.1:2002/hi
hello. go chassis
</code></pre></div>]]></content>
		</item>
		
		<item>
			<title>åŸºäºWsl Ubuntu20.04ä¸Šå®‰è£…Kuberneters</title>
			<link>https://aomi.run/posts/micro/kind-k8s-ubuntu2004-wsl/</link>
			<pubDate>Thu, 04 Feb 2021 13:50:02 +0800</pubDate>
			
			<guid>https://aomi.run/posts/micro/kind-k8s-ubuntu2004-wsl/</guid>
			<description>å‰è¨€ win10å¯è°“windowsç³»ç»Ÿå¯¹å¼€å‘äººå‘˜æœ€å‹å¥½çš„ç‰ˆæœ¬äº†,linuxå‘½ä»¤è¡ŒåŠ winçš„æ¡Œé¢ç³»ç»Ÿ,å¼ºå¼ºè”åˆ,æ­£å› ä¸ºè¿™ä¸ªLinuxå­ç³»ç»Ÿ,è®©æœ¬åœ°æµ‹è¯•ç¯å¢ƒæ­å»ºä¸å¼€å‘èµ·é£. ä¸‹é¢å°±é’ˆå¯¹åœ¨wsl2ä¸‹é¢çš„ubuntu20.04ä¸Šé¢å®‰è£…k8så¼€å‘ç¯å¢ƒåšç‚¹è¯´æ˜. åˆ›å»ºæœ¬åœ°k8så¼€å‘ç¯å¢ƒ,ä¸»è¦æ˜¯é€šè¿‡kindæ¥å®ç°
kind å®‰è£… kindï¼ˆKubernetes IN Dockerï¼‰ æ˜¯ä¸€ä¸ªåŸºäº docker æ„å»º Kubernetes é›†ç¾¤çš„å·¥å…·ï¼Œéå¸¸é€‚åˆç”¨æ¥åœ¨æœ¬åœ°æ­å»ºåŸºäº Kubernetes çš„å¼€å‘/æµ‹è¯•ç¯å¢ƒã€‚æ‰€ä»¥åœ¨å®‰è£…kindå‰,æœ€å¥½æŠŠwsl,docker,å›½å†…é•œåƒè¿™äº›å‰ç½®å·¥ä½œå‡†å¤‡å¥½. é€šè¿‡ https://github.com/kubernetes-sigs/kind/releases/latest è·å–æœ€æ–°çš„ releaseï¼Œæ ¹æ®è‡ªå·±çš„ç³»ç»Ÿç±»å‹é€‰æ‹©ç›¸åº”çš„ç³»ç»Ÿ releaseï¼Œä¸‹è½½ release ä¹‹åé‡å‘½åä¸º kindï¼ˆWindows ç³»ç»Ÿ release é‡å‘½åä¸º kind.exe)ï¼Œç„¶åå°†å…¶æ”¾åœ¨æŸä¸€ä¸ªç›®å½•ä¸‹ï¼Œå¹¶è¦ç¡®ä¿è¿™ä¸ªç›®å½•åœ¨ç³»ç»Ÿ PATH ä¸­ä»¥æ–¹ä¾¿çš„ä½¿ç”¨ï¼Œå¯ä»¥æ”¾åœ¨ usr/bin ç›®å½•ä¸‹ï¼ˆé»˜è®¤å·²ç»åœ¨ç³»ç»Ÿ PATH ä¸­ï¼‰ï¼Œlinux ç³»ç»Ÿä¸­å¯èƒ½éœ€è¦é…ç½®æ–‡ä»¶æƒé™
$ sudo chmod +x kind or éœ€è¦æœ¬åœ°æœ‰golangç¯å¢ƒ,å¹¶ä¸”GOPATH/binåœ¨PATHä¸­,å¦‚æœä¸åœ¨,éœ€è¦ export PATH=&amp;quot;$(go env GOPATH)/bin:${PATH}&amp;quot;
$ GO111MODULE=on go get sigs.k8s.io/kind@v0.10.0 æ‹‰å–é•œåƒ kindest/node æœ€æ–°çš„ v0.20.2/v0.19.7 æˆ‘æµ‹è¯•æ—¶æœ‰bug,åæ¥æµ‹è¯•åˆ°v.19.1æ˜¯æ­£å¸¸çš„,æ‰€ä»¥è¿™é‡Œæˆ‘å°±é‡‡ç”¨äº†v1.19.1
$ docker pull kindest/node:v1.19.1 æ“ä½œ Kuberneters é›†ç¾¤ ä½¿ç”¨ kind åˆ›å»º Kubernetes é›†ç¾¤éå¸¸çš„æ–¹ä¾¿ï¼Œåªéœ€è¦ä¸€è¡Œå‘½ä»¤å³å¯
$ kind create cluster #è¿™é‡Œé»˜è®¤æ˜¯ä½¿ç”¨kindçš„é»˜è®¤æœ€æ–°ç‰ˆæœ¬,æˆ‘æµ‹è¯•æ–°ç‰ˆæœ¬æœ‰é—®é¢˜,æ•…æˆ‘æµ‹è¯•çš„æ—¶å€™æŒ‡å®šäº†ä¸‹é¢çš„ç‰ˆæœ¬ or ç‰¹å®šç‰ˆæœ¬</description>
			<content type="html"><![CDATA[<h2 id="å‰è¨€">å‰è¨€</h2>
<p>win10å¯è°“windowsç³»ç»Ÿå¯¹å¼€å‘äººå‘˜æœ€å‹å¥½çš„ç‰ˆæœ¬äº†,linuxå‘½ä»¤è¡ŒåŠ winçš„æ¡Œé¢ç³»ç»Ÿ,å¼ºå¼ºè”åˆ,æ­£å› ä¸ºè¿™ä¸ªLinuxå­ç³»ç»Ÿ,è®©æœ¬åœ°æµ‹è¯•ç¯å¢ƒæ­å»ºä¸å¼€å‘èµ·é£.
ä¸‹é¢å°±é’ˆå¯¹åœ¨wsl2ä¸‹é¢çš„ubuntu20.04ä¸Šé¢å®‰è£…k8så¼€å‘ç¯å¢ƒåšç‚¹è¯´æ˜.
åˆ›å»ºæœ¬åœ°k8så¼€å‘ç¯å¢ƒ,ä¸»è¦æ˜¯é€šè¿‡kindæ¥å®ç°</p>
<h2 id="kind-å®‰è£…">kind å®‰è£…</h2>
<p>kindï¼ˆKubernetes IN Dockerï¼‰ æ˜¯ä¸€ä¸ªåŸºäº docker æ„å»º Kubernetes é›†ç¾¤çš„å·¥å…·ï¼Œéå¸¸é€‚åˆç”¨æ¥åœ¨æœ¬åœ°æ­å»ºåŸºäº Kubernetes çš„å¼€å‘/æµ‹è¯•ç¯å¢ƒã€‚æ‰€ä»¥åœ¨å®‰è£…kindå‰,æœ€å¥½æŠŠwsl,docker,å›½å†…é•œåƒè¿™äº›å‰ç½®å·¥ä½œå‡†å¤‡å¥½.
é€šè¿‡ <a href="https://github.com/kubernetes-sigs/kind/releases/latest">https://github.com/kubernetes-sigs/kind/releases/latest</a> è·å–æœ€æ–°çš„ releaseï¼Œæ ¹æ®è‡ªå·±çš„ç³»ç»Ÿç±»å‹é€‰æ‹©ç›¸åº”çš„ç³»ç»Ÿ releaseï¼Œä¸‹è½½ release ä¹‹åé‡å‘½åä¸º kindï¼ˆWindows ç³»ç»Ÿ release é‡å‘½åä¸º kind.exe)ï¼Œç„¶åå°†å…¶æ”¾åœ¨æŸä¸€ä¸ªç›®å½•ä¸‹ï¼Œå¹¶è¦ç¡®ä¿è¿™ä¸ªç›®å½•åœ¨ç³»ç»Ÿ PATH ä¸­ä»¥æ–¹ä¾¿çš„ä½¿ç”¨ï¼Œå¯ä»¥æ”¾åœ¨ usr/bin ç›®å½•ä¸‹ï¼ˆé»˜è®¤å·²ç»åœ¨ç³»ç»Ÿ PATH ä¸­ï¼‰ï¼Œlinux ç³»ç»Ÿä¸­å¯èƒ½éœ€è¦é…ç½®æ–‡ä»¶æƒé™</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">$ sudo chmod +x kind
</code></pre></div><p>or
éœ€è¦æœ¬åœ°æœ‰golangç¯å¢ƒ,å¹¶ä¸”GOPATH/binåœ¨PATHä¸­,å¦‚æœä¸åœ¨,éœ€è¦ <code>export PATH=&quot;$(go env GOPATH)/bin:${PATH}&quot;</code></p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">$ <span class="nv">GO111MODULE</span><span class="o">=</span>on go get sigs.k8s.io/kind@v0.10.0
</code></pre></div><h2 id="æ‹‰å–é•œåƒ--kindestnode">æ‹‰å–é•œåƒ  kindest/node</h2>
<p>æœ€æ–°çš„ v0.20.2/v0.19.7 æˆ‘æµ‹è¯•æ—¶æœ‰bug,åæ¥æµ‹è¯•åˆ°v.19.1æ˜¯æ­£å¸¸çš„,æ‰€ä»¥è¿™é‡Œæˆ‘å°±é‡‡ç”¨äº†v1.19.1</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">$ docker pull kindest/node:v1.19.1
</code></pre></div><h2 id="æ“ä½œ-kuberneters-é›†ç¾¤">æ“ä½œ Kuberneters é›†ç¾¤</h2>
<p>ä½¿ç”¨ kind åˆ›å»º Kubernetes é›†ç¾¤éå¸¸çš„æ–¹ä¾¿ï¼Œåªéœ€è¦ä¸€è¡Œå‘½ä»¤å³å¯</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">$ kind create cluster <span class="c1">#è¿™é‡Œé»˜è®¤æ˜¯ä½¿ç”¨kindçš„é»˜è®¤æœ€æ–°ç‰ˆæœ¬,æˆ‘æµ‹è¯•æ–°ç‰ˆæœ¬æœ‰é—®é¢˜,æ•…æˆ‘æµ‹è¯•çš„æ—¶å€™æŒ‡å®šäº†ä¸‹é¢çš„ç‰ˆæœ¬</span>
</code></pre></div><p>or ç‰¹å®šç‰ˆæœ¬</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">$ kind create cluster --image kindest/node:v1.19.1
</code></pre></div><h3 id="æˆåŠŸçš„è¿”å›">æˆåŠŸçš„è¿”å›</h3>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">Creating cluster <span class="s2">&#34;kind&#34;</span> ...
 âœ“ Ensuring node image <span class="o">(</span>kindest/node:v1.19.1<span class="o">)</span> ğŸ–¼ 
 âœ“ Preparing nodes ğŸ“¦  
 âœ“ Writing configuration ğŸ“œ 
 âœ“ Starting control-plane ğŸ•¹ï¸ 
 âœ“ Installing CNI ğŸ”Œ 
 âœ“ Installing StorageClass ğŸ’¾ 
Set kubectl context to <span class="s2">&#34;kind-kind&#34;</span>
You can now use your cluster with:

kubectl cluster-info --context kind-kind

Have a question, bug, or feature request? Let us know! https://kind.sigs.k8s.io/#community ğŸ™‚
</code></pre></div><p>åˆ é™¤é›†ç¾¤</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">$ kind delete cluster
</code></pre></div><p>é»˜è®¤é›†ç¾¤åç§°æ˜¯ &ldquo;kind&rdquo;ï¼Œå¦‚æœè¦åˆ›å»ºå¤šä¸ªæˆ–è€…æŒ‡å®šé›†ç¾¤åç§°ï¼Œå¯ä»¥æŒ‡å®š name å‚æ•°ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">$ kind create cluster --name<span class="o">=</span>k8s-cluster1
</code></pre></div><p>åˆ é™¤é›†ç¾¤</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">kind delete cluster --name<span class="o">=</span>k8s-cluster1
</code></pre></div><h2 id="kubectl-å®‰è£…">kubectl å®‰è£…</h2>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">$ sudo apt update 
$ sudo apt upgrade
$ sudo apt install -y apt-transport-https
$ curl -s https://mirrors.aliyun.com/kubernetes/apt/doc/apt-key.gpg <span class="p">|</span> sudo apt-key add -
$ <span class="nb">echo</span> <span class="s2">&#34;deb https://mirrors.aliyun.com/kubernetes/apt/ kubernetes-xenial main&#34;</span> <span class="p">|</span> sudo tee -a /etc/apt/sources.list.d/kubernetes.list
$ sudo apt update
$ sudo apt install -y kubelet kubeadm kubectl
</code></pre></div><p>åˆ›å»ºé›†ç¾¤æˆåŠŸä¹‹åï¼Œå°±å¯ä»¥ä½¿ç”¨ kubectl æ¥æ“ä½œ k8s é›†ç¾¤äº†</p>
<h2 id="æŸ¥çœ‹é›†ç¾¤ä¿¡æ¯">æŸ¥çœ‹é›†ç¾¤ä¿¡æ¯</h2>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">$ kubectl get all --all-namespaces
NAMESPACE            NAME                                             READY   STATUS    RESTARTS   AGE
kube-system          pod/coredns-f9fd979d6-sg289                      1/1     Running   <span class="m">0</span>          6m43s
kube-system          pod/coredns-f9fd979d6-wjksf                      1/1     Running   <span class="m">0</span>          6m43s
kube-system          pod/etcd-kind-control-plane                      1/1     Running   <span class="m">0</span>          6m50s
kube-system          pod/kindnet-9jv9s                                1/1     Running   <span class="m">0</span>          6m44s
kube-system          pod/kube-apiserver-kind-control-plane            1/1     Running   <span class="m">0</span>          6m50s
kube-system          pod/kube-controller-manager-kind-control-plane   1/1     Running   <span class="m">0</span>          6m50s
kube-system          pod/kube-proxy-5fmtx                             1/1     Running   <span class="m">0</span>          6m44s
kube-system          pod/kube-scheduler-kind-control-plane            1/1     Running   <span class="m">0</span>          6m50s
local-path-storage   pod/local-path-provisioner-78776bfc44-fqm22      1/1     Running   <span class="m">0</span>          6m43s

NAMESPACE     NAME                 TYPE        CLUSTER-IP   EXTERNAL-IP   PORT<span class="o">(</span>S<span class="o">)</span>                  AGE
default       service/kubernetes   ClusterIP   10.96.0.1    &lt;none&gt;        443/TCP                  7m3s
kube-system   service/kube-dns     ClusterIP   10.96.0.10   &lt;none&gt;        53/UDP,53/TCP,9153/TCP   7m2s

NAMESPACE     NAME                        DESIRED   CURRENT   READY   UP-TO-DATE   AVAILABLE   NODE SELECTOR            AGE
kube-system   daemonset.apps/kindnet      <span class="m">1</span>         <span class="m">1</span>         <span class="m">1</span>       <span class="m">1</span>            <span class="m">1</span>           &lt;none&gt;                   7m1s
kube-system   daemonset.apps/kube-proxy   <span class="m">1</span>         <span class="m">1</span>         <span class="m">1</span>       <span class="m">1</span>            <span class="m">1</span>           kubernetes.io/os<span class="o">=</span>linux   7m2s

NAMESPACE            NAME                                     READY   UP-TO-DATE   AVAILABLE   AGE
kube-system          deployment.apps/coredns                  2/2     <span class="m">2</span>            <span class="m">2</span>           7m2s
local-path-storage   deployment.apps/local-path-provisioner   1/1     <span class="m">1</span>            <span class="m">1</span>           7m1s

NAMESPACE            NAME                                                DESIRED   CURRENT   READY   AGE
kube-system          replicaset.apps/coredns-f9fd979d6                   <span class="m">2</span>         <span class="m">2</span>         <span class="m">2</span>       6m44s
local-path-storage   replicaset.apps/local-path-provisioner-78776bfc44   <span class="m">1</span>         <span class="m">1</span>         <span class="m">1</span>       6m44s
</code></pre></div><h2 id="æŸ¥çœ‹å®¹å™¨å†…éƒ¨å®¹å™¨åˆ—è¡¨">æŸ¥çœ‹å®¹å™¨å†…éƒ¨å®¹å™¨åˆ—è¡¨</h2>
<p>è·å–è¿™ä¸ªå®¹å™¨å†…éƒ¨çš„è¿è¡Œå®¹å™¨åˆ—è¡¨ï¼Œè¿™ä¸ªå®¹å™¨å†…éƒ¨é€šè¿‡ crictl æ¥æ“ä½œå®¹å™¨ï¼Œå¯ä»¥å‚è€ƒ <a href="https://github.com/kubernetes-sigs/cri-tools">https://github.com/kubernetes-sigs/cri-tools</a></p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">$ docker <span class="nb">exec</span> kind-control-plane crictl ps
CONTAINER           IMAGE               CREATED             STATE               NAME                      ATTEMPT             POD ID
03496f54d192d       bfe3a36ebd252       <span class="m">8</span> minutes ago       Running             coredns                   <span class="m">0</span>                   e170783fe655f
f2874e6f6eba7       bfe3a36ebd252       <span class="m">8</span> minutes ago       Running             coredns                   <span class="m">0</span>                   f2d4a12df3a93
178d427a80a68       e422121c9c5f9       <span class="m">8</span> minutes ago       Running             local-path-provisioner    <span class="m">0</span>                   1600c76f4bc03
d019fbe2d252a       b77790820d015       <span class="m">8</span> minutes ago       Running             kindnet-cni               <span class="m">0</span>                   f94e9d590d2ea
d8bc5b5bf64ea       47e289e332426       <span class="m">8</span> minutes ago       Running             kube-proxy                <span class="m">0</span>                   84ff49f7a0532
a2e91623770af       0369cf4303ffd       <span class="m">8</span> minutes ago       Running             etcd                      <span class="m">0</span>                   d680864effc4a
753ad7868585a       7dafbafe72c90       <span class="m">8</span> minutes ago       Running             kube-controller-manager   <span class="m">0</span>                   c0325d328da3d
a246720f380f2       4d648fc900179       <span class="m">8</span> minutes ago       Running             kube-scheduler            <span class="m">0</span>                   af718164f1b76
7a499ab5ae3f2       8cba89a89aaa8       <span class="m">8</span> minutes ago       Running             kube-apiserver            <span class="m">0</span>                   735ec1dcd8891
</code></pre></div><p>kind åˆ›å»ºé›†ç¾¤æˆåŠŸä¹‹åï¼Œå°±å¯ä»¥å‘ kubernetes é›†ç¾¤éƒ¨ç½²èµ„æºäº†ï¼Œå¼€å§‹ä½ çš„ Kubernetes ä¹‹æ—…å§~</p>
<h2 id="kindåˆ›å»ºä»ªè¡¨æ¿">Kindï¼šåˆ›å»ºä»ªè¡¨æ¿</h2>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">$ kubectl apply -f https://raw.githubusercontent.com/kubernetes/dashboard/v2.0.0/aio/deploy/recommended.yaml
</code></pre></div><p>æ‰§è¡Œä¸Šé¢å‘½ä»¤å¦‚æœç¢°åˆ°äº†å¦‚ä¸‹æƒ…å†µ,å°±åˆ°<a href="https://github.com/kubernetes/dashboard/blob/master/aio/deploy/recommended.yaml">github</a>ä¸Šé¢çœ‹æºä»£ç ,è‡ªå·±æœ¬åœ°å»ºä¸€ä¸ªæ¥ä½¿ç”¨.</p>
<pre><code>The connection to the server raw.githubusercontent.com was refused - did you specify the right host or port?
</code></pre><p>æ–°å»ºä¸€ä¸ªç”¨æˆ·kindæ”¾è„šæœ¬çš„ç›®å½•</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">$ mkdir ~/kind <span class="o">&amp;&amp;</span> <span class="nb">cd</span> ~/kind <span class="o">&amp;&amp;</span> touch recommended.yaml
<span class="c1"># æŠŠå†…å®¹å¤åˆ¶åˆ°recommended.yamlä¸­,ç„¶åæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤</span>

$ kubectl apply -f recommended.yaml
namespace/kubernetes-dashboard created
serviceaccount/kubernetes-dashboard created
service/kubernetes-dashboard created
secret/kubernetes-dashboard-certs created
secret/kubernetes-dashboard-csrf created
secret/kubernetes-dashboard-key-holder created
configmap/kubernetes-dashboard-settings created
role.rbac.authorization.k8s.io/kubernetes-dashboard created
clusterrole.rbac.authorization.k8s.io/kubernetes-dashboard created
rolebinding.rbac.authorization.k8s.io/kubernetes-dashboard created
clusterrolebinding.rbac.authorization.k8s.io/kubernetes-dashboard created
deployment.apps/kubernetes-dashboard created
service/dashboard-metrics-scraper created
deployment.apps/dashboard-metrics-scraper created
</code></pre></div><h3 id="åˆ›å»ºdashboard-adminuseryaml">åˆ›å»ºdashboard-adminuser.yaml</h3>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">$ cat &gt; dashboard-adminuser.yaml <span class="s">&lt;&lt; EOF
</span><span class="s">apiVersion: v1
</span><span class="s">kind: ServiceAccount
</span><span class="s">metadata:
</span><span class="s">  name: admin-user
</span><span class="s">  namespace: kubernetes-dashboard
</span><span class="s">
</span><span class="s">---
</span><span class="s">apiVersion: rbac.authorization.k8s.io/v1
</span><span class="s">kind: ClusterRoleBinding
</span><span class="s">metadata:
</span><span class="s">  name: admin-user
</span><span class="s">roleRef:
</span><span class="s">  apiGroup: rbac.authorization.k8s.io
</span><span class="s">  kind: ClusterRole
</span><span class="s">  name: cluster-admin
</span><span class="s">subjects:
</span><span class="s">- kind: ServiceAccount
</span><span class="s">  name: admin-user
</span><span class="s">  namespace: kubernetes-dashboard  
</span><span class="s">EOF</span>
</code></pre></div><h3 id="åˆ›å»ºç™»å½•ç”¨æˆ·">åˆ›å»ºç™»å½•ç”¨æˆ·</h3>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">$ kubectl apply -f dashboard-adminuser.yaml
</code></pre></div><p>è¯´æ˜ï¼šä¸Šé¢åˆ›å»ºäº†ä¸€ä¸ªå«admin-userçš„æœåŠ¡è´¦å·ï¼Œå¹¶æ”¾åœ¨kubernetes-dashboard å‘½åç©ºé—´ä¸‹ï¼Œå¹¶å°†cluster-adminè§’è‰²ç»‘å®šåˆ°admin-userè´¦æˆ·ï¼Œè¿™æ ·admin-userè´¦æˆ·å°±æœ‰äº†ç®¡ç†å‘˜çš„æƒé™ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œkubeadmåˆ›å»ºé›†ç¾¤æ—¶å·²ç»åˆ›å»ºäº†cluster-adminè§’è‰²ï¼Œæˆ‘ä»¬ç›´æ¥ç»‘å®šå³å¯ã€‚</p>
<h3 id="æŸ¥çœ‹admin-userè´¦æˆ·çš„token">æŸ¥çœ‹admin-userè´¦æˆ·çš„token</h3>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">$ kubectl -n kubernetes-dashboard describe secret <span class="k">$(</span>kubectl -n kubernetes-dashboard get secret <span class="p">|</span> grep admin-user <span class="p">|</span> awk <span class="s1">&#39;{print $1}&#39;</span><span class="k">)</span>
</code></pre></div><h3 id="åˆ›å»ºæœ¬åœ°ä»£ç†">åˆ›å»ºæœ¬åœ°ä»£ç†</h3>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">$ kubectl proxy
</code></pre></div><p>ç°åœ¨å³å¯ä½¿ç”¨æµè§ˆå™¨æ‰“å¼€</p>
<pre><code>http://localhost:8001/api/v1/namespaces/kubernetes-dashboard/services/https:kubernetes-dashboard:/proxy/
</code></pre><p>è¾“å…¥åˆšåˆšè·å–åˆ°çš„token,ç‚¹ç™»å½•,å³å¯è¿›å…¥.
<img src="/images/posts/k8s/k8s-dashboard.png" alt=""></p>
<h2 id="å®‰è£…helm">å®‰è£…helm</h2>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">$ curl https://baltocdn.com/helm/signing.asc <span class="p">|</span> sudo apt-key add -   
$ sudo apt install apt-transport-https --yes
$ <span class="nb">echo</span> <span class="s2">&#34;deb https://baltocdn.com/helm/stable/debian/ all main&#34;</span> <span class="p">|</span> sudo tee /etc/apt/sources.list.d/helm-stable-debian.list
$ sudo apt update
$ sudo apt install helm
$ helm version
version.BuildInfo<span class="o">{</span>Version:<span class="s2">&#34;v3.5.2&#34;</span>, GitCommit:<span class="s2">&#34;167aac70832d3a384f65f9745335e9fb40169dc2&#34;</span>, GitTreeState:<span class="s2">&#34;dirty&#34;</span>, GoVersion:<span class="s2">&#34;go1.15.7&#34;</span><span class="o">}</span>
</code></pre></div><h2 id="å®‰è£…ingress-nginx">å®‰è£…ingress-nginx</h2>
<p>è¿™é‡Œä¼šç”¨åˆ°k8s.gcr.ioçš„dockeré•œåƒï¼Œè¯·ç”¨ä¸­ç§‘å¤§é•œåƒåŠ é€Ÿ</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">$ helm repo add ingress-nginx https://kubernetes.github.io/ingress-nginx
$ helm repo update

$ helm install ingress-nginx ingress-nginx/ingress-nginx
</code></pre></div><h2 id="ç»“è¯­">ç»“è¯­</h2>
<p>è‡³æ­¤ï¼Œk8sçš„æœ¬åœ°å¼€å‘ç¯å¢ƒå°±åˆ›å»ºå¥½äº†ï¼Œåç»­å°±æ˜¯å¾€é‡ŒåŠ ä¸œè¥¿äº†ã€‚</p>
]]></content>
		</item>
		
		<item>
			<title>å®ç°æ”¶åˆ°IBMMQçš„æ•°æ®ä¹‹åå­˜å‚¨åˆ°æ•°æ®åº“(å¾®æœåŠ¡ç³»åˆ—ç¬¬äº”å¤©)</title>
			<link>https://aomi.run/posts/java/hello-java-5-day/</link>
			<pubDate>Mon, 01 Feb 2021 18:14:10 +0800</pubDate>
			
			<guid>https://aomi.run/posts/java/hello-java-5-day/</guid>
			<description>å‰è¨€ ä»Šå¤©çš„ç›®æ ‡æ˜¯ï¼š å®ç°æ”¶åˆ°MQé˜Ÿåˆ—æ¶ˆæ¯ï¼Œå®ç°æ”¶åˆ°IBMMQçš„æ•°æ®ä¹‹åå­˜å‚¨åˆ°æ•°æ®åº“ã€‚
 æ³¨æ„!!! è¿™æ˜¯ä¸ªå­¦ä¹ ä½¿ç”¨mybatisçš„ç¤ºä¾‹å·¥ç¨‹,æ­£å¼é¡¹ç›®åˆ™ä¸åº”è¯¥å¦‚æ­¤åš,è€¦åˆå¾ˆä¸¥é‡.æ­£ç¡®çš„åšæ³•æ˜¯æŠŠæ¶ˆæ¯å‘é€åˆ°topicä¸Šé¢,ç”±å­˜å‚¨æœåŠ¡å»topicä¸Šé¢å–æ•°æ®å†åšä¿å­˜,è¿™æ ·å°±å¯ä»¥è§£è€¦äº†.
 ä¿®æ”¹mqserveré¡¹ç›® pom.xml æ·»åŠ ä¾èµ– æ­¤å¤„ç”¨çš„æ˜¯é˜¿é‡Œçš„è¿æ¥æ±  druid
&amp;lt;dependency&amp;gt; &amp;lt;groupId&amp;gt;org.mybatis.spring.boot&amp;lt;/groupId&amp;gt; &amp;lt;artifactId&amp;gt;mybatis-spring-boot-starter&amp;lt;/artifactId&amp;gt; &amp;lt;version&amp;gt;2.1.4&amp;lt;/version&amp;gt; &amp;lt;/dependency&amp;gt; &amp;lt;dependency&amp;gt; &amp;lt;groupId&amp;gt;mysql&amp;lt;/groupId&amp;gt; &amp;lt;artifactId&amp;gt;mysql-connector-java&amp;lt;/artifactId&amp;gt; &amp;lt;scope&amp;gt;runtime&amp;lt;/scope&amp;gt; &amp;lt;/dependency&amp;gt; &amp;lt;dependency&amp;gt; &amp;lt;groupId&amp;gt;com.alibaba&amp;lt;/groupId&amp;gt; &amp;lt;artifactId&amp;gt;druid&amp;lt;/artifactId&amp;gt; &amp;lt;version&amp;gt;1.2.4&amp;lt;/version&amp;gt; &amp;lt;/dependency&amp;gt; JDBC é…ç½® è¿™ä¸ªæ˜¯ä»å®˜ç½‘ä¾‹å­ä¸Šæ‹¿æ¥çš„é…ç½®æ•°æ®
# åªæœ‰ä¸‹é¢ä¸‰ä¸ªæ˜¯å¿…å¡«é¡¹ï¼ˆä½¿ç”¨å†…åµŒæ•°æ®åº“çš„è¯è¿™ä¸‰ä¸ªä¹Ÿå¯ä»¥ä¸ç”¨å¡«ï¼Œä¼šä½¿ç”¨é»˜è®¤é…ç½®ï¼‰ï¼Œå…¶ä»–é…ç½®ä¸æ˜¯å¿…é¡»çš„ spring.datasource.url=jdbc:mysql://172.25.0.2:3306/db1 spring.datasource.username=root spring.datasource.password=123456 # driver-class-name éå¿…å¡«å¯æ ¹æ®urlæ¨æ–­ spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver # Druid æ•°æ®æºé…ç½®ï¼Œç»§æ‰¿spring.datasource.* é…ç½®ï¼Œç›¸åŒåˆ™è¦†ç›– spring.datasource.initial-size=2 spring.datasource.max-active=30 spring.datasource.min-idle=2 spring.datasource.max-wait=1234 spring.datasource.pool-prepared-statements=true spring.datasource.max-pool-prepared-statement-per-connection-size=5 # spring.datasource.max-open-prepared-statements= #ç­‰ä»·äºä¸Šé¢çš„max-pool-prepared-statement-per-connection-size spring.datasource.validation-query=select 1 spring.datasource.validation-query-timeout=1 spring.datasource.test-on-borrow=true spring.datasource.test-on-return=true spring.datasource.test-while-idle=true spring.datasource.time-between-eviction-runs-millis=10000 spring.datasource.min-evictable-idle-time-millis=30001 spring.datasource.async-close-connection-enable=true # spring.datasource.aop-patterns=com.alibaba.spring.boot.demo.service.* # è‡ªå®šä¹‰StatFilter é…ç½® å…¶ä»– Filter ä¸å†æ¼”ç¤º spring.datasource.filter.stat.db-type=h2 spring.</description>
			<content type="html"><![CDATA[<h2 id="å‰è¨€">å‰è¨€</h2>
<p>ä»Šå¤©çš„ç›®æ ‡æ˜¯ï¼š å®ç°æ”¶åˆ°MQé˜Ÿåˆ—æ¶ˆæ¯ï¼Œå®ç°æ”¶åˆ°IBMMQçš„æ•°æ®ä¹‹åå­˜å‚¨åˆ°æ•°æ®åº“ã€‚</p>
<blockquote>
<p>æ³¨æ„!!! è¿™æ˜¯ä¸ªå­¦ä¹ ä½¿ç”¨mybatisçš„ç¤ºä¾‹å·¥ç¨‹,æ­£å¼é¡¹ç›®åˆ™ä¸åº”è¯¥å¦‚æ­¤åš,è€¦åˆå¾ˆä¸¥é‡.æ­£ç¡®çš„åšæ³•æ˜¯æŠŠæ¶ˆæ¯å‘é€åˆ°topicä¸Šé¢,ç”±å­˜å‚¨æœåŠ¡å»topicä¸Šé¢å–æ•°æ®å†åšä¿å­˜,è¿™æ ·å°±å¯ä»¥è§£è€¦äº†.</p>
</blockquote>
<h2 id="ä¿®æ”¹mqserveré¡¹ç›®">ä¿®æ”¹mqserveré¡¹ç›®</h2>
<h3 id="pomxml">pom.xml</h3>
<h4 id="æ·»åŠ ä¾èµ–">æ·»åŠ ä¾èµ–</h4>
<p>æ­¤å¤„ç”¨çš„æ˜¯é˜¿é‡Œçš„è¿æ¥æ±  druid</p>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml">		<span class="nt">&lt;dependency&gt;</span>
			<span class="nt">&lt;groupId&gt;</span>org.mybatis.spring.boot<span class="nt">&lt;/groupId&gt;</span>
			<span class="nt">&lt;artifactId&gt;</span>mybatis-spring-boot-starter<span class="nt">&lt;/artifactId&gt;</span>
			<span class="nt">&lt;version&gt;</span>2.1.4<span class="nt">&lt;/version&gt;</span>
		<span class="nt">&lt;/dependency&gt;</span>
		<span class="nt">&lt;dependency&gt;</span>
			<span class="nt">&lt;groupId&gt;</span>mysql<span class="nt">&lt;/groupId&gt;</span>
			<span class="nt">&lt;artifactId&gt;</span>mysql-connector-java<span class="nt">&lt;/artifactId&gt;</span>
			<span class="nt">&lt;scope&gt;</span>runtime<span class="nt">&lt;/scope&gt;</span>
		<span class="nt">&lt;/dependency&gt;</span>
		<span class="nt">&lt;dependency&gt;</span>
			<span class="nt">&lt;groupId&gt;</span>com.alibaba<span class="nt">&lt;/groupId&gt;</span>
			<span class="nt">&lt;artifactId&gt;</span>druid<span class="nt">&lt;/artifactId&gt;</span>
			<span class="nt">&lt;version&gt;</span>1.2.4<span class="nt">&lt;/version&gt;</span>
		<span class="nt">&lt;/dependency&gt;</span>
</code></pre></div><h3 id="jdbc-é…ç½®">JDBC é…ç½®</h3>
<p>è¿™ä¸ªæ˜¯ä»å®˜ç½‘ä¾‹å­ä¸Šæ‹¿æ¥çš„é…ç½®æ•°æ®</p>
<div class="highlight"><pre class="chroma"><code class="language-ini" data-lang="ini">
<span class="c1"># åªæœ‰ä¸‹é¢ä¸‰ä¸ªæ˜¯å¿…å¡«é¡¹ï¼ˆä½¿ç”¨å†…åµŒæ•°æ®åº“çš„è¯è¿™ä¸‰ä¸ªä¹Ÿå¯ä»¥ä¸ç”¨å¡«ï¼Œä¼šä½¿ç”¨é»˜è®¤é…ç½®ï¼‰ï¼Œå…¶ä»–é…ç½®ä¸æ˜¯å¿…é¡»çš„</span>
<span class="na">spring.datasource.url</span><span class="o">=</span><span class="s">jdbc:mysql://172.25.0.2:3306/db1</span>
<span class="na">spring.datasource.username</span><span class="o">=</span><span class="s">root</span>
<span class="na">spring.datasource.password</span><span class="o">=</span><span class="s">123456</span>
<span class="c1"># driver-class-name éå¿…å¡«å¯æ ¹æ®urlæ¨æ–­</span>
<span class="na">spring.datasource.driver-class-name</span><span class="o">=</span><span class="s">com.mysql.cj.jdbc.Driver</span>

<span class="c1"># Druid æ•°æ®æºé…ç½®ï¼Œç»§æ‰¿spring.datasource.* é…ç½®ï¼Œç›¸åŒåˆ™è¦†ç›–</span>
<span class="na">spring.datasource.initial-size</span><span class="o">=</span><span class="s">2</span>
<span class="na">spring.datasource.max-active</span><span class="o">=</span><span class="s">30</span>
<span class="na">spring.datasource.min-idle</span><span class="o">=</span><span class="s">2</span>
<span class="na">spring.datasource.max-wait</span><span class="o">=</span><span class="s">1234</span>
<span class="na">spring.datasource.pool-prepared-statements</span><span class="o">=</span><span class="s">true</span>
<span class="na">spring.datasource.max-pool-prepared-statement-per-connection-size</span><span class="o">=</span><span class="s">5</span>
<span class="c1"># spring.datasource.max-open-prepared-statements= #ç­‰ä»·äºä¸Šé¢çš„max-pool-prepared-statement-per-connection-size</span>
<span class="na">spring.datasource.validation-query</span><span class="o">=</span><span class="s">select 1</span>
<span class="na">spring.datasource.validation-query-timeout</span><span class="o">=</span><span class="s">1</span>
<span class="na">spring.datasource.test-on-borrow</span><span class="o">=</span><span class="s">true</span>
<span class="na">spring.datasource.test-on-return</span><span class="o">=</span><span class="s">true</span>
<span class="na">spring.datasource.test-while-idle</span><span class="o">=</span><span class="s">true</span>
<span class="na">spring.datasource.time-between-eviction-runs-millis</span><span class="o">=</span><span class="s">10000</span>
<span class="na">spring.datasource.min-evictable-idle-time-millis</span><span class="o">=</span><span class="s">30001</span>
<span class="na">spring.datasource.async-close-connection-enable</span><span class="o">=</span><span class="s">true</span>


<span class="c1"># spring.datasource.aop-patterns=com.alibaba.spring.boot.demo.service.*</span>

<span class="c1"># è‡ªå®šä¹‰StatFilter é…ç½® å…¶ä»– Filter ä¸å†æ¼”ç¤º</span>
<span class="na">spring.datasource.filter.stat.db-type</span><span class="o">=</span><span class="s">h2</span>
<span class="na">spring.datasource.filter.stat.log-slow-sql</span><span class="o">=</span><span class="s">true</span>
<span class="na">spring.datasource.filter.stat.slow-sql-millis</span><span class="o">=</span><span class="s">2000</span>

<span class="c1"># JPA</span>
<span class="na">spring.jpa.show-sql</span><span class="o">=</span> <span class="s">true</span>
<span class="na">spring.jpa.hibernate.ddl-auto</span><span class="o">=</span><span class="s">create-drop</span>

<span class="c1"># é…ç½®ä¸‹é¢å‚æ•°ç”¨äºå¯åŠ¨ç›‘æ§é¡µé¢ï¼Œè€ƒè™‘å®‰å…¨é—®é¢˜ï¼Œé»˜è®¤æ˜¯å…³é—­çš„ï¼ŒæŒ‰éœ€å¼€å¯</span>
<span class="na">spring.datasource.stat-view-servlet.enabled</span><span class="o">=</span><span class="s">true</span>
<span class="na">spring.datasource.filter.stat.enabled</span><span class="o">=</span><span class="s">true</span>
<span class="na">spring.datasource.web-stat-filter.enabled</span><span class="o">=</span><span class="s">true</span>

<span class="c1"># æ›´å¤šé…ç½®å±æ€§è§ DruidDataSource å†…æˆå‘˜å˜é‡ï¼ˆåªè¦æœ‰setæ–¹æ³•ä¾¿æ”¯æŒï¼‰ï¼Œæˆ–è€…æ ¹æ®IDEæç¤ºï¼Œæˆ–è€…æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£</span>
</code></pre></div><h3 id="druidç±»">Druidç±»</h3>
<p>src/main/java/com/example/dbserver/DruidConfig.java</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Configuration</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">DruidConfig</span> <span class="o">{</span>

    <span class="cm">/**
</span><span class="cm">     * æ•°æ®æº
</span><span class="cm">     * 
</span><span class="cm">     * @return
</span><span class="cm">     */</span>
    <span class="nd">@Bean</span>
    <span class="nd">@ConfigurationProperties</span><span class="o">(</span><span class="n">prefix</span> <span class="o">=</span> <span class="s">&#34;spring.datasource&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">DataSource</span> <span class="nf">druid</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="n">DruidDataSource</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div><h4 id="æµ‹è¯•ä»£ç ">æµ‹è¯•ä»£ç </h4>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java">    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">testDataSourceExists</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="n">assertThat</span><span class="o">(</span><span class="n">dataSource</span><span class="o">).</span><span class="na">isNotNull</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">testDataSourcePropertiesOverridden</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="n">assertThat</span><span class="o">(</span><span class="n">dataSource</span><span class="o">.</span><span class="na">getUrl</span><span class="o">()).</span><span class="na">isEqualTo</span><span class="o">(</span><span class="s">&#34;jdbc:mysql://172.25.0.2:3306/db1&#34;</span><span class="o">);</span>
        <span class="n">assertThat</span><span class="o">(</span><span class="n">dataSource</span><span class="o">.</span><span class="na">getInitialSize</span><span class="o">()).</span><span class="na">isEqualTo</span><span class="o">(</span><span class="n">2</span><span class="o">);</span>
        <span class="n">assertThat</span><span class="o">(</span><span class="n">dataSource</span><span class="o">.</span><span class="na">getMaxActive</span><span class="o">()).</span><span class="na">isEqualTo</span><span class="o">(</span><span class="n">30</span><span class="o">);</span>
        <span class="n">assertThat</span><span class="o">(</span><span class="n">dataSource</span><span class="o">.</span><span class="na">getMinIdle</span><span class="o">()).</span><span class="na">isEqualTo</span><span class="o">(</span><span class="n">2</span><span class="o">);</span>
        <span class="n">assertThat</span><span class="o">(</span><span class="n">dataSource</span><span class="o">.</span><span class="na">getMaxWait</span><span class="o">()).</span><span class="na">isEqualTo</span><span class="o">(</span><span class="n">1234</span><span class="o">);</span>
        <span class="n">assertThat</span><span class="o">(</span><span class="n">dataSource</span><span class="o">.</span><span class="na">isPoolPreparedStatements</span><span class="o">()).</span><span class="na">isTrue</span><span class="o">();</span>
        <span class="c1">//assertThat(dataSource.getMaxOpenPreparedStatements()).isEqualTo(5); //Duplicated with following
</span><span class="c1"></span>        <span class="n">assertThat</span><span class="o">(</span><span class="n">dataSource</span><span class="o">.</span><span class="na">getMaxPoolPreparedStatementPerConnectionSize</span><span class="o">()).</span><span class="na">isEqualTo</span><span class="o">(</span><span class="n">5</span><span class="o">);</span>
        <span class="n">assertThat</span><span class="o">(</span><span class="n">dataSource</span><span class="o">.</span><span class="na">getValidationQuery</span><span class="o">()).</span><span class="na">isEqualTo</span><span class="o">(</span><span class="s">&#34;select 1&#34;</span><span class="o">);</span>
        <span class="n">assertThat</span><span class="o">(</span><span class="n">dataSource</span><span class="o">.</span><span class="na">getValidationQueryTimeout</span><span class="o">()).</span><span class="na">isEqualTo</span><span class="o">(</span><span class="n">1</span><span class="o">);</span>
        <span class="n">assertThat</span><span class="o">(</span><span class="n">dataSource</span><span class="o">.</span><span class="na">isTestWhileIdle</span><span class="o">()).</span><span class="na">isTrue</span><span class="o">();</span>
        <span class="n">assertThat</span><span class="o">(</span><span class="n">dataSource</span><span class="o">.</span><span class="na">isTestOnBorrow</span><span class="o">()).</span><span class="na">isTrue</span><span class="o">();</span>
        <span class="n">assertThat</span><span class="o">(</span><span class="n">dataSource</span><span class="o">.</span><span class="na">isTestOnReturn</span><span class="o">()).</span><span class="na">isTrue</span><span class="o">();</span>
        <span class="n">assertThat</span><span class="o">(</span><span class="n">dataSource</span><span class="o">.</span><span class="na">getTimeBetweenEvictionRunsMillis</span><span class="o">()).</span><span class="na">isEqualTo</span><span class="o">(</span><span class="n">10000</span><span class="o">);</span>
        <span class="n">assertThat</span><span class="o">(</span><span class="n">dataSource</span><span class="o">.</span><span class="na">getMinEvictableIdleTimeMillis</span><span class="o">()).</span><span class="na">isEqualTo</span><span class="o">(</span><span class="n">30001</span><span class="o">);</span>
        <span class="n">assertThat</span><span class="o">(</span><span class="n">dataSource</span><span class="o">.</span><span class="na">isAsyncCloseConnectionEnable</span><span class="o">()).</span><span class="na">isEqualTo</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
    <span class="o">}</span>
</code></pre></div><h3 id="åˆ›å»ºæ¶ˆæ¯å®ä½“">åˆ›å»ºæ¶ˆæ¯å®ä½“</h3>
<p>è¿™ä¸ªå†™æ³•ï¼Œæœ‰ç‚¹æŠŠç±»å½“ç»“æ„ä½“ç”¨çš„æ„Ÿè§‰
src/main/java/com/example/tarsmqserver/domain/MessageModel.java</p>
<h4 id="æ­£å¸¸å†™æ³•">æ­£å¸¸å†™æ³•</h4>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MessageModel</span> <span class="o">{</span>
    <span class="cm">/**
</span><span class="cm">     * æ¶ˆæ¯ID
</span><span class="cm">     */</span>
    <span class="kd">private</span> <span class="kt">long</span> <span class="n">msgid</span><span class="o">;</span>

    <span class="cm">/**
</span><span class="cm">     * æ¶ˆæ¯å†…å®¹
</span><span class="cm">     */</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">content</span><span class="o">;</span>

    <span class="cm">/**
</span><span class="cm">     * æ¶ˆæ¯ä¿å­˜åˆ°æ•°æ®åº“çš„æ—¶é—´
</span><span class="cm">     */</span>
    <span class="kd">private</span> <span class="kt">long</span> <span class="n">created</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setContent</span><span class="o">(</span><span class="n">String</span> <span class="n">content</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">content</span> <span class="o">=</span> <span class="n">content</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setCreated</span><span class="o">(</span><span class="kt">long</span> <span class="n">created</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">created</span> <span class="o">=</span> <span class="n">created</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setMsgid</span><span class="o">(</span><span class="kt">long</span> <span class="n">msgid</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">msgid</span> <span class="o">=</span> <span class="n">msgid</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getContent</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">content</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">long</span> <span class="nf">getCreated</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">created</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">long</span> <span class="nf">getMsgid</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">msgid</span><span class="o">;</span>
    <span class="o">}</span>

<span class="o">}</span>
</code></pre></div><h4 id="data-æ³¨è§£å†™æ³•">@data æ³¨è§£å†™æ³•</h4>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Data</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MessageData</span> <span class="o">{</span>
    <span class="cm">/**
</span><span class="cm">     * æ¶ˆæ¯ID
</span><span class="cm">     */</span>
    <span class="kd">private</span> <span class="kt">long</span> <span class="n">msgid</span><span class="o">;</span>

    <span class="cm">/**
</span><span class="cm">     * æ¶ˆæ¯å†…å®¹
</span><span class="cm">     */</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">content</span><span class="o">;</span>

    <span class="cm">/**
</span><span class="cm">     * æ¶ˆæ¯ä¿å­˜åˆ°æ•°æ®åº“çš„æ—¶é—´
</span><span class="cm">     */</span>
    <span class="kd">private</span> <span class="kt">long</span> <span class="n">created</span><span class="o">;</span>

<span class="o">}</span>
</code></pre></div><p>ä¸¤ç§æ–¹æ³•éƒ½èƒ½é€šè¿‡æµ‹è¯•</p>
<h3 id="åˆ›å»º-mapper">åˆ›å»º mapper</h3>
<p>src/main/java/com/example/tarsmqserver/dao/MessageMapper.java</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Repository</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">MessageMapper</span> <span class="o">{</span>
    <span class="cm">/**
</span><span class="cm">     * ä»nsqçš„topicè·å–åˆ°æ•°æ®ä¿å­˜åˆ°dbä¸­å­˜å‚¨
</span><span class="cm">     * @param msg
</span><span class="cm">     */</span>
    <span class="nd">@Insert</span><span class="o">(</span><span class="s">&#34;insert into message (content,created) values (#{content},#{created})&#34;</span><span class="o">)</span>
    <span class="kt">void</span> <span class="nf">save</span><span class="o">(</span><span class="n">Message</span> <span class="n">msg</span><span class="o">);</span>

    <span class="cm">/**
</span><span class="cm">     * ä»nsqçš„topicè·å–åˆ°æ•°æ®ä¿å­˜åˆ°dbä¸­å­˜å‚¨       æµ‹è¯•@dataå†™æ³•æ•°æ®çš„æäº¤
</span><span class="cm">     * @param msg
</span><span class="cm">     */</span>
    <span class="nd">@Insert</span><span class="o">(</span><span class="s">&#34;insert into message (content,created) values (#{content},#{created})&#34;</span><span class="o">)</span>
    <span class="kt">void</span> <span class="nf">saveData</span><span class="o">(</span><span class="n">MessageData</span> <span class="n">msg</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div><h3 id="åˆ›å»ºæœåŠ¡">åˆ›å»ºæœåŠ¡</h3>
<h4 id="æœåŠ¡æ¥å£">æœåŠ¡æ¥å£</h4>
<p>src/main/java/com/example/tarsmqserver/service/MessageService.java</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">MessageService</span> <span class="o">{</span>
    <span class="cm">/**
</span><span class="cm">     * ä»nsqçš„topicè·å–åˆ°æ•°æ®ä¿å­˜åˆ°dbä¸­å­˜å‚¨
</span><span class="cm">     */</span>
    <span class="kt">void</span> <span class="nf">save</span><span class="o">(</span><span class="n">Message</span> <span class="n">msg</span><span class="o">);</span>
    <span class="kt">void</span> <span class="nf">saveData</span><span class="o">(</span><span class="n">MessageData</span> <span class="n">msg</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div><h4 id="æ¥å£å®ç°">æ¥å£å®ç°</h4>
<p>src/main/java/com/example/tarsmqserver/service/MessageServiceImpl.java</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Component</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MessageServiceImpl</span> <span class="kd">implements</span> <span class="n">MessageService</span> <span class="o">{</span>

    <span class="nd">@Autowired</span>
    <span class="n">MessageMapper</span> <span class="n">messageMapper</span><span class="o">;</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">save</span><span class="o">(</span><span class="n">Message</span> <span class="n">msg</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// TODO Auto-generated method stub
</span><span class="c1"></span>        <span class="n">messageMapper</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">msg</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">saveData</span><span class="o">(</span><span class="n">MessageData</span> <span class="n">msg</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// TODO Auto-generated method stub
</span><span class="c1"></span>        <span class="n">messageMapper</span><span class="o">.</span><span class="na">saveData</span><span class="o">(</span><span class="n">msg</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div><h3 id="ä¿®æ”¹-main">ä¿®æ”¹ main</h3>
<p>ä¸»è¦æ˜¯æ·»åŠ æ³¨è§£ <code>@MapperScan(&quot;com.example.dbserver.dao&quot;)</code> æ„æ€æ˜¯è®© mybatis æ€ä¹ˆå»æ‰¾åˆ°è¿™ä¸ªæ–‡ä»¶ï¼Œç„¶åäº§ç”Ÿç»‘å®šå…³ç³»</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@SpringBootApplication</span>
<span class="nd">@EnableTarsServer</span>
<span class="nd">@MapperScan</span><span class="o">(</span><span class="s">&#34;com.example.tarsmqserver.dao&#34;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TarsMqServerApplication</span> <span class="o">{</span>

	<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
		<span class="c1">// å…³é—­ spring boot è‡ªå¸¦çš„webæœåŠ¡ ç›®å‰åœºæ™¯åªç”¨åˆ°äº†rpcæœåŠ¡
</span><span class="c1"></span>		<span class="n">SpringApplication</span> <span class="n">app</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SpringApplication</span><span class="o">(</span><span class="n">TarsMqServerApplication</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
		<span class="n">app</span><span class="o">.</span><span class="na">setWebApplicationType</span><span class="o">(</span><span class="n">WebApplicationType</span><span class="o">.</span><span class="na">NONE</span><span class="o">);</span>
		<span class="n">app</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="n">args</span><span class="o">);</span>
	<span class="o">}</span>

<span class="o">}</span>
</code></pre></div><h3 id="æµ‹è¯•ç”¨ä¾‹">æµ‹è¯•ç”¨ä¾‹</h3>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java">    <span class="nd">@Autowired</span>
    <span class="n">MessageServiceImpl</span> <span class="n">imp</span><span class="o">;</span>

    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">saveMessage</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">Message</span> <span class="n">message</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Message</span><span class="o">();</span>
        <span class="n">message</span><span class="o">.</span><span class="na">setContent</span><span class="o">(</span><span class="s">&#34;abcdefg&#34;</span><span class="o">);</span>
        <span class="n">message</span><span class="o">.</span><span class="na">setCreated</span><span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">());</span>
        <span class="n">imp</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">message</span><span class="o">);</span>
    <span class="o">}</span>
</code></pre></div><h3 id="ä¿®æ”¹-mqserver">ä¿®æ”¹ mqserver</h3>
<p>src/main/java/com/example/tarsmqserver/service/mqserver/ConsumerListener.java</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java">    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="n">NsqConfig</span> <span class="n">nsqConfig</span><span class="o">;</span>

    <span class="cm">/**
</span><span class="cm">     * ä½¿ç”¨JmsListeneré…ç½®æ¶ˆè´¹è€…ç›‘å¬çš„é˜Ÿåˆ—
</span><span class="cm">     * 
</span><span class="cm">     * @param receivedMsg æ¥æ”¶åˆ°çš„æ¶ˆæ¯
</span><span class="cm">     */</span>
    <span class="nd">@JmsListener</span><span class="o">(</span><span class="n">destination</span> <span class="o">=</span> <span class="s">&#34;#{@conf.recvQueueName}&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">receiveQueue</span><span class="o">(</span><span class="n">String</span> <span class="n">receivedMsg</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">JMS_LISTENER</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&#34;RECEIVE: {}&#34;</span><span class="o">,</span> <span class="n">receivedMsg</span><span class="o">);</span>

        <span class="n">MessageModel</span> <span class="n">messagObject</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MessageModel</span><span class="o">();</span>
        <span class="n">messagObject</span><span class="o">.</span><span class="na">setContent</span><span class="o">(</span><span class="n">receivedMsg</span><span class="o">);</span>
        <span class="n">messagObject</span><span class="o">.</span><span class="na">setCreated</span><span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">());</span>

        <span class="k">try</span> <span class="o">{</span>
            <span class="n">imp</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">messagObject</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
            <span class="n">JMS_LISTENER</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="n">e</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
            <span class="c1">//TODO: handle exception
</span><span class="c1"></span>        <span class="o">}</span>
    <span class="o">}</span>
</code></pre></div><h3 id="æ‰“åŒ…ä¸Šä¼ æµ‹è¯•è§‚å¯Ÿ">æ‰“åŒ…/ä¸Šä¼ /æµ‹è¯•/è§‚å¯Ÿ</h3>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">$ make build-upload
</code></pre></div><p>éšæ„å‘äº†ä¸€ä¸ªæ¶ˆæ¯ï¼Œè¿”å›å¦‚ä¸‹</p>
<pre><code class="language-log" data-lang="log">2021-02-01 19:38:57.002 INFO 3376 --- [ageObjAdapter-1] MQSERVER : send: DEV.QUEUE.1 -&gt; qqqqqqqqqq
2021-02-01 19:38:57.148 INFO 3376 --- [enerContainer-1] JMS_LISTENER : RECEIVE: qqqqqqqqqq
2021-02-01 19:38:57.465 INFO 3376 --- [ nsq-batch-0] com.sproutsocial.nsq.Connection : connected 172.25.0.213:4150 msgTimeout:60000 heartbeatInterval:30000 maxRdyCount:2500
2021-02-01 19:38:57.467 INFO 3376 --- [ nsq-batch-0] com.sproutsocial.nsq.Publisher : publisher connected:172.25.0.213:4150
</code></pre><p>æœåŠ¡æ­£å¸¸æ”¶åˆ°æ¶ˆæ¯,æŸ¥çœ‹æ•°æ®åº“,ä¹Ÿèƒ½çœ‹åˆ°æ•°æ®æ­£å¸¸è¢«æ·»åŠ ä¸Š,æ•°æ®åº“è¡¨è‡ªè¡Œåˆ›å»ºå³å¯.</p>
<h2 id="æºä»£ç ">æºä»£ç </h2>
<p><a href="https://github.com/aomirun/demo/tree/main/day-5/tars-mq-server">å®ç°æ”¶åˆ°IBMMQçš„æ•°æ®ä¹‹åå­˜å‚¨åˆ°æ•°æ®åº“(å¾®æœåŠ¡ç³»åˆ—ç¬¬äº”å¤©)</a></p>
<h2 id="ç»“è¯­">ç»“è¯­</h2>
<p>spring boot 2.x å¯¹äºå¿«é¤ä½¿ç”¨,è¿˜æ˜¯å¾ˆå‹å¥½çš„,å°è£…äº†å¾ˆå¤šä¸œè¥¿,å¾ˆå¤šä¸œè¥¿æ‹¿æ¥å°±å¯ä»¥ç›´æ¥ç”¨.ä½†å¯¹äºçœŸæ­£å»æŒæ§,ä¼°è®¡ä¼šå¾ˆå¤æ‚.è¿™ä¸ªåªæœ‰ç­‰æŠ€æœ¯æ·±å…¥å,å†æ…¢æ…¢æ¢ç©¶.
ä¸è¿‡Javaæ˜¯çœŸçš„åƒå†…å­˜,å¯èƒ½æ˜¯ç”¨JVMçš„åŸå› å§.è¿™ä¸ªæ—¶å€™æˆ‘å°±æ¯”è¾ƒæƒ³å¿µGOäº†,ç›¸åŒçš„åŠŸèƒ½,å¯¹èµ„æºå ç”¨å°‘å¾—å¤š.</p>
]]></content>
		</item>
		
		<item>
			<title>å®ç°javaçš„rsaåŠ è§£å¯†ä¸ç­¾åå¹¶è°ƒç”¨RPCå¾®æœåŠ¡(å¾®æœåŠ¡ç³»åˆ—ç¬¬å››å¤©)</title>
			<link>https://aomi.run/posts/java/hello-java-4-day/</link>
			<pubDate>Sun, 31 Jan 2021 15:40:31 +0800</pubDate>
			
			<guid>https://aomi.run/posts/java/hello-java-4-day/</guid>
			<description>å‰è¨€  å­¦ä¹ javaçš„ç¬¬4å¤© å®ç°ç›®æ ‡ï¼š å®ç°javaçš„rsaåŠ è§£å¯†ä¸ç­¾åå¹¶è°ƒç”¨RPCå¾®æœåŠ¡
 å®ç°RSAå·¥å…·ç±» ç”±äºåˆšå¼€å§‹å­¦ä¹ ï¼Œæœ¬è¿‡ç¨‹æ˜¯è¾¹ç½‘ä¸ŠæŠ„ä½œä¸šï¼Œè¾¹ç†è§£ã€‚
JDK1.8 çš„ base64 src/main/java/com/example/rsaserver/utils/JavaBase64Util.java
public class JavaBase64Util { public static final String UTF_8 = &amp;#34;UTF-8&amp;#34;; public static Base64.Encoder encoder; public static Base64.Encoder urlEncoder; public static Base64.Decoder decoder; public static Base64.Decoder urlDecoder; static { encoder = Base64.getEncoder(); urlEncoder = Base64.getUrlEncoder(); decoder = Base64.getDecoder(); urlDecoder = Base64.getUrlDecoder(); } /** * encode * @param bytes * @return byte[] */ public static byte[] encode(final byte[] bytes) { return encoder.</description>
			<content type="html"><![CDATA[<h2 id="å‰è¨€">å‰è¨€</h2>
<blockquote>
<p>å­¦ä¹ javaçš„ç¬¬4å¤© å®ç°ç›®æ ‡ï¼š å®ç°javaçš„rsaåŠ è§£å¯†ä¸ç­¾åå¹¶è°ƒç”¨RPCå¾®æœåŠ¡</p>
</blockquote>
<h2 id="å®ç°rsaå·¥å…·ç±»">å®ç°RSAå·¥å…·ç±»</h2>
<p>ç”±äºåˆšå¼€å§‹å­¦ä¹ ï¼Œæœ¬è¿‡ç¨‹æ˜¯è¾¹ç½‘ä¸ŠæŠ„ä½œä¸šï¼Œè¾¹ç†è§£ã€‚</p>
<h3 id="jdk18-çš„-base64">JDK1.8 çš„ base64</h3>
<p>src/main/java/com/example/rsaserver/utils/JavaBase64Util.java</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">JavaBase64Util</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">UTF_8</span> <span class="o">=</span> <span class="s">&#34;UTF-8&#34;</span><span class="o">;</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="n">Base64</span><span class="o">.</span><span class="na">Encoder</span> <span class="n">encoder</span><span class="o">;</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="n">Base64</span><span class="o">.</span><span class="na">Encoder</span> <span class="n">urlEncoder</span><span class="o">;</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="n">Base64</span><span class="o">.</span><span class="na">Decoder</span> <span class="n">decoder</span><span class="o">;</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="n">Base64</span><span class="o">.</span><span class="na">Decoder</span> <span class="n">urlDecoder</span><span class="o">;</span>

    <span class="kd">static</span> <span class="o">{</span>
        <span class="n">encoder</span> <span class="o">=</span> <span class="n">Base64</span><span class="o">.</span><span class="na">getEncoder</span><span class="o">();</span>
        <span class="n">urlEncoder</span> <span class="o">=</span> <span class="n">Base64</span><span class="o">.</span><span class="na">getUrlEncoder</span><span class="o">();</span>
        <span class="n">decoder</span> <span class="o">=</span> <span class="n">Base64</span><span class="o">.</span><span class="na">getDecoder</span><span class="o">();</span>
        <span class="n">urlDecoder</span> <span class="o">=</span> <span class="n">Base64</span><span class="o">.</span><span class="na">getUrlDecoder</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="cm">/**
</span><span class="cm">     * encode
</span><span class="cm">     * @param bytes
</span><span class="cm">     * @return byte[]
</span><span class="cm">     */</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">byte</span><span class="o">[]</span> <span class="nf">encode</span><span class="o">(</span><span class="kd">final</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">bytes</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">encoder</span><span class="o">.</span><span class="na">encode</span><span class="o">(</span><span class="n">bytes</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="cm">/**
</span><span class="cm">     * encode
</span><span class="cm">     * @param string
</span><span class="cm">     * @return
</span><span class="cm">     */</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="n">String</span> <span class="nf">encode</span><span class="o">(</span><span class="kd">final</span> <span class="n">String</span> <span class="n">string</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">final</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">encode</span> <span class="o">=</span> <span class="n">encode</span><span class="o">(</span><span class="n">string</span><span class="o">.</span><span class="na">getBytes</span><span class="o">());</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="k">return</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="n">encode</span><span class="o">,</span> <span class="n">UTF_8</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="kd">final</span> <span class="n">UnsupportedEncodingException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="cm">/**
</span><span class="cm">     * encode
</span><span class="cm">     * @param bytes
</span><span class="cm">     * @return
</span><span class="cm">     */</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="n">String</span> <span class="nf">encode2String</span><span class="o">(</span><span class="kd">final</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">bytes</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">encoder</span><span class="o">.</span><span class="na">encodeToString</span><span class="o">(</span><span class="n">bytes</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="cm">/**
</span><span class="cm">     * encode
</span><span class="cm">     * @param string
</span><span class="cm">     * @return
</span><span class="cm">     */</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">byte</span><span class="o">[]</span> <span class="nf">encode2Byte</span><span class="o">(</span><span class="kd">final</span> <span class="n">String</span> <span class="n">string</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">encode</span><span class="o">(</span><span class="n">string</span><span class="o">.</span><span class="na">getBytes</span><span class="o">());</span>
    <span class="o">}</span>

    <span class="cm">/**
</span><span class="cm">     * urlEncoder
</span><span class="cm">     * @param bytes
</span><span class="cm">     * @return
</span><span class="cm">     */</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">byte</span><span class="o">[]</span> <span class="nf">urlEncode</span><span class="o">(</span><span class="kd">final</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">bytes</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">urlEncoder</span><span class="o">.</span><span class="na">encode</span><span class="o">(</span><span class="n">bytes</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="cm">/**
</span><span class="cm">     * urlEncoder
</span><span class="cm">     * @param string
</span><span class="cm">     * @return
</span><span class="cm">     */</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="n">String</span> <span class="nf">urlEncode</span><span class="o">(</span><span class="kd">final</span> <span class="n">String</span> <span class="n">string</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">final</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">encode</span> <span class="o">=</span> <span class="n">urlEncode</span><span class="o">(</span><span class="n">string</span><span class="o">.</span><span class="na">getBytes</span><span class="o">());</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="k">return</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="n">encode</span><span class="o">,</span> <span class="n">UTF_8</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="kd">final</span> <span class="n">UnsupportedEncodingException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="cm">/**
</span><span class="cm">     * urlEncoder
</span><span class="cm">     * @param bytes
</span><span class="cm">     * @return
</span><span class="cm">     */</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="n">String</span> <span class="nf">urlEncode2String</span><span class="o">(</span><span class="kd">final</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">bytes</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">urlEncoder</span><span class="o">.</span><span class="na">encodeToString</span><span class="o">(</span><span class="n">bytes</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="cm">/**
</span><span class="cm">     * urlEncoder
</span><span class="cm">     * @param string
</span><span class="cm">     * @return
</span><span class="cm">     */</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">byte</span><span class="o">[]</span> <span class="nf">urlEncode2Byte</span><span class="o">(</span><span class="kd">final</span> <span class="n">String</span> <span class="n">string</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">urlEncode</span><span class="o">(</span><span class="n">string</span><span class="o">.</span><span class="na">getBytes</span><span class="o">());</span>
    <span class="o">}</span>

    <span class="cm">/**
</span><span class="cm">     * decode
</span><span class="cm">     * @param bytes
</span><span class="cm">     * @return
</span><span class="cm">     */</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">byte</span><span class="o">[]</span> <span class="nf">decode</span><span class="o">(</span><span class="kd">final</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">bytes</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">decoder</span><span class="o">.</span><span class="na">decode</span><span class="o">(</span><span class="n">bytes</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="cm">/**
</span><span class="cm">     * decode
</span><span class="cm">     * @param string
</span><span class="cm">     * @return
</span><span class="cm">     */</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">byte</span><span class="o">[]</span> <span class="nf">decode2Byte</span><span class="o">(</span><span class="kd">final</span> <span class="n">String</span> <span class="n">string</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">decoder</span><span class="o">.</span><span class="na">decode</span><span class="o">(</span><span class="n">string</span><span class="o">.</span><span class="na">getBytes</span><span class="o">());</span>
    <span class="o">}</span>

    <span class="cm">/**
</span><span class="cm">     * decode
</span><span class="cm">     * @param bytes
</span><span class="cm">     * @return
</span><span class="cm">     */</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="n">String</span> <span class="nf">decode2String</span><span class="o">(</span><span class="kd">final</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">bytes</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="k">return</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="n">decoder</span><span class="o">.</span><span class="na">decode</span><span class="o">(</span><span class="n">bytes</span><span class="o">),</span> <span class="n">UTF_8</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="kd">final</span> <span class="n">UnsupportedEncodingException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="cm">/**
</span><span class="cm">     * decode
</span><span class="cm">     * @param string
</span><span class="cm">     * @return
</span><span class="cm">     */</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="n">String</span> <span class="nf">decode</span><span class="o">(</span><span class="kd">final</span> <span class="n">String</span> <span class="n">string</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">final</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">decode</span> <span class="o">=</span> <span class="n">decode</span><span class="o">(</span><span class="n">string</span><span class="o">.</span><span class="na">getBytes</span><span class="o">());</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="k">return</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="n">decode</span><span class="o">,</span> <span class="n">UTF_8</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="kd">final</span> <span class="n">UnsupportedEncodingException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="cm">/**
</span><span class="cm">     * urlDecode
</span><span class="cm">     * @param bytes
</span><span class="cm">     * @return
</span><span class="cm">     */</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">byte</span><span class="o">[]</span> <span class="nf">urlDecode</span><span class="o">(</span><span class="kd">final</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">bytes</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">urlDecoder</span><span class="o">.</span><span class="na">decode</span><span class="o">(</span><span class="n">bytes</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="cm">/**
</span><span class="cm">     * urlDecode
</span><span class="cm">     * @param string
</span><span class="cm">     * @return
</span><span class="cm">     */</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">byte</span><span class="o">[]</span> <span class="nf">urlDecode2Byte</span><span class="o">(</span><span class="kd">final</span> <span class="n">String</span> <span class="n">string</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">urlDecode</span><span class="o">(</span><span class="n">string</span><span class="o">.</span><span class="na">getBytes</span><span class="o">());</span>
    <span class="o">}</span>

    <span class="cm">/**
</span><span class="cm">     * urlDecode
</span><span class="cm">     * @param bytes
</span><span class="cm">     * @return
</span><span class="cm">     */</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="n">String</span> <span class="nf">urlDecode2String</span><span class="o">(</span><span class="kd">final</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">bytes</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="k">return</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="n">urlDecode</span><span class="o">(</span><span class="n">bytes</span><span class="o">),</span> <span class="n">UTF_8</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="kd">final</span> <span class="n">UnsupportedEncodingException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="cm">/**
</span><span class="cm">     * urlDecode
</span><span class="cm">     * @param string
</span><span class="cm">     * @return
</span><span class="cm">     */</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="n">String</span> <span class="nf">urlDecode</span><span class="o">(</span><span class="kd">final</span> <span class="n">String</span> <span class="n">string</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">final</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">decode</span> <span class="o">=</span> <span class="n">urlDecode</span><span class="o">(</span><span class="n">string</span><span class="o">.</span><span class="na">getBytes</span><span class="o">());</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="k">return</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="n">decode</span><span class="o">,</span> <span class="n">UTF_8</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="kd">final</span> <span class="n">UnsupportedEncodingException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div><h3 id="ç”Ÿæˆå…¬ç§é’¥">ç”Ÿæˆå…¬ç§é’¥</h3>
<p>src/main/java/com/example/rsaserver/utils/RSAUtils.java</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">RSAUtils</span> <span class="o">{</span>

    <span class="cm">/**
</span><span class="cm">     * åŠ å¯†ç®—æ³•RSA
</span><span class="cm">     */</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">KEY_ALGORITHM</span> <span class="o">=</span> <span class="s">&#34;RSA&#34;</span><span class="o">;</span>

    <span class="cm">/**
</span><span class="cm">     * ç­¾åç®—æ³•
</span><span class="cm">     */</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">SIGNATURE_ALGORITHM</span> <span class="o">=</span> <span class="s">&#34;MD5withRSA&#34;</span><span class="o">;</span>

    <span class="cm">/**
</span><span class="cm">     * è·å–å…¬é’¥çš„key
</span><span class="cm">     */</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">PUBLIC_KEY</span> <span class="o">=</span> <span class="s">&#34;RSAPublicKey&#34;</span><span class="o">;</span>

    <span class="cm">/**
</span><span class="cm">     * è·å–ç§é’¥çš„key
</span><span class="cm">     */</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">PRIVATE_KEY</span> <span class="o">=</span> <span class="s">&#34;RSAPrivateKey&#34;</span><span class="o">;</span>

    <span class="cm">/**
</span><span class="cm">     * RSAæœ€å¤§åŠ å¯†æ˜æ–‡å¤§å°
</span><span class="cm">     */</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">MAX_ENCRYPT_BLOCK</span> <span class="o">=</span> <span class="n">117</span><span class="o">;</span>

    <span class="cm">/**
</span><span class="cm">     * RSAæœ€å¤§è§£å¯†å¯†æ–‡å¤§å°
</span><span class="cm">     */</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">MAX_DECRYPT_BLOCK</span> <span class="o">=</span> <span class="n">128</span><span class="o">;</span>

    <span class="cm">/**
</span><span class="cm">     * RSA ä½æ•° å¦‚æœé‡‡ç”¨2048 ä¸Šé¢æœ€å¤§åŠ å¯†å’Œæœ€å¤§è§£å¯†åˆ™é¡»å¡«å†™: 245 256
</span><span class="cm">     */</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">INITIALIZE_LENGTH</span> <span class="o">=</span> <span class="n">1024</span><span class="o">;</span>

    <span class="cm">/**
</span><span class="cm">     * &lt;p&gt;
</span><span class="cm">     * ç”Ÿæˆå¯†é’¥å¯¹(å…¬é’¥å’Œç§é’¥)
</span><span class="cm">     * &lt;/p&gt;
</span><span class="cm">     * 
</span><span class="cm">     * @return
</span><span class="cm">     * @throws Exception
</span><span class="cm">     */</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="nf">genKeyPair</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="n">KeyPairGenerator</span> <span class="n">keyPairGen</span> <span class="o">=</span> <span class="n">KeyPairGenerator</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="n">KEY_ALGORITHM</span><span class="o">);</span>
        <span class="n">keyPairGen</span><span class="o">.</span><span class="na">initialize</span><span class="o">(</span><span class="n">INITIALIZE_LENGTH</span><span class="o">);</span>
        <span class="n">KeyPair</span> <span class="n">keyPair</span> <span class="o">=</span> <span class="n">keyPairGen</span><span class="o">.</span><span class="na">generateKeyPair</span><span class="o">();</span>
        <span class="n">RSAPublicKey</span> <span class="n">publicKey</span> <span class="o">=</span> <span class="o">(</span><span class="n">RSAPublicKey</span><span class="o">)</span> <span class="n">keyPair</span><span class="o">.</span><span class="na">getPublic</span><span class="o">();</span>
        <span class="n">RSAPrivateKey</span> <span class="n">privateKey</span> <span class="o">=</span> <span class="o">(</span><span class="n">RSAPrivateKey</span><span class="o">)</span> <span class="n">keyPair</span><span class="o">.</span><span class="na">getPrivate</span><span class="o">();</span>
        <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">keyMap</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;(</span><span class="n">2</span><span class="o">);</span>
        <span class="n">keyMap</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">PUBLIC_KEY</span><span class="o">,</span> <span class="n">publicKey</span><span class="o">);</span>
        <span class="n">keyMap</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">PRIVATE_KEY</span><span class="o">,</span> <span class="n">privateKey</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">keyMap</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="cm">/**
</span><span class="cm">     * &lt;p&gt;
</span><span class="cm">     * è·å–ç§é’¥
</span><span class="cm">     * &lt;/p&gt;
</span><span class="cm">     * 
</span><span class="cm">     * @param keyMap å¯†é’¥å¯¹
</span><span class="cm">     * @return
</span><span class="cm">     * @throws Exception
</span><span class="cm">     */</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="n">String</span> <span class="nf">getPrivateKey</span><span class="o">(</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">keyMap</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="n">Key</span> <span class="n">key</span> <span class="o">=</span> <span class="o">(</span><span class="n">Key</span><span class="o">)</span> <span class="n">keyMap</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">PRIVATE_KEY</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">JavaBase64Util</span><span class="o">.</span><span class="na">encode2String</span><span class="o">(</span><span class="n">key</span><span class="o">.</span><span class="na">getEncoded</span><span class="o">());</span>
    <span class="o">}</span>

    <span class="cm">/**
</span><span class="cm">     * &lt;p&gt;
</span><span class="cm">     * è·å–å…¬é’¥
</span><span class="cm">     * &lt;/p&gt;
</span><span class="cm">     * 
</span><span class="cm">     * @param keyMap å¯†é’¥å¯¹
</span><span class="cm">     * @return
</span><span class="cm">     * @throws Exception
</span><span class="cm">     */</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="n">String</span> <span class="nf">getPublicKey</span><span class="o">(</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">keyMap</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="n">Key</span> <span class="n">key</span> <span class="o">=</span> <span class="o">(</span><span class="n">Key</span><span class="o">)</span> <span class="n">keyMap</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">PUBLIC_KEY</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">JavaBase64Util</span><span class="o">.</span><span class="na">encode2String</span><span class="o">(</span><span class="n">key</span><span class="o">.</span><span class="na">getEncoded</span><span class="o">());</span>
    <span class="o">}</span>

<span class="o">}</span>
</code></pre></div><h3 id="æµ‹è¯•-å…¬ç§é’¥ç”Ÿæˆ">æµ‹è¯• å…¬ç§é’¥ç”Ÿæˆ</h3>
<p>src/test/java/com/example/rsaserver/RsaserverApplicationTests.java</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@SpringBootTest</span>
<span class="kd">class</span> <span class="nc">RsaserverApplicationTests</span> <span class="o">{</span>

	<span class="nd">@Test</span>
	<span class="kt">void</span> <span class="nf">genKeyPair</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">try</span> <span class="o">{</span>
			<span class="kd">final</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">keyPair</span> <span class="o">=</span> <span class="n">RSAUtils</span><span class="o">.</span><span class="na">genKeyPair</span><span class="o">();</span>
			<span class="n">assertNotNull</span><span class="o">(</span><span class="n">keyPair</span><span class="o">);</span>

			<span class="n">String</span> <span class="n">publicKey</span> <span class="o">=</span> <span class="n">RSAUtils</span><span class="o">.</span><span class="na">getPublicKey</span><span class="o">(</span><span class="n">keyPair</span><span class="o">);</span>
			<span class="n">String</span> <span class="n">privateKey</span> <span class="o">=</span> <span class="n">RSAUtils</span><span class="o">.</span><span class="na">getPrivateKey</span><span class="o">(</span><span class="n">keyPair</span><span class="o">);</span>
			<span class="n">assertNotNull</span><span class="o">(</span><span class="n">publicKey</span><span class="o">);</span>
			<span class="n">assertNotNull</span><span class="o">(</span><span class="n">privateKey</span><span class="o">);</span>

			<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">&#34;RSAPublicKey base64 string is %s\n&#34;</span><span class="o">,</span> <span class="n">publicKey</span><span class="o">);</span>
			<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">&#34;RSAPrivateKey base64 string is %s\n&#34;</span><span class="o">,</span> <span class="n">privateKey</span><span class="o">);</span>

			<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">&#34;RSAPublicKey byte is %s&#34;</span><span class="o">,</span> <span class="n">keyPair</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">&#34;RSAPublicKey&#34;</span><span class="o">));</span>
			<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">&#34;RSAPublicKey byte is %s&#34;</span><span class="o">,</span> <span class="n">keyPair</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">&#34;RSAPrivateKey&#34;</span><span class="o">));</span>

		<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
			<span class="n">fail</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
		<span class="o">}</span>
	<span class="o">}</span>

<span class="o">}</span>
</code></pre></div><p>è¿è¡Œæµ‹è¯•ä»£ç </p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">$ mvn <span class="nb">test</span>
067509788673<span class="o">[</span>INFO<span class="o">]</span> Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 1.126 s - in com.example.rsaserver.RsaserverApplicationTests
</code></pre></div><p>æµ‹è¯•é€šè¿‡ï¼Œè§‚çœ‹æµ‹è¯•çš„è¾“å‡ºï¼Œbyteå’Œbase64çš„å…¬ç§é’¥éƒ½å·²æ­£å¸¸è¾“å‡º</p>
<h3 id="åŸºäº-byte-çš„åŠ è§£å¯†">åŸºäº byte çš„åŠ è§£å¯†</h3>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java">	<span class="cm">/**
</span><span class="cm">	 * &lt;P&gt;
</span><span class="cm">	 * ç§é’¥è§£å¯†
</span><span class="cm">	 * &lt;/p&gt;
</span><span class="cm">	 * 
</span><span class="cm">	 * @param encryptedData
</span><span class="cm">	 *            å·²åŠ å¯†æ•°æ®
</span><span class="cm">	 * @param privateKey
</span><span class="cm">	 *            ç§é’¥(BASE64ç¼–ç )
</span><span class="cm">	 * @return
</span><span class="cm">	 * @throws Exception
</span><span class="cm">	 */</span>
	<span class="kd">public</span> <span class="kd">static</span> <span class="kt">byte</span><span class="o">[]</span> <span class="nf">decryptByPrivateKey</span><span class="o">(</span><span class="kt">byte</span><span class="o">[]</span> <span class="n">encryptedData</span><span class="o">,</span> <span class="n">String</span> <span class="n">privateKey</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
		<span class="kt">byte</span><span class="o">[]</span> <span class="n">keyBytes</span> <span class="o">=</span> <span class="n">JavaBase64Util</span><span class="o">.</span><span class="na">decode2Byte</span><span class="o">(</span><span class="n">privateKey</span><span class="o">);</span>
		<span class="n">PKCS8EncodedKeySpec</span> <span class="n">pkcs8KeySpec</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PKCS8EncodedKeySpec</span><span class="o">(</span><span class="n">keyBytes</span><span class="o">);</span>
		<span class="n">KeyFactory</span> <span class="n">keyFactory</span> <span class="o">=</span> <span class="n">KeyFactory</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="n">KEY_ALGORITHM</span><span class="o">);</span>
		<span class="n">Key</span> <span class="n">privateK</span> <span class="o">=</span> <span class="n">keyFactory</span><span class="o">.</span><span class="na">generatePrivate</span><span class="o">(</span><span class="n">pkcs8KeySpec</span><span class="o">);</span>
		<span class="n">Cipher</span> <span class="n">cipher</span> <span class="o">=</span> <span class="n">Cipher</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="n">keyFactory</span><span class="o">.</span><span class="na">getAlgorithm</span><span class="o">());</span>
		<span class="n">cipher</span><span class="o">.</span><span class="na">init</span><span class="o">(</span><span class="n">Cipher</span><span class="o">.</span><span class="na">DECRYPT_MODE</span><span class="o">,</span> <span class="n">privateK</span><span class="o">);</span>
		<span class="kt">int</span> <span class="n">inputLen</span> <span class="o">=</span> <span class="n">encryptedData</span><span class="o">.</span><span class="na">length</span><span class="o">;</span>
		<span class="n">ByteArrayOutputStream</span> <span class="n">out</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ByteArrayOutputStream</span><span class="o">();</span>
		<span class="kt">int</span> <span class="n">offSet</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span>
		<span class="kt">byte</span><span class="o">[]</span> <span class="n">cache</span><span class="o">;</span>
		<span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span>
		<span class="c1">// å¯¹æ•°æ®åˆ†æ®µè§£å¯†
</span><span class="c1"></span>		<span class="k">while</span> <span class="o">(</span><span class="n">inputLen</span> <span class="o">-</span> <span class="n">offSet</span> <span class="o">&gt;</span> <span class="n">0</span><span class="o">)</span> <span class="o">{</span>
			<span class="k">if</span> <span class="o">(</span><span class="n">inputLen</span> <span class="o">-</span> <span class="n">offSet</span> <span class="o">&gt;</span> <span class="n">MAX_DECRYPT_BLOCK</span><span class="o">)</span> <span class="o">{</span>
				<span class="n">cache</span> <span class="o">=</span> <span class="n">cipher</span><span class="o">.</span><span class="na">doFinal</span><span class="o">(</span><span class="n">encryptedData</span><span class="o">,</span> <span class="n">offSet</span><span class="o">,</span> <span class="n">MAX_DECRYPT_BLOCK</span><span class="o">);</span>
			<span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
				<span class="n">cache</span> <span class="o">=</span> <span class="n">cipher</span><span class="o">.</span><span class="na">doFinal</span><span class="o">(</span><span class="n">encryptedData</span><span class="o">,</span> <span class="n">offSet</span><span class="o">,</span> <span class="n">inputLen</span> <span class="o">-</span> <span class="n">offSet</span><span class="o">);</span>
			<span class="o">}</span>
			<span class="n">out</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">cache</span><span class="o">,</span> <span class="n">0</span><span class="o">,</span> <span class="n">cache</span><span class="o">.</span><span class="na">length</span><span class="o">);</span>
			<span class="n">i</span><span class="o">++;</span>
			<span class="n">offSet</span> <span class="o">=</span> <span class="n">i</span> <span class="o">*</span> <span class="n">MAX_DECRYPT_BLOCK</span><span class="o">;</span>
		<span class="o">}</span>
		<span class="kt">byte</span><span class="o">[]</span> <span class="n">decryptedData</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="na">toByteArray</span><span class="o">();</span>
		<span class="n">out</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
		<span class="k">return</span> <span class="n">decryptedData</span><span class="o">;</span>
	<span class="o">}</span>
 
	<span class="cm">/**
</span><span class="cm">	 * &lt;p&gt;
</span><span class="cm">	 * å…¬é’¥è§£å¯†
</span><span class="cm">	 * &lt;/p&gt;
</span><span class="cm">	 * 
</span><span class="cm">	 * @param encryptedData
</span><span class="cm">	 *            å·²åŠ å¯†æ•°æ®
</span><span class="cm">	 * @param publicKey
</span><span class="cm">	 *            å…¬é’¥(BASE64ç¼–ç )
</span><span class="cm">	 * @return
</span><span class="cm">	 * @throws Exception
</span><span class="cm">	 */</span>
	<span class="kd">public</span> <span class="kd">static</span> <span class="kt">byte</span><span class="o">[]</span> <span class="nf">decryptByPublicKey</span><span class="o">(</span><span class="kt">byte</span><span class="o">[]</span> <span class="n">encryptedData</span><span class="o">,</span> <span class="n">String</span> <span class="n">publicKey</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
		<span class="kt">byte</span><span class="o">[]</span> <span class="n">keyBytes</span> <span class="o">=</span> <span class="n">JavaBase64Util</span><span class="o">.</span><span class="na">decode2Byte</span><span class="o">(</span><span class="n">publicKey</span><span class="o">);</span>
		<span class="n">X509EncodedKeySpec</span> <span class="n">x509KeySpec</span> <span class="o">=</span> <span class="k">new</span> <span class="n">X509EncodedKeySpec</span><span class="o">(</span><span class="n">keyBytes</span><span class="o">);</span>
		<span class="n">KeyFactory</span> <span class="n">keyFactory</span> <span class="o">=</span> <span class="n">KeyFactory</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="n">KEY_ALGORITHM</span><span class="o">);</span>
		<span class="n">Key</span> <span class="n">publicK</span> <span class="o">=</span> <span class="n">keyFactory</span><span class="o">.</span><span class="na">generatePublic</span><span class="o">(</span><span class="n">x509KeySpec</span><span class="o">);</span>
		<span class="n">Cipher</span> <span class="n">cipher</span> <span class="o">=</span> <span class="n">Cipher</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="n">keyFactory</span><span class="o">.</span><span class="na">getAlgorithm</span><span class="o">());</span>
		<span class="n">cipher</span><span class="o">.</span><span class="na">init</span><span class="o">(</span><span class="n">Cipher</span><span class="o">.</span><span class="na">DECRYPT_MODE</span><span class="o">,</span> <span class="n">publicK</span><span class="o">);</span>
		<span class="kt">int</span> <span class="n">inputLen</span> <span class="o">=</span> <span class="n">encryptedData</span><span class="o">.</span><span class="na">length</span><span class="o">;</span>
		<span class="n">ByteArrayOutputStream</span> <span class="n">out</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ByteArrayOutputStream</span><span class="o">();</span>
		<span class="kt">int</span> <span class="n">offSet</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span>
		<span class="kt">byte</span><span class="o">[]</span> <span class="n">cache</span><span class="o">;</span>
		<span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span>
		<span class="c1">// å¯¹æ•°æ®åˆ†æ®µè§£å¯†
</span><span class="c1"></span>		<span class="k">while</span> <span class="o">(</span><span class="n">inputLen</span> <span class="o">-</span> <span class="n">offSet</span> <span class="o">&gt;</span> <span class="n">0</span><span class="o">)</span> <span class="o">{</span>
			<span class="k">if</span> <span class="o">(</span><span class="n">inputLen</span> <span class="o">-</span> <span class="n">offSet</span> <span class="o">&gt;</span> <span class="n">MAX_DECRYPT_BLOCK</span><span class="o">)</span> <span class="o">{</span>
				<span class="n">cache</span> <span class="o">=</span> <span class="n">cipher</span><span class="o">.</span><span class="na">doFinal</span><span class="o">(</span><span class="n">encryptedData</span><span class="o">,</span> <span class="n">offSet</span><span class="o">,</span> <span class="n">MAX_DECRYPT_BLOCK</span><span class="o">);</span>
			<span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
				<span class="n">cache</span> <span class="o">=</span> <span class="n">cipher</span><span class="o">.</span><span class="na">doFinal</span><span class="o">(</span><span class="n">encryptedData</span><span class="o">,</span> <span class="n">offSet</span><span class="o">,</span> <span class="n">inputLen</span> <span class="o">-</span> <span class="n">offSet</span><span class="o">);</span>
			<span class="o">}</span>
			<span class="n">out</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">cache</span><span class="o">,</span> <span class="n">0</span><span class="o">,</span> <span class="n">cache</span><span class="o">.</span><span class="na">length</span><span class="o">);</span>
			<span class="n">i</span><span class="o">++;</span>
			<span class="n">offSet</span> <span class="o">=</span> <span class="n">i</span> <span class="o">*</span> <span class="n">MAX_DECRYPT_BLOCK</span><span class="o">;</span>
		<span class="o">}</span>
		<span class="kt">byte</span><span class="o">[]</span> <span class="n">decryptedData</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="na">toByteArray</span><span class="o">();</span>
		<span class="n">out</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
		<span class="k">return</span> <span class="n">decryptedData</span><span class="o">;</span>
	<span class="o">}</span>
 
	<span class="cm">/**
</span><span class="cm">	 * &lt;p&gt;
</span><span class="cm">	 * å…¬é’¥åŠ å¯†
</span><span class="cm">	 * &lt;/p&gt;
</span><span class="cm">	 * 
</span><span class="cm">	 * @param data
</span><span class="cm">	 *            æºæ•°æ®
</span><span class="cm">	 * @param publicKey
</span><span class="cm">	 *            å…¬é’¥(BASE64ç¼–ç )
</span><span class="cm">	 * @return
</span><span class="cm">	 * @throws Exception
</span><span class="cm">	 */</span>
	<span class="kd">public</span> <span class="kd">static</span> <span class="kt">byte</span><span class="o">[]</span> <span class="nf">encryptByPublicKey</span><span class="o">(</span><span class="kt">byte</span><span class="o">[]</span> <span class="n">data</span><span class="o">,</span> <span class="n">String</span> <span class="n">publicKey</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
		<span class="kt">byte</span><span class="o">[]</span> <span class="n">keyBytes</span> <span class="o">=</span> <span class="n">JavaBase64Util</span><span class="o">.</span><span class="na">decode2Byte</span><span class="o">(</span><span class="n">publicKey</span><span class="o">);</span>
		<span class="n">X509EncodedKeySpec</span> <span class="n">x509KeySpec</span> <span class="o">=</span> <span class="k">new</span> <span class="n">X509EncodedKeySpec</span><span class="o">(</span><span class="n">keyBytes</span><span class="o">);</span>
		<span class="n">KeyFactory</span> <span class="n">keyFactory</span> <span class="o">=</span> <span class="n">KeyFactory</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="n">KEY_ALGORITHM</span><span class="o">);</span>
		<span class="n">Key</span> <span class="n">publicK</span> <span class="o">=</span> <span class="n">keyFactory</span><span class="o">.</span><span class="na">generatePublic</span><span class="o">(</span><span class="n">x509KeySpec</span><span class="o">);</span>
		<span class="c1">// å¯¹æ•°æ®åŠ å¯†
</span><span class="c1"></span>		<span class="n">Cipher</span> <span class="n">cipher</span> <span class="o">=</span> <span class="n">Cipher</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="n">keyFactory</span><span class="o">.</span><span class="na">getAlgorithm</span><span class="o">());</span>
		<span class="n">cipher</span><span class="o">.</span><span class="na">init</span><span class="o">(</span><span class="n">Cipher</span><span class="o">.</span><span class="na">ENCRYPT_MODE</span><span class="o">,</span> <span class="n">publicK</span><span class="o">);</span>
		<span class="kt">int</span> <span class="n">inputLen</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="na">length</span><span class="o">;</span>
		<span class="n">ByteArrayOutputStream</span> <span class="n">out</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ByteArrayOutputStream</span><span class="o">();</span>
		<span class="kt">int</span> <span class="n">offSet</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span>
		<span class="kt">byte</span><span class="o">[]</span> <span class="n">cache</span><span class="o">;</span>
		<span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span>
		<span class="c1">// å¯¹æ•°æ®åˆ†æ®µåŠ å¯†
</span><span class="c1"></span>		<span class="k">while</span> <span class="o">(</span><span class="n">inputLen</span> <span class="o">-</span> <span class="n">offSet</span> <span class="o">&gt;</span> <span class="n">0</span><span class="o">)</span> <span class="o">{</span>
			<span class="k">if</span> <span class="o">(</span><span class="n">inputLen</span> <span class="o">-</span> <span class="n">offSet</span> <span class="o">&gt;</span> <span class="n">MAX_ENCRYPT_BLOCK</span><span class="o">)</span> <span class="o">{</span>
				<span class="n">cache</span> <span class="o">=</span> <span class="n">cipher</span><span class="o">.</span><span class="na">doFinal</span><span class="o">(</span><span class="n">data</span><span class="o">,</span> <span class="n">offSet</span><span class="o">,</span> <span class="n">MAX_ENCRYPT_BLOCK</span><span class="o">);</span>
			<span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
				<span class="n">cache</span> <span class="o">=</span> <span class="n">cipher</span><span class="o">.</span><span class="na">doFinal</span><span class="o">(</span><span class="n">data</span><span class="o">,</span> <span class="n">offSet</span><span class="o">,</span> <span class="n">inputLen</span> <span class="o">-</span> <span class="n">offSet</span><span class="o">);</span>
			<span class="o">}</span>
			<span class="n">out</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">cache</span><span class="o">,</span> <span class="n">0</span><span class="o">,</span> <span class="n">cache</span><span class="o">.</span><span class="na">length</span><span class="o">);</span>
			<span class="n">i</span><span class="o">++;</span>
			<span class="n">offSet</span> <span class="o">=</span> <span class="n">i</span> <span class="o">*</span> <span class="n">MAX_ENCRYPT_BLOCK</span><span class="o">;</span>
		<span class="o">}</span>
		<span class="kt">byte</span><span class="o">[]</span> <span class="n">encryptedData</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="na">toByteArray</span><span class="o">();</span>
		<span class="n">out</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
		<span class="k">return</span> <span class="n">encryptedData</span><span class="o">;</span>
	<span class="o">}</span>

</code></pre></div><h3 id="åŸºäºå­—ç¬¦ä¸²åŠ è§£å¯†-ä¸Šé¢byteçš„åŒ…è£…">åŸºäºå­—ç¬¦ä¸²åŠ è§£å¯† ä¸Šé¢byteçš„åŒ…è£…</h3>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java">    <span class="cm">/**
</span><span class="cm">     * å…¬é’¥åŠ å¯†
</span><span class="cm">     */</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="n">String</span> <span class="nf">encryptedDataOnJavaByPublicKey</span><span class="o">(</span><span class="n">String</span> <span class="n">data</span><span class="o">,</span> <span class="n">String</span> <span class="n">PUBLICKEY</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">JavaBase64Util</span><span class="o">.</span><span class="na">encode2String</span><span class="o">(</span><span class="n">encryptByPublicKey</span><span class="o">(</span><span class="n">data</span><span class="o">.</span><span class="na">getBytes</span><span class="o">(),</span> <span class="n">PUBLICKEY</span><span class="o">));</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">// TODO Auto-generated catch block
</span><span class="c1"></span>            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">data</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="cm">/**
</span><span class="cm">     * ç§é’¥è§£å¯†
</span><span class="cm">     */</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="n">String</span> <span class="nf">decryptDataOnJavaByPrivateKey</span><span class="o">(</span><span class="n">String</span> <span class="n">data</span><span class="o">,</span> <span class="n">String</span> <span class="n">PRIVATEKEY</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">String</span> <span class="n">temp</span> <span class="o">=</span> <span class="s">&#34;&#34;</span><span class="o">;</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="kt">byte</span><span class="o">[]</span> <span class="n">rs</span> <span class="o">=</span> <span class="n">JavaBase64Util</span><span class="o">.</span><span class="na">decode2Byte</span><span class="o">(</span><span class="n">data</span><span class="o">);</span>
            <span class="n">temp</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="n">RSAUtils</span><span class="o">.</span><span class="na">decryptByPrivateKey</span><span class="o">(</span><span class="n">rs</span><span class="o">,</span> <span class="n">PRIVATEKEY</span><span class="o">),</span> <span class="s">&#34;UTF-8&#34;</span><span class="o">);</span>

        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">temp</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="cm">/**
</span><span class="cm">     * ç§é’¥åŠ å¯†
</span><span class="cm">     */</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="n">String</span> <span class="nf">encryptedDataOnJavaByPrivateKey</span><span class="o">(</span><span class="n">String</span> <span class="n">data</span><span class="o">,</span> <span class="n">String</span> <span class="n">PRIVATEKEY</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">JavaBase64Util</span><span class="o">.</span><span class="na">encode2String</span><span class="o">(</span><span class="n">encryptByPrivateKey</span><span class="o">(</span><span class="n">data</span><span class="o">.</span><span class="na">getBytes</span><span class="o">(),</span> <span class="n">PRIVATEKEY</span><span class="o">));</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">// TODO Auto-generated catch block
</span><span class="c1"></span>            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">data</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="cm">/**
</span><span class="cm">     * å…¬é’¥è§£å¯†
</span><span class="cm">     */</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="n">String</span> <span class="nf">decryptDataOnJavaByPublicKey</span><span class="o">(</span><span class="n">String</span> <span class="n">data</span><span class="o">,</span> <span class="n">String</span> <span class="n">PUBLICKEY</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">String</span> <span class="n">temp</span> <span class="o">=</span> <span class="s">&#34;&#34;</span><span class="o">;</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="kt">byte</span><span class="o">[]</span> <span class="n">rs</span> <span class="o">=</span> <span class="n">JavaBase64Util</span><span class="o">.</span><span class="na">decode2Byte</span><span class="o">(</span><span class="n">data</span><span class="o">);</span>
            <span class="n">temp</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="n">RSAUtils</span><span class="o">.</span><span class="na">decryptByPublicKey</span><span class="o">(</span><span class="n">rs</span><span class="o">,</span> <span class="n">PUBLICKEY</span><span class="o">),</span> <span class="s">&#34;UTF-8&#34;</span><span class="o">);</span>

        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">temp</span><span class="o">;</span>
    <span class="o">}</span>
</code></pre></div><h3 id="æµ‹è¯•-åŠ å¯†ä¸è§£å¯†">æµ‹è¯• åŠ å¯†ä¸è§£å¯†</h3>
<p>è¿™é‡Œçš„å­—ç¬¦ä¸²åŠ å¯†æ˜¯byteåŠ å¯†çš„ä¸€ä¸ªåŒ…è£…ï¼Œæ‰€ä»¥æµ‹è¯•å­—ç¬¦ä¸²åŠ å¯†å°±éƒ½æµ‹è¯•äº†ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java">	<span class="kd">final</span> <span class="kd">private</span> <span class="n">String</span> <span class="n">plain</span> <span class="o">=</span> <span class="s">&#34;å¾…åŠ å¯†å­—ç¬¦ä¸²&#34;</span><span class="o">;</span>

	<span class="nd">@Test</span>
	<span class="kt">void</span> <span class="nf">encodeAndDecode</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">try</span> <span class="o">{</span>
			<span class="kd">final</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">keyPair</span> <span class="o">=</span> <span class="n">RSAUtils</span><span class="o">.</span><span class="na">genKeyPair</span><span class="o">();</span>
			<span class="n">String</span> <span class="n">publicKey</span> <span class="o">=</span> <span class="n">RSAUtils</span><span class="o">.</span><span class="na">getPublicKey</span><span class="o">(</span><span class="n">keyPair</span><span class="o">);</span>
			<span class="n">String</span> <span class="n">privateKey</span> <span class="o">=</span> <span class="n">RSAUtils</span><span class="o">.</span><span class="na">getPrivateKey</span><span class="o">(</span><span class="n">keyPair</span><span class="o">);</span>

			<span class="c1">// å…¬é’¥åŠ å¯†ï¼Œç§é’¥è§£å¯†
</span><span class="c1"></span>			<span class="n">String</span> <span class="n">enData</span> <span class="o">=</span> <span class="n">RSAUtils</span><span class="o">.</span><span class="na">encryptedDataOnJavaByPublicKey</span><span class="o">(</span><span class="n">plain</span><span class="o">,</span> <span class="n">publicKey</span><span class="o">);</span>
			<span class="n">String</span> <span class="n">deData</span> <span class="o">=</span> <span class="n">RSAUtils</span><span class="o">.</span><span class="na">decryptDataOnJavaByPrivateKey</span><span class="o">(</span><span class="n">enData</span><span class="o">,</span> <span class="n">privateKey</span><span class="o">);</span>
			<span class="n">assertEquals</span><span class="o">(</span><span class="n">deData</span><span class="o">,</span> <span class="n">plain</span><span class="o">);</span>

			<span class="c1">// ç§é’¥åŠ å¯†ï¼Œå…¬é’¥è§£å¯†
</span><span class="c1"></span>			<span class="n">enData</span> <span class="o">=</span> <span class="n">RSAUtils</span><span class="o">.</span><span class="na">encryptedDataOnJavaByPrivateKey</span><span class="o">(</span><span class="n">plain</span><span class="o">,</span> <span class="n">privateKey</span><span class="o">);</span>
			<span class="n">deData</span> <span class="o">=</span> <span class="n">RSAUtils</span><span class="o">.</span><span class="na">decryptDataOnJavaByPublicKey</span><span class="o">(</span><span class="n">enData</span><span class="o">,</span> <span class="n">publicKey</span><span class="o">);</span>
			<span class="n">assertEquals</span><span class="o">(</span><span class="n">deData</span><span class="o">,</span> <span class="n">plain</span><span class="o">);</span>
		<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
			<span class="n">fail</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
		<span class="o">}</span>
	<span class="o">}</span>
</code></pre></div><div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">$ mvn <span class="nb">test</span>
</code></pre></div><p>æµ‹è¯•é€šè¿‡</p>
<h3 id="ç­¾åä¸éªŒç­¾">ç­¾åä¸éªŒç­¾</h3>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java">    <span class="cm">/**
</span><span class="cm">     * &lt;p&gt;
</span><span class="cm">     * ç”¨ç§é’¥å¯¹ä¿¡æ¯ç”Ÿæˆæ•°å­—ç­¾åï¼Œé»˜è®¤ç­¾åç®—æ³•ä½¿ç”¨ MD5withRSA
</span><span class="cm">     * &lt;/p&gt;
</span><span class="cm">     * 
</span><span class="cm">     * @param data       å·²åŠ å¯†æ•°æ®
</span><span class="cm">     * @param privateKey ç§é’¥(BASE64ç¼–ç )
</span><span class="cm">     * 
</span><span class="cm">     * @return
</span><span class="cm">     * @throws Exception
</span><span class="cm">     */</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="n">String</span> <span class="nf">sign</span><span class="o">(</span><span class="kt">byte</span><span class="o">[]</span> <span class="n">data</span><span class="o">,</span> <span class="n">String</span> <span class="n">privateKey</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">sign</span><span class="o">(</span><span class="n">data</span><span class="o">,</span> <span class="n">privateKey</span><span class="o">,</span> <span class="n">SIGNATURE_ALGORITHM</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="cm">/**
</span><span class="cm">     * ç”¨ç§é’¥å¯¹ä¿¡æ¯ç”Ÿæˆæ•°å­—ç­¾å
</span><span class="cm">     * 
</span><span class="cm">     * @param data
</span><span class="cm">     * @param privateKey
</span><span class="cm">     * @param algorithm
</span><span class="cm">     * @return
</span><span class="cm">     * @throws Exception
</span><span class="cm">     */</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="n">String</span> <span class="nf">sign</span><span class="o">(</span><span class="kt">byte</span><span class="o">[]</span> <span class="n">data</span><span class="o">,</span> <span class="n">String</span> <span class="n">privateKey</span><span class="o">,</span> <span class="n">String</span> <span class="n">algorithm</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="kt">byte</span><span class="o">[]</span> <span class="n">keyBytes</span> <span class="o">=</span> <span class="n">JavaBase64Util</span><span class="o">.</span><span class="na">decode2Byte</span><span class="o">(</span><span class="n">privateKey</span><span class="o">);</span>
        <span class="n">PKCS8EncodedKeySpec</span> <span class="n">pkcs8KeySpec</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PKCS8EncodedKeySpec</span><span class="o">(</span><span class="n">keyBytes</span><span class="o">);</span>
        <span class="n">KeyFactory</span> <span class="n">keyFactory</span> <span class="o">=</span> <span class="n">KeyFactory</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="n">KEY_ALGORITHM</span><span class="o">);</span>
        <span class="n">PrivateKey</span> <span class="n">privateK</span> <span class="o">=</span> <span class="n">keyFactory</span><span class="o">.</span><span class="na">generatePrivate</span><span class="o">(</span><span class="n">pkcs8KeySpec</span><span class="o">);</span>
        <span class="n">Signature</span> <span class="n">signature</span> <span class="o">=</span> <span class="n">Signature</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="n">algorithm</span><span class="o">);</span>
        <span class="n">signature</span><span class="o">.</span><span class="na">initSign</span><span class="o">(</span><span class="n">privateK</span><span class="o">);</span>
        <span class="n">signature</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">data</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">JavaBase64Util</span><span class="o">.</span><span class="na">encode2String</span><span class="o">(</span><span class="n">signature</span><span class="o">.</span><span class="na">sign</span><span class="o">());</span>
    <span class="o">}</span>

    <span class="cm">/**
</span><span class="cm">     * &lt;p&gt;
</span><span class="cm">     * æ ¡éªŒæ•°å­—ç­¾åï¼Œé»˜è®¤ä½¿ç”¨ MD5withRSA
</span><span class="cm">     * &lt;/p&gt;
</span><span class="cm">     * 
</span><span class="cm">     * @param data      å·²åŠ å¯†æ•°æ®
</span><span class="cm">     * @param publicKey å…¬é’¥(BASE64ç¼–ç )
</span><span class="cm">     * @param sign      æ•°å­—ç­¾å
</span><span class="cm">     * 
</span><span class="cm">     * @return
</span><span class="cm">     * @throws Exception
</span><span class="cm">     * 
</span><span class="cm">     */</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">boolean</span> <span class="nf">verify</span><span class="o">(</span><span class="kt">byte</span><span class="o">[]</span> <span class="n">data</span><span class="o">,</span> <span class="n">String</span> <span class="n">publicKey</span><span class="o">,</span> <span class="n">String</span> <span class="n">sign</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">verify</span><span class="o">(</span><span class="n">data</span><span class="o">,</span> <span class="n">publicKey</span><span class="o">,</span> <span class="n">sign</span><span class="o">,</span> <span class="n">SIGNATURE_ALGORITHM</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="cm">/**
</span><span class="cm">     * æ ¡éªŒæ•°å­—ç­¾å
</span><span class="cm">     * 
</span><span class="cm">     * @param data
</span><span class="cm">     * @param publicKey
</span><span class="cm">     * @param sign
</span><span class="cm">     * @param algorithm
</span><span class="cm">     * @return
</span><span class="cm">     * @throws Exception
</span><span class="cm">     */</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">boolean</span> <span class="nf">verify</span><span class="o">(</span><span class="kt">byte</span><span class="o">[]</span> <span class="n">data</span><span class="o">,</span> <span class="n">String</span> <span class="n">publicKey</span><span class="o">,</span> <span class="n">String</span> <span class="n">sign</span><span class="o">,</span> <span class="n">String</span> <span class="n">algorithm</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="kt">byte</span><span class="o">[]</span> <span class="n">keyBytes</span> <span class="o">=</span> <span class="n">JavaBase64Util</span><span class="o">.</span><span class="na">decode2Byte</span><span class="o">(</span><span class="n">publicKey</span><span class="o">);</span>
        <span class="n">X509EncodedKeySpec</span> <span class="n">keySpec</span> <span class="o">=</span> <span class="k">new</span> <span class="n">X509EncodedKeySpec</span><span class="o">(</span><span class="n">keyBytes</span><span class="o">);</span>
        <span class="n">KeyFactory</span> <span class="n">keyFactory</span> <span class="o">=</span> <span class="n">KeyFactory</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="n">KEY_ALGORITHM</span><span class="o">);</span>
        <span class="n">PublicKey</span> <span class="n">publicK</span> <span class="o">=</span> <span class="n">keyFactory</span><span class="o">.</span><span class="na">generatePublic</span><span class="o">(</span><span class="n">keySpec</span><span class="o">);</span>
        <span class="n">Signature</span> <span class="n">signature</span> <span class="o">=</span> <span class="n">Signature</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="n">algorithm</span><span class="o">);</span>
        <span class="n">signature</span><span class="o">.</span><span class="na">initVerify</span><span class="o">(</span><span class="n">publicK</span><span class="o">);</span>
        <span class="n">signature</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">data</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">signature</span><span class="o">.</span><span class="na">verify</span><span class="o">(</span><span class="n">JavaBase64Util</span><span class="o">.</span><span class="na">decode2Byte</span><span class="o">(</span><span class="n">sign</span><span class="o">));</span>
    <span class="o">}</span>
</code></pre></div><h3 id="æµ‹è¯•-ç­¾åä¸éªŒç­¾">æµ‹è¯• ç­¾åä¸éªŒç­¾</h3>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java">	<span class="nd">@Test</span>
	<span class="kt">void</span> <span class="nf">signAndVerify</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">try</span> <span class="o">{</span>
			<span class="kd">final</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">keyPair</span> <span class="o">=</span> <span class="n">RSAUtils</span><span class="o">.</span><span class="na">genKeyPair</span><span class="o">();</span>
			<span class="n">String</span> <span class="n">publicKey</span> <span class="o">=</span> <span class="n">RSAUtils</span><span class="o">.</span><span class="na">getPublicKey</span><span class="o">(</span><span class="n">keyPair</span><span class="o">);</span>
			<span class="n">String</span> <span class="n">privateKey</span> <span class="o">=</span> <span class="n">RSAUtils</span><span class="o">.</span><span class="na">getPrivateKey</span><span class="o">(</span><span class="n">keyPair</span><span class="o">);</span>

			<span class="c1">// æ­£ç¡®çš„ç­¾åæµ‹è¯•ï¼Œç­¾åå†…å®¹ä¸éªŒè¯ç­¾åçš„å†…å®¹ç›¸ç¬¦
</span><span class="c1"></span>			<span class="n">String</span> <span class="n">enSign</span> <span class="o">=</span> <span class="n">RSAUtils</span><span class="o">.</span><span class="na">sign</span><span class="o">(</span><span class="n">plain</span><span class="o">.</span><span class="na">getBytes</span><span class="o">(),</span> <span class="n">privateKey</span><span class="o">);</span>
			<span class="kt">boolean</span> <span class="n">ok</span> <span class="o">=</span> <span class="n">RSAUtils</span><span class="o">.</span><span class="na">verify</span><span class="o">(</span><span class="n">plain</span><span class="o">.</span><span class="na">getBytes</span><span class="o">(),</span> <span class="n">publicKey</span><span class="o">,</span> <span class="n">enSign</span><span class="o">);</span>
			<span class="n">assertTrue</span><span class="o">(</span><span class="n">ok</span><span class="o">);</span>

			<span class="c1">// é”™è¯¯çš„ç­¾åæµ‹è¯•ï¼Œç­¾åå†…å®¹ä¸éªŒè¯ç­¾åçš„å†…å®¹ä¸ç¬¦åˆ
</span><span class="c1"></span>			<span class="n">String</span> <span class="n">errPlain</span> <span class="o">=</span> <span class="n">plain</span> <span class="o">+</span> <span class="s">&#34;asdfasf&#34;</span><span class="o">;</span>
			<span class="n">enSign</span> <span class="o">=</span> <span class="n">RSAUtils</span><span class="o">.</span><span class="na">sign</span><span class="o">(</span><span class="n">errPlain</span><span class="o">.</span><span class="na">getBytes</span><span class="o">(),</span> <span class="n">privateKey</span><span class="o">);</span>
			<span class="n">ok</span> <span class="o">=</span> <span class="n">RSAUtils</span><span class="o">.</span><span class="na">verify</span><span class="o">(</span><span class="n">plain</span><span class="o">.</span><span class="na">getBytes</span><span class="o">(),</span> <span class="n">publicKey</span><span class="o">,</span> <span class="n">enSign</span><span class="o">);</span>
			<span class="n">assertFalse</span><span class="o">(</span><span class="n">ok</span><span class="o">);</span>

			<span class="c1">// ä½¿ç”¨å…¶å®ƒç­¾åç®—æ³•
</span><span class="c1"></span>			<span class="n">String</span> <span class="n">algorithm</span> <span class="o">=</span> <span class="s">&#34;SHA256withRSA&#34;</span><span class="o">;</span>
			<span class="n">enSign</span> <span class="o">=</span> <span class="n">RSAUtils</span><span class="o">.</span><span class="na">sign</span><span class="o">(</span><span class="n">plain</span><span class="o">.</span><span class="na">getBytes</span><span class="o">(),</span> <span class="n">privateKey</span><span class="o">,</span>  <span class="n">algorithm</span><span class="o">);</span>
			<span class="n">ok</span> <span class="o">=</span> <span class="n">RSAUtils</span><span class="o">.</span><span class="na">verify</span><span class="o">(</span><span class="n">plain</span><span class="o">.</span><span class="na">getBytes</span><span class="o">(),</span> <span class="n">publicKey</span><span class="o">,</span> <span class="n">enSign</span><span class="o">,</span>  <span class="n">algorithm</span><span class="o">);</span>
			<span class="n">assertTrue</span><span class="o">(</span><span class="n">ok</span><span class="o">);</span>
		<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
			<span class="n">fail</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
		<span class="o">}</span>

	<span class="o">}</span>
</code></pre></div><p>è¿è¡Œæµ‹è¯•</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">$ mvn <span class="nb">test</span>
</code></pre></div><p>çœ‹åˆ°å¯ä»¥æµ‹è¯•é€šè¿‡äº†ã€‚</p>
<h3 id="bouncycastle-åŒ…">bouncycastle åŒ…</h3>
<p>ç½‘ä¸ŠæŸ¥æ‰¾èµ„æ–™ï¼Œå‘ç°è¿™ä¸ªåŒ…é’ˆå¯¹åŠ è§£å¯†è¿™ä¸€å—æœ‰ç›¸å½“å¤šçš„åŠŸèƒ½ï¼Œä½†exampleå¾ˆæ—§ï¼Œå¾ˆå¤šAPIéƒ½æœ‰å˜åŒ–äº†ï¼Œç¤ºä¾‹å­¦ä¹ ä»·å€¼ä¸å¤§äº†ï¼Œæ”¹å¤©ç ”ç©¶ã€‚</p>
<h2 id="æŠŠrsaåŠ å…¥åˆ°tarsé¡¹ç›®ä¸­">æŠŠRSAåŠ å…¥åˆ°tarsé¡¹ç›®ä¸­</h2>
<h3 id="tars-æ¥å£">tars æ¥å£</h3>
<p>ä»Šå¤©æ¥å£åŠ å…¥äº†æšä¸¾ï¼Œå¯ä»¥æ¯”è¾ƒæœ‰æ•ˆçš„æ§åˆ¶è¾“å‡ºå‚æ•°
src/main/resources/rsaserver.tars</p>
<div class="highlight"><pre class="chroma"><code class="language-nginx" data-lang="nginx"><span class="k">module</span> <span class="s">rsaserver</span>
<span class="p">{</span>
        <span class="kn">//</span> <span class="s">å…¬é’¥ç±»å‹ï¼Œä¸åŒåŠŸèƒ½å¯èƒ½éƒ½éœ€è¦åˆ°å…¬é’¥ï¼Œå¦‚æœä¸æƒ³ç»Ÿä¸€ä½¿ç”¨åŒä¸€ä¸ªå…¬é’¥ï¼Œå¯ä»¥æ·»åŠ å¤šç§ç±»å‹ï¼Œä¾›ä½¿ç”¨ã€‚</span>
        <span class="s">enum</span> <span class="s">KeyType</span>
        <span class="p">{</span>
                <span class="kn">PASSWORD,</span>
                <span class="s">PLAIN,</span>
                <span class="s">SIGN,</span>
                <span class="s">JWT</span>
        <span class="err">}</span><span class="p">;</span>

        <span class="kn">//</span> <span class="s">ç­¾åç±»å‹</span>
        <span class="s">enum</span> <span class="s">SignType</span>
        <span class="p">{</span>
                <span class="kn">MD5withRSA,</span>
                <span class="s">SHA1withRSA,</span>
                <span class="s">SHA256withRSA</span>
        <span class="err">}</span><span class="p">;</span>

	<span class="kn">interface</span> <span class="s">Cipher</span>
	<span class="p">{</span>
                <span class="kn">//</span> <span class="s">è·å–å…¬é’¥</span> <span class="s">ç”¨äºå„åº”ç”¨éœ€è¦å…¬é’¥åšåŠ è§£å¯†æˆ–ç­¾åä½¿ç”¨</span>
                <span class="s">//</span> <span class="s">ä¸ºäº†ç½‘ç»œå®‰å…¨ï¼Œç§é’¥æ˜¯ä¸å…è®¸å¤–éƒ¨è·å–çš„ï¼Œåªèƒ½è°ƒç”¨è¿œç¨‹æœåŠ¡é—´æ¥ä½¿ç”¨ç§é’¥ã€‚</span>
                <span class="s">bool</span> <span class="s">getPublicKey(KeyType</span> <span class="s">typ,</span> <span class="s">out</span> <span class="s">string</span> <span class="s">pubKey)</span><span class="p">;</span>

                <span class="kn">//</span> <span class="s">ç”Ÿæˆä¸€å¯¹æ–°çš„å…¬ç§é’¥ï¼Œå®¢æˆ·ç«¯è·å–åç”¨äºå…¶å®ƒç”¨é€”</span>
                <span class="s">//</span> <span class="s">é»˜è®¤ç”Ÿæˆçš„æ˜¯é•¿åº¦1024</span> <span class="s">RSAçš„å¯†é’¥å¯¹ï¼Œæœ‰å…¶å®ƒéœ€è¦è¿™ä¸ªåŠŸèƒ½å¯ä»¥å†åŠ å…¥å‚æ•°å°±å¯ä»¥æ‰©å±•äº†</span>
                <span class="s">//</span> <span class="s">ä¸ºäº†ç®€å•ï¼Œç›®å‰å°±ä¸åŠ å‚æ•°äº†</span>
                <span class="s">bool</span> <span class="s">genKey(out</span> <span class="s">string</span> <span class="s">priKey,</span> <span class="s">out</span> <span class="s">string</span> <span class="s">pubKey)</span><span class="p">;</span>

                <span class="kn">//</span> <span class="s">ä½¿ç”¨ç§é’¥åŠ å¯†</span>
                <span class="s">bool</span> <span class="s">encodeByPrivateKey(string</span> <span class="s">data,</span> <span class="s">out</span> <span class="s">string</span> <span class="s">enStr)</span><span class="p">;</span>

                <span class="kn">//</span> <span class="s">ä½¿ç”¨å…¬é’¥åŠ å¯†</span>
                <span class="s">bool</span> <span class="s">encodeByPublicKey(string</span> <span class="s">data,</span> <span class="s">out</span> <span class="s">string</span> <span class="s">enStr)</span><span class="p">;</span>

                <span class="kn">//</span> <span class="s">ä½¿ç”¨ç§é’¥è§£å¯†</span>
                <span class="s">bool</span> <span class="s">decodeByPrivateKey(string</span> <span class="s">data,</span> <span class="s">out</span> <span class="s">string</span> <span class="s">plain)</span><span class="p">;</span>

                <span class="kn">//</span> <span class="s">ä½¿ç”¨å…¬é’¥è§£å¯†</span>
                <span class="s">bool</span> <span class="s">decodeByPublicKey(string</span> <span class="s">data,</span> <span class="s">out</span> <span class="s">string</span> <span class="s">plain)</span><span class="p">;</span>

                <span class="kn">//</span> <span class="s">ç”Ÿæˆæ•°å­—ç­¾å</span>
                <span class="s">bool</span> <span class="s">sign(string</span> <span class="s">data,</span> <span class="s">SignType</span> <span class="s">typ,</span> <span class="s">out</span> <span class="s">string</span> <span class="s">signStr)</span><span class="p">;</span>

                <span class="kn">//</span> <span class="s">éªŒè¯æ•°å­—ç­¾å</span>
                <span class="s">bool</span> <span class="s">verify(string</span> <span class="s">plain,</span> <span class="s">string</span> <span class="s">signStr,</span> <span class="s">SignType</span> <span class="s">typ)</span><span class="p">;</span>
	<span class="p">}</span>;
<span class="p">}</span>;
</code></pre></div><h3 id="pomxml">pom.xml</h3>
<h4 id="æ·»åŠ ä¾èµ–">æ·»åŠ ä¾èµ–</h4>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml">		<span class="nt">&lt;dependency&gt;</span>
			<span class="nt">&lt;groupId&gt;</span>com.tencent.tars<span class="nt">&lt;/groupId&gt;</span>
			<span class="nt">&lt;artifactId&gt;</span>tars-spring-boot-starter<span class="nt">&lt;/artifactId&gt;</span>
			<span class="nt">&lt;version&gt;</span>1.7.2<span class="nt">&lt;/version&gt;</span>
		<span class="nt">&lt;/dependency&gt;</span>
		<span class="nt">&lt;dependency&gt;</span>
			<span class="nt">&lt;groupId&gt;</span>org.apache.commons<span class="nt">&lt;/groupId&gt;</span>
			<span class="nt">&lt;artifactId&gt;</span>commons-lang3<span class="nt">&lt;/artifactId&gt;</span>
			<span class="nt">&lt;version&gt;</span>3.11<span class="nt">&lt;/version&gt;</span>
		<span class="nt">&lt;/dependency&gt;</span>
</code></pre></div><h4 id="æ·»åŠ æ’ä»¶">æ·»åŠ æ’ä»¶</h4>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml">		<span class="c">&lt;!--tars2java plugin --&gt;</span>
		<span class="nt">&lt;plugin&gt;</span>
			<span class="nt">&lt;groupId&gt;</span>com.tencent.tars<span class="nt">&lt;/groupId&gt;</span>
			<span class="nt">&lt;artifactId&gt;</span>tars-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>
			<span class="nt">&lt;version&gt;</span>1.7.2<span class="nt">&lt;/version&gt;</span>
			<span class="nt">&lt;configuration&gt;</span>
				<span class="nt">&lt;tars2JavaConfig&gt;</span>
					<span class="c">&lt;!-- tars file location --&gt;</span>
					<span class="nt">&lt;tarsFiles&gt;</span>
						<span class="nt">&lt;tarsFile&gt;</span>${basedir}/src/main/resources/rsaserver.tars<span class="nt">&lt;/tarsFile&gt;</span>
					<span class="nt">&lt;/tarsFiles&gt;</span>
					<span class="c">&lt;!-- Source file encoding --&gt;</span>
					<span class="nt">&lt;tarsFileCharset&gt;</span>UTF-8<span class="nt">&lt;/tarsFileCharset&gt;</span>
					<span class="c">&lt;!-- Generate server code --&gt;</span>
					<span class="nt">&lt;servant&gt;</span>true<span class="nt">&lt;/servant&gt;</span>
					<span class="c">&lt;!-- Generated source code encoding --&gt;</span>
					<span class="nt">&lt;charset&gt;</span>UTF-8<span class="nt">&lt;/charset&gt;</span>
					<span class="c">&lt;!-- Generated source code directory --&gt;</span>
					<span class="nt">&lt;srcPath&gt;</span>${basedir}/src/main/java<span class="nt">&lt;/srcPath&gt;</span>
					<span class="c">&lt;!-- Generated source code package prefix --&gt;</span>
					<span class="nt">&lt;packagePrefixName&gt;</span>com.example.rsaserver.service.<span class="nt">&lt;/packagePrefixName&gt;</span>
				<span class="nt">&lt;/tars2JavaConfig&gt;</span>
			<span class="nt">&lt;/configuration&gt;</span>
		<span class="nt">&lt;/plugin&gt;</span>
		<span class="c">&lt;!--package plugin--&gt;</span>
</code></pre></div><h4 id="æŒ‡å®šjaråç§°">æŒ‡å®šjaråç§°</h4>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml">		<span class="nt">&lt;finalName&gt;</span>rsaserver<span class="nt">&lt;/finalName&gt;</span>
</code></pre></div><h3 id="é…ç½®æ–‡ä»¶">é…ç½®æ–‡ä»¶</h3>
<p>è¿™æ˜¯æˆ‘ä¸ºäº†æµ‹è¯•ç”Ÿæˆçš„ä¸€å¯¹å…¬ç§é’¥ï¼Œå›¾æ–¹ä¾¿ç›´æ¥æŠŠå…¬ç§é’¥éƒ½æ”¾æœ¬åœ°é…ç½®æ–‡ä»¶ä¸­è¿›è¡Œæµ‹è¯•ã€‚
src/main/resources/application.properties</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="err">#</span> <span class="n">rsa</span> <span class="n">pub</span> <span class="n">pri</span> <span class="n">key</span> <span class="n">config</span>
<span class="n">test</span><span class="o">.</span><span class="na">key</span><span class="o">.</span><span class="na">public</span><span class="o">=</span><span class="n">MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQCOGU7lIbniqiI4WjoF3FmY9NAMr6VYrD</span><span class="o">+</span><span class="n">V0O</span><span class="o">/</span><span class="n">TShrSmaObYbYLHZ</span><span class="o">/</span><span class="n">NcIscCpV1ibdbhCylK77O</span><span class="o">+</span><span class="n">jEtBMAh</span><span class="o">+</span><span class="n">jR8lCVMcfNUtHBWkakiMXTMBnI5ddDOmU</span><span class="o">/</span><span class="n">J4jdQxhjlqfjvhjBzEMvUx0</span><span class="o">/</span><span class="n">16HuqfwEGolr1Zs6tBTjQ0TrsYDwSJQIDAQAB</span>
<span class="n">test</span><span class="o">.</span><span class="na">key</span><span class="o">.</span><span class="na">private</span><span class="o">=</span><span class="n">MIICdgIBADANBgkqhkiG9w0BAQEFAASCAmAwggJcAgEAAoGBAI4ZTuUhueKqIjhaOgXcWZj00AyvpVisP5XQ79NKGtKZo5thtgsdn81wixwKlXWJt1uELKUrvs76MS0EwCH6NHyUJUxx81S0cFaRqSIxdMwGcjl10M6ZT8niN1DGGOWp</span><span class="o">+</span><span class="n">O</span><span class="o">+</span><span class="n">GMHMQy9THT</span><span class="o">/</span><span class="n">Xoe6p</span><span class="o">/</span><span class="n">AQaiWvVmzq0FONDROuxgPBIlAgMBAAECgYBic9h82twu1o</span><span class="o">/</span><span class="n">1GVaAPwZ4</span><span class="o">+</span><span class="n">o23bG8UO</span><span class="o">+</span><span class="n">umQmgXrY1eAwMfIhj</span><span class="o">+</span><span class="n">JJ1WurY3TIH3ON6ocrB4FBIU17YAqfzwzalU4doFrmwk5WCpLm6xgSlhAkAMj0TDOz0irinVpS8RcYIQLWKvnl391NNIP9l2cataCnDh4lA15yzrTiSVRWrzAQJBAPgQGYvwnWZUErk4f3QvqwFvxEJyPQCUfxvYp3B</span><span class="o">/</span><span class="n">aAS9fHVjFZOUUr2W</span><span class="o">/</span><span class="n">pcVJnWlPkeTdMRs7AHjJhPt2KFSf</span><span class="o">+</span><span class="n">UCQQCSpT</span><span class="o">/</span><span class="n">uSEqht6AafooDKHcHHLnRVflIfbFglf4sYHuERp6zT0pe52</span><span class="o">/</span><span class="n">7F28sXHBuztkeA7UvHVB2JVG7zsNqv6VBAkEAuxLpMS</span><span class="o">/</span><span class="n">0hAdDV4vUErsgK6UuTS3580YJ1eY94Ak1WN3Nznk6</span><span class="o">/</span><span class="n">GEPRQtqVGYO6woDPddmZ</span><span class="o">/</span><span class="n">v8wC</span><span class="o">+</span><span class="n">dt8nXZVHiQQJAJq</span><span class="o">+</span><span class="n">Tev</span><span class="o">/</span><span class="n">1OE5h3Ttum0CsjeLFHnVoyvfluE45fGmDjDS5HyKWwwyZHQtkl7ZXLtRAsMtXm</span><span class="o">/</span><span class="n">NGy7QyqLH2GY4vQQJAJagMRmIV0AlIr1UyZk2vVU9n3LDWO57a3VMxAMQ6Hi6R3yqZb2Stgo62djYCtjoqE25gAUAs2jJ8Bk7uyRbW</span><span class="o">/</span><span class="n">A</span><span class="o">==</span>
</code></pre></div><h3 id="main">main</h3>
<p>src/main/java/com/example/rsaserver/RsaserverApplication.java</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@SpringBootApplication</span>
<span class="nd">@EnableTarsServer</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">RsaserverApplication</span> <span class="o">{</span>

	<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
		<span class="c1">// å…³é—­ spring boot è‡ªå¸¦çš„webæœåŠ¡ ç›®å‰åœºæ™¯åªç”¨åˆ°äº†rpcæœåŠ¡
</span><span class="c1"></span>		<span class="n">SpringApplication</span> <span class="n">app</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SpringApplication</span><span class="o">(</span><span class="n">RsaserverApplication</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
		<span class="n">app</span><span class="o">.</span><span class="na">setWebApplicationType</span><span class="o">(</span><span class="n">WebApplicationType</span><span class="o">.</span><span class="na">NONE</span><span class="o">);</span>
		<span class="n">app</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="n">args</span><span class="o">);</span>

	<span class="o">}</span>

<span class="o">}</span>
</code></pre></div><h3 id="é…ç½®ç±»">é…ç½®ç±»</h3>
<p>src/main/java/com/example/tarsmqserver/domain/RSAConfig.java</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Component</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">RSAConfig</span> <span class="o">{</span>
    <span class="nd">@Value</span><span class="o">(</span><span class="s">&#34;${test.key.public}&#34;</span><span class="o">)</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">publicKey</span><span class="o">;</span>

    <span class="nd">@Value</span><span class="o">(</span><span class="s">&#34;${test.key.private}&#34;</span><span class="o">)</span>
    <span class="kd">private</span>  <span class="n">String</span> <span class="n">privateKey</span><span class="o">;</span>


    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getPublicKey</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">publicKey</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getPrivateKey</span><span class="o">(){</span>
        <span class="k">return</span> <span class="n">privateKey</span><span class="o">;</span>
    <span class="o">}</span>

<span class="o">}</span>
</code></pre></div><h3 id="tar2java-ç”Ÿæˆä»£ç ">tar2java ç”Ÿæˆä»£ç </h3>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">$ mvn tars:tars2java
</code></pre></div><h3 id="ç”Ÿæˆå¥½çš„æ¥å£æ–‡ä»¶">ç”Ÿæˆå¥½çš„æ¥å£æ–‡ä»¶</h3>
<p>src/main/java/com/example/rsaserver/service/rsaserver/CipherServant.java</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Servant</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">CipherServant</span> <span class="o">{</span>

	 <span class="kt">boolean</span> <span class="nf">getPublicKey</span><span class="o">(</span><span class="nd">@TarsMethodParameter</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#34;typ&#34;</span><span class="o">)</span><span class="kt">int</span> <span class="n">typ</span><span class="o">,</span> <span class="nd">@TarsHolder</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#34;pubKey&#34;</span><span class="o">)</span> <span class="n">Holder</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">pubKey</span><span class="o">);</span>

	 <span class="kt">boolean</span> <span class="nf">genKey</span><span class="o">(</span><span class="nd">@TarsHolder</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#34;priKey&#34;</span><span class="o">)</span> <span class="n">Holder</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">priKey</span><span class="o">,</span> <span class="nd">@TarsHolder</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#34;pubKey&#34;</span><span class="o">)</span> <span class="n">Holder</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">pubKey</span><span class="o">);</span>

	 <span class="kt">boolean</span> <span class="nf">encodeByPrivateKey</span><span class="o">(</span><span class="nd">@TarsMethodParameter</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#34;data&#34;</span><span class="o">)</span><span class="n">String</span> <span class="n">data</span><span class="o">,</span> <span class="nd">@TarsHolder</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#34;enStr&#34;</span><span class="o">)</span> <span class="n">Holder</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">enStr</span><span class="o">);</span>

	 <span class="kt">boolean</span> <span class="nf">encodeByPublicKey</span><span class="o">(</span><span class="nd">@TarsMethodParameter</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#34;data&#34;</span><span class="o">)</span><span class="n">String</span> <span class="n">data</span><span class="o">,</span> <span class="nd">@TarsHolder</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#34;enStr&#34;</span><span class="o">)</span> <span class="n">Holder</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">enStr</span><span class="o">);</span>

	 <span class="kt">boolean</span> <span class="nf">decodeByPrivateKey</span><span class="o">(</span><span class="nd">@TarsMethodParameter</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#34;data&#34;</span><span class="o">)</span><span class="n">String</span> <span class="n">data</span><span class="o">,</span> <span class="nd">@TarsHolder</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#34;plain&#34;</span><span class="o">)</span> <span class="n">Holder</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">plain</span><span class="o">);</span>

	 <span class="kt">boolean</span> <span class="nf">decodeByPublicKey</span><span class="o">(</span><span class="nd">@TarsMethodParameter</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#34;data&#34;</span><span class="o">)</span><span class="n">String</span> <span class="n">data</span><span class="o">,</span> <span class="nd">@TarsHolder</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#34;plain&#34;</span><span class="o">)</span> <span class="n">Holder</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">plain</span><span class="o">);</span>

	 <span class="kt">boolean</span> <span class="nf">sign</span><span class="o">(</span><span class="nd">@TarsMethodParameter</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#34;data&#34;</span><span class="o">)</span><span class="n">String</span> <span class="n">data</span><span class="o">,</span> <span class="nd">@TarsMethodParameter</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#34;typ&#34;</span><span class="o">)</span><span class="kt">int</span> <span class="n">typ</span><span class="o">,</span> <span class="nd">@TarsHolder</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#34;signStr&#34;</span><span class="o">)</span> <span class="n">Holder</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">signStr</span><span class="o">);</span>

	 <span class="kt">boolean</span> <span class="nf">verify</span><span class="o">(</span><span class="nd">@TarsMethodParameter</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#34;plain&#34;</span><span class="o">)</span><span class="n">String</span> <span class="n">plain</span><span class="o">,</span> <span class="nd">@TarsMethodParameter</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#34;signStr&#34;</span><span class="o">)</span><span class="n">String</span> <span class="n">signStr</span><span class="o">,</span> <span class="nd">@TarsMethodParameter</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#34;typ&#34;</span><span class="o">)</span><span class="kt">int</span> <span class="n">typ</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div><h3 id="tars-æœåŠ¡æ¥å£å®ç°">tars æœåŠ¡æ¥å£å®ç°</h3>
<p>src/main/java/com/example/rsaserver/service/rsaserver/impl/CipherServantImpl.java</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@TarsServant</span><span class="o">(</span><span class="s">&#34;cipherObj&#34;</span><span class="o">)</span>
<span class="nd">@Component</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CipherServantImpl</span> <span class="kd">implements</span> <span class="n">CipherServant</span> <span class="o">{</span>

    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="n">RSAConfig</span> <span class="n">rsaConfig</span><span class="o">;</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="kd">static</span> <span class="n">Logger</span> <span class="n">RSA_LOGGER</span> <span class="o">=</span> <span class="n">LoggerFactory</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="s">&#34;RSA_SERVER&#34;</span><span class="o">);</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">genKey</span><span class="o">(</span><span class="n">Holder</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">priKey</span><span class="o">,</span> <span class="n">Holder</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">pubKey</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="kd">final</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">keyPair</span> <span class="o">=</span> <span class="n">RSAUtils</span><span class="o">.</span><span class="na">genKeyPair</span><span class="o">();</span>
            <span class="n">String</span> <span class="n">publickey</span> <span class="o">=</span> <span class="n">RSAUtils</span><span class="o">.</span><span class="na">getPublicKey</span><span class="o">(</span><span class="n">keyPair</span><span class="o">);</span>
            <span class="n">String</span> <span class="n">privatekey</span> <span class="o">=</span> <span class="n">RSAUtils</span><span class="o">.</span><span class="na">getPrivateKey</span><span class="o">(</span><span class="n">keyPair</span><span class="o">);</span>
            <span class="n">priKey</span><span class="o">.</span><span class="na">setValue</span><span class="o">(</span><span class="n">privatekey</span><span class="o">);</span>
            <span class="n">pubKey</span><span class="o">.</span><span class="na">setValue</span><span class="o">(</span><span class="n">publickey</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">exHandler</span><span class="o">(</span><span class="s">&#34;genKey&#34;</span><span class="o">,</span> <span class="n">e</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="n">RSA_LOGGER</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&#34;genkey() successfully call&#34;</span><span class="o">);</span>
        <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">getPublicKey</span><span class="o">(</span><span class="kt">int</span> <span class="n">typ</span><span class="o">,</span> <span class="n">Holder</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">pubKey</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">String</span> <span class="n">publicKey</span> <span class="o">=</span> <span class="n">rsaConfig</span><span class="o">.</span><span class="na">getPublicKey</span><span class="o">();</span>
        <span class="n">KeyType</span> <span class="n">convert</span> <span class="o">=</span> <span class="n">KeyType</span><span class="o">.</span><span class="na">convert</span><span class="o">(</span><span class="n">typ</span><span class="o">);</span>

        <span class="c1">// TODO è¿™é‡Œç›®å‰æ²¡æœ‰å¾€ä¸‹æ‰©å±•ï¼Œåç»­å¯ä»¥æ‰©å±•å®Œå–„
</span><span class="c1"></span>        <span class="c1">// ç›®å‰æ‰€æœ‰éƒ½è¿”å›ç»Ÿä¸€çš„å…¬é’¥
</span><span class="c1"></span>        <span class="k">switch</span> <span class="o">(</span><span class="n">convert</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">case</span> <span class="n">PASSWORD</span><span class="o">:</span>
                <span class="n">pubKey</span><span class="o">.</span><span class="na">setValue</span><span class="o">(</span><span class="n">publicKey</span><span class="o">);</span>
                <span class="k">break</span><span class="o">;</span>

            <span class="k">case</span> <span class="n">PLAIN</span><span class="o">:</span>
                <span class="n">pubKey</span><span class="o">.</span><span class="na">setValue</span><span class="o">(</span><span class="n">publicKey</span><span class="o">);</span>
                <span class="k">break</span><span class="o">;</span>

            <span class="k">case</span> <span class="n">SIGN</span><span class="o">:</span>
                <span class="n">pubKey</span><span class="o">.</span><span class="na">setValue</span><span class="o">(</span><span class="n">publicKey</span><span class="o">);</span>
                <span class="k">break</span><span class="o">;</span>

            <span class="k">case</span> <span class="n">JWT</span><span class="o">:</span>
                <span class="n">pubKey</span><span class="o">.</span><span class="na">setValue</span><span class="o">(</span><span class="n">publicKey</span><span class="o">);</span>
                <span class="k">break</span><span class="o">;</span>
<span class="nl">
</span><span class="nl">            default:</span>
                <span class="n">pubKey</span><span class="o">.</span><span class="na">setValue</span><span class="o">(</span><span class="kc">null</span><span class="o">);</span>
                <span class="k">break</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="k">if</span> <span class="o">(</span><span class="n">StringUtils</span><span class="o">.</span><span class="na">isBlank</span><span class="o">(</span><span class="n">pubKey</span><span class="o">.</span><span class="na">getValue</span><span class="o">()))</span> <span class="o">{</span>
            <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">encodeByPrivateKey</span><span class="o">(</span><span class="n">String</span> <span class="n">data</span><span class="o">,</span> <span class="n">Holder</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">enStr</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">StringUtils</span><span class="o">.</span><span class="na">isBlank</span><span class="o">(</span><span class="n">data</span><span class="o">))</span> <span class="o">{</span>
            <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="k">try</span> <span class="o">{</span>
            <span class="n">String</span> <span class="n">privateKey</span> <span class="o">=</span> <span class="n">rsaConfig</span><span class="o">.</span><span class="na">getPrivateKey</span><span class="o">();</span>
            <span class="n">String</span> <span class="n">enData</span> <span class="o">=</span> <span class="n">RSAUtils</span><span class="o">.</span><span class="na">encryptedDataOnJavaByPrivateKey</span><span class="o">(</span><span class="n">data</span><span class="o">,</span> <span class="n">privateKey</span><span class="o">);</span>
            <span class="n">enStr</span><span class="o">.</span><span class="na">setValue</span><span class="o">(</span><span class="n">enData</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">exHandler</span><span class="o">(</span><span class="s">&#34;encodeByPrivateKey&#34;</span><span class="o">,</span> <span class="n">e</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="n">RSA_LOGGER</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&#34;encodeByPrivateKey() successfully call&#34;</span><span class="o">);</span>
        <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">encodeByPublicKey</span><span class="o">(</span><span class="n">String</span> <span class="n">data</span><span class="o">,</span> <span class="n">Holder</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">enStr</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">StringUtils</span><span class="o">.</span><span class="na">isBlank</span><span class="o">(</span><span class="n">data</span><span class="o">))</span> <span class="o">{</span>
            <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="k">try</span> <span class="o">{</span>
            <span class="n">String</span> <span class="n">publicKey</span> <span class="o">=</span> <span class="n">rsaConfig</span><span class="o">.</span><span class="na">getPublicKey</span><span class="o">();</span>
            <span class="n">String</span> <span class="n">enData</span> <span class="o">=</span> <span class="n">RSAUtils</span><span class="o">.</span><span class="na">encryptedDataOnJavaByPublicKey</span><span class="o">(</span><span class="n">data</span><span class="o">,</span> <span class="n">publicKey</span><span class="o">);</span>
            <span class="n">enStr</span><span class="o">.</span><span class="na">setValue</span><span class="o">(</span><span class="n">enData</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">exHandler</span><span class="o">(</span><span class="s">&#34;encodeByPublicKey&#34;</span><span class="o">,</span> <span class="n">e</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="n">RSA_LOGGER</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&#34;encodeByPublicKey() successfully call&#34;</span><span class="o">);</span>
        <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">decodeByPrivateKey</span><span class="o">(</span><span class="n">String</span> <span class="n">data</span><span class="o">,</span> <span class="n">Holder</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">plain</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">StringUtils</span><span class="o">.</span><span class="na">isBlank</span><span class="o">(</span><span class="n">data</span><span class="o">))</span> <span class="o">{</span>
            <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="k">try</span> <span class="o">{</span>
            <span class="n">String</span> <span class="n">privateKey</span> <span class="o">=</span> <span class="n">rsaConfig</span><span class="o">.</span><span class="na">getPrivateKey</span><span class="o">();</span>
            <span class="n">String</span> <span class="n">deData</span> <span class="o">=</span> <span class="n">RSAUtils</span><span class="o">.</span><span class="na">decryptDataOnJavaByPrivateKey</span><span class="o">(</span><span class="n">data</span><span class="o">,</span> <span class="n">privateKey</span><span class="o">);</span>
            <span class="n">plain</span><span class="o">.</span><span class="na">setValue</span><span class="o">(</span><span class="n">deData</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">exHandler</span><span class="o">(</span><span class="s">&#34;decodeByPrivateKey&#34;</span><span class="o">,</span> <span class="n">e</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="n">RSA_LOGGER</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&#34;decodeByPrivateKey() successfully call&#34;</span><span class="o">);</span>
        <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">decodeByPublicKey</span><span class="o">(</span><span class="n">String</span> <span class="n">data</span><span class="o">,</span> <span class="n">Holder</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">plain</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">StringUtils</span><span class="o">.</span><span class="na">isBlank</span><span class="o">(</span><span class="n">data</span><span class="o">))</span> <span class="o">{</span>
            <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="k">try</span> <span class="o">{</span>
            <span class="n">String</span> <span class="n">publicKey</span> <span class="o">=</span> <span class="n">rsaConfig</span><span class="o">.</span><span class="na">getPublicKey</span><span class="o">();</span>
            <span class="n">String</span> <span class="n">deData</span> <span class="o">=</span> <span class="n">RSAUtils</span><span class="o">.</span><span class="na">decryptDataOnJavaByPublicKey</span><span class="o">(</span><span class="n">data</span><span class="o">,</span> <span class="n">publicKey</span><span class="o">);</span>
            <span class="n">plain</span><span class="o">.</span><span class="na">setValue</span><span class="o">(</span><span class="n">deData</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">exHandler</span><span class="o">(</span><span class="s">&#34;decodeByPublicKey&#34;</span><span class="o">,</span> <span class="n">e</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="n">RSA_LOGGER</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&#34;decodeByPublicKey() successfully call&#34;</span><span class="o">);</span>
        <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">sign</span><span class="o">(</span><span class="n">String</span> <span class="n">data</span><span class="o">,</span> <span class="kt">int</span> <span class="n">typ</span><span class="o">,</span> <span class="n">Holder</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">signStr</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">StringUtils</span><span class="o">.</span><span class="na">isBlank</span><span class="o">(</span><span class="n">data</span><span class="o">))</span> <span class="o">{</span>
            <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="k">try</span> <span class="o">{</span>
            <span class="c1">// TODO ç›®å‰åªä½¿ç”¨äº†é»˜è®¤çš„ MD5withRSA éœ€è¦å…¶å®ƒçš„åŠŸèƒ½,åç»­å¯ä»¥æ·»åŠ ,é€šè¿‡å…¥å‚typæ¥è°ƒç”¨ä¸åŒçš„æ–¹æ³•
</span><span class="c1"></span>            <span class="n">String</span> <span class="n">privateKey</span> <span class="o">=</span> <span class="n">rsaConfig</span><span class="o">.</span><span class="na">getPrivateKey</span><span class="o">();</span>
            <span class="n">String</span> <span class="n">enSign</span> <span class="o">=</span> <span class="n">RSAUtils</span><span class="o">.</span><span class="na">sign</span><span class="o">(</span><span class="n">data</span><span class="o">.</span><span class="na">getBytes</span><span class="o">(),</span> <span class="n">privateKey</span><span class="o">);</span>
            <span class="n">signStr</span><span class="o">.</span><span class="na">setValue</span><span class="o">(</span><span class="n">enSign</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">exHandler</span><span class="o">(</span><span class="s">&#34;sign&#34;</span><span class="o">,</span> <span class="n">e</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="n">RSA_LOGGER</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&#34;sign() successfully call&#34;</span><span class="o">);</span>
        <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">verify</span><span class="o">(</span><span class="n">String</span> <span class="n">plain</span><span class="o">,</span> <span class="n">String</span> <span class="n">signStr</span><span class="o">,</span> <span class="kt">int</span> <span class="n">typ</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">StringUtils</span><span class="o">.</span><span class="na">isBlank</span><span class="o">(</span><span class="n">plain</span><span class="o">)</span> <span class="o">||</span> <span class="n">StringUtils</span><span class="o">.</span><span class="na">isBlank</span><span class="o">(</span><span class="n">signStr</span><span class="o">))</span> <span class="o">{</span>
            <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="c1">// TODO ç›®å‰åªä½¿ç”¨äº†é»˜è®¤çš„ MD5withRSA éœ€è¦å…¶å®ƒçš„åŠŸèƒ½,åç»­å¯ä»¥æ·»åŠ ,é€šè¿‡å…¥å‚typæ¥è°ƒç”¨ä¸åŒçš„æ–¹æ³•
</span><span class="c1"></span>        <span class="k">try</span> <span class="o">{</span>
            <span class="n">String</span> <span class="n">publicKey</span> <span class="o">=</span> <span class="n">rsaConfig</span><span class="o">.</span><span class="na">getPublicKey</span><span class="o">();</span>
            <span class="kt">boolean</span> <span class="n">ok</span> <span class="o">=</span> <span class="n">RSAUtils</span><span class="o">.</span><span class="na">verify</span><span class="o">(</span><span class="n">plain</span><span class="o">.</span><span class="na">getBytes</span><span class="o">(),</span> <span class="n">publicKey</span><span class="o">,</span> <span class="n">signStr</span><span class="o">);</span>
            <span class="n">RSA_LOGGER</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&#34;verify() successfully call&#34;</span><span class="o">);</span>
            <span class="k">return</span> <span class="n">ok</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">exHandler</span><span class="o">(</span><span class="s">&#34;verify&#34;</span><span class="o">,</span> <span class="n">e</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kt">boolean</span> <span class="nf">exHandler</span><span class="o">(</span><span class="n">String</span> <span class="n">funcname</span><span class="o">,</span> <span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="n">RSA_LOGGER</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="s">&#34;{}(): {}&#34;</span><span class="o">,</span> <span class="n">funcname</span><span class="o">,</span> <span class="n">e</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
        <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>

    <span class="o">}</span>

<span class="o">}</span>
</code></pre></div><h3 id="æµ‹è¯•ä»£ç ">æµ‹è¯•ä»£ç </h3>
<p>src/test/java/com/example/rsaserver/CipherServantImplTest.java</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@SpringBootTest</span>
<span class="nd">@Component</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CipherServantImplTest</span> <span class="o">{</span>

    <span class="c1">// å› CipherServantImplä¸­æœ‰ @Autowired æ‰€ä»¥æµ‹è¯•çš„æ—¶å€™ä¸èƒ½ä½¿ç”¨newï¼Œ
</span><span class="c1"></span>    <span class="c1">// å¿…é¡»ä½¿ç”¨ @Autowiredæ¥è£…è½½ç±»æ‰èƒ½è¯»å–åˆ°é…ç½®ï¼Œè¦ä¸ç„¶ä¼šå‡ºç°ç©ºæŒ‡é’ˆå¯¹é”™è¯¯
</span><span class="c1"></span>    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="n">CipherServantImpl</span> <span class="n">imp</span><span class="o">;</span>

    <span class="nd">@Test</span>
    <span class="kt">void</span> <span class="nf">genKey</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">Holder</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">priKey</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Holder</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;();</span>
        <span class="n">Holder</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">pubKey</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Holder</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;();</span>
        <span class="kt">boolean</span> <span class="n">ok</span> <span class="o">=</span> <span class="n">imp</span><span class="o">.</span><span class="na">genKey</span><span class="o">(</span><span class="n">priKey</span><span class="o">,</span> <span class="n">pubKey</span><span class="o">);</span>
        <span class="n">assertTrue</span><span class="o">(</span><span class="n">ok</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">getPublicKey</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">KeyType</span> <span class="n">convert</span> <span class="o">=</span> <span class="n">KeyType</span><span class="o">.</span><span class="na">convert</span><span class="o">(</span><span class="n">0</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">convert</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
        <span class="n">Holder</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">pubKey</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Holder</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;();</span>
        <span class="kt">boolean</span> <span class="n">ok</span> <span class="o">=</span> <span class="n">imp</span><span class="o">.</span><span class="na">getPublicKey</span><span class="o">(</span><span class="n">0</span><span class="o">,</span> <span class="n">pubKey</span><span class="o">);</span>
        <span class="n">assertTrue</span><span class="o">(</span><span class="n">ok</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">encodeByPrivateKeyWithDecodeByPublicKey</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">String</span> <span class="n">data</span> <span class="o">=</span> <span class="s">&#34;as65df4656a4sd6fa&#34;</span><span class="o">;</span>
        <span class="n">Holder</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">enStr</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Holder</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;();</span>
        <span class="kt">boolean</span> <span class="n">ok</span> <span class="o">=</span> <span class="n">imp</span><span class="o">.</span><span class="na">encodeByPrivateKey</span><span class="o">(</span><span class="n">data</span><span class="o">,</span> <span class="n">enStr</span><span class="o">);</span>
        <span class="n">assertTrue</span><span class="o">(</span><span class="n">ok</span><span class="o">);</span>

        <span class="n">Holder</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">plain</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Holder</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;();</span>
        <span class="n">imp</span><span class="o">.</span><span class="na">decodeByPublicKey</span><span class="o">(</span><span class="n">enStr</span><span class="o">.</span><span class="na">getValue</span><span class="o">(),</span> <span class="n">plain</span><span class="o">);</span>
        <span class="n">assertEquals</span><span class="o">(</span><span class="n">plain</span><span class="o">.</span><span class="na">value</span><span class="o">,</span> <span class="n">data</span><span class="o">);</span>

    <span class="o">}</span>

    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">encodeByPublicKeyWithDecodeByPrivateKey</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">String</span> <span class="n">data</span> <span class="o">=</span> <span class="s">&#34;as65df4656a4sd6fa&#34;</span><span class="o">;</span>
        <span class="n">Holder</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">enStr</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Holder</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;();</span>
        <span class="kt">boolean</span> <span class="n">ok</span> <span class="o">=</span> <span class="n">imp</span><span class="o">.</span><span class="na">encodeByPublicKey</span><span class="o">(</span><span class="n">data</span><span class="o">,</span> <span class="n">enStr</span><span class="o">);</span>
        <span class="n">assertTrue</span><span class="o">(</span><span class="n">ok</span><span class="o">);</span>

        <span class="n">Holder</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">plain</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Holder</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;();</span>
        <span class="n">imp</span><span class="o">.</span><span class="na">decodeByPrivateKey</span><span class="o">(</span><span class="n">enStr</span><span class="o">.</span><span class="na">getValue</span><span class="o">(),</span> <span class="n">plain</span><span class="o">);</span>
        <span class="n">assertEquals</span><span class="o">(</span><span class="n">plain</span><span class="o">.</span><span class="na">value</span><span class="o">,</span> <span class="n">data</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">signWithVerify</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">String</span> <span class="n">data</span> <span class="o">=</span> <span class="s">&#34;as65df4656a4sd6fa&#34;</span><span class="o">;</span>
        <span class="n">Holder</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">signStr</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Holder</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;();</span>
        <span class="kt">boolean</span> <span class="n">ok</span> <span class="o">=</span> <span class="n">imp</span><span class="o">.</span><span class="na">sign</span><span class="o">(</span><span class="n">data</span><span class="o">,</span> <span class="n">0</span><span class="o">,</span> <span class="n">signStr</span><span class="o">);</span>
        <span class="n">assertTrue</span><span class="o">(</span><span class="n">ok</span><span class="o">);</span>

        <span class="n">ok</span> <span class="o">=</span> <span class="n">imp</span><span class="o">.</span><span class="na">verify</span><span class="o">(</span><span class="n">data</span><span class="o">,</span> <span class="n">signStr</span><span class="o">.</span><span class="na">getValue</span><span class="o">(),</span> <span class="n">0</span><span class="o">);</span>
        <span class="n">assertTrue</span><span class="o">(</span><span class="n">ok</span><span class="o">);</span>

    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div><h3 id="tars-é…ç½®æ–‡ä»¶">tars é…ç½®æ–‡ä»¶</h3>
<p>src/main/resources/example.rsaserver.config.conf</p>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml"><span class="nt">&lt;tars&gt;</span>
	<span class="nt">&lt;application&gt;</span>
		enableset=N
		setdivision=NULL
		<span class="nt">&lt;client&gt;</span>
			locator=
			sync-invoke-timeout=20000
			async-invoke-timeout=20000
			refresh-endpoint-interval=60000
			stat=tars.tarsstat.StatObj
			property=tars.tarsproperty.PropertyObj
			report-interval=60000
			modulename=rsaserver.cipherJavaServer
		<span class="nt">&lt;/client&gt;</span>
		<span class="nt">&lt;server&gt;</span>
			node=
			app=rsaserver
			server=Cipher
			localip=127.0.0.1
			local=tcp -h 127.0.0.1 -p 18601 -t 3000
			basepath=.
			datapath=.
			logpath=.
			loglevel=DEBUG
			logsize=15M
			log=
			config=tars.tarsconfig.ConfigObj
			notify=tars.tarsnotify.NotifyObj
			mainclass=com.qq.tars.server.startup.Main
			jvmparams=-Xms1024m -Xmx1024m
			sessiontimeout=120000
			sessioncheckinterval=60000
			tcpnodelay=true
			udpbuffersize=8192
			charsetname=UTF-8
			<span class="nt">&lt;rsaserver.Cipher.cipherObjAdapter&gt;</span>
				allow
				endpoint=tcp -h 127.0.0.1 -p 18600 -t 60000
				handlegroup=rsaserver.Cipher.cipherObjAdapter
				maxconns=200000
				protocol=tars
				queuecap=10000
				queuetimeout=60000
				servant=rsaserver.Cipher.cipherObj
				shmcap=0
				shmkey=0
				threads=100
			<span class="nt">&lt;/rsaserver.Cipher.cipherObjAdapter&gt;</span>
		<span class="nt">&lt;/server&gt;</span>
	<span class="nt">&lt;/application&gt;</span>
<span class="nt">&lt;/tars&gt;</span>
</code></pre></div><h3 id="è¿è¡Œæµ‹è¯•">è¿è¡Œæµ‹è¯•</h3>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">$ mvn <span class="nb">test</span> -Dconfig<span class="o">=</span>src/main/resources/example.rsaserver.config.conf
</code></pre></div><p>æˆ–ç”¨æˆ‘æä¾›çš„Makefileæ¥æµ‹è¯• <a href="https://github.com/aomirun/demo/blob/main/day-4/rsaserver/Makefile">ä¼ é€é—¨</a></p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">$ make <span class="nb">test</span>
</code></pre></div><h3 id="æµ‹è¯•ç»“æœ">æµ‹è¯•ç»“æœ</h3>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh"><span class="o">[</span>INFO<span class="o">]</span> Tests run: 8, Failures: 0, Errors: 0, Skipped: <span class="m">0</span>
<span class="o">[</span>INFO<span class="o">]</span> 
<span class="o">[</span>INFO<span class="o">]</span> ------------------------------------------------------------------------
<span class="o">[</span>INFO<span class="o">]</span> BUILD SUCCESS
<span class="o">[</span>INFO<span class="o">]</span> ------------------------------------------------------------------------
</code></pre></div><h3 id="tars-web-ä¸Šä¼ åŠå‘å¸ƒ">tars-web ä¸Šä¼ åŠå‘å¸ƒ</h3>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">$ make build-upload
</code></pre></div><p>æˆ–è€…æ‰‹åŠ¨ä¸Šä¼ </p>
<h3 id="ä¸Šä¼ tarsæ¥å£å®šä¹‰æ–‡ä»¶">ä¸Šä¼ tarsæ¥å£å®šä¹‰æ–‡ä»¶</h3>
<p>æ‰‹åŠ¨ä¸Šä¼ <code>src/main/resources/rsaserver.tars</code>
æ‰‹åŠ¨æµ‹è¯•
æŸ¥çœ‹ç»“æœ
ä¸€åˆ‡æ­£å¸¸</p>
<h2 id="ä¿®æ”¹day2çš„mqserveré¡¹ç›®">ä¿®æ”¹day2çš„mqserveré¡¹ç›®</h2>
<h3 id="ä¿®æ”¹mqservertars">ä¿®æ”¹mqserver.tars</h3>
<p>å› tarsæ’ä»¶å¤šä¸ªtarsæ–‡ä»¶,å…±æœ‰æ˜¯å¦ç”ŸæˆæœåŠ¡æ¥å£é€‰é¡¹,æœ¬ä¾‹ä¸­åŒæ˜¯æœ‰æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯,éœ€è¦åˆ†åˆ«ç”Ÿæˆæ‰è¡Œ
src/main/resources/mqserver.tars</p>
<pre><code>module mqserver
{
	interface Message
	{
                // msg å­—ç¬¦ä¸²å†…å®¹åŸæ ·å‘é€
                bool send(string msg);

                // ç”¨ç§é’¥å¯¹å­—ç¬¦ä¸²è¿›è¡ŒåŠ å¯†,è¿”å›åŠ å¯†åçš„å­—ç¬¦ä¸²
                bool encode(string sign, out string enStr);

                // ç”¨ç§é’¥å¯¹å­—ç¬¦ä¸²è¿›è¡ŒåŠ å¯†,å¹¶å‘é€åŠ å¯†åçš„å†…å®¹
                bool encodeWithSend(string msg);

                // å…·ä½“å­—ç¬¦ä¸²æ‹¼æ¥å¯èƒ½è‡ªå·±å®šä¹‰,æ˜¯å¦åœ¨å­—ç¬¦ä¸²ä¸­ä¼ è¾“æ˜¯å¦åŠ å¯†å­—ç¬¦,æˆ–è€…é»˜è®¤çº¦å®šå“ªäº›æœåŠ¡å‘é€å¯†æ–‡,å“ªäº›æœåŠ¡å‘é€æ˜æ–‡
                // if isEncode = false then
                // å¯¹å‘é€çš„åŸå†…å®¹è¿›è¡Œç­¾å,ä¹‹åç­¾åå­—ç¬¦ä¸²ä¸åŸå†…å®¹å­—ç¬¦ä¸²ä½¿ç”¨ | æ‹¼æ¥ä¸ºä¸€ä¸ªå­—ç¬¦ä¸²åå‘é€
                // e.g: msg = abc, signStr = AF@FSDafe23 æœ€åå‘é€çš„å­—ç¬¦ä¸² msg = AF@FSDafe23|abc
                // if isEncode = true then
                // å¯¹å‘é€çš„åŸå†…å®¹å…ˆè¿›è¡Œç­¾åå¹¶å¯¹åŸå†…å®¹è¿›è¡ŒåŠ å¯†,ä¹‹åä½¿ç”¨ | æ‹¼æ¥ä¸ºä¸€ä¸ªå­—ç¬¦ä¸²åå‘é€
                // e.g: msg = abc signStr = AF@FSDafe23 enStr = ASFDHFHSGGG233f2f2fadfAGAF æœ€åå‘é€çš„å­—ç¬¦ä¸² msg = AF@FSDafe23|ASFDHFHSGGG233f2f2fadfAGAF
                bool signWithSend(string msg, bool isEncode);
	};
};
</code></pre><h3 id="ç”ŸæˆæœåŠ¡æ¥å£">ç”ŸæˆæœåŠ¡æ¥å£</h3>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">$ mvn tars:tars2java
</code></pre></div><p>å¤åˆ¶rsaserver.tarsåˆ°mqserveré¡¹ç›®ä¸­</p>
<h3 id="pomxml-ä¿®æ”¹">pom.xml ä¿®æ”¹</h3>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml">			<span class="c">&lt;!--tars2java plugin --&gt;</span>
			<span class="nt">&lt;plugin&gt;</span>
				<span class="nt">&lt;groupId&gt;</span>com.tencent.tars<span class="nt">&lt;/groupId&gt;</span>
				<span class="nt">&lt;artifactId&gt;</span>tars-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>
				<span class="nt">&lt;version&gt;</span>1.7.2<span class="nt">&lt;/version&gt;</span>
				<span class="nt">&lt;configuration&gt;</span>
					<span class="nt">&lt;tars2JavaConfig&gt;</span>
						<span class="c">&lt;!-- tars file location --&gt;</span>
						<span class="nt">&lt;tarsFiles&gt;</span>
							<span class="nt">&lt;tarsFile&gt;</span>${basedir}/src/main/resources/mqserver.tars<span class="nt">&lt;/tarsFile&gt;</span>
						<span class="nt">&lt;/tarsFiles&gt;</span>
						<span class="c">&lt;!-- Source file encoding --&gt;</span>
						<span class="nt">&lt;tarsFileCharset&gt;</span>UTF-8<span class="nt">&lt;/tarsFileCharset&gt;</span>
						<span class="c">&lt;!-- Generate server code --&gt;</span>
						<span class="nt">&lt;servant&gt;</span>true<span class="nt">&lt;/servant&gt;</span>
						<span class="c">&lt;!-- Generated source code encoding --&gt;</span>
						<span class="nt">&lt;charset&gt;</span>UTF-8<span class="nt">&lt;/charset&gt;</span>
						<span class="c">&lt;!-- Generated source code directory --&gt;</span>
						<span class="nt">&lt;srcPath&gt;</span>${basedir}/src/main/java<span class="nt">&lt;/srcPath&gt;</span>
						<span class="c">&lt;!-- Generated source code package prefix --&gt;</span>
						<span class="nt">&lt;packagePrefixName&gt;</span>com.example.tarsmqserver.service.<span class="nt">&lt;/packagePrefixName&gt;</span>
					<span class="nt">&lt;/tars2JavaConfig&gt;</span>
					<span class="nt">&lt;tars2JavaConfig&gt;</span>
						<span class="c">&lt;!-- tars file location --&gt;</span>
						<span class="nt">&lt;tarsFiles&gt;</span>
							<span class="nt">&lt;tarsFile&gt;</span>${basedir}/src/main/resources/rsaserver.tars<span class="nt">&lt;/tarsFile&gt;</span>
						<span class="nt">&lt;/tarsFiles&gt;</span>
						<span class="c">&lt;!-- Source file encoding --&gt;</span>
						<span class="nt">&lt;tarsFileCharset&gt;</span>UTF-8<span class="nt">&lt;/tarsFileCharset&gt;</span>
						<span class="c">&lt;!-- Generate server code --&gt;</span>
						<span class="nt">&lt;servant&gt;</span>false<span class="nt">&lt;/servant&gt;</span>
						<span class="c">&lt;!-- Generated source code encoding --&gt;</span>
						<span class="nt">&lt;charset&gt;</span>UTF-8<span class="nt">&lt;/charset&gt;</span>
						<span class="c">&lt;!-- Generated source code directory --&gt;</span>
						<span class="nt">&lt;srcPath&gt;</span>${basedir}/src/main/java<span class="nt">&lt;/srcPath&gt;</span>
						<span class="c">&lt;!-- Generated source code package prefix --&gt;</span>
						<span class="nt">&lt;packagePrefixName&gt;</span>com.example.tarsmqserver.service.<span class="nt">&lt;/packagePrefixName&gt;</span>
					<span class="nt">&lt;/tars2JavaConfig&gt;</span>
				<span class="nt">&lt;/configuration&gt;</span>
			<span class="nt">&lt;/plugin&gt;</span>
			<span class="c">&lt;!--package plugin--&gt;</span>
</code></pre></div><p>ç”Ÿæˆtarså®¢æˆ·ç«¯ä»£ç </p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">$ mvn tars:tars2java
</code></pre></div><p>æ–°ç”Ÿæˆçš„ä»£ç å­˜æ”¾åœ¨
src/main/java/com/example/tarsmqserver/service/rsaserver</p>
<h3 id="ä¿®æ”¹æ¥å£å®ç°">ä¿®æ”¹æ¥å£å®ç°</h3>
<p>src/main/java/com/example/tarsmqserver/service/mqserver/impl/MessageServantImpl.java</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@TarsServant</span><span class="o">(</span><span class="s">&#34;messageObj&#34;</span><span class="o">)</span>
<span class="nd">@Component</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MessageServantImpl</span> <span class="kd">implements</span> <span class="n">MessageServant</span> <span class="o">{</span>
    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="n">Producer</span> <span class="n">producer</span><span class="o">;</span>

    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="n">JmqConfig</span> <span class="n">jmqConfig</span><span class="o">;</span>

    <span class="nd">@TarsClient</span><span class="o">(</span><span class="s">&#34;example.rsaserver.cipherObj&#34;</span><span class="o">)</span>
    <span class="n">CipherPrx</span> <span class="n">cipherPrx</span><span class="o">;</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="kd">static</span> <span class="n">Logger</span> <span class="n">MQSERVER_LOGGER</span> <span class="o">=</span> <span class="n">LoggerFactory</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="s">&#34;MQSERVER&#34;</span><span class="o">);</span>

    <span class="cm">/**
</span><span class="cm">     * å‘é€æ¶ˆæ¯åˆ°IBM MQ
</span><span class="cm">     */</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">send</span><span class="o">(</span><span class="n">String</span> <span class="n">msg</span><span class="o">)</span> <span class="o">{</span>

        <span class="k">if</span> <span class="o">(</span><span class="n">StringUtils</span><span class="o">.</span><span class="na">isBlank</span><span class="o">(</span><span class="n">msg</span><span class="o">))</span> <span class="o">{</span>
            <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="k">try</span> <span class="o">{</span>
            <span class="n">String</span> <span class="n">queueName</span> <span class="o">=</span> <span class="n">jmqConfig</span><span class="o">.</span><span class="na">getSendQueueName</span><span class="o">();</span>
            <span class="n">MQSERVER_LOGGER</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&#34;send: {} -&gt; {}&#34;</span><span class="o">,</span> <span class="n">queueName</span><span class="o">,</span> <span class="n">msg</span><span class="o">);</span>
            <span class="k">return</span> <span class="n">producer</span><span class="o">.</span><span class="na">sendMessage</span><span class="o">(</span><span class="n">queueName</span><span class="o">,</span> <span class="n">msg</span><span class="o">);</span>
                
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">exHandler</span><span class="o">(</span><span class="s">&#34;send&#34;</span><span class="o">,</span> <span class="n">e</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">encode</span><span class="o">(</span><span class="n">String</span> <span class="n">msg</span><span class="o">,</span> <span class="n">Holder</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">enStr</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">StringUtils</span><span class="o">.</span><span class="na">isBlank</span><span class="o">(</span><span class="n">msg</span><span class="o">))</span> <span class="o">{</span>
            <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="k">try</span> <span class="o">{</span>
            <span class="kt">boolean</span> <span class="n">ok</span> <span class="o">=</span> <span class="n">cipherPrx</span><span class="o">.</span><span class="na">encodeByPrivateKey</span><span class="o">(</span><span class="n">msg</span><span class="o">,</span> <span class="n">enStr</span><span class="o">);</span>
            <span class="n">MQSERVER_LOGGER</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&#34;encode: {} -&gt; {}&#34;</span><span class="o">,</span> <span class="n">msg</span><span class="o">,</span> <span class="n">enStr</span><span class="o">.</span><span class="na">value</span><span class="o">);</span>
            <span class="k">return</span> <span class="n">ok</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">exHandler</span><span class="o">(</span><span class="s">&#34;encode&#34;</span><span class="o">,</span> <span class="n">e</span><span class="o">);</span>
        <span class="o">}</span>

    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">encodeWithSend</span><span class="o">(</span><span class="n">String</span> <span class="n">msg</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">StringUtils</span><span class="o">.</span><span class="na">isBlank</span><span class="o">(</span><span class="n">msg</span><span class="o">))</span> <span class="o">{</span>
            <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="k">try</span> <span class="o">{</span>
            <span class="n">Holder</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">enStr</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Holder</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;();</span>
            <span class="kt">boolean</span> <span class="n">ok</span> <span class="o">=</span> <span class="n">encode</span><span class="o">(</span><span class="n">msg</span><span class="o">,</span> <span class="n">enStr</span><span class="o">);</span>
            <span class="k">if</span> <span class="o">(!</span><span class="n">ok</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
            <span class="o">}</span>
            <span class="k">return</span> <span class="n">send</span><span class="o">(</span><span class="n">enStr</span><span class="o">.</span><span class="na">value</span><span class="o">);</span>

        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">exHandler</span><span class="o">(</span><span class="s">&#34;encodeWithSend&#34;</span><span class="o">,</span> <span class="n">e</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">signWithSend</span><span class="o">(</span><span class="n">String</span> <span class="n">msg</span><span class="o">,</span> <span class="kt">boolean</span> <span class="n">isEncode</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">StringUtils</span><span class="o">.</span><span class="na">isBlank</span><span class="o">(</span><span class="n">msg</span><span class="o">))</span> <span class="o">{</span>
            <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="k">try</span> <span class="o">{</span>
            <span class="c1">// åŸå†…å®¹å»ç”Ÿæˆç­¾å
</span><span class="c1"></span>            <span class="n">Holder</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">signStr</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Holder</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;();</span>
            <span class="kt">boolean</span> <span class="n">ok</span> <span class="o">=</span> <span class="n">cipherPrx</span><span class="o">.</span><span class="na">sign</span><span class="o">(</span><span class="n">msg</span><span class="o">,</span> <span class="n">SignType</span><span class="o">.</span><span class="na">MD5withRSA</span><span class="o">.</span><span class="na">value</span><span class="o">(),</span> <span class="n">signStr</span><span class="o">);</span>
            <span class="n">MQSERVER_LOGGER</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&#34;signWithSend: {} -&gt; {}&#34;</span><span class="o">,</span> <span class="n">msg</span><span class="o">,</span> <span class="n">signStr</span><span class="o">.</span><span class="na">value</span><span class="o">);</span>
            <span class="k">if</span> <span class="o">(!</span><span class="n">ok</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
            <span class="o">}</span>
            <span class="n">String</span> <span class="n">content</span> <span class="o">=</span> <span class="n">signStr</span><span class="o">.</span><span class="na">getValue</span><span class="o">()</span> <span class="o">+</span> <span class="s">&#34;|&#34;</span><span class="o">;</span>

            <span class="c1">// æ˜¯å¦éœ€è¦å¯¹å‘é€çš„å†…å®¹è¿›è¡ŒåŠ å¯†
</span><span class="c1"></span>            <span class="k">if</span> <span class="o">(</span><span class="n">isEncode</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">Holder</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">enStr</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Holder</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;();</span>

                <span class="n">ok</span> <span class="o">=</span> <span class="n">encode</span><span class="o">(</span><span class="n">msg</span><span class="o">,</span> <span class="n">enStr</span><span class="o">);</span>
                <span class="c1">// åŠ å¯†å¤±è´¥å¤„ç†é€»è¾‘,æ ¹æ®ä¸šåŠ¡éœ€æ±‚ä¸åŒ,å¯ä»¥é‡‡ç”¨è¿”å›å¤±è´¥æˆ–ä¸åŠ å¯†,ç›´æ¥å‘é€æ˜æ–‡
</span><span class="c1"></span>                <span class="k">if</span> <span class="o">(!</span><span class="n">ok</span><span class="o">)</span> <span class="o">{</span>
                    <span class="c1">// è¿™é‡Œé€‰æ‹©ç›´æ¥å‘é€æ˜æ–‡
</span><span class="c1"></span>                    <span class="n">content</span> <span class="o">+=</span> <span class="n">msg</span><span class="o">;</span>
                <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                    <span class="c1">// åŠ å¯†æˆåŠŸ,å‘é€å¯†æ–‡
</span><span class="c1"></span>                    <span class="n">content</span> <span class="o">+=</span> <span class="n">enStr</span><span class="o">.</span><span class="na">getValue</span><span class="o">();</span>
                <span class="o">}</span>

            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                <span class="c1">// ä¸åŠ å¯†,å‘é€æ˜æ–‡
</span><span class="c1"></span>                <span class="n">content</span> <span class="o">+=</span> <span class="n">msg</span><span class="o">;</span>
            <span class="o">}</span>
            <span class="k">return</span> <span class="n">send</span><span class="o">(</span><span class="n">content</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">exHandler</span><span class="o">(</span><span class="s">&#34;signWithSend&#34;</span><span class="o">,</span> <span class="n">e</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="cm">/**
</span><span class="cm">     * é”™è¯¯å¤„ç†å™¨ ç±»é‡Œé¢ç»Ÿä¸€ä¸€ä¸‹,æœ‰ç©ºå†ç ”ç©¶ä¸€ä¸‹ç»Ÿä¸€é”™è¯¯æœºåˆ¶
</span><span class="cm">     * @param funcname
</span><span class="cm">     * @param e
</span><span class="cm">     * @return
</span><span class="cm">     */</span>
    <span class="kd">private</span> <span class="kt">boolean</span> <span class="nf">exHandler</span><span class="o">(</span><span class="n">String</span> <span class="n">funcname</span><span class="o">,</span> <span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="n">MQSERVER_LOGGER</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="s">&#34;{}() fail call. cause: {}&#34;</span><span class="o">,</span> <span class="n">funcname</span><span class="o">,</span> <span class="n">e</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
        <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>

    <span class="o">}</span>

<span class="o">}</span>
</code></pre></div><h3 id="ä¼˜åŒ–æ¶ˆæ¯ç›‘å¬è€…æœåŠ¡">ä¼˜åŒ–æ¶ˆæ¯ç›‘å¬è€…æœåŠ¡</h3>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Component</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ConsumerListener</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="kd">static</span> <span class="n">Logger</span> <span class="n">JMS_LISTENER</span> <span class="o">=</span> <span class="n">LoggerFactory</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="s">&#34;JMS_LISTENER&#34;</span><span class="o">);</span>

    <span class="cm">/**
</span><span class="cm">     * ä½¿ç”¨JmsListeneré…ç½®æ¶ˆè´¹è€…ç›‘å¬çš„é˜Ÿåˆ—
</span><span class="cm">     * 
</span><span class="cm">     * @param receivedMsg æ¥æ”¶åˆ°çš„æ¶ˆæ¯
</span><span class="cm">     */</span>

    <span class="c1">// @JmsListener(destination = &#34;DEV.QUEUE.1&#34;)
</span><span class="c1"></span>    <span class="nd">@JmsListener</span><span class="o">(</span><span class="n">destination</span> <span class="o">=</span> <span class="s">&#34;#{@conf.recvQueueName}&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">receiveQueue</span><span class="o">(</span><span class="n">String</span> <span class="n">receivedMsg</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">JMS_LISTENER</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&#34;RECEIVE: {}&#34;</span><span class="o">,</span> <span class="n">receivedMsg</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="n">DefaultJmsListenerContainerFactory</span> <span class="nf">jmsListenerContainerFactory</span><span class="o">(</span><span class="n">ConnectionFactory</span> <span class="n">connectionFactory</span><span class="o">,</span>
            <span class="n">ExampleErrorHandler</span> <span class="n">errorHandler</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">DefaultJmsListenerContainerFactory</span> <span class="n">factory</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DefaultJmsListenerContainerFactory</span><span class="o">();</span>
        <span class="n">factory</span><span class="o">.</span><span class="na">setConnectionFactory</span><span class="o">(</span><span class="n">connectionFactory</span><span class="o">);</span>
        <span class="n">factory</span><span class="o">.</span><span class="na">setErrorHandler</span><span class="o">(</span><span class="n">errorHandler</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">factory</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Service</span>
    <span class="kd">public</span> <span class="kd">class</span> <span class="nc">ExampleErrorHandler</span> <span class="kd">implements</span> <span class="n">ErrorHandler</span> <span class="o">{</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">handleError</span><span class="o">(</span><span class="n">Throwable</span> <span class="n">t</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">// handle exception here
</span><span class="c1"></span>            <span class="n">JMS_LISTENER</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="n">t</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="n">JmqConfig</span> <span class="nf">conf</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="n">JmqConfig</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div><h3 id="æ‰“åŒ…ä¸Šä¼ æµ‹è¯•è§‚å¯Ÿ">æ‰“åŒ…/ä¸Šä¼ /æµ‹è¯•/è§‚å¯Ÿ</h3>
<p>æˆ‘ä½¿ç”¨ Makefile æ‰“åŒ…ä¸Šä¼  <a href="https://github.com/aomirun/demo/blob/main/day-4/rsaserver/Makefile">Makefile ä»£ç  ä¼ é€é—¨</a></p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">$ make build-upload
</code></pre></div><p>ä¸€åˆ‡æ­£å¸¸,åŠ å¯†å’Œç­¾åéƒ½æµ‹è¯•æˆåŠŸäº†</p>
<h2 id="æºä»£ç ">æºä»£ç </h2>
<p><a href="https://github.com/aomirun/demo/tree/main/day-4">å®ç°javaçš„rsaåŠ è§£å¯†ä¸ç­¾åå¹¶è°ƒç”¨RPCå¾®æœåŠ¡(å¾®æœåŠ¡ç³»åˆ—ç¬¬å››å¤©)</a></p>
<h2 id="ç»“è¯­">ç»“è¯­</h2>
<p>ç»è¿‡å‡ å¤©çš„æŠ˜è…¾,è™½ç„¶ä»£ç æ²¡å†™å¤šå°‘è¡Œ,ä½†ç¢°åˆ°çš„é—®é¢˜ç¡®å®å¾ˆå¤š,è¿˜å¥½éƒ½åŸºæœ¬ä¸Šè§£å†³äº†.è¿™æ¬¡ä½¿ç”¨äº†ä¸€ä¸ªæœåŠ¡è°ƒç”¨å¦å¤–ä¸€ä¸ªæœåŠ¡çš„æ–¹å¼,ä½“ç°äº†åˆ†å¸ƒå¼å¾®æœåŠ¡çš„ä¸€äº›å¼€å‘ä¸ä½¿ç”¨.
ä»Šå¤©çš„rsaserverè¿›å±•æ‰©å±•,å¾ˆå¿«å°±å¯ä»¥å¼„å‡ºä¸€ä¸ªå¯†é’¥æœåŠ¡ä¸­å¿ƒ,ä¸“é—¨é’ˆå¯¹åŠ è§£å¯†è¿›è¡Œå¤„ç†,åˆå•ç‹¬ä¿å­˜äº†å…¬ç§é’¥,æ‰©å±•ä¸€ä¸‹è¿˜å¯ä»¥æå¯†é’¥é“¾.
ç§é’¥è¶Šå°‘äººæŒæ¡å°±è¶Šå®‰å…¨.</p>
]]></content>
		</item>
		
		<item>
			<title>å®ç°å®¢æˆ·ç«¯åŒæ­¥å’Œå¼‚æ­¥è°ƒç”¨RPCå¾®æœåŠ¡(å¾®æœåŠ¡ç³»åˆ—ç¬¬ä¸‰å¤©)</title>
			<link>https://aomi.run/posts/java/hello-java-3-day/</link>
			<pubDate>Thu, 28 Jan 2021 18:16:06 +0800</pubDate>
			
			<guid>https://aomi.run/posts/java/hello-java-3-day/</guid>
			<description>å‰è¨€  å­¦ä¹ javaçš„ç¬¬3å¤© å®ç°ç›®æ ‡ï¼š å­¦ä¹ tars å®¢æˆ·ç«¯åŒæ­¥å’Œå¼‚æ­¥è°ƒç”¨RPCæœåŠ¡
 å‰é¢æäº†é‚£ä¹ˆå¤šç¯å¢ƒï¼Œä¸»è¦è¿˜æ˜¯ä¸ºäº†æŠ˜è…¾å¤šè¯­è¨€å¾®æœåŠ¡å¼€å‘æ¶æ„ï¼Œè¿™æ ·å°±ä¸ç”¨åªé™å®šæŸä¸€ç§å¼€å‘è¯­è¨€äº†ï¼Œå„ç§è¯­è¨€è°è¡Œè°ä¸Šã€‚ä»Šå¤©ä¸»è¦ç›®çš„å°±æ˜¯æŠŠå‰é¢åšçš„æœåŠ¡ç«¯ç¨‹åºï¼Œä½¿ç”¨å®¢æˆ·ç«¯æ¥è°ƒç”¨ã€‚
å®¢æˆ·ç«¯åŒæ­¥/å•å‘/å¼‚æ­¥è°ƒç”¨æœåŠ¡ æ„å»ºå®¢æˆ·ç«¯å·¥ç¨‹é¡¹ç›®,æä¾›WEBä»£ç†æœåŠ¡ åˆ›å»ºæ–¹æ³•æœ‰å¾ˆå¤šç§ï¼Œå…·ä½“ä¸å¤šè¯´äº†ï¼Œè‡ªè¡Œåˆ›å»ºmavené¡¹ç›®
æ·»åŠ ä¾èµ– &amp;lt;dependency&amp;gt; &amp;lt;groupId&amp;gt;com.tencent.tars&amp;lt;/groupId&amp;gt; &amp;lt;artifactId&amp;gt;tars-client&amp;lt;/artifactId&amp;gt; &amp;lt;version&amp;gt;1.7.2&amp;lt;/version&amp;gt; &amp;lt;type&amp;gt;jar&amp;lt;/type&amp;gt; &amp;lt;/dependency&amp;gt; &amp;lt;dependency&amp;gt; &amp;lt;groupId&amp;gt;com.tencent.tars&amp;lt;/groupId&amp;gt; &amp;lt;artifactId&amp;gt;tars-spring-boot-starter&amp;lt;/artifactId&amp;gt; &amp;lt;version&amp;gt;1.7.2&amp;lt;/version&amp;gt; &amp;lt;/dependency&amp;gt; æ·»åŠ æ’ä»¶ &amp;lt;build&amp;gt; &amp;lt;finalName&amp;gt;mqwebservice&amp;lt;/finalName&amp;gt; &amp;lt;plugins&amp;gt; &amp;lt;plugin&amp;gt; &amp;lt;groupId&amp;gt;org.springframework.boot&amp;lt;/groupId&amp;gt; &amp;lt;artifactId&amp;gt;spring-boot-maven-plugin&amp;lt;/artifactId&amp;gt; &amp;lt;/plugin&amp;gt; &amp;lt;!--tars2java plugin --&amp;gt; &amp;lt;plugin&amp;gt; &amp;lt;groupId&amp;gt;com.tencent.tars&amp;lt;/groupId&amp;gt; &amp;lt;artifactId&amp;gt;tars-maven-plugin&amp;lt;/artifactId&amp;gt; &amp;lt;version&amp;gt;1.7.2&amp;lt;/version&amp;gt; &amp;lt;configuration&amp;gt; &amp;lt;tars2JavaConfig&amp;gt; &amp;lt;!-- tarsæ–‡ä»¶ä½ç½® --&amp;gt; &amp;lt;tarsFiles&amp;gt; &amp;lt;tarsFile&amp;gt;${basedir}/src/main/resources/mqserver.tars&amp;lt;/tarsFile&amp;gt; &amp;lt;/tarsFiles&amp;gt; &amp;lt;!-- æºæ–‡ä»¶ç¼–ç  --&amp;gt; &amp;lt;tarsFileCharset&amp;gt;UTF-8&amp;lt;/tarsFileCharset&amp;gt; &amp;lt;!-- ç”Ÿæˆä»£ç ï¼ŒPSï¼šå®¢æˆ·ç«¯è°ƒç”¨ï¼Œè¿™é‡Œéœ€è¦è®¾ç½®ä¸ºfalse --&amp;gt; &amp;lt;servant&amp;gt;false&amp;lt;/servant&amp;gt; &amp;lt;!-- ç”Ÿæˆæºä»£ç ç¼–ç  --&amp;gt; &amp;lt;charset&amp;gt;UTF-8&amp;lt;/charset&amp;gt; &amp;lt;!-- ç”Ÿæˆçš„æºä»£ç ç›®å½• --&amp;gt; &amp;lt;srcPath&amp;gt;${basedir}/src/main/java&amp;lt;/srcPath&amp;gt; &amp;lt;!-- ç”Ÿæˆæºä»£ç åŒ…å‰ç¼€ --&amp;gt; &amp;lt;packagePrefixName&amp;gt;com.example.mqwebservice.service.&amp;lt;/packagePrefixName&amp;gt; &amp;lt;/tars2JavaConfig&amp;gt; &amp;lt;/configuration&amp;gt; &amp;lt;/plugin&amp;gt; &amp;lt;!--package plugin--&amp;gt; &amp;lt;/plugins&amp;gt; &amp;lt;/build&amp;gt; æ³¨è§£main @SpringBootApplication @EnableTarsServer public class MqwebserviceApplication { public static void main(String[] args) { SpringApplication.</description>
			<content type="html"><![CDATA[<h2 id="å‰è¨€">å‰è¨€</h2>
<blockquote>
<p>å­¦ä¹ javaçš„ç¬¬3å¤© å®ç°ç›®æ ‡ï¼š å­¦ä¹ tars å®¢æˆ·ç«¯åŒæ­¥å’Œå¼‚æ­¥è°ƒç”¨RPCæœåŠ¡</p>
</blockquote>
<p>å‰é¢æäº†é‚£ä¹ˆå¤šç¯å¢ƒï¼Œä¸»è¦è¿˜æ˜¯ä¸ºäº†æŠ˜è…¾å¤šè¯­è¨€å¾®æœåŠ¡å¼€å‘æ¶æ„ï¼Œè¿™æ ·å°±ä¸ç”¨åªé™å®šæŸä¸€ç§å¼€å‘è¯­è¨€äº†ï¼Œå„ç§è¯­è¨€è°è¡Œè°ä¸Šã€‚ä»Šå¤©ä¸»è¦ç›®çš„å°±æ˜¯æŠŠå‰é¢åšçš„æœåŠ¡ç«¯ç¨‹åºï¼Œä½¿ç”¨å®¢æˆ·ç«¯æ¥è°ƒç”¨ã€‚</p>
<h2 id="å®¢æˆ·ç«¯åŒæ­¥å•å‘å¼‚æ­¥è°ƒç”¨æœåŠ¡">å®¢æˆ·ç«¯åŒæ­¥/å•å‘/å¼‚æ­¥è°ƒç”¨æœåŠ¡</h2>
<h3 id="æ„å»ºå®¢æˆ·ç«¯å·¥ç¨‹é¡¹ç›®æä¾›webä»£ç†æœåŠ¡">æ„å»ºå®¢æˆ·ç«¯å·¥ç¨‹é¡¹ç›®,æä¾›WEBä»£ç†æœåŠ¡</h3>
<p>åˆ›å»ºæ–¹æ³•æœ‰å¾ˆå¤šç§ï¼Œå…·ä½“ä¸å¤šè¯´äº†ï¼Œè‡ªè¡Œåˆ›å»ºmavené¡¹ç›®</p>
<h3 id="æ·»åŠ ä¾èµ–">æ·»åŠ ä¾èµ–</h3>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml">		<span class="nt">&lt;dependency&gt;</span>
			<span class="nt">&lt;groupId&gt;</span>com.tencent.tars<span class="nt">&lt;/groupId&gt;</span>
			<span class="nt">&lt;artifactId&gt;</span>tars-client<span class="nt">&lt;/artifactId&gt;</span>
			<span class="nt">&lt;version&gt;</span>1.7.2<span class="nt">&lt;/version&gt;</span>
			<span class="nt">&lt;type&gt;</span>jar<span class="nt">&lt;/type&gt;</span>
		<span class="nt">&lt;/dependency&gt;</span>
		<span class="nt">&lt;dependency&gt;</span>
			<span class="nt">&lt;groupId&gt;</span>com.tencent.tars<span class="nt">&lt;/groupId&gt;</span>
			<span class="nt">&lt;artifactId&gt;</span>tars-spring-boot-starter<span class="nt">&lt;/artifactId&gt;</span>
			<span class="nt">&lt;version&gt;</span>1.7.2<span class="nt">&lt;/version&gt;</span>
		<span class="nt">&lt;/dependency&gt;</span>
</code></pre></div><h3 id="æ·»åŠ æ’ä»¶">æ·»åŠ æ’ä»¶</h3>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml">	<span class="nt">&lt;build&gt;</span>
		<span class="nt">&lt;finalName&gt;</span>mqwebservice<span class="nt">&lt;/finalName&gt;</span>
		<span class="nt">&lt;plugins&gt;</span>
			<span class="nt">&lt;plugin&gt;</span>
				<span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
				<span class="nt">&lt;artifactId&gt;</span>spring-boot-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>
			<span class="nt">&lt;/plugin&gt;</span>
			<span class="c">&lt;!--tars2java plugin --&gt;</span>
			<span class="nt">&lt;plugin&gt;</span>
				<span class="nt">&lt;groupId&gt;</span>com.tencent.tars<span class="nt">&lt;/groupId&gt;</span>
				<span class="nt">&lt;artifactId&gt;</span>tars-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>
				<span class="nt">&lt;version&gt;</span>1.7.2<span class="nt">&lt;/version&gt;</span>
				<span class="nt">&lt;configuration&gt;</span>
					<span class="nt">&lt;tars2JavaConfig&gt;</span>
						<span class="c">&lt;!-- tarsæ–‡ä»¶ä½ç½® --&gt;</span>
						<span class="nt">&lt;tarsFiles&gt;</span>
							<span class="nt">&lt;tarsFile&gt;</span>${basedir}/src/main/resources/mqserver.tars<span class="nt">&lt;/tarsFile&gt;</span>
						<span class="nt">&lt;/tarsFiles&gt;</span>
						<span class="c">&lt;!-- æºæ–‡ä»¶ç¼–ç  --&gt;</span>
						<span class="nt">&lt;tarsFileCharset&gt;</span>UTF-8<span class="nt">&lt;/tarsFileCharset&gt;</span>
						<span class="c">&lt;!-- ç”Ÿæˆä»£ç ï¼ŒPSï¼šå®¢æˆ·ç«¯è°ƒç”¨ï¼Œè¿™é‡Œéœ€è¦è®¾ç½®ä¸ºfalse --&gt;</span>
						<span class="nt">&lt;servant&gt;</span>false<span class="nt">&lt;/servant&gt;</span>
						<span class="c">&lt;!-- ç”Ÿæˆæºä»£ç ç¼–ç  --&gt;</span>
						<span class="nt">&lt;charset&gt;</span>UTF-8<span class="nt">&lt;/charset&gt;</span>
						<span class="c">&lt;!-- ç”Ÿæˆçš„æºä»£ç ç›®å½• --&gt;</span>
						<span class="nt">&lt;srcPath&gt;</span>${basedir}/src/main/java<span class="nt">&lt;/srcPath&gt;</span>
						<span class="c">&lt;!-- ç”Ÿæˆæºä»£ç åŒ…å‰ç¼€ --&gt;</span>
						<span class="nt">&lt;packagePrefixName&gt;</span>com.example.mqwebservice.service.<span class="nt">&lt;/packagePrefixName&gt;</span>
					<span class="nt">&lt;/tars2JavaConfig&gt;</span>
				<span class="nt">&lt;/configuration&gt;</span>
			<span class="nt">&lt;/plugin&gt;</span>
			<span class="c">&lt;!--package plugin--&gt;</span>
		<span class="nt">&lt;/plugins&gt;</span>
	<span class="nt">&lt;/build&gt;</span>
</code></pre></div><h3 id="æ³¨è§£main">æ³¨è§£main</h3>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@SpringBootApplication</span>
<span class="nd">@EnableTarsServer</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MqwebserviceApplication</span> <span class="o">{</span>

	<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
		<span class="n">SpringApplication</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="n">MqwebserviceApplication</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">args</span><span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span>
</code></pre></div><h3 id="ç”Ÿæˆmqservertarså®¢æˆ·ç«¯æ–‡ä»¶">ç”Ÿæˆmqserver.tarså®¢æˆ·ç«¯æ–‡ä»¶</h3>
<p>æ–‡ä»¶ç”¨çš„æ˜¯ç¬¬ä¸€å¤©æœåŠ¡ç«¯çš„æ¥å£å®šä¹‰æ–‡ä»¶ <a href="/posts/java/hello-java-1-day/">ä¼ é€é—¨</a></p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">$ mvn tars:tars2java
</code></pre></div><h3 id="åˆ›å»ºwebæ§åˆ¶å™¨">åˆ›å»ºWebæ§åˆ¶å™¨</h3>
<p>src/main/java/com/example/mqwebservice/web/MQController.java</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@TarsHttpService</span><span class="o">(</span><span class="s">&#34;mqwebserviceObj&#34;</span><span class="o">)</span>
<span class="nd">@RestController</span><span class="o">()</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;/api/mq&#34;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MQController</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="kd">static</span> <span class="n">Logger</span> <span class="n">RPC_LOGGER</span> <span class="o">=</span> <span class="n">LoggerFactory</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="s">&#34;rpc&#34;</span><span class="o">);</span>

    <span class="nd">@TarsClient</span><span class="o">(</span><span class="s">&#34;example.mqserver.messageObj&#34;</span><span class="o">)</span>
    <span class="n">MessagePrx</span> <span class="n">messagePrx</span><span class="o">;</span>

    
    <span class="cm">/**
</span><span class="cm">     * è¿œç¨‹è°ƒç”¨rpcæœåŠ¡ï¼Œå‘é€æ¶ˆæ¯ç»™ibmmq
</span><span class="cm">     * 
</span><span class="cm">     * @param msg
</span><span class="cm">     * @return
</span><span class="cm">     */</span>
    <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">&#34;/send/{msg}&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">rpcSend</span><span class="o">(</span><span class="nd">@PathVariable</span><span class="o">(</span><span class="s">&#34;msg&#34;</span><span class="o">)</span> <span class="n">String</span> <span class="n">msg</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">StringUtils</span><span class="o">.</span><span class="na">isBlank</span><span class="o">(</span><span class="n">msg</span><span class="o">))</span> <span class="o">{</span>
            <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="n">RPC_LOGGER</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&#34;å‘é€çš„æŠ¥æ–‡ä¸º: {}&#34;</span><span class="o">,</span> <span class="n">msg</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">messagePrx</span><span class="o">.</span><span class="na">send</span><span class="o">(</span><span class="n">msg</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">&#34;/encode/{sign}&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">rpcEncode</span><span class="o">(</span><span class="nd">@PathVariable</span><span class="o">(</span><span class="s">&#34;sign&#34;</span><span class="o">)</span> <span class="n">String</span> <span class="n">sign</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Holder</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">enStr</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Holder</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;();</span>
        <span class="n">messagePrx</span><span class="o">.</span><span class="na">encode</span><span class="o">(</span><span class="n">sign</span><span class="o">,</span> <span class="n">enStr</span><span class="o">);</span>
        <span class="n">String</span> <span class="n">ret</span> <span class="o">=</span> <span class="n">enStr</span><span class="o">.</span><span class="na">value</span><span class="o">;</span>
        <span class="n">RPC_LOGGER</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&#34;æ”¶åˆ°çš„å¯†æ–‡æ˜¯: {}&#34;</span><span class="o">,</span> <span class="n">enStr</span><span class="o">.</span><span class="na">value</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">ret</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">&#34;/send/{msg}/encode/{sign}&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">rpcEncodeWithSend</span><span class="o">(</span><span class="nd">@PathVariable</span><span class="o">(</span><span class="s">&#34;msg&#34;</span><span class="o">)</span> <span class="n">String</span> <span class="n">msg</span><span class="o">,</span> <span class="nd">@PathVariable</span><span class="o">(</span><span class="s">&#34;sign&#34;</span><span class="o">)</span> <span class="n">String</span> <span class="n">sign</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">StringUtils</span><span class="o">.</span><span class="na">isBlank</span><span class="o">(</span><span class="n">msg</span><span class="o">)</span> <span class="o">||</span> <span class="n">StringUtils</span><span class="o">.</span><span class="na">isBlank</span><span class="o">(</span><span class="n">sign</span><span class="o">))</span> <span class="o">{</span>
            <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="kt">boolean</span> <span class="n">ok</span> <span class="o">=</span><span class="n">messagePrx</span><span class="o">.</span><span class="na">encodeWithSend</span><span class="o">(</span><span class="n">msg</span><span class="o">,</span> <span class="n">sign</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(!</span><span class="n">ok</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="n">RPC_LOGGER</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&#34;å‘é€çš„æŠ¥æ–‡ä¸º: {}&#34;</span><span class="o">,</span> <span class="n">msg</span><span class="o">);</span>
        <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div><h3 id="main">main</h3>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@SpringBootApplication</span>
<span class="nd">@EnableTarsServer</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MqwebserviceApplication</span> <span class="o">{</span>

	<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
		<span class="n">SpringApplication</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="n">MqwebserviceApplication</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">args</span><span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span>
</code></pre></div><h3 id="åŒæ­¥è°ƒç”¨æ³¨è§£">åŒæ­¥è°ƒç”¨æ³¨è§£</h3>
<p>é€šè¿‡æ³¨è§£ç»‘å®šäº†tarså®¢æˆ·ç«¯</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java">    <span class="nd">@TarsClient</span><span class="o">(</span><span class="s">&#34;example.mqserver.messageObj&#34;</span><span class="o">)</span>
    <span class="n">MessagePrx</span> <span class="n">messagePrx</span><span class="o">;</span>
</code></pre></div><h3 id="ç¼–å†™restful-å®ç°åŒæ­¥å¼‚æ­¥è¯·æ±‚">ç¼–å†™restful å®ç°åŒæ­¥/å¼‚æ­¥è¯·æ±‚</h3>
<p>src/main/java/com/example/client/controller/MessageController.java</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">// å¼€å¯tarsçš„webæœåŠ¡ï¼Œæ•´åˆspring boot tomcat çš„webæœåŠ¡
</span><span class="c1"></span><span class="nd">@TarsHttpService</span><span class="o">(</span><span class="s">&#34;mqwebserviceObj&#34;</span><span class="o">)</span>
<span class="nd">@RestController</span><span class="o">()</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;/api/mq&#34;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MQController</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="kd">static</span> <span class="n">Logger</span> <span class="n">RPC_LOGGER</span> <span class="o">=</span> <span class="n">LoggerFactory</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="s">&#34;rpc&#34;</span><span class="o">);</span>

    <span class="nd">@TarsClient</span><span class="o">(</span><span class="s">&#34;example.mqserver.messageObj&#34;</span><span class="o">)</span>
    <span class="n">MessagePrx</span> <span class="n">messagePrx</span><span class="o">;</span>

    <span class="cm">/**
</span><span class="cm">     * è¿œç¨‹è°ƒç”¨rpcæœåŠ¡ï¼Œå‘é€æ¶ˆæ¯ç»™ibmmq
</span><span class="cm">     * 
</span><span class="cm">     * @param msg
</span><span class="cm">     * @return
</span><span class="cm">     */</span>
    <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">&#34;/send/{msg}&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">rpcSend</span><span class="o">(</span><span class="nd">@PathVariable</span><span class="o">(</span><span class="s">&#34;msg&#34;</span><span class="o">)</span> <span class="n">String</span> <span class="n">msg</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">StringUtils</span><span class="o">.</span><span class="na">isBlank</span><span class="o">(</span><span class="n">msg</span><span class="o">))</span> <span class="o">{</span>
            <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="c1">// å¼‚æ­¥è°ƒç”¨
</span><span class="c1"></span>        <span class="n">RPC_LOGGER</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&#34;å¼€å§‹å¼‚æ­¥å‘é€çš„æŠ¥æ–‡ä¸º: {}&#34;</span><span class="o">,</span> <span class="n">msg</span><span class="o">);</span>
        <span class="n">messagePrx</span><span class="o">.</span><span class="na">async_send</span><span class="o">(</span><span class="k">new</span> <span class="n">MessagePrxCallback</span><span class="o">()</span> <span class="o">{</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">callback_expired</span><span class="o">()</span> <span class="o">{</span>
            <span class="o">}</span>

            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">callback_exception</span><span class="o">(</span><span class="n">Throwable</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
            <span class="o">}</span>

            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">callback_send</span><span class="o">(</span><span class="kt">boolean</span> <span class="n">ret</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">RPC_LOGGER</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&#34;æ¥æ”¶åˆ°å¼‚æ­¥è¿”å›çŠ¶æ€: {}, &#34;</span><span class="o">,</span><span class="n">ret</span><span class="o">);</span>
            <span class="o">}</span>

            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">callback_encode</span><span class="o">(</span><span class="kt">boolean</span> <span class="n">ret</span><span class="o">,</span> <span class="n">String</span> <span class="n">enStr</span><span class="o">){}</span>

            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">callback_encodeWithSend</span><span class="o">(</span><span class="kt">boolean</span> <span class="n">ret</span><span class="o">){}</span>
        <span class="o">},</span> <span class="n">msg</span><span class="o">);</span>
        
        <span class="c1">// å•å‘è°ƒç”¨ æ‰€è°“å•å‘è°ƒç”¨ï¼Œè¡¨ç¤ºå®¢æˆ·ç«¯åªç®¡å‘é€æ•°æ®ï¼Œè€Œä¸æ¥æ”¶æœåŠ¡ç«¯çš„å“åº”ï¼Œä¹Ÿä¸ç®¡æœåŠ¡ç«¯æ˜¯å¦æ¥æ”¶åˆ°è¯·æ±‚ã€‚
</span><span class="c1"></span>        <span class="n">messagePrx</span><span class="o">.</span><span class="na">async_send</span><span class="o">(</span><span class="kc">null</span><span class="o">,</span> <span class="n">msg</span><span class="o">);</span>
        <span class="n">RPC_LOGGER</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&#34;å•å‘è°ƒç”¨å‘é€çš„æŠ¥æ–‡ä¸º: {}&#34;</span><span class="o">,</span> <span class="n">msg</span><span class="o">);</span>


        <span class="c1">// åŒæ­¥è°ƒç”¨
</span><span class="c1"></span>        <span class="kt">boolean</span> <span class="n">isSend</span> <span class="o">=</span> <span class="n">messagePrx</span><span class="o">.</span><span class="na">send</span><span class="o">(</span><span class="n">msg</span><span class="o">);</span>
        <span class="n">RPC_LOGGER</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&#34;åŒæ­¥å‘é€çš„æŠ¥æ–‡ä¸º: {}, çŠ¶æ€ï¼š {}&#34;</span><span class="o">,</span> <span class="n">msg</span><span class="o">,</span> <span class="n">isSend</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">isSend</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">&#34;/encode/{sign}&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">rpcEncode</span><span class="o">(</span><span class="nd">@PathVariable</span><span class="o">(</span><span class="s">&#34;sign&#34;</span><span class="o">)</span> <span class="n">String</span> <span class="n">sign</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Holder</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">enStr</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Holder</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;();</span>
        <span class="n">messagePrx</span><span class="o">.</span><span class="na">encode</span><span class="o">(</span><span class="n">sign</span><span class="o">,</span> <span class="n">enStr</span><span class="o">);</span>
        <span class="n">String</span> <span class="n">ret</span> <span class="o">=</span> <span class="n">enStr</span><span class="o">.</span><span class="na">value</span><span class="o">;</span>
        <span class="n">RPC_LOGGER</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&#34;æ”¶åˆ°çš„å¯†æ–‡æ˜¯: {}&#34;</span><span class="o">,</span> <span class="n">enStr</span><span class="o">.</span><span class="na">value</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">ret</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">&#34;/send/{msg}/encode/{sign}&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">rpcEncodeWithSend</span><span class="o">(</span><span class="nd">@PathVariable</span><span class="o">(</span><span class="s">&#34;msg&#34;</span><span class="o">)</span> <span class="n">String</span> <span class="n">msg</span><span class="o">,</span> <span class="nd">@PathVariable</span><span class="o">(</span><span class="s">&#34;sign&#34;</span><span class="o">)</span> <span class="n">String</span> <span class="n">sign</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">StringUtils</span><span class="o">.</span><span class="na">isBlank</span><span class="o">(</span><span class="n">msg</span><span class="o">)</span> <span class="o">||</span> <span class="n">StringUtils</span><span class="o">.</span><span class="na">isBlank</span><span class="o">(</span><span class="n">sign</span><span class="o">))</span> <span class="o">{</span>
            <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="kt">boolean</span> <span class="n">ok</span> <span class="o">=</span> <span class="n">messagePrx</span><span class="o">.</span><span class="na">encodeWithSend</span><span class="o">(</span><span class="n">msg</span><span class="o">,</span> <span class="n">sign</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(!</span><span class="n">ok</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="n">RPC_LOGGER</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&#34;å‘é€çš„æŠ¥æ–‡ä¸º: {}&#34;</span><span class="o">,</span> <span class="n">msg</span><span class="o">);</span>
        <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div><h3 id="tarshttpservice-ç”¨é€”">@TarsHttpService ç”¨é€”</h3>
<p>æŠŠspringboot tomcatçš„ç«¯å£é…ç½®å˜æˆtarsçš„æŒ‡å®šçš„å•†å“ï¼Œå¯ä»¥åœ¨tars-webå¹³å°ä¸Šç»‘å®š</p>
<pre><code class="language-log" data-lang="log">[SERVER] server starting at tcp -h 127.0.0.1 -p 1080 -t 3000...
[SERVER] server started at tcp -h 127.0.0.1 -p 1080 -t 3000...
[SERVER] The application started successfully.
The session manager service started...
[SERVER] server is ready...
2021-01-30 14:25:14.886 INFO 26735 --- [ main] o.s.b.w.embedded.tomcat.TomcatWebServer : Tomcat started on port(s): 1080 (http) with context path ''
</code></pre><h3 id="éƒ¨ç½²">éƒ¨ç½²</h3>
<p>é€šè¿‡ä¹‹å‰çš„æ–¹æ³•ï¼Œæ‰“åŒ…-&gt;ä¸Šä¼ -&gt;æµ‹è¯•æ•°æ®-&gt;è§‚å¯Ÿç»“æœ</p>
<h4 id="æ‰“åŒ…">æ‰“åŒ…</h4>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">$ mvn clean package -DskipTests 
</code></pre></div><h4 id="ä¸Šä¼ ">ä¸Šä¼ </h4>
<p>é€šè¿‡tars-webä¸Šä¼ </p>
<h4 id="æµ‹è¯•">æµ‹è¯•</h4>
<p>é€šè¿‡æµè§ˆå™¨æˆ–curlæµ‹è¯•</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">$ curl http://localhost:1080/api/mq/send/abcd
<span class="o">{</span><span class="s2">&#34;success&#34;</span>:true,<span class="s2">&#34;code&#34;</span>:200,<span class="s2">&#34;msg&#34;</span>:null,<span class="s2">&#34;data&#34;</span>:true<span class="o">}</span>% 
</code></pre></div><h4 id="æŸ¥çœ‹ç»“æœ">æŸ¥çœ‹ç»“æœ</h4>
<p>åœ¨tars-webåé¢æŸ¥çœ‹æ—¥å¿—ï¼Œå¯ä»¥çœ‹åˆ°æ”¶åˆ°äº†æ¶ˆæ¯ï¼ŒåŒæ­¥æ¶ˆæ¯æµ‹è¯•å®Œæˆã€‚
mqserver</p>
<pre><code class="language-log" data-lang="log">2021-01-30 14:28:30.033 INFO 26862 --- [ageObjAdapter-5] msg : send: DEV.QUEUE.1 -&gt; abcd
2021-01-30 14:28:30.034 INFO 26862 --- [ageObjAdapter-2] msg : send: DEV.QUEUE.1 -&gt; abcd
2021-01-30 14:28:30.035 INFO 26862 --- [ageObjAdapter-1] msg : send: DEV.QUEUE.1 -&gt; abcd
2021-01-30 14:28:30.037 INFO 26862 --- [enerContainer-1] flow : Consumeræ”¶åˆ°çš„æŠ¥æ–‡ä¸º: abcd
2021-01-30 14:28:30.126 INFO 26862 --- [enerContainer-1] flow : Consumeræ”¶åˆ°çš„æŠ¥æ–‡ä¸º: abcd
2021-01-30 14:28:30.130 INFO 26862 --- [enerContainer-1] flow : Consumeræ”¶åˆ°çš„æŠ¥æ–‡ä¸º: abcd
</code></pre><p>mqwebservice</p>
<pre><code class="language-log" data-lang="log">2021-01-30 14:28:30.027 INFO 27613 --- [0.5-1080-exec-1] rpc : å¼€å§‹å¼‚æ­¥å‘é€çš„æŠ¥æ–‡ä¸º: abcd
2021-01-30 14:28:30.033 INFO 27613 --- [0.5-1080-exec-1] rpc : å•å‘è°ƒç”¨å‘é€çš„æŠ¥æ–‡ä¸º: abcd
2021-01-30 14:28:30.040 INFO 27613 --- [ient-executor-2] rpc : æ¥æ”¶åˆ°å¼‚æ­¥è¿”å›çŠ¶æ€: true,
2021-01-30 14:28:30.136 INFO 27613 --- [0.5-1080-exec-1] rpc : åŒæ­¥å‘é€çš„æŠ¥æ–‡ä¸º: abcd, çŠ¶æ€ï¼š true
</code></pre><p>ä¸ºäº†å±•ç¤ºä¾‹å­ï¼Œé¡¹ç›®ä»£ç è¿˜æ˜¯æ¯”è¾ƒç®€å•çš„ã€‚</p>
<h2 id="ç”¨golangç»™javaæœåŠ¡å‘æ¶ˆæ¯">ç”¨golangç»™javaæœåŠ¡å‘æ¶ˆæ¯</h2>
<p>åé¢æƒ³æƒ³åŠ ä¸ªå…¶å®ƒè¯­è¨€å¼€å‘çš„å®¢æˆ·ç«¯æ¥è°ƒç”¨ï¼Œä½“éªŒå¤šè¯­è¨€çš„ä¼˜åŠ¿ï¼Œåªæ˜¯ç®€è¦çš„å®Œæˆï¼Œç”¨äºæµ‹è¯•</p>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
	<span class="s">&#34;fmt&#34;</span>
	<span class="s">&#34;log&#34;</span>

	<span class="s">&#34;github.com/TarsCloud/TarsGo/tars&#34;</span>

	<span class="s">&#34;aomi.run/goclient/mqserver&#34;</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="nx">comm</span> <span class="o">:=</span> <span class="nx">tars</span><span class="p">.</span><span class="nf">NewCommunicator</span><span class="p">()</span>
	<span class="nx">obj</span> <span class="o">:=</span> <span class="nx">fmt</span><span class="p">.</span><span class="nf">Sprintf</span><span class="p">(</span><span class="s">&#34;example.mqserver.messageObj&#34;</span><span class="p">)</span>
	<span class="nx">app</span> <span class="o">:=</span> <span class="nb">new</span><span class="p">(</span><span class="nx">mqserver</span><span class="p">.</span><span class="nx">Message</span><span class="p">)</span>
	<span class="nx">comm</span><span class="p">.</span><span class="nf">StringToProxy</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="nx">app</span><span class="p">)</span>

	<span class="nx">ret</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">app</span><span class="p">.</span><span class="nf">Send</span><span class="p">(</span><span class="s">&#34;é€šè¿‡golangå‘é€çš„æ¶ˆæ¯&#34;</span><span class="p">)</span>
	<span class="nf">check</span><span class="p">(</span><span class="nx">ret</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>

	<span class="nx">enStr</span> <span class="o">:=</span> <span class="s">&#34;&#34;</span>
	<span class="nx">ret</span><span class="p">,</span> <span class="nx">err</span> <span class="p">=</span> <span class="nx">app</span><span class="p">.</span><span class="nf">Encode</span><span class="p">(</span><span class="s">&#34;é€šè¿‡golangå‘é€çš„åŠ å¯†æ–‡æœ¬&#34;</span><span class="p">,</span> <span class="o">&amp;</span><span class="nx">enStr</span><span class="p">)</span>
	<span class="nf">check</span><span class="p">(</span><span class="nx">ret</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>

	<span class="nx">ret</span><span class="p">,</span> <span class="nx">err</span> <span class="p">=</span> <span class="nx">app</span><span class="p">.</span><span class="nf">EncodeWithSend</span><span class="p">(</span><span class="s">&#34;é€šè¿‡golangå‘é€çš„æ¶ˆæ¯&#34;</span><span class="p">,</span> <span class="s">&#34;é€šè¿‡golangå‘é€çš„åŠ å¯†æ–‡æœ¬&#34;</span><span class="p">)</span>
	<span class="nf">check</span><span class="p">(</span><span class="nx">ret</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>

<span class="p">}</span>

<span class="kd">func</span> <span class="nf">check</span><span class="p">(</span><span class="nx">status</span> <span class="kt">bool</span><span class="p">,</span> <span class="nx">err</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
		<span class="nx">log</span><span class="p">.</span><span class="nf">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
	<span class="p">}</span>
	<span class="nx">log</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">status</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div><h3 id="æ—¥å¿—æ¶ˆæ¯">æ—¥å¿—æ¶ˆæ¯</h3>
<pre><code class="language-log" data-lang="log">onSessionDestroyed: 0
2021-01-30 19:05:09.369 INFO 18188 --- [ageObjAdapter-3] msg : send: DEV.QUEUE.1 -&gt; é€šè¿‡golangå‘é€çš„æ¶ˆæ¯
2021-01-30 19:05:09.381 INFO 18188 --- [enerContainer-1] flow : Consumeræ”¶åˆ°çš„æŠ¥æ–‡ä¸º: é€šè¿‡golangå‘é€çš„æ¶ˆæ¯
2021-01-30 19:05:09.381 INFO 18188 --- [ageObjAdapter-4] msg : encode: é€šè¿‡golangå‘é€çš„åŠ å¯†æ–‡æœ¬ -&gt; 123é€šè¿‡golangå‘é€çš„åŠ å¯†æ–‡æœ¬456
2021-01-30 19:05:09.383 INFO 18188 --- [ageObjAdapter-5] msg : encode: é€šè¿‡golangå‘é€çš„åŠ å¯†æ–‡æœ¬ -&gt; 123é€šè¿‡golangå‘é€çš„åŠ å¯†æ–‡æœ¬456
2021-01-30 19:05:09.383 INFO 18188 --- [ageObjAdapter-5] msg : send: DEV.QUEUE.1 -&gt; 123é€šè¿‡golangå‘é€çš„åŠ å¯†æ–‡æœ¬456é€šè¿‡golangå‘é€çš„æ¶ˆæ¯
2021-01-30 19:05:09.387 INFO 18188 --- [enerContainer-1] flow : Consumeræ”¶åˆ°çš„æŠ¥æ–‡ä¸º: 123é€šè¿‡golangå‘é€çš„åŠ å¯†æ–‡æœ¬456é€šè¿‡golangå‘é€çš„æ¶ˆæ¯
</code></pre><h2 id="æœ¬åœ°è°ƒè¯•">æœ¬åœ°è°ƒè¯•</h2>
<p>å¦‚æœæ‰€æœ‰å¼€å‘çš„é¡¹ç›®éƒ½è¦æ‰“åŒ…/ä¸Šä¼ /è¿œç¨‹è°ƒè¯•/æŸ¥çœ‹æ—¥å¿—ï¼Œæ— ç–‘æ˜¯éå¸¸éº»çƒ¦çš„ï¼Œæ‰€ä»¥å°±éœ€è¦æœ‰æœ¬åœ°è°ƒè¯•ã€‚æŸ¥çœ‹tarså®˜æ–¹æ–‡æ¡£ä¸­æœ‰æè¿°è¯´æ˜</p>
<blockquote>
<ul>
<li>é¦–å…ˆåœ¨å·¥ç¨‹ç›®å½•ä¸‹æ‰§è¡Œ mvn tars:build -Dapp=TestApp -Dserver=HelloJavaServer -DjvmParams=&quot;-Xms1024m -Xmx1024m -Dcom.sun.management.jmxremote.ssl=false -Dcom.sun.management.jmxremote.authenticate=false -Xdebug -Xrunjdwp:transport=dt_socket,address=9000,server=y,suspend=n&quot;</li>
<li>åœ¨å·¥ç¨‹ç›®å½•target/tars/bin/tars_start å¯åŠ¨æœåŠ¡</li>
</ul>
</blockquote>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">$ mvn tars:build -Dapp<span class="o">=</span>example -Dserver<span class="o">=</span>mqserver -DjvmParams<span class="o">=</span><span class="s2">&#34;-Xms1024m -Xmx1024m -Dcom.sun.management.jmxremote.ssl=false -Dcom.sun.management.jmxremote.authenticate=false -Xdebug -Xrunjdwp:transport=dt_socket,address=9000,server=y,suspend=n&#34;</span> 
</code></pre></div><p>æˆ‘è°ƒè¯•äº†ä¸€æ®µæ—¶é—´ï¼Œä¼šæŠ¥ä¸€äº›é”™è¯¯ï¼Œæœ€åæç¤ºé”™è¯¯ä¸ºï¼Œä¸€ç›´æ²¡æœ‰è§£å†³</p>
<pre><code>Failed to tars build: failed to find WEB-INF/servants.xml,  servants will be disabled
</code></pre><p>å¦‚ä½•é…ç½®ä½¿<code>tars:build</code>æ‰¾åˆ°è¿™ä¸ªç›®å½•å’Œæ–‡ä»¶ï¼Œè¿˜æ²¡å­¦ä¼šï¼Œä»¥åå­¦ä¼šäº†å†å›æ¥ä¿®æ”¹è¿™ä¸€æ®µã€‚
ç°åœ¨æˆ‘ä½¿ç”¨å¦å¤–ä¸€ä¸ªæ–¹æ³•æ¥è§£å†³è¿™ä¸ªé—®é¢˜,ä»¥ç¬¬2å¤©çš„ä»£ç ä¸ºä¾‹å­ï¼Œæ¥åšæœ¬åœ°è°ƒè¯•ï¼Œå› ä¸ºä»Šå¤©çš„ä¾‹å­æ˜¯å®¢æˆ·ç«¯ï¼Œä¾èµ–ç¬¬2å¤©åšçš„æœåŠ¡ç«¯ã€‚</p>
<h3 id="ä»tarsæœåŠ¡å™¨æ‰¾æ–‡ä»¶">ä»tarsæœåŠ¡å™¨æ‰¾æ–‡ä»¶</h3>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">$ tree ~/docker-app/tars/data/node/tarsnode-data/example.mqserver

â”œâ”€â”€ bin
â”‚   â”œâ”€â”€ example.mqserver.jar
â”‚   â””â”€â”€ tars_start.sh
â”œâ”€â”€ conf
â”‚   â”œâ”€â”€ example.mqserver.config.conf
â”‚   â””â”€â”€ example.mqserver.config.conf.bak
â””â”€â”€ data
    â””â”€â”€ tarsnodes.dat

<span class="m">3</span> directories, <span class="m">5</span> files

$ cp ~/docker-app/tars/data/node/tarsnode-data/example.mqserver/bin/tars_start.sh .
$ cp ~/docker-app/tars/data/node/tarsnode-data/example.mqserver/conf/example.mqserver.config.conf .
</code></pre></div><h3 id="ä¿®æ”¹-examplemqserverconfigconf">ä¿®æ”¹ example.mqserver.config.conf</h3>
<p>day-2/tars-mq-server/src/main/resources/example.mqserver.config.conf</p>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml"><span class="nt">&lt;tars&gt;</span>
	<span class="nt">&lt;application&gt;</span>
		enableset=N
		setdivision=NULL
		<span class="nt">&lt;client&gt;</span>
			locator=
			sync-invoke-timeout=20000
			async-invoke-timeout=20000
			refresh-endpoint-interval=60000
			stat=tars.tarsstat.StatObj
			property=tars.tarsproperty.PropertyObj
			report-interval=60000
			modulename=mqserver.messageJavaServer
		<span class="nt">&lt;/client&gt;</span>
		<span class="nt">&lt;server&gt;</span>
			node=
            		app=mqserver
            		server=Message
            		localip=127.0.0.1
            		local=tcp -h 127.0.0.1 -p 18601 -t 3000
            		basepath=.
            		datapath=.
            		logpath=.
            		loglevel=DEBUG
            		logsize=15M
            		log=
            		config=tars.tarsconfig.ConfigObj
            		notify=tars.tarsnotify.NotifyObj
            		mainclass=com.qq.tars.server.startup.Main
            		jvmparams=-Xms1024m -Xmx1024m
            		sessiontimeout=120000
            		sessioncheckinterval=60000
            		tcpnodelay=true
            		udpbuffersize=8192
            		charsetname=UTF-8
			<span class="nt">&lt;mqserver.Message.messageObjAdapter&gt;</span>
				allow
				endpoint=tcp -h 127.0.0.1 -p 18600 -t 60000
				handlegroup=mqserver.Message.messageObjAdapter
				maxconns=200000
				protocol=tars
				queuecap=10000
				queuetimeout=60000
				servant=mqserver.Message.messageObj
				shmcap=0
				shmkey=0
				threads=100
			<span class="nt">&lt;/mqserver.Message.messageObjAdapter&gt;</span>
		<span class="nt">&lt;/server&gt;</span>
	<span class="nt">&lt;/application&gt;</span>
<span class="nt">&lt;/tars&gt;</span>
</code></pre></div><h3 id="ä¿®æ”¹tars_startsh">ä¿®æ”¹tars_start.sh</h3>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh"><span class="cp">#!/bin/sh
</span><span class="cp"></span>
java -Dconfig<span class="o">=</span>target/classes/example.mqserver.config.conf -Dcom.sun.management.jmxremote.ssl<span class="o">=</span><span class="nb">false</span> -Dcom.sun.management.jmxremote.authenticate<span class="o">=</span><span class="nb">false</span> -Xms2000m -Xmx2000m -Xmn1000m -Xss1000k -XX:CMSInitiatingOccupancyFraction<span class="o">=</span><span class="m">60</span> -XX:+CMSParallelRemarkEnabled -XX:+CMSScavengeBeforeRemark -verbosegc -XX:+PrintGCDetails -XX:ErrorFile<span class="o">=</span>target/mqserver/logs/jvm_error.log -jar target/mqserver.jar
</code></pre></div><h3 id="å¯åŠ¨æœ¬åœ°æµ‹è¯•">å¯åŠ¨æœ¬åœ°æµ‹è¯•</h3>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">$ sh tars_start.sh


  .   ____          _            __ _ _
 /<span class="se">\\</span> / ___<span class="s1">&#39;_ __ _ _(_)_ __  __ _ \ \ \ \
</span><span class="s1">( ( )\___ | &#39;</span>_ <span class="p">|</span> <span class="s1">&#39;_| | &#39;</span>_ <span class="se">\/</span> _<span class="sb">`</span> <span class="p">|</span> <span class="se">\ \ \ \
</span><span class="se"></span> <span class="se">\\</span>/  ___<span class="o">)</span><span class="p">|</span> <span class="p">|</span>_<span class="o">)</span><span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="o">||</span> <span class="o">(</span>_<span class="p">|</span> <span class="p">|</span>  <span class="o">)</span> <span class="o">)</span> <span class="o">)</span> <span class="o">)</span>
  <span class="err">&#39;</span>  <span class="p">|</span>____<span class="p">|</span> .__<span class="p">|</span>_<span class="p">|</span> <span class="p">|</span>_<span class="p">|</span>_<span class="p">|</span> <span class="p">|</span>_<span class="se">\_</span>_, <span class="p">|</span> / / / /
 <span class="o">=========</span><span class="p">|</span>_<span class="p">|</span><span class="o">==============</span><span class="p">|</span>___/<span class="o">=</span>/_/_/_/
 :: Spring Boot ::                <span class="o">(</span>v2.4.2<span class="o">)</span>
 ...
 ...
 ...
</code></pre></div><p>è¿™æ ·æœ¬åœ°å°±å¯åŠ¨èµ·æ¥äº†ï¼Œè°ƒè¯•æ–¹ä¾¿å¤šäº†ã€‚
æ—¢ç„¶å·²ç»æŠ˜è…¾è¿™ä¹ˆä¹…äº†ï¼Œåç»­è¿˜ä¼šå¾ˆé¢‘ç¹çš„ä½¿ç”¨ï¼Œå¼„ä¸ªè„šæœ¬æ–‡ä»¶æ¥å¤„ç†å§ã€‚</p>
<h3 id="makefile">Makefile</h3>
<p>ç”¨Linuxåšå¼€å‘çš„äººè‚¯å®šå¾ˆç†Ÿäº†ï¼Œæˆ‘è¿™é‡Œå°±ç®€å•çš„å¼„äº†ä¸€ä¸ªè„šæœ¬ã€‚
å…¶å®å°±æ˜¯åšäº†mvnä¸€äº›å‘½ä»¤çš„åˆ«åï¼Œå¦å¤–åŠ äº†ä¸€ä¸ªä¸Šä¼ jaræ–‡ä»¶çš„å‘½ä»¤ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">$ make <span class="nb">help</span>
<span class="o">===============</span>A common Makefile <span class="k">for</span> java maven tars <span class="nv">programs</span><span class="o">==============</span>
Copyright <span class="o">(</span>C<span class="o">)</span> <span class="m">2021</span> aomi.run
The following targets aresupport:

 <span class="nb">test</span>                                   - mvn <span class="nb">test</span>
 run                                    - tars <span class="nb">local</span> run
 build                                  - mvn clean package -DskipTests
 test-build                             - mvn clean package
 upload                                 - upload jar package to tars node
 build-upload                           - build and upload
 test-build-upload                      - test-build and upload
 <span class="nb">help</span>                                   - print <span class="nb">help</span> information

To make a target, <span class="k">do</span> <span class="s1">&#39;make [target]&#39;</span>
<span class="o">===============================</span> Version 1.7.2 <span class="o">=============================</span>
</code></pre></div><p><code>Makefile</code>æ–‡ä»¶å­˜æ”¾åœ¨æˆ‘çš„githubä¸Šé¢ï¼Œéœ€è¦çš„å¯ä»¥è¿›å…¥<a href="https://github.com/aomirun/demo/blob/main/day-2/tars-mq-server/Makefile">ä¼ é€é—¨</a>æŸ¥çœ‹ã€‚</p>
<h2 id="æºä»£ç ">æºä»£ç </h2>
<p><a href="https://github.com/aomirun/demo/tree/main/day-3/mqwebservice">å®ç°å®¢æˆ·ç«¯åŒæ­¥å’Œå¼‚æ­¥è°ƒç”¨RPCå¾®æœåŠ¡(å¾®æœåŠ¡ç³»åˆ—ç¬¬ä¸‰å¤©)</a></p>
<h2 id="ç»“è¯­">ç»“è¯­</h2>
<p>æœ¬æ‰“ç®—ä»Šå¤©å¼„ç®€å•ç‚¹ï¼Œä¸æƒ³åˆ°åˆåŠ äº†ä¸ªæœ¬åœ°è°ƒè¯•ï¼Œå’Œæ‰“åŒ…ä¸Šä¼ è„šæœ¬ï¼Œè¶…çº²äº†ï¼é¡ºä¾¿æ¢³ç†äº†è¿™3ä¸ªæ–‡ç« ï¼ŒæŠŠé¡¹ç›®åç§°å’Œæ–‡ä»¶åç§°ç†äº†ä¸€ä¸‹ï¼Œé¡ºä¾¿æŠŠæºä»£ç ä¹Ÿå­˜æ”¾åˆ°githubä¸Šé¢ï¼Œæ–¹ä¾¿ä»Šåè‡ªå·±å¿˜è®°äº†å¯ä»¥æŸ¥é˜…ã€‚</p>
]]></content>
		</item>
		
		<item>
			<title>å®ç°tars-springboot-ibm-mqçš„å¾®æœåŠ¡(å¾®æœåŠ¡ç³»åˆ—ç¬¬äºŒå¤©)</title>
			<link>https://aomi.run/posts/java/hello-java-2-day/</link>
			<pubDate>Wed, 27 Jan 2021 12:37:57 +0800</pubDate>
			
			<guid>https://aomi.run/posts/java/hello-java-2-day/</guid>
			<description>å‰è¨€  å­¦ä¹ JAVAç¬¬2å¤© ç›®æ ‡å®ç°ï¼š åŸºäºtars springboot ibm mqçš„å¾®æœåŠ¡
 ç¬¬1å¤©å­¦ä¹ äº†javaçš„é¡¹ç›®åˆ›å»ºï¼Œæ‰“åŒ…ï¼Œä¸Šä¼ åˆ°tarsä¸­ï¼Œæ”¶è·è‰¯å¤šï¼Œä»Šå¤©æŠ˜è…¾ä¸€ä¸‹é¡¹ç›®ä¸­éœ€è¦ç”¨åˆ°çš„IBM MQæ¶ˆæ¯æœåŠ¡,äºæ˜¯å°±å®ç°äº†åŸºäºtars springboot ibm mqçš„å¾®æœåŠ¡.
æ­å»ºIBM MQ åŒæ ·è¿˜æ˜¯ä½¿ç”¨dockeræ¥åˆ›å»ºï¼Œæ·»åŠ ibmmq
$ docker volume create qm1data # ibm mq æœ‰äº›æƒé™è¦æ±‚ï¼Œé…ç½®ä¸å½“æœ‰å¯èƒ½å¯åŠ¨ä¸äº†ï¼Œæ‰€ä»¥ä½¿ç”¨å·çš„æ–¹å¼æ¯”è¾ƒç®€å• docker-compose.yml ä¸­æ·»åŠ å†…å®¹å¦‚ä¸‹ï¼š
ibmmq:image:ibmcom/mqcontainer_name:ibmmqvolumes:- qm1data:/mnt/mqmenvironment:LICENSE:&amp;#34;accept&amp;#34;MQ_QMGR_NAME:&amp;#34;QM1&amp;#34;MQ_APP_PASSWORD:&amp;#34;abcd1234&amp;#34;ports:- &amp;#34;1414:1414&amp;#34;- &amp;#34;9443:9443&amp;#34;networks:tars:ipv4_address:172.25.0.201volumes:qm1data:å¦å¤–ç»™nodeä¸€ä¸ªwebæœåŠ¡ç«¯å£ï¼Œåç»­ä¼šç”¨ä¸Š
node:# image: tarscloud/tars-node:stableimage:tarscloud/tars-node:latestcontainer_name:tars-node# restart: alwaysports:- &amp;#34;1080:1080&amp;#34;networks:tars:ipv4_address:172.25.0.5volumes:- ./node/data:/data/tars:rw- /etc/localtime:/etc/localtimeenvironment:INET:eth0WEB_HOST:http://172.25.0.3:3000depends_on:- frameworkè¿è¡Œèµ·æ¥
$ docker-compose up -d Creating tars-mysql ... done Creating ibmmq ... done Creating tars-framework ... done Creating tars-node ... done æ‰“å¼€æµè§ˆå™¨è®¿é—®ä¸€ä¸‹ï¼Œå¹¶åšç›¸åº”çš„é…ç½® https://localhost:9443 é‡è¦ï¼ï¼ï¼ 9443æ˜¯SSLç«¯å£ï¼Œä¸€å®šéœ€è¦ä½¿ç”¨httpsæ¥è®¿é—®,å¥½åƒibmmqè¿™ä¸ªç‰ˆæœ¬çš„webæœåŠ¡æœ‰bug,é‡å¯Dockeråï¼Œä¼šå ç”¨ç«¯å£ï¼Œä¹‹åå°±å¯åŠ¨ä¸äº†äº†ï¼ŒåŸå› æ²¡æœ‰æ·±ç©¶ï¼Œæµ‹è¯•çš„è¯ï¼Œé»˜è®¤åˆ›å»ºå¥½åå°±å¯ä»¥ä½¿ç”¨ï¼Œè¦ä¸è¦Webç®¡ç†ç«¯éƒ½æ— æ‰€è°“ã€‚
IBM MQç™»å½•é¡µ è¾“å…¥è´¦å·å¯†ç ç™»å½•ï¼Œé»˜è®¤è´¦å·å¯†ç æ˜¯ï¼š admin/passw0rd
IBM MQç™»å½•åçš„æ¬¢è¿é¡µ ç‰ˆæœ¬ä¿¡æ¯ æ–°ç‰ˆæœ¬çš„IBM MQçš„ç•Œé¢è¿˜æ˜¯å¾ˆæ¼‚äº®çš„</description>
			<content type="html"><![CDATA[<h2 id="å‰è¨€">å‰è¨€</h2>
<blockquote>
<p>å­¦ä¹ JAVAç¬¬2å¤© ç›®æ ‡å®ç°ï¼š åŸºäºtars springboot ibm mqçš„å¾®æœåŠ¡</p>
</blockquote>
<p>ç¬¬1å¤©å­¦ä¹ äº†javaçš„é¡¹ç›®åˆ›å»ºï¼Œæ‰“åŒ…ï¼Œä¸Šä¼ åˆ°tarsä¸­ï¼Œæ”¶è·è‰¯å¤šï¼Œä»Šå¤©æŠ˜è…¾ä¸€ä¸‹é¡¹ç›®ä¸­éœ€è¦ç”¨åˆ°çš„IBM MQæ¶ˆæ¯æœåŠ¡,äºæ˜¯å°±å®ç°äº†åŸºäºtars springboot ibm mqçš„å¾®æœåŠ¡.</p>
<h2 id="æ­å»ºibm-mq">æ­å»ºIBM MQ</h2>
<p>åŒæ ·è¿˜æ˜¯ä½¿ç”¨dockeræ¥åˆ›å»ºï¼Œæ·»åŠ ibmmq</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">$ docker volume create qm1data  <span class="c1"># ibm mq æœ‰äº›æƒé™è¦æ±‚ï¼Œé…ç½®ä¸å½“æœ‰å¯èƒ½å¯åŠ¨ä¸äº†ï¼Œæ‰€ä»¥ä½¿ç”¨å·çš„æ–¹å¼æ¯”è¾ƒç®€å•</span>
</code></pre></div><p>docker-compose.yml ä¸­æ·»åŠ å†…å®¹å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-yml" data-lang="yml"><span class="w">  </span><span class="nt">ibmmq</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">ibmcom/mq</span><span class="w">
</span><span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l">ibmmq</span><span class="w">
</span><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- <span class="l">qm1data:/mnt/mqm</span><span class="w">
</span><span class="w">    </span><span class="nt">environment</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="nt">LICENSE</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;accept&#34;</span><span class="w">
</span><span class="w">      </span><span class="nt">MQ_QMGR_NAME</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;QM1&#34;</span><span class="w">
</span><span class="w">      </span><span class="nt">MQ_APP_PASSWORD</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;abcd1234&#34;</span><span class="w">
</span><span class="w">    </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- <span class="s2">&#34;1414:1414&#34;</span><span class="w">
</span><span class="w">      </span>- <span class="s2">&#34;9443:9443&#34;</span><span class="w">
</span><span class="w">    </span><span class="nt">networks</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="nt">tars</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="nt">ipv4_address</span><span class="p">:</span><span class="w"> </span><span class="m">172.25.0.201</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">qm1data</span><span class="p">:</span><span class="w">
</span><span class="w">   
</span></code></pre></div><p>å¦å¤–ç»™nodeä¸€ä¸ªwebæœåŠ¡ç«¯å£ï¼Œåç»­ä¼šç”¨ä¸Š</p>
<div class="highlight"><pre class="chroma"><code class="language-yml" data-lang="yml"><span class="w">  </span><span class="nt">node</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="c"># image: tarscloud/tars-node:stable</span><span class="w">
</span><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">tarscloud/tars-node:latest</span><span class="w">
</span><span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l">tars-node</span><span class="w">
</span><span class="w">    </span><span class="c"># restart: always</span><span class="w">
</span><span class="w">    </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- <span class="s2">&#34;1080:1080&#34;</span><span class="w">
</span><span class="w">    </span><span class="nt">networks</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="nt">tars</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="nt">ipv4_address</span><span class="p">:</span><span class="w"> </span><span class="m">172.25.0.5</span><span class="w">
</span><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- <span class="l">./node/data:/data/tars:rw</span><span class="w">
</span><span class="w">      </span>- <span class="l">/etc/localtime:/etc/localtime</span><span class="w">
</span><span class="w">    </span><span class="nt">environment</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="nt">INET</span><span class="p">:</span><span class="w"> </span><span class="l">eth0</span><span class="w">
</span><span class="w">      </span><span class="nt">WEB_HOST</span><span class="p">:</span><span class="w"> </span><span class="l">http://172.25.0.3:3000</span><span class="w">
</span><span class="w">    </span><span class="nt">depends_on</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- <span class="l">framework</span><span class="w">
</span></code></pre></div><p>è¿è¡Œèµ·æ¥</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">$ docker-compose up -d

Creating tars-mysql ... <span class="k">done</span>
Creating ibmmq      ... <span class="k">done</span>
Creating tars-framework ... <span class="k">done</span>
Creating tars-node      ... <span class="k">done</span>
</code></pre></div><p>æ‰“å¼€æµè§ˆå™¨è®¿é—®ä¸€ä¸‹ï¼Œå¹¶åšç›¸åº”çš„é…ç½® https://localhost:9443 <code>é‡è¦ï¼ï¼ï¼ 9443æ˜¯SSLç«¯å£ï¼Œä¸€å®šéœ€è¦ä½¿ç”¨httpsæ¥è®¿é—®</code>,å¥½åƒibmmqè¿™ä¸ªç‰ˆæœ¬çš„webæœåŠ¡æœ‰bug,é‡å¯Dockeråï¼Œä¼šå ç”¨ç«¯å£ï¼Œä¹‹åå°±å¯åŠ¨ä¸äº†äº†ï¼ŒåŸå› æ²¡æœ‰æ·±ç©¶ï¼Œæµ‹è¯•çš„è¯ï¼Œé»˜è®¤åˆ›å»ºå¥½åå°±å¯ä»¥ä½¿ç”¨ï¼Œè¦ä¸è¦Webç®¡ç†ç«¯éƒ½æ— æ‰€è°“ã€‚</p>
<h3 id="ibm-mqç™»å½•é¡µ">IBM MQç™»å½•é¡µ</h3>
<p><img src="/images/posts/mq/ibm-mq-index.png" alt="">
è¾“å…¥è´¦å·å¯†ç ç™»å½•ï¼Œé»˜è®¤è´¦å·å¯†ç æ˜¯ï¼š <code>admin/passw0rd</code></p>
<h3 id="ibm-mqç™»å½•åçš„æ¬¢è¿é¡µ">IBM MQç™»å½•åçš„æ¬¢è¿é¡µ</h3>
<p><img src="/images/posts/mq/ibm-mq-admin-index.png" alt=""></p>
<h3 id="ç‰ˆæœ¬ä¿¡æ¯">ç‰ˆæœ¬ä¿¡æ¯</h3>
<p><img src="/images/posts/mq/ibm-mq-version.png" alt="">
æ–°ç‰ˆæœ¬çš„IBM MQçš„ç•Œé¢è¿˜æ˜¯å¾ˆæ¼‚äº®çš„</p>
<h2 id="æµ‹è¯•ibm-mq">æµ‹è¯•IBM MQ</h2>
<p>æ·»åŠ ibmmqçš„ä¾èµ–</p>
<h3 id="pomxml">pom.xml</h3>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml">		<span class="nt">&lt;dependency&gt;</span>
			<span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
			<span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-web<span class="nt">&lt;/artifactId&gt;</span>
		<span class="nt">&lt;/dependency&gt;</span>
		<span class="nt">&lt;dependency&gt;</span>
			<span class="nt">&lt;groupId&gt;</span>com.fasterxml.jackson.core<span class="nt">&lt;/groupId&gt;</span>
			<span class="nt">&lt;artifactId&gt;</span>jackson-databind<span class="nt">&lt;/artifactId&gt;</span>
		<span class="nt">&lt;/dependency&gt;</span>
		<span class="nt">&lt;dependency&gt;</span>
			<span class="nt">&lt;groupId&gt;</span>com.ibm.mq<span class="nt">&lt;/groupId&gt;</span>
			<span class="nt">&lt;artifactId&gt;</span>mq-jms-spring-boot-starter<span class="nt">&lt;/artifactId&gt;</span>
			<span class="nt">&lt;version&gt;</span>2.4.2<span class="nt">&lt;/version&gt;</span>
		<span class="nt">&lt;/dependency&gt;</span>
</code></pre></div><h3 id="æ·»åŠ é…ç½®é¡¹">æ·»åŠ é…ç½®é¡¹</h3>
<p>application.properties
spring boot é»˜è®¤éƒ½æ˜¯å¼€å¯8080ç«¯å£ï¼Œå› ä¸ºæˆ‘å¼€å‘æœºä¸Šè¦è¿è¡Œå¤šä¸ªï¼Œæ‰€ä»¥æ”¹ä¸‹ç«¯å£ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-ini" data-lang="ini"><span class="c1"># tomcat default 8080</span>
<span class="na">server.port</span><span class="o">=</span><span class="s">1080</span>

<span class="c1"># ibm mq config</span>
<span class="na">ibm.mq.queueManager</span><span class="o">=</span><span class="s">QM1</span>
<span class="na">ibm.mq.channel</span><span class="o">=</span><span class="s">DEV.APP.SVRCONN</span>
<span class="na">ibm.mq.connName</span><span class="o">=</span><span class="s">172.25.0.201(1414)</span>
<span class="na">ibm.mq.user</span><span class="o">=</span><span class="s">app</span>
<span class="na">ibm.mq.password</span><span class="o">=</span><span class="s">abcd1234</span>
<span class="na">ibm.mq.sendQueueName</span><span class="o">=</span><span class="s">DEV.QUEUE.1</span>
<span class="na">ibm.mq.recvQueueName</span><span class="o">=</span><span class="s">DEV.QUEUE.1</span>
</code></pre></div><h3 id="ä¿®æ”¹main">ä¿®æ”¹main</h3>
<p>TarsMqServerApplication
è¿™é‡Œéœ€è¦ç”¨åˆ°spring boot çš„webæœåŠ¡ï¼Œæ‰€ä»¥è¿™é‡Œæ¢å¤åˆ°é¡¹ç›®åˆå§‹çŠ¶æ€ï¼Œä¸Šä¼ tarsæ—¶ï¼Œåè®®é€‰étarsåè®®å³å¯ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@SpringBootApplication</span>
<span class="nd">@EnableTarsServer</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TarsMqServerApplication</span> <span class="o">{</span>

	<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
		<span class="n">SpringApplication</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="n">TarsMqServerApplication</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">args</span><span class="o">);</span>
	<span class="o">}</span>

<span class="o">}</span>
</code></pre></div><h3 id="æ·»åŠ restæ§åˆ¶å™¨">æ·»åŠ Restæ§åˆ¶å™¨</h3>
<p>è¿™é‡Œå…ˆåšä¸ªç®€å•çš„æµ‹è¯•ï¼Œä¸»è¦ç›®çš„æ˜¯ç”¨æœ€ç®€å•çš„ä»£ç æµ‹è¯•ibmmqçš„è¿é€šæ€§
src/main/java/com/example/tarsmqserver/web/MQController.java</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@RestController</span>
<span class="nd">@EnableJms</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;/api/mq&#34;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MQController</span> <span class="o">{</span> 
    <span class="nd">@Autowired</span>
	<span class="kd">private</span> <span class="n">JmsTemplate</span> <span class="n">jmsTemplate</span><span class="o">;</span>

	<span class="nd">@GetMapping</span><span class="o">(</span><span class="s">&#34;send&#34;</span><span class="o">)</span> 
	<span class="n">String</span> <span class="nf">send</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">try</span> <span class="o">{</span>
			<span class="n">jmsTemplate</span><span class="o">.</span><span class="na">convertAndSend</span><span class="o">(</span><span class="s">&#34;DEV.QUEUE.1&#34;</span><span class="o">,</span> <span class="s">&#34;Hello World!&#34;</span><span class="o">);</span>
			<span class="k">return</span> <span class="s">&#34;OK&#34;</span><span class="o">;</span>
		<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">JmsException</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
			<span class="n">ex</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
			<span class="k">return</span> <span class="s">&#34;FAIL&#34;</span><span class="o">;</span>
		<span class="o">}</span>
	<span class="o">}</span>

	<span class="nd">@GetMapping</span><span class="o">(</span><span class="s">&#34;recv&#34;</span><span class="o">)</span>
	<span class="n">String</span> <span class="nf">recv</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">try</span> <span class="o">{</span>
			<span class="k">return</span> <span class="n">jmsTemplate</span><span class="o">.</span><span class="na">receiveAndConvert</span><span class="o">(</span><span class="s">&#34;DEV.QUEUE.1&#34;</span><span class="o">).</span><span class="na">toString</span><span class="o">();</span>
		<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">JmsException</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
			<span class="n">ex</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
			<span class="k">return</span> <span class="s">&#34;FAIL&#34;</span><span class="o">;</span>
		<span class="o">}</span>
	<span class="o">}</span>
    
<span class="o">}</span>
</code></pre></div><h3 id="æäº¤tars-webæµ‹è¯•">æäº¤tars-webæµ‹è¯•</h3>
<h4 id="æ‰“åŒ…">æ‰“åŒ…</h4>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">$ mvn clean package -DskipTests 
</code></pre></div><h4 id="ä¸Šä¼ ">ä¸Šä¼ </h4>
<p>ä¸Šä¼ åŠæ³•è¯¦ç»†çœ‹ç¬¬1èŠ‚</p>
<h4 id="æµ‹è¯•">æµ‹è¯•</h4>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">$ curl http://localhost:1080/api/mq/recv
Hello World!%

$ curl http://localhost:1080/api/mq/send
OK%
</code></pre></div><p>çœ‹åˆ°ä¸Šé¢çš„ä¿¡æ¯ï¼Œè¯æ˜IBM MQæœåŠ¡æ­£å¸¸è·‘èµ·æ¥äº†ï¼Œjmsæµ‹è¯•ä»£ç ä¹Ÿèµ·äº†ä½œç”¨ï¼Œåé¢å°±æ˜¯æ”¹è‰¯ä»£ç äº†ã€‚</p>
<h2 id="jms">JMS</h2>
<h3 id="æœåŠ¡ä»‹ç»">æœåŠ¡ä»‹ç»</h3>
<p>å…³äºJMSåˆ°ç½‘ä¸ŠæŠ„äº†ä¸€ä»½ä½œä¸š,äº†è§£ä¸€ä¸‹è¿è¡Œé€»è¾‘ã€‚
<img src="/images/posts/mq/jms.png" alt="">
ä¸‹é¢å¼€å§‹æ‰“é€ åŸºäºtarsçš„JMSæœåŠ¡äº†</p>
<h3 id="ibmmq-ç»‘å®šé…ç½®æ–‡ä»¶">ibmmq ç»‘å®šé…ç½®æ–‡ä»¶</h3>
<p>ç›®å½•å»ºå¾—æ¯”è¾ƒéšæ„ï¼Œç½‘ä¸ŠæŠ„ä½œä¸šçœ‹åˆ°æœ‰äººç”¨è¿™ç§ç›®å½•æ–¹å¼ï¼Œå°±ç›´æ¥æŠ„äº†ã€‚
src/main/java/com/example/tarsmqserver/domain/JmqConfig.java</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Component</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">JmqConfig</span> <span class="o">{</span>

    <span class="nd">@Value</span><span class="o">(</span><span class="s">&#34;${ibm.mq.sendQueueName}&#34;</span><span class="o">)</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">sendQueueName</span><span class="o">;</span>

    <span class="nd">@Value</span><span class="o">(</span><span class="s">&#34;${ibm.mq.recvQueueName}&#34;</span><span class="o">)</span>
    <span class="kd">private</span>  <span class="n">String</span> <span class="n">recvQueueName</span><span class="o">;</span>


    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getSendQueueName</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">sendQueueName</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getRecvQueueName</span><span class="o">(){</span>
        <span class="k">return</span> <span class="n">recvQueueName</span><span class="o">;</span>
    <span class="o">}</span>

<span class="o">}</span>
</code></pre></div><h3 id="æ¶ˆæ¯ç”Ÿäº§è€…">æ¶ˆæ¯ç”Ÿäº§è€…</h3>
<p>src/main/java/com/example/tarsmqserver/service/mqserver/Producer.java</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Service</span><span class="o">(</span><span class="s">&#34;producer&#34;</span><span class="o">)</span>
<span class="nd">@EnableJms</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Producer</span> <span class="o">{</span>
    <span class="cm">/**
</span><span class="cm">     * ä¹Ÿå¯ä»¥æ³¨å…¥JmsTemplateï¼ŒJmsMessagingTemplateå¯¹JmsTemplateè¿›è¡Œäº†å°è£…
</span><span class="cm">     */</span>
    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="n">JmsMessagingTemplate</span> <span class="n">jmsTemplate</span><span class="o">;</span>

    <span class="cm">/**
</span><span class="cm">     * å‘é€æ¶ˆæ¯ï¼ŒdestinationName æ˜¯IBM MQ å‘é€é˜Ÿåˆ—çš„åç§°ï¼Œmessageæ˜¯å¾…å‘é€çš„æ¶ˆæ¯
</span><span class="cm">     *
</span><span class="cm">     * @param destinationName
</span><span class="cm">     * @param message
</span><span class="cm">     */</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">sendMessage</span><span class="o">(</span><span class="n">String</span> <span class="n">destinationName</span><span class="o">,</span> <span class="n">String</span> <span class="n">message</span><span class="o">)</span> <span class="o">{</span>
        <span class="kt">boolean</span> <span class="n">ok</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">jmsTemplate</span><span class="o">.</span><span class="na">convertAndSend</span><span class="o">(</span><span class="n">destinationName</span><span class="o">,</span> <span class="n">message</span><span class="o">);</span>
            <span class="n">ok</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">JmsException</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">ex</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
            <span class="n">ok</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">ok</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div><h3 id="æ¶ˆæ¯æ¶ˆè´¹è€…">æ¶ˆæ¯æ¶ˆè´¹è€…</h3>
<p>src/main/java/com/example/demo/jmq/ConsumerListener.java</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Component</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ConsumerListener</span> <span class="kd">extends</span> <span class="n">MessageListenerAdapter</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="n">Logger</span> <span class="n">logger</span> <span class="o">=</span> <span class="n">LoggerFactory</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="n">ConsumerListener</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

    <span class="cm">/**
</span><span class="cm">     * ä½¿ç”¨JmsListeneré…ç½®æ¶ˆè´¹è€…ç›‘å¬çš„é˜Ÿåˆ—
</span><span class="cm">     * 
</span><span class="cm">     * @param receivedMsg æ¥æ”¶åˆ°çš„æ¶ˆæ¯
</span><span class="cm">     */</span>
    <span class="nd">@JmsListener</span><span class="o">(</span><span class="n">destination</span> <span class="o">=</span> <span class="s">&#34;#{@conf.recvQueueName}&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">receiveQueue</span><span class="o">(</span><span class="n">String</span> <span class="n">receivedMsg</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">logger</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&#34;Consumeræ”¶åˆ°çš„æŠ¥æ–‡ä¸º: {}&#34;</span><span class="o">,</span> <span class="n">receivedMsg</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="n">JmqConfig</span> <span class="nf">conf</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="n">JmqConfig</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div><h3 id="é»˜è®¤å…¥å£">é»˜è®¤å…¥å£</h3>
<p>å…³é—­æœ¬åœ°tomcatæœåŠ¡ï¼Œåªå¼€å¯rpcæœåŠ¡ç«¯å£
src/main/java/com/example/demo/DemoApplication.java</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@SpringBootApplication</span>
<span class="nd">@EnableTarsServer</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TarsMqServerApplication</span> <span class="o">{</span>

	<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
		<span class="c1">// å…³é—­ spring boot è‡ªå¸¦çš„webæœåŠ¡ ç›®å‰åœºæ™¯åªç”¨åˆ°äº†rpcæœåŠ¡
</span><span class="c1"></span>		<span class="n">SpringApplication</span> <span class="n">app</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SpringApplication</span><span class="o">(</span><span class="n">TarsMqServerApplication</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
		<span class="n">app</span><span class="o">.</span><span class="na">setWebApplicationType</span><span class="o">(</span><span class="n">WebApplicationType</span><span class="o">.</span><span class="na">NONE</span><span class="o">);</span>
		<span class="n">app</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="n">args</span><span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span>
</code></pre></div><h3 id="å®Œå–„tarsæ¥å£">å®Œå–„tarsæ¥å£</h3>
<p>ç”¨çš„æ˜¯ä¸Šä¸€ç« å®šä¹‰çš„æ¥å£
tarsæ¥å£å®šä¹‰ä¼ é€é—¨ <a href="/posts/java/hello-java-1-day/#%E5%88%9B%E5%BB%BAtars%E5%8D%8F%E8%AE%AE%E6%8E%A5%E5%8F%A3%E6%96%87%E4%BB%B6">ç¬¬1å¤© é€šè¿‡dockeræ•´åˆspringbootå’Œtars</a>
src/main/java/com/example/tarsmqserver/service/mqserver/impl/MessageServantImpl.java</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@TarsServant</span><span class="o">(</span><span class="s">&#34;messageObj&#34;</span><span class="o">)</span>
<span class="nd">@Component</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MessageServantImpl</span> <span class="kd">implements</span> <span class="n">MessageServant</span> <span class="o">{</span>
    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="n">Producer</span> <span class="n">producer</span><span class="o">;</span>

    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="n">JmqConfig</span> <span class="n">jmqConfig</span><span class="o">;</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="kd">static</span> <span class="n">Logger</span> <span class="n">MSG_LOGGER</span> <span class="o">=</span> <span class="n">LoggerFactory</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="s">&#34;msg&#34;</span><span class="o">);</span>

    <span class="cm">/**
</span><span class="cm">     * å‘é€æ¶ˆæ¯åˆ°IBM MQ
</span><span class="cm">     */</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">send</span><span class="o">(</span><span class="n">String</span> <span class="n">msg</span><span class="o">)</span> <span class="o">{</span>
        
        <span class="k">if</span> <span class="o">(</span><span class="n">StringUtils</span><span class="o">.</span><span class="na">isBlank</span><span class="o">(</span><span class="n">msg</span><span class="o">))</span> <span class="o">{</span>
            <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="n">String</span> <span class="n">queueName</span> <span class="o">=</span> <span class="n">jmqConfig</span><span class="o">.</span><span class="na">getSendQueueName</span><span class="o">();</span>
        <span class="n">MSG_LOGGER</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&#34;send: {} -&gt; {}&#34;</span><span class="o">,</span> <span class="n">queueName</span><span class="o">,</span> <span class="n">msg</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">producer</span><span class="o">.</span><span class="na">sendMessage</span><span class="o">(</span><span class="n">queueName</span><span class="o">,</span> <span class="n">msg</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">encode</span><span class="o">(</span><span class="n">String</span> <span class="n">sign</span><span class="o">,</span> <span class="n">Holder</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">enStr</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// TODO å…ˆç®€å•èµ°æµç¨‹ åé¢å®ç°å…·ä½“åŠ å¯†ç­¾åä¹‹ç±»çš„
</span><span class="c1"></span>        <span class="k">if</span> <span class="o">(</span><span class="n">StringUtils</span><span class="o">.</span><span class="na">isBlank</span><span class="o">(</span><span class="n">sign</span><span class="o">))</span> <span class="o">{</span>
            <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="n">enStr</span><span class="o">.</span><span class="na">setValue</span><span class="o">(</span><span class="s">&#34;123&#34;</span> <span class="o">+</span> <span class="n">sign</span> <span class="o">+</span> <span class="s">&#34;456&#34;</span><span class="o">);</span>
        <span class="n">MSG_LOGGER</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&#34;encode: {} -&gt; {}&#34;</span><span class="o">,</span> <span class="n">sign</span><span class="o">,</span> <span class="n">enStr</span><span class="o">.</span><span class="na">value</span><span class="o">);</span>
        <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">encodeWithSend</span><span class="o">(</span><span class="n">String</span> <span class="n">msg</span><span class="o">,</span> <span class="n">String</span> <span class="n">sign</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">StringUtils</span><span class="o">.</span><span class="na">isBlank</span><span class="o">(</span><span class="n">msg</span><span class="o">)</span> <span class="o">||</span> <span class="n">StringUtils</span><span class="o">.</span><span class="na">isBlank</span><span class="o">(</span><span class="n">sign</span><span class="o">))</span> <span class="o">{</span>
            <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="n">Holder</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">enStr</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Holder</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;();</span>
        <span class="kt">boolean</span> <span class="n">ok</span> <span class="o">=</span> <span class="n">encode</span><span class="o">(</span><span class="n">sign</span><span class="o">,</span> <span class="n">enStr</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(!</span><span class="n">ok</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">send</span><span class="o">(</span><span class="n">enStr</span><span class="o">.</span><span class="na">value</span> <span class="o">+</span> <span class="n">msg</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div><p>è¿™é‡Œçš„å­—ç¬¦ä¸²éªŒè¯å·¥å…·ç”¨çš„æ˜¯org.apache.commonsï¼Œmavenå¼•å…¥å¦‚ä¸‹</p>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml">		<span class="nt">&lt;dependency&gt;</span>
			<span class="nt">&lt;groupId&gt;</span>org.apache.commons<span class="nt">&lt;/groupId&gt;</span>
			<span class="nt">&lt;artifactId&gt;</span>commons-lang3<span class="nt">&lt;/artifactId&gt;</span>
			<span class="nt">&lt;version&gt;</span>3.11<span class="nt">&lt;/version&gt;</span>
		<span class="nt">&lt;/dependency&gt;</span>
</code></pre></div><h3 id="ç”ŸæˆjaråŒ…ä¸Šä¼ æµ‹è¯•è§‚å¯Ÿ">ç”ŸæˆjaråŒ…/ä¸Šä¼ /æµ‹è¯•/è§‚å¯Ÿ</h3>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">$ mvn clean package -DskipTests
</code></pre></div><p>æŸ¥çœ‹æ—¥å¿—ï¼Œæœ‰ç±»ä¼¼ä¿¡æ¯</p>
<pre><code class="language-log" data-lang="log">2021-01-29 13:14:34.416 INFO 4474 --- [enerContainer-1] c.e.t.service.mqserver.ConsumerListener : Consumeræ”¶åˆ°çš„æŠ¥æ–‡ä¸º: 123ä¸­æ–‡456aaaaaaaaaaaaaaa
2021-01-29 13:14:56.194 INFO 4474 --- [enerContainer-1] c.e.t.service.mqserver.ConsumerListener : Consumeræ”¶åˆ°çš„æŠ¥æ–‡ä¸º: æ˜¥æ ‘æš®äº‘
</code></pre><p>æ•´åˆå®Œæˆ</p>
<h2 id="æ±‡æ€»">æ±‡æ€»</h2>
<h3 id="æœ€åé¡¹ç›®ç›®å½•">æœ€åé¡¹ç›®ç›®å½•</h3>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">$ tree
.
â”œâ”€â”€ mvnw
â”œâ”€â”€ mvnw.cmd
â”œâ”€â”€ pom.xml
â””â”€â”€ src
    â”œâ”€â”€ main
    â”‚   â”œâ”€â”€ java
    â”‚   â”‚   â””â”€â”€ com
    â”‚   â”‚       â””â”€â”€ example
    â”‚   â”‚           â””â”€â”€ tarsmqserver
    â”‚   â”‚               â”œâ”€â”€ TarsMqServerApplication.java
    â”‚   â”‚               â”œâ”€â”€ domain
    â”‚   â”‚               â”‚   â””â”€â”€ JmqConfig.java
    â”‚   â”‚               â”œâ”€â”€ service
    â”‚   â”‚               â”‚   â””â”€â”€ mqserver
    â”‚   â”‚               â”‚       â”œâ”€â”€ ConsumerListener.java
    â”‚   â”‚               â”‚       â”œâ”€â”€ MessageServant.java
    â”‚   â”‚               â”‚       â”œâ”€â”€ Producer.java
    â”‚   â”‚               â”‚       â””â”€â”€ impl
    â”‚   â”‚               â”‚           â””â”€â”€ MessageServantImpl.java
    â”‚   â”‚               â””â”€â”€ web
    â”‚   â”‚                   â””â”€â”€ MQController.java
    â”‚   â””â”€â”€ resources
    â”‚       â”œâ”€â”€ application.properties
    â”‚       â””â”€â”€ mqserver.tars
</code></pre></div><h2 id="æºä»£ç ">æºä»£ç </h2>
<p><a href="https://github.com/aomirun/demo/tree/main/day-2">å­¦ä¹ JAVAç¬¬2å¤© å®ç°tars-springboot-ibm-mqçš„å¾®æœåŠ¡(å¾®æœåŠ¡ç³»åˆ—ç¬¬äºŒå¤©)</a></p>
<h2 id="ç»“è¯­">ç»“è¯­</h2>
<p>ç”±äºæ‰æ¥è§¦javaï¼Œspringbootå¾ˆå¤šåŠŸèƒ½éƒ½æ˜¯é€šè¿‡javaä¸“æœ‰çš„æ³¨è§£å®Œæˆçš„ã€‚å­¦ä¹ æ—¶é—´æœ‰é™ï¼Œå¾ˆå¤šä¸œè¥¿è¿˜æ²¡æœ‰ç†è§£ï¼Œä¸­é—´è°ƒè¯•çš„æ—¶å€™èŠ±äº†ä¸å°‘æ—¶é—´å»æŸ¥èµ„æ–™å’Œè°ƒè¯•ã€‚æ›´å› ä¸ºæˆ‘æ˜¯ä½¿ç”¨vscode+tars+springbootæ¥å¼„çš„ï¼Œå‘ç”Ÿäº†é”™è¯¯ä¹Ÿä¸çŸ¥é“å“ªé‡Œå‡ºé—®é¢˜äº†ã€‚æœç´¢çš„èµ„æ–™åªèƒ½åšå‚è€ƒï¼Œç„¶åè‡ªå·±æ¶ˆåŒ–å­¦ä¹ ï¼Œæœ€ç»ˆè°ƒè¯•å®Œæˆã€‚</p>
]]></content>
		</item>
		
		<item>
			<title>é€šè¿‡docker-springboot-tarsæ„å»ºå¾®æœåŠ¡ç¯å¢ƒ(å¾®æœåŠ¡ç³»åˆ—ç¬¬ä¸€å¤©)</title>
			<link>https://aomi.run/posts/java/hello-java-1-day/</link>
			<pubDate>Tue, 26 Jan 2021 11:39:02 +0800</pubDate>
			
			<guid>https://aomi.run/posts/java/hello-java-1-day/</guid>
			<description>å‰è¨€  å­¦ä¹ JAVAç¬¬1å¤©,å®ç°ç›®æ ‡ï¼šé€šè¿‡dockeræ•´åˆspringbootå’Œtars
 å…ˆèŠ±äº†äº›æ—¶é—´æŠ˜è…¾äº†ä¸€ä¸‹Javaçš„å¼€å‘ç¯å¢ƒï¼Œå¹³å¸¸ä¸»è¦ç”¨vscodeåšå¼€å‘ï¼Œå°±åœ¨VScodeä¸Šå¼„äº†ä¸€å¥—Javaçš„å¼€å‘ç¯å¢ƒï¼ŒåŸºäºwin10 wsl2 vscode çš„ï¼Œå…·ä½“ç¯å¢ƒæŠ˜è…¾å¯ä»¥çœ‹æˆ‘é‚£ç¯‡ç¯å¢ƒæ­å»ºçš„æ–‡ç« ã€‚ç„¶åèŠ±äº†å‡ ä¸ªå°æ—¶æ—¶é—´å­¦ä¹ ä¸€ä¸‹Javaçš„åŸºæœ¬è¯­æ³•ï¼Œæœ‰å“ªäº›ä¿ç•™å­—ï¼Œå˜é‡çš„ä½œç”¨åŸŸã€‚åŒ…ã€æ¥å£ã€ç±»è¿˜æœ‰ç»§æ‰¿å…³ç³»ï¼Œå’Œå…¶å®ƒè¯­è¨€å‚ç…§å­¦ä¹ ä¸€ä¸‹ã€‚æ‰“ç®—ä½¿ç”¨Javaåšä¸€äº›é¡¹ç›®çš„è¡¥å……ï¼Œåˆ™éœ€è¦å¤šè¯­è¨€æ··åˆå¼€å‘ï¼Œæˆ‘é€‰äº†è¾ƒç†Ÿçš„Tarsæ¥åšã€‚TarsåŸç”Ÿæ”¯æŒSpringBootï¼ŒOKå¼€å§‹æŠ˜è…¾ã€‚
tars ç¯å¢ƒæ­å»º ä¸ºäº†å¿«é€Ÿå¼€å§‹ï¼Œæˆ‘ä½¿ç”¨Dockeræ¥æ­å»ºå¼€å‘ç¯å¢ƒ,Dockerçš„å®‰è£…åŠä½¿ç”¨æœç´¢ç½‘ç»œæ–‡ç« ä»‹ç»å³å¯ã€‚
åˆ›å»º Docker ç½‘ç»œ $ docker network create -d bridge --subnet=172.25.0.0/16 --gateway=172.25.0.1 tars åˆ›å»º docker ç›®å½• $ mkdir ~/docker-app/tars/framework/data -p $ mkdir ~/docker-app/tars/framework-slave/data -p $ mkdir ~/docker-app/tars/node/data -p $ mkdir ~/docker-app/tars/mysql/data -p $ mkdir ~/docker-app/tars/mysql/conf -p åˆ›å»º ~/docker-app/tars/mysql/conf/my.cnf æ–‡ä»¶ [mysqld] user=root default-storage-engine=INNODB character-set-server=utf8 [client] default-character-set=utf8 [mysql] default-character-set=utf8 åˆ›å»º ~/docker-app/tars/docker-compose.yml æ–‡ä»¶ version:&amp;#34;3&amp;#34;services:mysql:image:mysql:5.6container_name:tars-mysqlports:- &amp;#34;3307:3306&amp;#34;# restart: alwaysprivileged:trueenvironment:MYSQL_ROOT_PASSWORD:&amp;#34;123456&amp;#34;volumes:- ./mysql/data:/var/lib/mysql- ./mysql/conf/my.cnf:/etc/my.cnf- /etc/localtime:/etc/localtimenetworks:tars:ipv4_address:172.25.0.2framework:# image: tarscloud/framework:stableimage:tarscloud/framework:latestcontainer_name:tars-frameworkports:- &amp;#34;3000:3000&amp;#34;- &amp;#34;3001:3001&amp;#34;# restart: alwaysnetworks:tars:ipv4_address:172.</description>
			<content type="html"><![CDATA[<h2 id="å‰è¨€">å‰è¨€</h2>
<blockquote>
<p>å­¦ä¹ JAVAç¬¬1å¤©,å®ç°ç›®æ ‡ï¼šé€šè¿‡dockeræ•´åˆspringbootå’Œtars</p>
</blockquote>
<p>å…ˆèŠ±äº†äº›æ—¶é—´æŠ˜è…¾äº†ä¸€ä¸‹Javaçš„å¼€å‘ç¯å¢ƒï¼Œå¹³å¸¸ä¸»è¦ç”¨vscodeåšå¼€å‘ï¼Œå°±åœ¨VScodeä¸Šå¼„äº†ä¸€å¥—Javaçš„å¼€å‘ç¯å¢ƒï¼ŒåŸºäº<a href="/posts/wsl2-vscode-openjdk-install/">win10 wsl2 vscode</a> çš„ï¼Œå…·ä½“ç¯å¢ƒæŠ˜è…¾å¯ä»¥çœ‹æˆ‘é‚£ç¯‡ç¯å¢ƒæ­å»ºçš„æ–‡ç« ã€‚ç„¶åèŠ±äº†å‡ ä¸ªå°æ—¶æ—¶é—´å­¦ä¹ ä¸€ä¸‹Javaçš„åŸºæœ¬è¯­æ³•ï¼Œæœ‰å“ªäº›ä¿ç•™å­—ï¼Œå˜é‡çš„ä½œç”¨åŸŸã€‚åŒ…ã€æ¥å£ã€ç±»è¿˜æœ‰ç»§æ‰¿å…³ç³»ï¼Œå’Œå…¶å®ƒè¯­è¨€å‚ç…§å­¦ä¹ ä¸€ä¸‹ã€‚æ‰“ç®—ä½¿ç”¨Javaåšä¸€äº›é¡¹ç›®çš„è¡¥å……ï¼Œåˆ™éœ€è¦å¤šè¯­è¨€æ··åˆå¼€å‘ï¼Œæˆ‘é€‰äº†è¾ƒç†Ÿçš„Tarsæ¥åšã€‚TarsåŸç”Ÿæ”¯æŒSpringBootï¼ŒOKå¼€å§‹æŠ˜è…¾ã€‚</p>
<h2 id="tars-ç¯å¢ƒæ­å»º">tars ç¯å¢ƒæ­å»º</h2>
<p>ä¸ºäº†å¿«é€Ÿå¼€å§‹ï¼Œæˆ‘ä½¿ç”¨Dockeræ¥æ­å»ºå¼€å‘ç¯å¢ƒ,Dockerçš„å®‰è£…åŠä½¿ç”¨æœç´¢ç½‘ç»œæ–‡ç« ä»‹ç»å³å¯ã€‚</p>
<h3 id="åˆ›å»º-docker-ç½‘ç»œ">åˆ›å»º Docker ç½‘ç»œ</h3>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">$ docker network create -d bridge --subnet<span class="o">=</span>172.25.0.0/16 --gateway<span class="o">=</span>172.25.0.1 tars
</code></pre></div><h3 id="åˆ›å»º-docker-ç›®å½•">åˆ›å»º docker ç›®å½•</h3>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">$ mkdir ~/docker-app/tars/framework/data -p
$ mkdir ~/docker-app/tars/framework-slave/data -p
$ mkdir ~/docker-app/tars/node/data -p
$ mkdir ~/docker-app/tars/mysql/data -p
$ mkdir ~/docker-app/tars/mysql/conf -p
</code></pre></div><h3 id="åˆ›å»º-docker-apptarsmysqlconfmycnf-æ–‡ä»¶">åˆ›å»º ~/docker-app/tars/mysql/conf/my.cnf æ–‡ä»¶</h3>
<div class="highlight"><pre class="chroma"><code class="language-ini" data-lang="ini"><span class="k">[mysqld]</span>
<span class="na">user</span><span class="o">=</span><span class="s">root</span>
<span class="na">default-storage-engine</span><span class="o">=</span><span class="s">INNODB</span>
<span class="na">character-set-server</span><span class="o">=</span><span class="s">utf8</span>
<span class="k">[client]</span>
<span class="na">default-character-set</span><span class="o">=</span><span class="s">utf8</span>
<span class="k">[mysql]</span>
<span class="na">default-character-set</span><span class="o">=</span><span class="s">utf8</span>
</code></pre></div><h3 id="åˆ›å»º-docker-apptarsdocker-composeyml-æ–‡ä»¶">åˆ›å»º ~/docker-app/tars/docker-compose.yml æ–‡ä»¶</h3>
<div class="highlight"><pre class="chroma"><code class="language-yml" data-lang="yml"><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;3&#34;</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="nt">services</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">mysql</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">mysql:5.6</span><span class="w">
</span><span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l">tars-mysql</span><span class="w">
</span><span class="w">    </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- <span class="s2">&#34;3307:3306&#34;</span><span class="w">
</span><span class="w">    </span><span class="c"># restart: always</span><span class="w">
</span><span class="w">    </span><span class="nt">privileged</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span><span class="w">    </span><span class="nt">environment</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="nt">MYSQL_ROOT_PASSWORD</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;123456&#34;</span><span class="w">
</span><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- <span class="l">./mysql/data:/var/lib/mysql</span><span class="w">
</span><span class="w">      </span>- <span class="l">./mysql/conf/my.cnf:/etc/my.cnf</span><span class="w">
</span><span class="w">      </span>- <span class="l">/etc/localtime:/etc/localtime</span><span class="w">
</span><span class="w">    </span><span class="nt">networks</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="nt">tars</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="nt">ipv4_address</span><span class="p">:</span><span class="w"> </span><span class="m">172.25.0.2</span><span class="w">
</span><span class="w">  </span><span class="nt">framework</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="c"># image: tarscloud/framework:stable</span><span class="w">
</span><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">tarscloud/framework:latest</span><span class="w">
</span><span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l">tars-framework</span><span class="w">
</span><span class="w">    </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- <span class="s2">&#34;3000:3000&#34;</span><span class="w">
</span><span class="w">      </span>- <span class="s2">&#34;3001:3001&#34;</span><span class="w">
</span><span class="w">    </span><span class="c"># restart: always</span><span class="w">
</span><span class="w">    </span><span class="nt">networks</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="nt">tars</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="nt">ipv4_address</span><span class="p">:</span><span class="w"> </span><span class="m">172.25.0.3</span><span class="w">
</span><span class="w">    </span><span class="nt">environment</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="nt">MYSQL_HOST</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;172.25.0.2&#34;</span><span class="w">
</span><span class="w">      </span><span class="nt">MYSQL_ROOT_PASSWORD</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;123456&#34;</span><span class="w">
</span><span class="w">      </span><span class="nt">MYSQL_USER</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;root&#34;</span><span class="w">
</span><span class="w">      </span><span class="nt">MYSQL_PORT</span><span class="p">:</span><span class="w"> </span><span class="m">3306</span><span class="w">
</span><span class="w">      </span><span class="nt">REBUILD</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;false&#34;</span><span class="w">
</span><span class="w">      </span><span class="nt">INET</span><span class="p">:</span><span class="w"> </span><span class="l">eth0</span><span class="w">
</span><span class="w">      </span><span class="nt">SLAVE</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;false&#34;</span><span class="w">
</span><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- <span class="l">./framework/data:/data/tars:rw</span><span class="w">
</span><span class="w">      </span>- <span class="l">/etc/localtime:/etc/localtime</span><span class="w">
</span><span class="w">    </span><span class="nt">depends_on</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- <span class="l">mysql</span><span class="w">
</span><span class="w">  </span><span class="nt">framework-slave</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="c"># image: tarscloud/framework:stable</span><span class="w">
</span><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">tarscloud/framework:latest</span><span class="w">
</span><span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l">tars-framework-slave</span><span class="w">
</span><span class="w">    </span><span class="c"># restart: always</span><span class="w">
</span><span class="w">    </span><span class="nt">networks</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="nt">tars</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="nt">ipv4_address</span><span class="p">:</span><span class="w"> </span><span class="m">172.25.0.4</span><span class="w">
</span><span class="w">    </span><span class="nt">environment</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="nt">MYSQL_HOST</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;172.25.0.2&#34;</span><span class="w">
</span><span class="w">      </span><span class="nt">MYSQL_ROOT_PASSWORD</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;123456&#34;</span><span class="w">
</span><span class="w">      </span><span class="nt">MYSQL_USER</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;root&#34;</span><span class="w">
</span><span class="w">      </span><span class="nt">MYSQL_PORT</span><span class="p">:</span><span class="w"> </span><span class="m">3306</span><span class="w">
</span><span class="w">      </span><span class="nt">REBUILD</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;false&#34;</span><span class="w">
</span><span class="w">      </span><span class="nt">INET</span><span class="p">:</span><span class="w"> </span><span class="l">eth0</span><span class="w">
</span><span class="w">      </span><span class="nt">SLAVE</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;true&#34;</span><span class="w">
</span><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- <span class="l">./framework-slave/data:/data/tars:rw</span><span class="w">
</span><span class="w">      </span>- <span class="l">/etc/localtime:/etc/localtime</span><span class="w">
</span><span class="w">    </span><span class="nt">depends_on</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- <span class="l">mysql</span><span class="w">
</span><span class="w">  </span><span class="nt">node</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="c"># image: tarscloud/tars-node:stable</span><span class="w">
</span><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">tarscloud/tars-node:latest</span><span class="w">
</span><span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l">tars-node</span><span class="w">
</span><span class="w">    </span><span class="c"># restart: always</span><span class="w">
</span><span class="w">    </span><span class="nt">networks</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="nt">tars</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="nt">ipv4_address</span><span class="p">:</span><span class="w"> </span><span class="m">172.25.0.5</span><span class="w">
</span><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- <span class="l">./node/data:/data/tars:rw</span><span class="w">
</span><span class="w">      </span>- <span class="l">/etc/localtime:/etc/localtime</span><span class="w">
</span><span class="w">    </span><span class="nt">environment</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="nt">INET</span><span class="p">:</span><span class="w"> </span><span class="l">eth0</span><span class="w">
</span><span class="w">      </span><span class="nt">WEB_HOST</span><span class="p">:</span><span class="w"> </span><span class="l">http://172.25.0.3:3000</span><span class="w">
</span><span class="w">    </span><span class="nt">depends_on</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- <span class="l">framework</span><span class="w">
</span><span class="w"></span><span class="nt">networks</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">tars</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">external</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></code></pre></div><h3 id="è¿è¡Œ-docker-compose">è¿è¡Œ docker-compose</h3>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">$ <span class="nb">cd</span> ~/docker-app/tars
$ docker-compose up -d
</code></pre></div><p>ç­‰ä¸€æ®µæ—¶é—´ï¼ŒæŠŠé•œåƒä¸‹è½½å®Œåï¼Œä¼šè‡ªåŠ¨è¿è¡Œèµ·æ¥</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">Creating tars-mysql ... <span class="k">done</span>
Creating tars-framework-slave ... <span class="k">done</span>
Creating tars-framework       ... <span class="k">done</span>
Creating tars-node            ... <span class="k">done</span>
</code></pre></div><p>æ‰“å¼€æµè§ˆå™¨ï¼Œè®¿é—® <code>http://localhost:3000/</code> å³å¯æ‰“å¼€ <code>tars web</code>ï¼Œå…³äºTarsæ›´è¯¦ç»†çš„è¯·æŸ¥çœ‹ <a href="https://tarscloud.gitbook.io/">å®˜æ–¹æ–‡æ¡£</a></p>
<h2 id="åˆ›å»ºjavaé¡¹ç›®">åˆ›å»ºJAVAé¡¹ç›®</h2>
<p>è¿™æ˜¯æˆ‘æ˜¯ç”¨<code>vscode + maven + tars</code>åˆ›å»ºå¥½çš„ä¸€ä¸ª<code>IBM MQ CLIENT</code>çš„ä¸€ä¸ªåˆå§‹é¡¹ç›®ï¼Œå…³äºvscodeæ€ä¹ˆè®¾ç½®Javaå¼€å‘ç¯å¢ƒåŠMavençš„ï¼Œè¯·çœ‹æˆ‘å¦å¤–ä¸€ç¯‡æ–‡ç«  <a href="/posts/wsl2-vscode-openjdk-install/">Wsl2 Vscode Openjdk Install</a> ï¼Œæœ€åé¡¹ç›®ç›®å½•ä¸º</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">$ tree
.
â”œâ”€â”€ HELP.md
â”œâ”€â”€ mvnw
â”œâ”€â”€ mvnw.cmd
â”œâ”€â”€ pom.xml
â””â”€â”€ src
    â”œâ”€â”€ main
    â”‚   â”œâ”€â”€ java
    â”‚   â”‚   â””â”€â”€ com
    â”‚   â”‚       â””â”€â”€ example
    â”‚   â”‚           â””â”€â”€ tarsmqserver
    â”‚   â”‚               â””â”€â”€ TarsMqServerApplication.java
    â”‚   â””â”€â”€ resources
    â”‚       â””â”€â”€ application.properties
    â””â”€â”€ <span class="nb">test</span>
        â””â”€â”€ java
            â””â”€â”€ com
                â””â”€â”€ example
                    â””â”€â”€ tarsmqserver
                        â””â”€â”€ TarsMqServerApplicationTests.java

<span class="m">12</span> directories, <span class="m">7</span> files
</code></pre></div><h3 id="æ·»åŠ ä¾èµ–">æ·»åŠ ä¾èµ–</h3>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml">		<span class="nt">&lt;dependency&gt;</span>
			<span class="nt">&lt;groupId&gt;</span>com.tencent.tars<span class="nt">&lt;/groupId&gt;</span>
			<span class="nt">&lt;artifactId&gt;</span>tars-spring-boot-starter<span class="nt">&lt;/artifactId&gt;</span>
			<span class="nt">&lt;version&gt;</span>1.7.2<span class="nt">&lt;/version&gt;</span>
		<span class="nt">&lt;/dependency&gt;</span>
</code></pre></div><h3 id="åˆ›å»ºtarsåè®®æ¥å£æ–‡ä»¶">åˆ›å»ºtarsåè®®æ¥å£æ–‡ä»¶</h3>
<pre><code>module mqserver
{
	interface Message
	{
        bool send(string msg);
        bool encode(string sign, out string enStr);
        bool encodeWithSend(string msg, string sign);
	};
};
</code></pre><h3 id="æ·»åŠ -tars-æ’ä»¶">æ·»åŠ  tars æ’ä»¶</h3>
<p>åŒæ—¶å®šä¹‰å¥½ jar çš„æ–‡ä»¶å,æœ€åbuildçœ‹èµ·æ¥åƒè¿™æ ·</p>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml">	<span class="nt">&lt;build&gt;</span>
		<span class="nt">&lt;finalName&gt;</span>mqserver<span class="nt">&lt;/finalName&gt;</span>
		<span class="nt">&lt;plugins&gt;</span>
			<span class="nt">&lt;plugin&gt;</span>
				<span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
				<span class="nt">&lt;artifactId&gt;</span>spring-boot-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>
			<span class="nt">&lt;/plugin&gt;</span>
			<span class="c">&lt;!--tars2java plugin --&gt;</span>
			<span class="nt">&lt;plugin&gt;</span>
				<span class="nt">&lt;groupId&gt;</span>com.tencent.tars<span class="nt">&lt;/groupId&gt;</span>
				<span class="nt">&lt;artifactId&gt;</span>tars-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>
				<span class="nt">&lt;version&gt;</span>1.7.2<span class="nt">&lt;/version&gt;</span>
				<span class="nt">&lt;configuration&gt;</span>
					<span class="nt">&lt;tars2JavaConfig&gt;</span>
						<span class="c">&lt;!-- tars file location --&gt;</span>
						<span class="nt">&lt;tarsFiles&gt;</span>
							<span class="nt">&lt;tarsFile&gt;</span>${basedir}/src/main/resources/mqserver.tars<span class="nt">&lt;/tarsFile&gt;</span>
						<span class="nt">&lt;/tarsFiles&gt;</span>
						<span class="c">&lt;!-- Source file encoding --&gt;</span>
						<span class="nt">&lt;tarsFileCharset&gt;</span>UTF-8<span class="nt">&lt;/tarsFileCharset&gt;</span>
						<span class="c">&lt;!-- Generate server code --&gt;</span>
						<span class="nt">&lt;servant&gt;</span>true<span class="nt">&lt;/servant&gt;</span>
						<span class="c">&lt;!-- Generated source code encoding --&gt;</span>
						<span class="nt">&lt;charset&gt;</span>UTF-8<span class="nt">&lt;/charset&gt;</span>
						<span class="c">&lt;!-- Generated source code directory --&gt;</span>
						<span class="nt">&lt;srcPath&gt;</span>${basedir}/src/main/java<span class="nt">&lt;/srcPath&gt;</span>
						<span class="c">&lt;!-- Generated source code package prefix --&gt;</span>
						<span class="nt">&lt;packagePrefixName&gt;</span>com.example.tarsmqserver.service.<span class="nt">&lt;/packagePrefixName&gt;</span>
					<span class="nt">&lt;/tars2JavaConfig&gt;</span>
				<span class="nt">&lt;/configuration&gt;</span>
			<span class="nt">&lt;/plugin&gt;</span>
			<span class="c">&lt;!--package plugin--&gt;</span>
		<span class="nt">&lt;/plugins&gt;</span>
	<span class="nt">&lt;/build&gt;</span>
</code></pre></div><h3 id="tars2java">tars2java</h3>
<p>é€šè¿‡tarsåè®®æ¥å£,ç”Ÿæˆjavaæ¥å£æ–‡ä»¶</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">$ mvn tars:tars2java

<span class="o">[</span>INFO<span class="o">]</span> Scanning <span class="k">for</span> projects...
<span class="o">[</span>INFO<span class="o">]</span> 
<span class="o">[</span>INFO<span class="o">]</span> ---------------------&lt; com.example:tars-mq-server &gt;---------------------
<span class="o">[</span>INFO<span class="o">]</span> Building tars-mq-server 0.0.1-SNAPSHOT
<span class="o">[</span>INFO<span class="o">]</span> --------------------------------<span class="o">[</span> jar <span class="o">]</span>---------------------------------
<span class="o">[</span>INFO<span class="o">]</span> 
<span class="o">[</span>INFO<span class="o">]</span> --- tars-maven-plugin:1.7.2:tars2java <span class="o">(</span>default-cli<span class="o">)</span> @ tars-mq-server ---
<span class="o">[</span>INFO<span class="o">]</span> Parse /mnt/d/projects/java/demo/day-1/tars-mq-server/src/main/resources/mqserver.tars ...
<span class="o">[</span>INFO<span class="o">]</span> generate code <span class="k">for</span> namespace : mqserver ...
<span class="o">[</span>INFO<span class="o">]</span> module mqserver &gt;&gt;
<span class="o">[</span>INFO<span class="o">]</span> generate Servant MessageServant
<span class="o">[</span>INFO<span class="o">]</span> module mqserver &lt;&lt;
<span class="o">[</span>INFO<span class="o">]</span> ------------------------------------------------------------------------
<span class="o">[</span>INFO<span class="o">]</span> BUILD SUCCESS
</code></pre></div><p>æ–‡ä»¶ç”Ÿæˆåˆ°äº† <code>src/main/java/com/example/tarsmqserver/service/mqserver/MessageServant.java</code>,æ‰“å¼€çœ‹çœ‹</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Servant</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">MessageServant</span> <span class="o">{</span>

	 <span class="kt">boolean</span> <span class="nf">send</span><span class="o">(</span><span class="nd">@TarsMethodParameter</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#34;msg&#34;</span><span class="o">)</span><span class="n">String</span> <span class="n">msg</span><span class="o">);</span>

	 <span class="kt">boolean</span> <span class="nf">encode</span><span class="o">(</span><span class="nd">@TarsMethodParameter</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#34;sign&#34;</span><span class="o">)</span><span class="n">String</span> <span class="n">sign</span><span class="o">,</span> <span class="nd">@TarsHolder</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#34;enStr&#34;</span><span class="o">)</span> <span class="n">Holder</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">enStr</span><span class="o">);</span>

	 <span class="kt">boolean</span> <span class="nf">encodeWithSend</span><span class="o">(</span><span class="nd">@TarsMethodParameter</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#34;msg&#34;</span><span class="o">)</span><span class="n">String</span> <span class="n">msg</span><span class="o">,</span> <span class="nd">@TarsMethodParameter</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#34;sign&#34;</span><span class="o">)</span><span class="n">String</span> <span class="n">sign</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div><h3 id="å®ç°æ¥å£">å®ç°æ¥å£</h3>
<p>src/main/java/com/example/tarsmqserver/service/mqserver/impl/MessageServantImpl.java
tars æ¥å£çš„ç±»åéœ€è¦æ·»åŠ æ³¨è§£ @TarsServant(&ldquo;messageObj&rdquo;)
messageObj çš„åç§°æ˜¯è¦å’Œtars-webä¸Šè‡ªå·±å®šä¹‰çš„åç§°ç›¸åŒ,æ–¹æ³•å®ç°éœ€è¦æ³¨è§£ @Override</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.example.tarsmqserver.service.mqserver.impl</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.example.tarsmqserver.service.mqserver.MessageServant</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qq.tars.common.support.Holder</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qq.tars.spring.annotation.TarsServant</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * @author aomi.run
</span><span class="cm"> */</span>
<span class="nd">@TarsServant</span><span class="o">(</span><span class="s">&#34;messageObj&#34;</span><span class="o">)</span> 
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MessageServantImpl</span> <span class="kd">implements</span> <span class="n">MessageServant</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">send</span><span class="o">(</span><span class="n">String</span> <span class="n">msg</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// TODO å…ˆç®€å•èµ°æµç¨‹ åé¢å®ç°å…·ä½“ä¸ibmmqçš„å¯¹æ¥
</span><span class="c1"></span>        <span class="k">if</span> <span class="o">(</span><span class="n">msg</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">encode</span><span class="o">(</span><span class="n">String</span> <span class="n">sign</span><span class="o">,</span> <span class="n">Holder</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">enStr</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// TODO å…ˆç®€å•èµ°æµç¨‹ åé¢å®ç°å…·ä½“ä¸ibmmqçš„å¯¹æ¥
</span><span class="c1"></span>        <span class="k">if</span> <span class="o">(</span><span class="n">sign</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="n">enStr</span><span class="o">.</span><span class="na">setValue</span><span class="o">(</span><span class="s">&#34;123&#34;</span> <span class="o">+</span> <span class="n">sign</span> <span class="o">+</span> <span class="s">&#34;456&#34;</span><span class="o">);</span>
        <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">encodeWithSend</span><span class="o">(</span><span class="n">String</span> <span class="n">msg</span><span class="o">,</span> <span class="n">String</span> <span class="n">sign</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// TODO å…ˆç®€å•èµ°æµç¨‹ åé¢å®ç°å…·ä½“ä¸ibmmqçš„å¯¹æ¥
</span><span class="c1"></span>        <span class="k">if</span> <span class="o">(</span><span class="n">sign</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">msg</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="n">Holder</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">enStr</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Holder</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;();</span>
        <span class="kt">boolean</span> <span class="n">ok</span> <span class="o">=</span> <span class="n">encode</span><span class="o">(</span><span class="n">sign</span><span class="o">,</span> <span class="n">enStr</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(!</span><span class="n">ok</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="k">return</span> <span class="n">send</span><span class="o">(</span><span class="n">enStr</span> <span class="o">+</span> <span class="n">msg</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div><h3 id="å¼€å¯-tars-æœåŠ¡ç›‘å¬">å¼€å¯ tars æœåŠ¡ç›‘å¬</h3>
<p>åœ¨ main å…¥å£å¤„æ·»åŠ æ³¨è§£ <code>@EnableTarsServer</code>,å¹¶å…³é—­è‡ªå¸¦çš„WebæœåŠ¡.</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@SpringBootApplication</span>
<span class="nd">@EnableTarsServer</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TarsMqServerApplication</span> <span class="o">{</span>

	<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
		<span class="c1">// å…³é—­ spring boot è‡ªå¸¦çš„webæœåŠ¡ ç›®å‰åœºæ™¯åªç”¨åˆ°äº†rpcæœåŠ¡
</span><span class="c1"></span>		<span class="n">SpringApplication</span> <span class="n">app</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SpringApplication</span><span class="o">(</span><span class="n">TarsMqServerApplication</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
		<span class="n">app</span><span class="o">.</span><span class="na">setWebApplicationType</span><span class="o">(</span><span class="n">WebApplicationType</span><span class="o">.</span><span class="na">NONE</span><span class="o">);</span>
		<span class="n">app</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="n">args</span><span class="o">);</span>
	<span class="o">}</span>

<span class="o">}</span>
</code></pre></div><h3 id="jaræ‰“åŒ…">Jaræ‰“åŒ…</h3>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">$ mvn clean package -DskipTests
</code></pre></div><p>æœ€åçš„ç›®å½•ç»“æ„æ˜¯</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">$ tree
.
â”œâ”€â”€ HELP.md
â”œâ”€â”€ mvnw
â”œâ”€â”€ mvnw.cmd
â”œâ”€â”€ pom.xml
â”œâ”€â”€ src
â”‚   â”œâ”€â”€ main
â”‚   â”‚   â”œâ”€â”€ java
â”‚   â”‚   â”‚   â””â”€â”€ com
â”‚   â”‚   â”‚       â””â”€â”€ example
â”‚   â”‚   â”‚           â””â”€â”€ tarsmqserver
â”‚   â”‚   â”‚               â”œâ”€â”€ TarsMqServerApplication.java
â”‚   â”‚   â”‚               â””â”€â”€ service
â”‚   â”‚   â”‚                   â””â”€â”€ mqserver
â”‚   â”‚   â”‚                       â”œâ”€â”€ MessageServant.java
â”‚   â”‚   â”‚                       â””â”€â”€ impl
â”‚   â”‚   â”‚                           â””â”€â”€ MessageServantImpl.java
â”‚   â”‚   â””â”€â”€ resources
â”‚   â”‚       â”œâ”€â”€ application.properties
â”‚   â”‚       â””â”€â”€ mqserver.tars
â”‚   â””â”€â”€ ...
â””â”€â”€ target
    ...
    â”œâ”€â”€ mqserver.jar
    â”œâ”€â”€ mqserver.jar.original
    â””â”€â”€ test-classes

<span class="m">35</span> directories, <span class="m">22</span> files
</code></pre></div><p>mqserver.jar å°±æ˜¯tarsçš„åŒ…,ä¸Šä¼ åˆ°tars-webä¸Šé¢</p>
<h3 id="tars-çš„éƒ¨ç½²ä¸æµ‹è¯•">tars çš„éƒ¨ç½²ä¸æµ‹è¯•</h3>
<blockquote>
<p>é¦–æ¬¡ä½¿ç”¨tars-web,æˆ‘å°½é‡å¼„äº›å›¾è§£,åç»­æ–‡æ¡£ä¸­æœ‰å¾ˆå¤šæ¶‰åŠåˆ°tars-webçš„å°±ç®€å•æ–‡å­—å¸¦è¿‡äº†</p>
</blockquote>
<h4 id="åˆ›å»ºåº”ç”¨åç§°">åˆ›å»ºåº”ç”¨åç§°</h4>
<p><img src="/images/posts/tars/tars-web-add-app.png" alt=""></p>
<h4 id="åˆ›å»ºæœåŠ¡">åˆ›å»ºæœåŠ¡</h4>
<p><img src="/images/posts/tars/tars-web-add-server.png" alt=""></p>
<h4 id="ä¸Šä¼ jaråŒ…">ä¸Šä¼ jaråŒ…</h4>
<p><img src="/images/posts/tars/tars-web-push-manage.png" alt="">
<img src="/images/posts/tars/tars-web-update-push.png" alt=""></p>
<h4 id="ä¸Šä¼ æ¥å£å®šä¹‰æ–‡ä»¶">ä¸Šä¼ æ¥å£å®šä¹‰æ–‡ä»¶</h4>
<p>å°±æ˜¯å‰é¢å†™çš„mqserver.tarsæ–‡ä»¶
<img src="/images/posts/tars/tars-web-interface-test.png" alt="">
è°ƒè¯•æ—¶å¯ä»¥çœ‹åˆ°ï¼Œè¿”å›å€¼ä¸è‡ªå·±ä»£ç ä¸­å®šåˆ¶çš„å€¼ç›¸åŒï¼Œä»£è¡¨æˆåŠŸéƒ¨ç½²</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java">    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">encode</span><span class="o">(</span><span class="n">String</span> <span class="n">sign</span><span class="o">,</span> <span class="n">Holder</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">enStr</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// TODO å…ˆç®€å•èµ°æµç¨‹ åé¢å®ç°å…·ä½“ä¸ibmmqçš„å¯¹æ¥
</span><span class="c1"></span>        <span class="k">if</span> <span class="o">(</span><span class="n">sign</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="n">enStr</span><span class="o">.</span><span class="na">setValue</span><span class="o">(</span><span class="s">&#34;123&#34;</span> <span class="o">+</span> <span class="n">sign</span> <span class="o">+</span> <span class="s">&#34;456&#34;</span><span class="o">);</span>
        <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
    <span class="o">}</span>
</code></pre></div><h3 id="æºä»£ç ">æºä»£ç </h3>
<p>æºä»£ç å‡ å¤©ååšäº†æ•´ç†ï¼Œç°ä¸Šä¼ åˆ°githubä¸Šé¢äº† ä¼ é€é—¨ -&gt; <a href="https://github.com/aomirun/demo/tree/main/day-1/tars-mq-server">é€šè¿‡docker-springboot-tarsæ„å»ºå¾®æœåŠ¡ç¯å¢ƒ(å¾®æœåŠ¡ç³»åˆ—ç¬¬ä¸€å¤©)</a></p>
<h3 id="ç»“è¯­">ç»“è¯­</h3>
<p>å­¦ä¹ javaçš„ç¬¬ä¸€å¤©æŠ˜è…¾äº†ä¸€ä¸‹é¡¹ç›®å¤§è‡´æµç¨‹ï¼Œä¸»è¦æ˜¯åœ¨ <code>vscode</code> ä¸­ä½¿ç”¨ <code>maven</code> æ¥åˆ›å»º <code>springboot</code> é¡¹ç›®ï¼Œå¹¶åŠ å…¥ <code>tars</code> çš„æ”¯æŒï¼Œç„¶åæ‰“åŒ…ä¸Šä¼ åˆ° <code>tars</code> ä¸­è¿è¡Œå¹¶è°ƒè¯•ã€‚ä¸­é—´ä¹Ÿç¢°åˆ°äº†ä¸€äº›é—®é¢˜ï¼Œæ¯”å¦‚åŠ è½½äº†tarsåŒ…å<code>test</code>æ–‡ä»¶å°±æœ‰ä¾èµ–äº†ï¼Œä¸åŠ å…¥ä¾èµ–å°±ä¼šæŠ¥æ‰¾ä¸åˆ°tars é…ç½®æ–‡ä»¶çš„é”™è¯¯ï¼Œå¼€å§‹ä¸€ç›´ä¿ç•™åœ¨é¡¹ç›®ä¸­ï¼Œæ‰“åŒ…<code>jar</code>çš„æ—¶å€™å°±ä¼šæŠ¥é”™ï¼Œæ€»ä¹‹è‡ªå·±æ˜¯javaèœé¸Ÿï¼Œç¢°åˆ°å„ç§é”™è¯¯ä¹Ÿå±äºæ­£å¸¸äº†ï¼Œæ•´ä½“è¿˜æ˜¯å¾ˆæˆåŠŸçš„ã€‚ä¸€ç»åœ¨ <code>tars</code> ä¸­ä½¿ç”¨åï¼Œå°±å’Œå¼€å‘è¯­è¨€æ— å…³äº†ã€‚ä¹‹åå–œæ¬¢ç”¨å“ªç§å¼€å‘è¯­è¨€å»è°ƒç”¨æœåŠ¡éƒ½å¯ä»¥ï¼Œè¿™ä¹Ÿç®—æ˜¯å¾®æœåŠ¡çš„ç‰¹ç‚¹ä¹‹ä¸€å§ã€‚</p>
]]></content>
		</item>
		
		<item>
			<title>Wsl2 Vscode Openjdk Install</title>
			<link>https://aomi.run/posts/wsl2-vscode-openjdk-install/</link>
			<pubDate>Mon, 25 Jan 2021 11:46:59 +0800</pubDate>
			
			<guid>https://aomi.run/posts/wsl2-vscode-openjdk-install/</guid>
			<description>å‡†å¤‡ è¿›å…¥wslå‘½ä»¤è¡Œï¼Œå…ˆæ›´æ–°ç³»ç»Ÿ,æ›´æ–°æ…¢çš„å¯ä»¥æ¢aptæºå¤„ç†ï¼Œæ¢æºè‡ªè¡Œæœç´¢ã€‚
$ sudo apt update -y $ sudo apt upgrade -y å®‰è£…JDK å®‰è£… JDK 8 $ sudo apt install openjdk-8-jdk -y /usr/lib/jvm/java-8-openjdk-amd64 #æˆ‘ç”µè„‘å®‰è£…çš„ä½ç½® $ java -version openjdk version &amp;#34;1.8.0_275&amp;#34; OpenJDK Runtime Environment (build 1.8.0_275-8u275-b01-0ubuntu1~20.04-b01) OpenJDK 64-Bit Server VM (build 25.275-b01, mixed mode) è£…ä¸ª JDK 11 $ sudo apt install openjdk-11-jdk -y /usr/lib/jvm/java-11-openjdk-amd64 #æˆ‘ç”µè„‘å®‰è£…çš„ä½ç½® JDKç‰ˆæœ¬åˆ‡æ¢ $ sudo update-alternatives --install /usr/local/jdk jdk /usr/lib/jvm/java-8-openjdk-amd64 8 $ sudo update-alternatives --install /usr/local/jdk jdk /usr/lib/jvm/java-11-openjdk-amd64 11 $ sudo update-alternatives --config jdk There are 2 choices for the alternative jdk (providing /usr/local/jdk).</description>
			<content type="html"><![CDATA[<h2 id="å‡†å¤‡">å‡†å¤‡</h2>
<p>è¿›å…¥wslå‘½ä»¤è¡Œï¼Œå…ˆæ›´æ–°ç³»ç»Ÿ,æ›´æ–°æ…¢çš„å¯ä»¥æ¢aptæºå¤„ç†ï¼Œæ¢æºè‡ªè¡Œæœç´¢ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell">$ sudo apt update -y
$ sudo apt upgrade -y
</code></pre></div><h2 id="å®‰è£…jdk">å®‰è£…JDK</h2>
<h3 id="å®‰è£…-jdk-8">å®‰è£… JDK 8</h3>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell">$ sudo apt install openjdk-8-jdk -y

/usr/lib/jvm/java-8-openjdk-amd64 <span class="c1">#æˆ‘ç”µè„‘å®‰è£…çš„ä½ç½®</span>

$ java -version
openjdk version <span class="s2">&#34;1.8.0_275&#34;</span>
OpenJDK Runtime Environment <span class="o">(</span>build 1.8.0_275-8u275-b01-0ubuntu1~20.04-b01<span class="o">)</span>
OpenJDK 64-Bit Server VM <span class="o">(</span>build 25.275-b01, mixed mode<span class="o">)</span>
</code></pre></div><h3 id="è£…ä¸ª-jdk-11">è£…ä¸ª JDK 11</h3>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">$ sudo apt install openjdk-11-jdk -y

/usr/lib/jvm/java-11-openjdk-amd64 <span class="c1">#æˆ‘ç”µè„‘å®‰è£…çš„ä½ç½®</span>
</code></pre></div><h3 id="jdkç‰ˆæœ¬åˆ‡æ¢">JDKç‰ˆæœ¬åˆ‡æ¢</h3>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">$ sudo update-alternatives --install /usr/local/jdk jdk /usr/lib/jvm/java-8-openjdk-amd64 <span class="m">8</span>
$ sudo update-alternatives --install /usr/local/jdk jdk /usr/lib/jvm/java-11-openjdk-amd64 <span class="m">11</span>

$ sudo update-alternatives --config jdk

There are <span class="m">2</span> choices <span class="k">for</span> the alternative jdk <span class="o">(</span>providing /usr/local/jdk<span class="o">)</span>.

  Selection    Path                                Priority   Status
------------------------------------------------------------
  <span class="m">0</span>            /usr/lib/jvm/java-11-openjdk-amd64   <span class="m">11</span>        auto mode
  <span class="m">1</span>            /usr/lib/jvm/java-11-openjdk-amd64   <span class="m">11</span>        manual mode
* <span class="m">2</span>            /usr/lib/jvm/java-8-openjdk-amd64    <span class="m">8</span>         manual mode

Press &lt;enter&gt; to keep the current choice<span class="o">[</span>*<span class="o">]</span>, or <span class="nb">type</span> selection number:
</code></pre></div><p>æœ€åçš„8å’Œ11æ˜¯ä¼˜å…ˆçº§çš„æ„æ€ï¼Œæ•°å­—è¶Šå¤§ä¼˜å…ˆçº§å°±è¶Šé«˜ï¼Œé»˜è®¤æœ€å¤§å€¼ï¼Œæˆ‘è¿™é‡Œæœ€å¤§æ˜¯11 é»˜è®¤å°±æ˜¯JDK 11ï¼Œè¾“å…¥æ•°å­—é€‰æ‹©
é€‰æ‹© 0=auto è‡ªåŠ¨é€‰æ‹©æ•°å€¼æœ€å¤§çš„ é€‰æ‹© 1=jdk11 é€‰æ‹© 2=jdk8
æ ¹æ®é¡¹ç›®éœ€è¦ï¼Œéšæ—¶å¯ä»¥åˆ‡æ¢ç‰ˆæœ¬</p>
<h2 id="å®‰è£…maven">å®‰è£…maven</h2>
<p>å®‰è£…maven</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">$ sudo apt install maven -y

$ mvn -v
Apache Maven 3.6.3
Maven home: /usr/share/maven
Java version: 1.8.0_275, vendor: Private Build, runtime: /usr/lib/jvm/java-8-openjdk-amd64/jre
Default locale: en, platform encoding: UTF-8
OS name: <span class="s2">&#34;linux&#34;</span>, version: <span class="s2">&#34;4.19.104-microsoft-standard&#34;</span>, arch: <span class="s2">&#34;amd64&#34;</span>, family: <span class="s2">&#34;unix&#34;</span>
</code></pre></div><p>æ·»åŠ å›½å†…é•œåƒåˆ°é…ç½®æ–‡ä»¶<code>/usr/share/maven/conf/settings.xml</code>ï¼Œåˆ°ç½‘ä¸Šæ‰¾äº†ä¸€ä¸ªé•œåƒé…ç½®ï¼Œå¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml">  <span class="nt">&lt;mirrors&gt;</span>
        <span class="nt">&lt;mirror&gt;</span>
        <span class="nt">&lt;id&gt;</span>aliyun-public<span class="nt">&lt;/id&gt;</span>
        <span class="nt">&lt;mirrorOf&gt;</span>*<span class="nt">&lt;/mirrorOf&gt;</span>
        <span class="nt">&lt;name&gt;</span>aliyun public<span class="nt">&lt;/name&gt;</span>
        <span class="nt">&lt;url&gt;</span>https://maven.aliyun.com/repository/public<span class="nt">&lt;/url&gt;</span>
    <span class="nt">&lt;/mirror&gt;</span>

    <span class="nt">&lt;mirror&gt;</span>
        <span class="nt">&lt;id&gt;</span>aliyun-central<span class="nt">&lt;/id&gt;</span>
        <span class="nt">&lt;mirrorOf&gt;</span>*<span class="nt">&lt;/mirrorOf&gt;</span>
        <span class="nt">&lt;name&gt;</span>aliyun central<span class="nt">&lt;/name&gt;</span>
        <span class="nt">&lt;url&gt;</span>https://maven.aliyun.com/repository/central<span class="nt">&lt;/url&gt;</span>
    <span class="nt">&lt;/mirror&gt;</span>

    <span class="nt">&lt;mirror&gt;</span>
        <span class="nt">&lt;id&gt;</span>aliyun-spring<span class="nt">&lt;/id&gt;</span>
        <span class="nt">&lt;mirrorOf&gt;</span>*<span class="nt">&lt;/mirrorOf&gt;</span>
        <span class="nt">&lt;name&gt;</span>aliyun spring<span class="nt">&lt;/name&gt;</span>
        <span class="nt">&lt;url&gt;</span>https://maven.aliyun.com/repository/spring<span class="nt">&lt;/url&gt;</span>
    <span class="nt">&lt;/mirror&gt;</span>

    <span class="nt">&lt;mirror&gt;</span>
        <span class="nt">&lt;id&gt;</span>aliyun-spring-plugin<span class="nt">&lt;/id&gt;</span>
        <span class="nt">&lt;mirrorOf&gt;</span>*<span class="nt">&lt;/mirrorOf&gt;</span>
        <span class="nt">&lt;name&gt;</span>aliyun spring-plugin<span class="nt">&lt;/name&gt;</span>
        <span class="nt">&lt;url&gt;</span>https://maven.aliyun.com/repository/spring-plugin<span class="nt">&lt;/url&gt;</span>
    <span class="nt">&lt;/mirror&gt;</span>

    <span class="nt">&lt;mirror&gt;</span>
        <span class="nt">&lt;id&gt;</span>aliyun-apache-snapshots<span class="nt">&lt;/id&gt;</span>
        <span class="nt">&lt;mirrorOf&gt;</span>*<span class="nt">&lt;/mirrorOf&gt;</span>
        <span class="nt">&lt;name&gt;</span>aliyun apache-snapshots<span class="nt">&lt;/name&gt;</span>
        <span class="nt">&lt;url&gt;</span>https://maven.aliyun.com/repository/apache-snapshots<span class="nt">&lt;/url&gt;</span>
    <span class="nt">&lt;/mirror&gt;</span>

    <span class="nt">&lt;mirror&gt;</span>
        <span class="nt">&lt;id&gt;</span>aliyun-google<span class="nt">&lt;/id&gt;</span>
        <span class="nt">&lt;mirrorOf&gt;</span>*<span class="nt">&lt;/mirrorOf&gt;</span>
        <span class="nt">&lt;name&gt;</span>aliyun google<span class="nt">&lt;/name&gt;</span>
        <span class="nt">&lt;url&gt;</span>https://maven.aliyun.com/repository/google<span class="nt">&lt;/url&gt;</span>
    <span class="nt">&lt;/mirror&gt;</span>

    <span class="nt">&lt;mirror&gt;</span>
        <span class="nt">&lt;id&gt;</span>aliyun-gradle-plugin<span class="nt">&lt;/id&gt;</span>
        <span class="nt">&lt;mirrorOf&gt;</span>*<span class="nt">&lt;/mirrorOf&gt;</span>
        <span class="nt">&lt;name&gt;</span>aliyun gradle-plugin<span class="nt">&lt;/name&gt;</span>
        <span class="nt">&lt;url&gt;</span>https://maven.aliyun.com/repository/gradle-plugin<span class="nt">&lt;/url&gt;</span>
    <span class="nt">&lt;/mirror&gt;</span>

    <span class="nt">&lt;mirror&gt;</span>
        <span class="nt">&lt;id&gt;</span>aliyun-jcenter<span class="nt">&lt;/id&gt;</span>
        <span class="nt">&lt;mirrorOf&gt;</span>*<span class="nt">&lt;/mirrorOf&gt;</span>
        <span class="nt">&lt;name&gt;</span>aliyun jcenter<span class="nt">&lt;/name&gt;</span>
        <span class="nt">&lt;url&gt;</span>https://maven.aliyun.com/repository/jcenter<span class="nt">&lt;/url&gt;</span>
    <span class="nt">&lt;/mirror&gt;</span>

    <span class="nt">&lt;mirror&gt;</span>
        <span class="nt">&lt;id&gt;</span>aliyun-releases<span class="nt">&lt;/id&gt;</span>
        <span class="nt">&lt;mirrorOf&gt;</span>*<span class="nt">&lt;/mirrorOf&gt;</span>
        <span class="nt">&lt;name&gt;</span>aliyun releases<span class="nt">&lt;/name&gt;</span>
        <span class="nt">&lt;url&gt;</span>https://maven.aliyun.com/repository/releases<span class="nt">&lt;/url&gt;</span>
    <span class="nt">&lt;/mirror&gt;</span>

    <span class="nt">&lt;mirror&gt;</span>
        <span class="nt">&lt;id&gt;</span>aliyun-snapshots<span class="nt">&lt;/id&gt;</span>
        <span class="nt">&lt;mirrorOf&gt;</span>*<span class="nt">&lt;/mirrorOf&gt;</span>
        <span class="nt">&lt;name&gt;</span>aliyun snapshots<span class="nt">&lt;/name&gt;</span>
        <span class="nt">&lt;url&gt;</span>https://maven.aliyun.com/repository/snapshots<span class="nt">&lt;/url&gt;</span>
    <span class="nt">&lt;/mirror&gt;</span>

    <span class="nt">&lt;mirror&gt;</span>
        <span class="nt">&lt;id&gt;</span>aliyun-grails-core<span class="nt">&lt;/id&gt;</span>
        <span class="nt">&lt;mirrorOf&gt;</span>*<span class="nt">&lt;/mirrorOf&gt;</span>
        <span class="nt">&lt;name&gt;</span>aliyun grails-core<span class="nt">&lt;/name&gt;</span>
        <span class="nt">&lt;url&gt;</span>https://maven.aliyun.com/repository/grails-core<span class="nt">&lt;/url&gt;</span>
    <span class="nt">&lt;/mirror&gt;</span>

    <span class="nt">&lt;mirror&gt;</span>
        <span class="nt">&lt;id&gt;</span>aliyun-mapr-public<span class="nt">&lt;/id&gt;</span>
        <span class="nt">&lt;mirrorOf&gt;</span>*<span class="nt">&lt;/mirrorOf&gt;</span>
        <span class="nt">&lt;name&gt;</span>aliyun mapr-public<span class="nt">&lt;/name&gt;</span>
        <span class="nt">&lt;url&gt;</span>https://maven.aliyun.com/repository/mapr-public<span class="nt">&lt;/url&gt;</span>
    <span class="nt">&lt;/mirror&gt;</span>
 <span class="c">&lt;!-- mirror
</span><span class="c">     | Specifies a repository mirror site to use instead of a given repository. The repository that
</span><span class="c">     | this mirror serves has an ID that matches the mirrorOf element of this mirror. IDs are used
</span><span class="c">     | for inheritance and direct lookup purposes, and must be unique across the set of mirrors.
</span><span class="c">     |
</span><span class="c">    &lt;mirror&gt;
</span><span class="c">      &lt;id&gt;mirrorId&lt;/id&gt;
</span><span class="c">      &lt;mirrorOf&gt;repositoryId&lt;/mirrorOf&gt;
</span><span class="c">      &lt;name&gt;Human Readable Name for this Mirror.&lt;/name&gt;
</span><span class="c">      &lt;url&gt;http://my.repository.com/repo/path&lt;/url&gt;
</span><span class="c">    &lt;/mirror&gt;
</span><span class="c">     --&gt;</span>
  <span class="nt">&lt;/mirrors&gt;</span>
</code></pre></div><h2 id="æ·»åŠ ç¯å¢ƒå˜é‡">æ·»åŠ ç¯å¢ƒå˜é‡</h2>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">$ <span class="nb">echo</span> <span class="nb">export</span> <span class="nv">MAVEN_HOME</span><span class="o">=</span>/usr/share/maven &gt;&gt; ~/.bash_profile <span class="c1"># zsh æ˜¯ ~/.zshrc</span>
$ <span class="nb">echo</span> <span class="nb">export</span> <span class="nv">PATH</span><span class="o">=</span><span class="nv">$PATH</span>:<span class="nv">$MAVEN_HOME</span>/bin &gt;&gt; ~/.bash_profile <span class="c1"># zsh æ˜¯ ~/.zshrc</span>

$ <span class="nb">echo</span> <span class="nb">export</span> <span class="nv">JAVA_HOME</span><span class="o">=</span>/usr/local/jdk &gt;&gt; ~/.bash_profile <span class="c1"># zsh æ˜¯ ~/.zshrc</span>
$ <span class="nb">echo</span> <span class="nb">export</span> <span class="nv">PATH</span><span class="o">=</span><span class="nv">$PATH</span>:<span class="nv">$JAVA_HOME</span>/bin &gt;&gt; ~/.bash_profile <span class="c1"># zsh æ˜¯ ~/.zshrc</span>
$ <span class="nb">source</span> ~/.bash_profile <span class="c1"># zsh æ˜¯ ~/.zshrc</span>

$ <span class="nb">echo</span> <span class="nv">$JAVA_HOME</span>
/usr/local/jdk

$ <span class="nb">echo</span> <span class="nv">$MAVEN_HOME</span>
/usr/share/maven
</code></pre></div><h2 id="æµ‹è¯•åˆ‡æ¢ä¸åŒç¯å¢ƒ">æµ‹è¯•åˆ‡æ¢ä¸åŒç¯å¢ƒ</h2>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">$ sudo update-alternatives --config jdk
There are <span class="m">2</span> choices <span class="k">for</span> the alternative jdk <span class="o">(</span>providing /usr/local/jdk<span class="o">)</span>.

  Selection    Path                                Priority   Status
------------------------------------------------------------
  <span class="m">0</span>            /usr/lib/jvm/java-11-openjdk-amd64   <span class="m">11</span>        auto mode
  <span class="m">1</span>            /usr/lib/jvm/java-11-openjdk-amd64   <span class="m">11</span>        manual mode
* <span class="m">2</span>            /usr/lib/jvm/java-8-openjdk-amd64    <span class="m">8</span>         manual mode
Press &lt;enter&gt; to keep the current choice<span class="o">[</span>*<span class="o">]</span>, or <span class="nb">type</span> selection number: <span class="m">0</span>
update-alternatives: using /usr/lib/jvm/java-11-openjdk-amd64 to provide /usr/local/jdk <span class="o">(</span>jdk<span class="o">)</span> in auto mode

$ java -version
openjdk version <span class="s2">&#34;11.0.9.1&#34;</span> 2020-11-04
OpenJDK Runtime Environment <span class="o">(</span>build 11.0.9.1+1-Ubuntu-0ubuntu1.20.04<span class="o">)</span>
OpenJDK 64-Bit Server VM <span class="o">(</span>build 11.0.9.1+1-Ubuntu-0ubuntu1.20.04, mixed mode, sharing<span class="o">)</span>

$ javac -version
javac 11.0.9.1

$ mvn -v
Apache Maven 3.6.3
Maven home: /usr/share/maven
Java version: 11.0.9.1, vendor: Ubuntu, runtime: /usr/lib/jvm/java-11-openjdk-amd64
Default locale: en, platform encoding: UTF-8
OS name: <span class="s2">&#34;linux&#34;</span>, version: <span class="s2">&#34;4.19.128-microsoft-standard&#34;</span>, arch: <span class="s2">&#34;amd64&#34;</span>, family: <span class="s2">&#34;unix&#34;</span>

$ sudo update-alternatives --config jdk
There are <span class="m">2</span> choices <span class="k">for</span> the alternative jdk <span class="o">(</span>providing /usr/local/jdk<span class="o">)</span>.

  Selection    Path                                Priority   Status
------------------------------------------------------------
* <span class="m">0</span>            /usr/lib/jvm/java-11-openjdk-amd64   <span class="m">11</span>        auto mode
  <span class="m">1</span>            /usr/lib/jvm/java-11-openjdk-amd64   <span class="m">11</span>        manual mode
  <span class="m">2</span>            /usr/lib/jvm/java-8-openjdk-amd64    <span class="m">8</span>         manual mode

Press &lt;enter&gt; to keep the current choice<span class="o">[</span>*<span class="o">]</span>, or <span class="nb">type</span> selection number: <span class="m">2</span>
update-alternatives: using /usr/lib/jvm/java-8-openjdk-amd64 to provide /usr/local/jdk <span class="o">(</span>jdk<span class="o">)</span> in manual mode

$ javac -version
javac 1.8.0_275

$ java -version
openjdk version <span class="s2">&#34;1.8.0_275&#34;</span>
OpenJDK Runtime Environment <span class="o">(</span>build 1.8.0_275-8u275-b01-0ubuntu1~20.04-b01<span class="o">)</span>
OpenJDK 64-Bit Server VM <span class="o">(</span>build 25.275-b01, mixed mode<span class="o">)</span>

$ mvn -v
Apache Maven 3.6.3
Maven home: /usr/share/maven
Java version: 1.8.0_275, vendor: Private Build, runtime: /usr/lib/jvm/java-8-openjdk-amd64/jre
Default locale: en, platform encoding: UTF-8
OS name: <span class="s2">&#34;linux&#34;</span>, version: <span class="s2">&#34;4.19.128-microsoft-standard&#34;</span>, arch: <span class="s2">&#34;amd64&#34;</span>, family: <span class="s2">&#34;unix&#34;</span>
</code></pre></div><p>å¯ä»¥æ­£å¸¸åˆ‡æ¢ç¯å¢ƒï¼Œç›¸å¯¹åº”çš„è½¯ä»¶ä¹Ÿä¼šè·Ÿç€åˆ‡æ¢ç¯å¢ƒï¼Œå¾ˆç¾å¥½ã€‚</p>
<h2 id="ä½¿ç”¨vscodeè°ƒè¯•java">ä½¿ç”¨vscodeè°ƒè¯•java</h2>
<p>æ–°å»ºä¸€ä¸ªç”¨äºJavaå¼€å‘çš„é¡¹ç›®æ–‡ä»¶å¤¹</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">$ mkdir ~/projects/java/test -p
$ <span class="nb">cd</span> ~/projects/java/test <span class="o">&amp;&amp;</span> touch test.java
$ code .
</code></pre></div><p>è¿™æ—¶ä¼šæ‰“å¼€vscode,è¿›å…¥åï¼Œä¼šæç¤ºä¸‹è½½Javaæ‰©å±• vscjava.vscode-java-packï¼Œå¦‚æ²¡æœ‰æç¤ºï¼Œè‡ªå·±å»æ‰©å±•é‚£é‡Œæœç´¢vscjava.vscode-java-pack
å®‰è£…å®Œåï¼Œå¯èƒ½ä¼šæç¤ºç‰ˆæœ¬é—®é¢˜</p>
<blockquote>
<p>å¦‚æœé‡åˆ°é—®é¢˜ï¼šã€å¾ˆæŠ±æ­‰ï¼Œæ¿€æ´»é¢å‘ Java çš„ IntelliCode æ”¯æŒæ—¶é‡åˆ°é—®é¢˜ã€‚æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹â€œé’ˆå¯¹ Java çš„è¯­è¨€æ”¯æŒâ€å’Œ â€œVS IntelliCodeâ€ è¾“å‡ºçª—å£ã€‘</p>
</blockquote>
<p>æ‰‹åŠ¨é™çº§language supportâ€¦åˆ°0.64.1</p>
<p>ç¼–è¾‘test.javaæ–‡ä»¶</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">class</span> <span class="nc">wsl</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;hello java of wsl&#34;</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div><p>ç‚¹è¿è¡Œï¼Œå¯ä»¥çœ‹åˆ°è¾“å‡º</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">hello java of wsl
</code></pre></div><h2 id="ä½¿ç”¨mavenæ¥åˆ›å»ºspringbooté¡¹ç›®">ä½¿ç”¨mavenæ¥åˆ›å»ºSpringbooté¡¹ç›®</h2>
<p>åˆ›å»ºé¡¹ç›®å‰ï¼Œè¦é…ç½®ä¸€ä¸‹vscodeä¸­çš„mavené€‰é¡¹ï¼Œå‘Šè¯‰vscodeé…ç½®æ–‡ä»¶åœ°å€ï¼Œå¥½ä½¿ç”¨å›½å†…é•œåƒä¸‹è½½åŒ…ã€‚åœ¨vscodeçš„è®¾ç½®ä¸­ï¼Œæœç´¢mavenï¼Œglobal settings path to maven&rsquo;s global settings.xmlé€‰é¡¹ä¸­ï¼Œè¾“å…¥ <code>/usr/share/maven/conf/settings.xml</code></p>
<p>ä¹‹ååœ¨vscodeç•Œé¢æŒ‰ crtl+shift+p è°ƒå‡ºå‘½ä»¤è¾“å‡º spring init æ™ºèƒ½æç¤ºä¸­çœ‹åˆ°æœ‰ create maven projectç›¸å…³å­—æ ·ï¼Œé€šè¿‡è¿™ä¸ªæ¥åˆ›å»ºã€‚ä¹‹åä¼šè·³å‡ºé€‰æ‹©Springbootç‰ˆæœ¬ï¼Œæˆ‘é€‰äº†2.4 é¡¹ç›®æ‰€ç”¨å¼€å‘è¯­è¨€é€‰javaï¼Œgroupid com.example,project demo,package type jar,jdk é€‰8æˆ–11ï¼Œæ ¹æ®è‡ªå·±çš„ç¯å¢ƒæ¥å®šï¼Œä¹‹åå°±æ˜¯é€‰æ‹©è¦ç”¨åˆ°çš„springbootå¼€å‘å·¥å…·äº†ã€‚å°±åšä¸ªç®€å•çš„æµ‹è¯•ï¼Œæˆ‘é€‰äº†ä¸€ä¸ªrest repositoriesåŒ…ï¼Œé€‰å¥½å·¥å…·åŒ…åï¼Œå°±æ˜¯é€‰é¡¹ç›®æ ¹ç›®å½•äº†,è‡ªå·±å»ºä¸€ä¸ªç©ºæ–‡ä»¶å¤¹ï¼Œä½œä¸ºè¯¥é¡¹ç›®çš„æ ¹ç›®å½•ã€‚</p>
<p>åˆ›å»ºå¥½åï¼Œvscodeä¼šè‡ªåŠ¨å»ä¸‹è½½ç›¸å…³çš„åŒ…ï¼Œä¹‹åçš„é¡¹ç›®ç»“æ„æ˜¯ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">âœ  demo tree      
.
â”œâ”€â”€ HELP.md
â”œâ”€â”€ mvnw
â”œâ”€â”€ mvnw.cmd
â”œâ”€â”€ pom.xml
â”œâ”€â”€ src
â”‚   â”œâ”€â”€ main
â”‚   â”‚   â”œâ”€â”€ java
â”‚   â”‚   â”‚   â””â”€â”€ com
â”‚   â”‚   â”‚       â””â”€â”€ example
â”‚   â”‚   â”‚           â””â”€â”€ demo
â”‚   â”‚   â”‚               â””â”€â”€ DemoApplication.java
â”‚   â”‚   â””â”€â”€ resources
â”‚   â”‚       â””â”€â”€ application.properties
â”‚   â””â”€â”€ <span class="nb">test</span>
â”‚       â””â”€â”€ java
â”‚           â””â”€â”€ com
â”‚               â””â”€â”€ example
â”‚                   â””â”€â”€ demo
â”‚                       â””â”€â”€ DemoApplicationTests.java
â””â”€â”€ target
    â”œâ”€â”€ classes
    â”‚   â”œâ”€â”€ application.properties
    â”‚   â””â”€â”€ com
    â”‚       â””â”€â”€ example
    â”‚           â””â”€â”€ demo
    â”‚               â””â”€â”€ DemoApplication.class
    â””â”€â”€ test-classes
        â””â”€â”€ com
            â””â”€â”€ example
                â””â”€â”€ demo
                    â””â”€â”€ DemoApplicationTests.class

<span class="m">21</span> directories, <span class="m">10</span> files
</code></pre></div><p>åœ¨src/main/java/com/example/demo ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ªHello.javaæ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@RestController</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;/user&#34;</span><span class="o">)</span> 
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Hello</span> <span class="o">{</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;/hello&#34;</span><span class="o">)</span>
    <span class="kd">public</span>  <span class="n">String</span> <span class="nf">Hello</span><span class="o">(){</span>
        <span class="k">return</span> <span class="s">&#34;Hello World&#34;</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div><p>é€‰ä¸­ <code>@RequestMapping(&quot;/hello&quot;)</code>æŒ‰crtl+shift+o ä¼šè‡ªåŠ¨åŠ è½½åŒ…ï¼ŒåŒæ—¶è‡ªå·±ç»™ç±»åŠ ä¸ªåŒ…åã€‚<code>package com.example.demo;</code>,ä¹‹åä»£ç å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.example.demo</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RestController</span><span class="o">;</span>

<span class="nd">@RestController</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;/user&#34;</span><span class="o">)</span> 
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Hello</span> <span class="o">{</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;/hello&#34;</span><span class="o">)</span>
    <span class="kd">public</span>  <span class="n">String</span> <span class="nf">Hello</span><span class="o">(){</span>
        <span class="k">return</span> <span class="s">&#34;Hello World&#34;</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div><p>ä¹‹ååœ¨ç¼–è¾‘å™¨ä¸­ç‚¹å³é”®ï¼Œé€‰æ‹©runå³å¯è¿è¡Œé¡¹ç›®ï¼Œä¹‹ååœ¨æµè§ˆå™¨ä¸­æ‰“å¼€<code>http://localhost:8080/user/hello</code>å°±èƒ½çœ‹åˆ°<code>Hello World</code></p>
<h2 id="maven-æ‰“åŒ…">maven æ‰“åŒ…</h2>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">$ mvn clean package

<span class="o">[</span>INFO<span class="o">]</span> Results:
<span class="o">[</span>INFO<span class="o">]</span> 
<span class="o">[</span>INFO<span class="o">]</span> Tests run: 1, Failures: 0, Errors: 0, Skipped: <span class="m">0</span>
<span class="o">[</span>INFO<span class="o">]</span> 
<span class="o">[</span>INFO<span class="o">]</span> 
<span class="o">[</span>INFO<span class="o">]</span> --- maven-jar-plugin:3.2.0:jar <span class="o">(</span>default-jar<span class="o">)</span> @ demo ---
<span class="o">[</span>INFO<span class="o">]</span> Building jar: /mnt/d/projects/java/test2/demo2/demo/target/demo-0.0.1-SNAPSHOT.jar
<span class="o">[</span>INFO<span class="o">]</span> 
<span class="o">[</span>INFO<span class="o">]</span> --- spring-boot-maven-plugin:2.4.2:repackage <span class="o">(</span>repackage<span class="o">)</span> @ demo ---
<span class="o">[</span>INFO<span class="o">]</span> Replacing main artifact with repackaged archive
<span class="o">[</span>INFO<span class="o">]</span> ------------------------------------------------------------------------
<span class="o">[</span>INFO<span class="o">]</span> BUILD SUCCESS
<span class="o">[</span>INFO<span class="o">]</span> ------------------------------------------------------------------------
<span class="o">[</span>INFO<span class="o">]</span> Total time:  11.720 s
<span class="o">[</span>INFO<span class="o">]</span> Finished at: 2021-01-26T12:42:35+08:00
<span class="o">[</span>INFO<span class="o">]</span> ------------------------------------------------------------------------

$ java -jar target/demo-0.0.1-SNAPSHOT.jar

2021-01-26 12:44:39.326  INFO <span class="m">21527</span> --- <span class="o">[</span>           main<span class="o">]</span> o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port<span class="o">(</span>s<span class="o">)</span>: <span class="m">8080</span> <span class="o">(</span>http<span class="o">)</span>
2021-01-26 12:44:39.344  INFO <span class="m">21527</span> --- <span class="o">[</span>           main<span class="o">]</span> o.apache.catalina.core.StandardService   : Starting service <span class="o">[</span>Tomcat<span class="o">]</span>
2021-01-26 12:44:39.344  INFO <span class="m">21527</span> --- <span class="o">[</span>           main<span class="o">]</span> org.apache.catalina.core.StandardEngine  : Starting Servlet engine: <span class="o">[</span>Apache Tomcat/9.0.41<span class="o">]</span>
2021-01-26 12:44:39.455  INFO <span class="m">21527</span> --- <span class="o">[</span>           main<span class="o">]</span> o.a.c.c.C.<span class="o">[</span>Tomcat<span class="o">]</span>.<span class="o">[</span>localhost<span class="o">]</span>.<span class="o">[</span>/<span class="o">]</span>       : Initializing Spring embedded WebApplicationContext
2021-01-26 12:44:39.455  INFO <span class="m">21527</span> --- <span class="o">[</span>           main<span class="o">]</span> w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in <span class="m">2930</span> ms
2021-01-26 12:44:40.346  INFO <span class="m">21527</span> --- <span class="o">[</span>           main<span class="o">]</span> o.s.s.concurrent.ThreadPoolTaskExecutor  : Initializing ExecutorService <span class="s1">&#39;applicationTaskExecutor&#39;</span>
2021-01-26 12:44:40.982  INFO <span class="m">21527</span> --- <span class="o">[</span>           main<span class="o">]</span> o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port<span class="o">(</span>s<span class="o">)</span>: <span class="m">8080</span> <span class="o">(</span>http<span class="o">)</span> with context path <span class="s1">&#39;&#39;</span>
2021-01-26 12:44:41.001  INFO <span class="m">21527</span> --- <span class="o">[</span>           main<span class="o">]</span> com.example.demo.DemoApplication         : Started DemoApplication in 5.62 seconds <span class="o">(</span>JVM running <span class="k">for</span> 6.384<span class="o">)</span>
</code></pre></div><p>è¯·æ— è§†æˆ‘çš„ç›®å½•ç»“æ„ï¼Œç”±äºåˆšåˆšæ¥è§¦Javaï¼Œè°ƒè¯•äº†ä¸€ä¼šå„¿å†å¼„å¥½ï¼Œç›®å½•æœ‰äº›ä¹±ã€‚
åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€<code>http://localhost:8080/user/hello</code>å°±èƒ½çœ‹åˆ°<code>Hello World</code>ï¼ŒOKï¼Œç®€å•è°ƒè¯•å®Œæˆã€‚</p>
<h2 id="ç»“è¯­">ç»“è¯­</h2>
<p>ä¸ºå•¥è¦ç”¨vscodeæ¥æŠ˜è…¾å‘¢ï¼Œå› ä¸ºæˆ‘å¹³å¸¸ç”¨vscodeåšgoå¼€å‘ï¼Œæ­£å¥½æœ‰ä¸ªé¡¹ç›®åªæœ‰javaçš„åŒ…ï¼Œå°±æ¥å­¦ä¹ ä¸€ä¸‹Javaï¼Œç„¶åæŠŠåŠŸèƒ½åšæˆRPCè¿œç¨‹è°ƒç”¨å‡½æ•°ï¼Œå°±å¯ä»¥ç»§ç»­å¿«ä¹çš„ç©goäº†ã€‚</p>
]]></content>
		</item>
		
		<item>
			<title>å¯åŠ¨ WSL 2æ—¶è­¦å‘Šâ€œå‚è€ƒçš„å¯¹è±¡ç±»å‹ä¸æ”¯æŒå°è¯•çš„æ“ä½œâ€</title>
			<link>https://aomi.run/posts/wsl-error/</link>
			<pubDate>Sat, 23 Jan 2021 00:15:05 +0800</pubDate>
			
			<guid>https://aomi.run/posts/wsl-error/</guid>
			<description>å‡ºç°å›¾ä¸­æ‰€ç¤ºé”™è¯¯çš„åŸå› æ˜¯ ä»£ç†è½¯ä»¶ä¸ wsl2 çš„ç«¯å£å†²çªã€‚
ä½¿ç”¨ NoLsp.exe ä¸‹è½½é“¾æ¥ å¦‚æœæµè§ˆå™¨æ‰“ä¸å¼€ å¯ä»¥ç”¨è¿…é›·ä¹‹ç±»çš„æ¥ä¸‹è½½
ä½¿ç”¨ç®¡ç†å‘˜èº«ä»½è¿è¡Œä»¥ä¸‹å‘½ä»¤:
NoLsp.exe C:\Windows\system32\wsl.exe  å‚æ•°ä¸º wsl çš„ç»å¯¹è·¯å¾„ï¼ˆé»˜è®¤ä¸º C:\Windows\system32\wsl.exeï¼‰
 é—®é¢˜åŸå› åŠè§£å†³æ–¹æ¡ˆçš„è®¨è®ºè§ Gihub Issue</description>
			<content type="html"><![CDATA[<p><img src="https://i.loli.net/2019/12/30/8tUdMrmAfWqKHTw.png" alt=""></p>
<p>å‡ºç°å›¾ä¸­æ‰€ç¤ºé”™è¯¯çš„åŸå› æ˜¯ ä»£ç†è½¯ä»¶ä¸ wsl2 çš„ç«¯å£å†²çªã€‚</p>
<p>ä½¿ç”¨ NoLsp.exe <a href="http://www.proxifier.com/tmp/Test20200228/NoLsp.exe">ä¸‹è½½é“¾æ¥</a> å¦‚æœæµè§ˆå™¨æ‰“ä¸å¼€ å¯ä»¥ç”¨è¿…é›·ä¹‹ç±»çš„æ¥ä¸‹è½½</p>
<p>ä½¿ç”¨ç®¡ç†å‘˜èº«ä»½è¿è¡Œä»¥ä¸‹å‘½ä»¤:</p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell">NoLsp.exe C:<span class="se">\W</span>indows<span class="se">\s</span>ystem32<span class="se">\w</span>sl.exe
</code></pre></div><blockquote>
<p>å‚æ•°ä¸º wsl çš„ç»å¯¹è·¯å¾„ï¼ˆé»˜è®¤ä¸º C:\Windows\system32\wsl.exeï¼‰</p>
</blockquote>
<p>é—®é¢˜åŸå› åŠè§£å†³æ–¹æ¡ˆçš„è®¨è®ºè§ <a href="https://github.com/microsoft/WSL/issues/4177#issuecomment-597736482">Gihub Issue</a></p>
]]></content>
		</item>
		
		<item>
			<title>7å¤©ç”¨Goä»é›¶å®ç°Webæ¡†æ¶</title>
			<link>https://aomi.run/posts/golang/realizing-web-framework-from-scratch-with-go-in-7-days/</link>
			<pubDate>Thu, 21 Jan 2021 17:35:50 +0800</pubDate>
			
			<guid>https://aomi.run/posts/golang/realizing-web-framework-from-scratch-with-go-in-7-days/</guid>
			<description>åºè¨€ åœ¨ç½‘ä¸Šçœ‹åˆ°ä¸€ä¸ªä¸é”™çš„æ•™ç¨‹ï¼Œä¸ºäº†è‡ªå·±è®°å½•æ–¹ä¾¿ï¼Œè½¬è½½ä¸€ä¸‹ã€‚æºç«™åœ°å€ æå®¢å…”å…”
è®¾è®¡ä¸€ä¸ªæ¡†æ¶ å¤§éƒ¨åˆ†æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦å®ç°ä¸€ä¸ª Web åº”ç”¨ï¼Œç¬¬ä¸€ååº”æ˜¯åº”è¯¥ä½¿ç”¨å“ªä¸ªæ¡†æ¶ã€‚ä¸åŒçš„æ¡†æ¶è®¾è®¡ç†å¿µå’Œæä¾›çš„åŠŸèƒ½æœ‰å¾ˆå¤§çš„å·®åˆ«ã€‚æ¯”å¦‚ Python è¯­è¨€çš„ djangoå’Œflaskï¼Œå‰è€…å¤§è€Œå…¨ï¼Œåè€…å°è€Œç¾ã€‚Goè¯­è¨€/golang ä¹Ÿæ˜¯å¦‚æ­¤ï¼Œæ–°æ¡†æ¶å±‚å‡ºä¸ç©·ï¼Œæ¯”å¦‚Beegoï¼ŒGinï¼ŒIrisç­‰ã€‚é‚£ä¸ºä»€ä¹ˆä¸ç›´æ¥ä½¿ç”¨æ ‡å‡†åº“ï¼Œè€Œå¿…é¡»ä½¿ç”¨æ¡†æ¶å‘¢ï¼Ÿåœ¨è®¾è®¡ä¸€ä¸ªæ¡†æ¶ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å›ç­”æ¡†æ¶æ ¸å¿ƒä¸ºæˆ‘ä»¬è§£å†³äº†ä»€ä¹ˆé—®é¢˜ã€‚åªæœ‰ç†è§£äº†è¿™ä¸€ç‚¹ï¼Œæ‰èƒ½æƒ³æ˜ç™½æˆ‘ä»¬éœ€è¦åœ¨æ¡†æ¶ä¸­å®ç°ä»€ä¹ˆåŠŸèƒ½ã€‚
æˆ‘ä»¬å…ˆçœ‹çœ‹æ ‡å‡†åº“net/httpå¦‚ä½•å¤„ç†ä¸€ä¸ªè¯·æ±‚ã€‚
func main() { http.HandleFunc(&amp;#34;/&amp;#34;, handler) http.HandleFunc(&amp;#34;/count&amp;#34;, counter) log.Fatal(http.ListenAndServe(&amp;#34;localhost:8000&amp;#34;, nil)) } func handler(w http.ResponseWriter, r *http.Request) { fmt.Fprintf(w, &amp;#34;URL.Path = %qn&amp;#34;, r.URL.Path) } net/httpæä¾›äº†åŸºç¡€çš„WebåŠŸèƒ½ï¼Œå³ç›‘å¬ç«¯å£ï¼Œæ˜ å°„é™æ€è·¯ç”±ï¼Œè§£æHTTPæŠ¥æ–‡ã€‚ä¸€äº›Webå¼€å‘ä¸­ç®€å•çš„éœ€æ±‚å¹¶ä¸æ”¯æŒï¼Œéœ€è¦æ‰‹å·¥å®ç°ã€‚
 åŠ¨æ€è·¯ç”±ï¼šä¾‹å¦‚hello/:nameï¼Œhello/*è¿™ç±»çš„è§„åˆ™ã€‚ é‰´æƒï¼šæ²¡æœ‰åˆ†ç»„/ç»Ÿä¸€é‰´æƒçš„èƒ½åŠ›ï¼Œéœ€è¦åœ¨æ¯ä¸ªè·¯ç”±æ˜ å°„çš„handlerä¸­å®ç°ã€‚ æ¨¡æ¿ï¼šæ²¡æœ‰ç»Ÿä¸€ç®€åŒ–çš„HTMLæœºåˆ¶ã€‚ â€¦  å½“æˆ‘ä»¬ç¦»å¼€æ¡†æ¶ï¼Œä½¿ç”¨åŸºç¡€åº“æ—¶ï¼Œéœ€è¦é¢‘ç¹æ‰‹å·¥å¤„ç†çš„åœ°æ–¹ï¼Œå°±æ˜¯æ¡†æ¶çš„ä»·å€¼æ‰€åœ¨ã€‚ä½†å¹¶ä¸æ˜¯æ¯ä¸€ä¸ªé¢‘ç¹å¤„ç†çš„åœ°æ–¹éƒ½é€‚åˆåœ¨æ¡†æ¶ä¸­å®Œæˆã€‚Pythonæœ‰ä¸€ä¸ªå¾ˆè‘—åçš„Webæ¡†æ¶ï¼Œåå«bottleï¼Œæ•´ä¸ªæ¡†æ¶ç”±bottle.pyä¸€ä¸ªæ–‡ä»¶æ„æˆï¼Œå…±4400è¡Œï¼Œå¯ä»¥è¯´æ˜¯ä¸€ä¸ªå¾®æ¡†æ¶ã€‚é‚£ä¹ˆç†è§£è¿™ä¸ªå¾®æ¡†æ¶æä¾›çš„ç‰¹æ€§ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬ç†è§£æ¡†æ¶çš„æ ¸å¿ƒèƒ½åŠ›ã€‚
 è·¯ç”±(Routing)ï¼šå°†è¯·æ±‚æ˜ å°„åˆ°å‡½æ•°ï¼Œæ”¯æŒåŠ¨æ€è·¯ç”±ã€‚ä¾‹å¦‚&#39;/hello/:nameã€‚ æ¨¡æ¿(Templates)ï¼šä½¿ç”¨å†…ç½®æ¨¡æ¿å¼•æ“æä¾›æ¨¡æ¿æ¸²æŸ“æœºåˆ¶ã€‚ å·¥å…·é›†(Utilites)ï¼šæä¾›å¯¹ cookiesï¼Œheaders ç­‰å¤„ç†æœºåˆ¶ã€‚ æ’ä»¶(Plugin)ï¼šBottleæœ¬èº«åŠŸèƒ½æœ‰é™ï¼Œä½†æä¾›äº†æ’ä»¶æœºåˆ¶ã€‚å¯ä»¥é€‰æ‹©å®‰è£…åˆ°å…¨å±€ï¼Œä¹Ÿå¯ä»¥åªé’ˆå¯¹æŸå‡ ä¸ªè·¯ç”±ç”Ÿæ•ˆã€‚ â€¦  HTTP åŸºç¡€ æ ‡å‡†åº“å¯åŠ¨WebæœåŠ¡ Goè¯­è¨€å†…ç½®äº† net/httpåº“ï¼Œå°è£…äº†HTTPç½‘ç»œç¼–ç¨‹çš„åŸºç¡€çš„æ¥å£ï¼Œæˆ‘ä»¬å®ç°çš„Gee Web æ¡†æ¶ä¾¿æ˜¯åŸºäºnet/httpçš„ã€‚æˆ‘ä»¬æ¥ä¸‹æ¥é€šè¿‡ä¸€ä¸ªä¾‹å­ï¼Œç®€å•ä»‹ç»ä¸‹è¿™ä¸ªåº“çš„ä½¿ç”¨ã€‚
package main import ( &amp;#34;fmt&amp;#34; &amp;#34;log&amp;#34; &amp;#34;net/http&amp;#34; ) func main() { http.HandleFunc(&amp;#34;/&amp;#34;, indexHandler) http.</description>
			<content type="html"><![CDATA[<h2 id="åºè¨€">åºè¨€</h2>
<p>åœ¨ç½‘ä¸Šçœ‹åˆ°ä¸€ä¸ªä¸é”™çš„æ•™ç¨‹ï¼Œä¸ºäº†è‡ªå·±è®°å½•æ–¹ä¾¿ï¼Œè½¬è½½ä¸€ä¸‹ã€‚æºç«™åœ°å€ <a href="https://geektutu.com/post/gee.html" title="7å¤©ç”¨Goä»é›¶å®ç°Webæ¡†æ¶Geeæ•™ç¨‹">æå®¢å…”å…”</a></p>
<h3 id="è®¾è®¡ä¸€ä¸ªæ¡†æ¶">è®¾è®¡ä¸€ä¸ªæ¡†æ¶</h3>
<p>å¤§éƒ¨åˆ†æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦å®ç°ä¸€ä¸ª Web åº”ç”¨ï¼Œç¬¬ä¸€ååº”æ˜¯åº”è¯¥ä½¿ç”¨å“ªä¸ªæ¡†æ¶ã€‚ä¸åŒçš„æ¡†æ¶è®¾è®¡ç†å¿µå’Œæä¾›çš„åŠŸèƒ½æœ‰å¾ˆå¤§çš„å·®åˆ«ã€‚æ¯”å¦‚ <code>Python</code> è¯­è¨€çš„ <code>django</code>å’Œ<code>flask</code>ï¼Œå‰è€…å¤§è€Œå…¨ï¼Œåè€…å°è€Œç¾ã€‚<code>Go</code>è¯­è¨€/<code>golang</code> ä¹Ÿæ˜¯å¦‚æ­¤ï¼Œæ–°æ¡†æ¶å±‚å‡ºä¸ç©·ï¼Œæ¯”å¦‚<code>Beego</code>ï¼Œ<code>Gin</code>ï¼Œ<code>Iris</code>ç­‰ã€‚é‚£ä¸ºä»€ä¹ˆä¸ç›´æ¥ä½¿ç”¨æ ‡å‡†åº“ï¼Œè€Œå¿…é¡»ä½¿ç”¨æ¡†æ¶å‘¢ï¼Ÿåœ¨è®¾è®¡ä¸€ä¸ªæ¡†æ¶ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å›ç­”æ¡†æ¶æ ¸å¿ƒä¸ºæˆ‘ä»¬è§£å†³äº†ä»€ä¹ˆé—®é¢˜ã€‚åªæœ‰ç†è§£äº†è¿™ä¸€ç‚¹ï¼Œæ‰èƒ½æƒ³æ˜ç™½æˆ‘ä»¬éœ€è¦åœ¨æ¡†æ¶ä¸­å®ç°ä»€ä¹ˆåŠŸèƒ½ã€‚</p>
<p>æˆ‘ä»¬å…ˆçœ‹çœ‹æ ‡å‡†åº“<code>net/http</code>å¦‚ä½•å¤„ç†ä¸€ä¸ªè¯·æ±‚ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">http</span><span class="p">.</span><span class="nf">HandleFunc</span><span class="p">(</span><span class="s">&#34;/&#34;</span><span class="p">,</span> <span class="nx">handler</span><span class="p">)</span>
    <span class="nx">http</span><span class="p">.</span><span class="nf">HandleFunc</span><span class="p">(</span><span class="s">&#34;/count&#34;</span><span class="p">,</span> <span class="nx">counter</span><span class="p">)</span>
    <span class="nx">log</span><span class="p">.</span><span class="nf">Fatal</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nf">ListenAndServe</span><span class="p">(</span><span class="s">&#34;localhost:8000&#34;</span><span class="p">,</span> <span class="kc">nil</span><span class="p">))</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">handler</span><span class="p">(</span><span class="nx">w</span> <span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span> <span class="nx">r</span> <span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nf">Fprintf</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span> <span class="s">&#34;URL.Path = %qn&#34;</span><span class="p">,</span> <span class="nx">r</span><span class="p">.</span><span class="nx">URL</span><span class="p">.</span><span class="nx">Path</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div><p><code>net/http</code>æä¾›äº†åŸºç¡€çš„WebåŠŸèƒ½ï¼Œå³ç›‘å¬ç«¯å£ï¼Œæ˜ å°„é™æ€è·¯ç”±ï¼Œè§£æHTTPæŠ¥æ–‡ã€‚ä¸€äº›Webå¼€å‘ä¸­ç®€å•çš„éœ€æ±‚å¹¶ä¸æ”¯æŒï¼Œéœ€è¦æ‰‹å·¥å®ç°ã€‚</p>
<ul>
<li>åŠ¨æ€è·¯ç”±ï¼šä¾‹å¦‚hello/:nameï¼Œhello/*è¿™ç±»çš„è§„åˆ™ã€‚</li>
<li>é‰´æƒï¼šæ²¡æœ‰åˆ†ç»„/ç»Ÿä¸€é‰´æƒçš„èƒ½åŠ›ï¼Œéœ€è¦åœ¨æ¯ä¸ªè·¯ç”±æ˜ å°„çš„handlerä¸­å®ç°ã€‚</li>
<li>æ¨¡æ¿ï¼šæ²¡æœ‰ç»Ÿä¸€ç®€åŒ–çš„HTMLæœºåˆ¶ã€‚</li>
<li>â€¦</li>
</ul>
<p>å½“æˆ‘ä»¬ç¦»å¼€æ¡†æ¶ï¼Œä½¿ç”¨åŸºç¡€åº“æ—¶ï¼Œéœ€è¦é¢‘ç¹æ‰‹å·¥å¤„ç†çš„åœ°æ–¹ï¼Œå°±æ˜¯æ¡†æ¶çš„ä»·å€¼æ‰€åœ¨ã€‚ä½†å¹¶ä¸æ˜¯æ¯ä¸€ä¸ªé¢‘ç¹å¤„ç†çš„åœ°æ–¹éƒ½é€‚åˆåœ¨æ¡†æ¶ä¸­å®Œæˆã€‚Pythonæœ‰ä¸€ä¸ªå¾ˆè‘—åçš„Webæ¡†æ¶ï¼Œåå«bottleï¼Œæ•´ä¸ªæ¡†æ¶ç”±bottle.pyä¸€ä¸ªæ–‡ä»¶æ„æˆï¼Œå…±4400è¡Œï¼Œå¯ä»¥è¯´æ˜¯ä¸€ä¸ªå¾®æ¡†æ¶ã€‚é‚£ä¹ˆç†è§£è¿™ä¸ªå¾®æ¡†æ¶æä¾›çš„ç‰¹æ€§ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬ç†è§£æ¡†æ¶çš„æ ¸å¿ƒèƒ½åŠ›ã€‚</p>
<ul>
<li>è·¯ç”±(Routing)ï¼šå°†è¯·æ±‚æ˜ å°„åˆ°å‡½æ•°ï¼Œæ”¯æŒåŠ¨æ€è·¯ç”±ã€‚ä¾‹å¦‚'/hello/:nameã€‚</li>
<li>æ¨¡æ¿(Templates)ï¼šä½¿ç”¨å†…ç½®æ¨¡æ¿å¼•æ“æä¾›æ¨¡æ¿æ¸²æŸ“æœºåˆ¶ã€‚</li>
<li>å·¥å…·é›†(Utilites)ï¼šæä¾›å¯¹ cookiesï¼Œheaders ç­‰å¤„ç†æœºåˆ¶ã€‚</li>
<li>æ’ä»¶(Plugin)ï¼šBottleæœ¬èº«åŠŸèƒ½æœ‰é™ï¼Œä½†æä¾›äº†æ’ä»¶æœºåˆ¶ã€‚å¯ä»¥é€‰æ‹©å®‰è£…åˆ°å…¨å±€ï¼Œä¹Ÿå¯ä»¥åªé’ˆå¯¹æŸå‡ ä¸ªè·¯ç”±ç”Ÿæ•ˆã€‚</li>
<li>â€¦</li>
</ul>
<h2 id="http-åŸºç¡€">HTTP åŸºç¡€</h2>
<h3 id="æ ‡å‡†åº“å¯åŠ¨webæœåŠ¡">æ ‡å‡†åº“å¯åŠ¨WebæœåŠ¡</h3>
<p>Goè¯­è¨€å†…ç½®äº† <code>net/http</code>åº“ï¼Œå°è£…äº†HTTPç½‘ç»œç¼–ç¨‹çš„åŸºç¡€çš„æ¥å£ï¼Œæˆ‘ä»¬å®ç°çš„Gee Web æ¡†æ¶ä¾¿æ˜¯åŸºäº<code>net/http</code>çš„ã€‚æˆ‘ä»¬æ¥ä¸‹æ¥é€šè¿‡ä¸€ä¸ªä¾‹å­ï¼Œç®€å•ä»‹ç»ä¸‹è¿™ä¸ªåº“çš„ä½¿ç”¨ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
	<span class="s">&#34;fmt&#34;</span>
	<span class="s">&#34;log&#34;</span>
	<span class="s">&#34;net/http&#34;</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="nx">http</span><span class="p">.</span><span class="nf">HandleFunc</span><span class="p">(</span><span class="s">&#34;/&#34;</span><span class="p">,</span> <span class="nx">indexHandler</span><span class="p">)</span>
	<span class="nx">http</span><span class="p">.</span><span class="nf">HandleFunc</span><span class="p">(</span><span class="s">&#34;/hello&#34;</span><span class="p">,</span> <span class="nx">helloHandler</span><span class="p">)</span>
	<span class="nx">log</span><span class="p">.</span><span class="nf">Fatal</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nf">ListenAndServe</span><span class="p">(</span><span class="s">&#34;:9999&#34;</span><span class="p">,</span> <span class="kc">nil</span><span class="p">))</span>
<span class="p">}</span>

<span class="c1">// handler echoes r.URL.Path
</span><span class="c1"></span><span class="kd">func</span> <span class="nf">indexHandler</span><span class="p">(</span><span class="nx">w</span> <span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span> <span class="nx">req</span> <span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Fprintf</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span> <span class="s">&#34;URL.Path = %qn&#34;</span><span class="p">,</span> <span class="nx">req</span><span class="p">.</span><span class="nx">URL</span><span class="p">.</span><span class="nx">Path</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// handler echoes r.URL.Header
</span><span class="c1"></span><span class="kd">func</span> <span class="nf">helloHandler</span><span class="p">(</span><span class="nx">w</span> <span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span> <span class="nx">req</span> <span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">for</span> <span class="nx">k</span><span class="p">,</span> <span class="nx">v</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">req</span><span class="p">.</span><span class="nx">Header</span> <span class="p">{</span>
		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Fprintf</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span> <span class="s">&#34;Header[%q] = %qn&#34;</span><span class="p">,</span> <span class="nx">k</span><span class="p">,</span> <span class="nx">v</span><span class="p">)</span>
	<span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p>æˆ‘ä»¬è®¾ç½®äº†2ä¸ªè·¯ç”±ï¼Œ<code>/</code>å’Œ<code>/hello</code>ï¼Œåˆ†åˆ«ç»‘å®š indexHandler å’Œ helloHandler ï¼Œ æ ¹æ®ä¸åŒçš„HTTPè¯·æ±‚ä¼šè°ƒç”¨ä¸åŒçš„å¤„ç†å‡½æ•°ã€‚è®¿é—®/ï¼Œå“åº”æ˜¯URL.Path = /ï¼Œè€Œ/helloçš„å“åº”åˆ™æ˜¯è¯·æ±‚å¤´(header)ä¸­çš„é”®å€¼å¯¹ä¿¡æ¯ã€‚</p>
<p>ç”¨ curl è¿™ä¸ªå·¥å…·æµ‹è¯•ä¸€ä¸‹ï¼Œå°†ä¼šå¾—åˆ°å¦‚ä¸‹çš„ç»“æœã€‚</p>
<pre><code>$ curl http://localhost:9999/
URL.Path = &quot;/&quot;
$ curl http://localhost:9999/hello
Header[&quot;Accept&quot;] = [&quot;*/*&quot;]
Header[&quot;User-Agent&quot;] = [&quot;curl/7.54.0&quot;]
</code></pre><p>main å‡½æ•°çš„æœ€åä¸€è¡Œï¼Œæ˜¯ç”¨æ¥å¯åŠ¨ Web æœåŠ¡çš„ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯åœ°å€ï¼Œ<code>:9999</code>è¡¨ç¤ºåœ¨ 9999 ç«¯å£ç›‘å¬ã€‚è€Œç¬¬äºŒä¸ªå‚æ•°åˆ™ä»£è¡¨å¤„ç†æ‰€æœ‰çš„HTTPè¯·æ±‚çš„å®ä¾‹ï¼Œnil ä»£è¡¨ä½¿ç”¨æ ‡å‡†åº“ä¸­çš„å®ä¾‹å¤„ç†ã€‚ç¬¬äºŒä¸ªå‚æ•°ï¼Œåˆ™æ˜¯æˆ‘ä»¬åŸºäº<code>net/http</code>æ ‡å‡†åº“å®ç°Webæ¡†æ¶çš„å…¥å£ã€‚</p>
<h3 id="å®ç°httphandleræ¥å£">å®ç°http.Handleræ¥å£</h3>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="kn">package</span> <span class="nx">http</span>

<span class="kd">type</span> <span class="nx">Handler</span> <span class="kd">interface</span> <span class="p">{</span>
    <span class="nf">ServeHTTP</span><span class="p">(</span><span class="nx">w</span> <span class="nx">ResponseWriter</span><span class="p">,</span> <span class="nx">r</span> <span class="o">*</span><span class="nx">Request</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">ListenAndServe</span><span class="p">(</span><span class="nx">address</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">h</span> <span class="nx">Handler</span><span class="p">)</span> <span class="kt">error</span>
</code></pre></div><p>ç¬¬äºŒä¸ªå‚æ•°çš„ç±»å‹æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿé€šè¿‡æŸ¥çœ‹<code>net/http</code>çš„æºç å¯ä»¥å‘ç°ï¼Œ<code>Handler</code>æ˜¯ä¸€ä¸ªæ¥å£ï¼Œéœ€è¦å®ç°æ–¹æ³• <code>ServeHTTP</code> ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåªè¦ä¼ å…¥ä»»ä½•å®ç°äº† ServerHTTP æ¥å£çš„å®ä¾‹ï¼Œæ‰€æœ‰çš„HTTPè¯·æ±‚ï¼Œå°±éƒ½äº¤ç»™äº†è¯¥å®ä¾‹å¤„ç†äº†ã€‚é©¬ä¸Šæ¥è¯•ä¸€è¯•å§ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
	<span class="s">&#34;fmt&#34;</span>
	<span class="s">&#34;log&#34;</span>
	<span class="s">&#34;net/http&#34;</span>
<span class="p">)</span>

<span class="c1">// Engine is the uni handler for all requests
</span><span class="c1"></span><span class="kd">type</span> <span class="nx">Engine</span> <span class="kd">struct</span><span class="p">{}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">engine</span> <span class="o">*</span><span class="nx">Engine</span><span class="p">)</span> <span class="nf">ServeHTTP</span><span class="p">(</span><span class="nx">w</span> <span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span> <span class="nx">req</span> <span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">switch</span> <span class="nx">req</span><span class="p">.</span><span class="nx">URL</span><span class="p">.</span><span class="nx">Path</span> <span class="p">{</span>
	<span class="k">case</span> <span class="s">&#34;/&#34;</span><span class="p">:</span>
		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Fprintf</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span> <span class="s">&#34;URL.Path = %qn&#34;</span><span class="p">,</span> <span class="nx">req</span><span class="p">.</span><span class="nx">URL</span><span class="p">.</span><span class="nx">Path</span><span class="p">)</span>
	<span class="k">case</span> <span class="s">&#34;/hello&#34;</span><span class="p">:</span>
		<span class="k">for</span> <span class="nx">k</span><span class="p">,</span> <span class="nx">v</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">req</span><span class="p">.</span><span class="nx">Header</span> <span class="p">{</span>
			<span class="nx">fmt</span><span class="p">.</span><span class="nf">Fprintf</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span> <span class="s">&#34;Header[%q] = %qn&#34;</span><span class="p">,</span> <span class="nx">k</span><span class="p">,</span> <span class="nx">v</span><span class="p">)</span>
		<span class="p">}</span>
	<span class="k">default</span><span class="p">:</span>
		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Fprintf</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span> <span class="s">&#34;404 NOT FOUND: %sn&#34;</span><span class="p">,</span> <span class="nx">req</span><span class="p">.</span><span class="nx">URL</span><span class="p">)</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="nx">engine</span> <span class="o">:=</span> <span class="nb">new</span><span class="p">(</span><span class="nx">Engine</span><span class="p">)</span>
	<span class="nx">log</span><span class="p">.</span><span class="nf">Fatal</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nf">ListenAndServe</span><span class="p">(</span><span class="s">&#34;:9999&#34;</span><span class="p">,</span> <span class="nx">engine</span><span class="p">))</span>
<span class="p">}</span>
</code></pre></div><ul>
<li>
<p>æˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªç©ºçš„ç»“æ„ä½“Engineï¼Œå®ç°äº†æ–¹æ³•ServeHTTPã€‚è¿™ä¸ªæ–¹æ³•æœ‰2ä¸ªå‚æ•°ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯ Request ï¼Œè¯¥å¯¹è±¡åŒ…å«äº†è¯¥HTTPè¯·æ±‚çš„æ‰€æœ‰çš„ä¿¡æ¯ï¼Œæ¯”å¦‚è¯·æ±‚åœ°å€ã€Headerå’ŒBodyç­‰ä¿¡æ¯ï¼›ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ ResponseWriter ï¼Œåˆ©ç”¨ ResponseWriter å¯ä»¥æ„é€ é’ˆå¯¹è¯¥è¯·æ±‚çš„å“åº”ã€‚</p>
</li>
<li>
<p>åœ¨ main å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬ç»™ ListenAndServe æ–¹æ³•çš„ç¬¬äºŒä¸ªå‚æ•°ä¼ å…¥äº†åˆšæ‰åˆ›å»ºçš„engineå®ä¾‹ã€‚è‡³æ­¤ï¼Œæˆ‘ä»¬èµ°å‡ºäº†å®ç°Webæ¡†æ¶çš„ç¬¬ä¸€æ­¥ï¼Œå³ï¼Œå°†æ‰€æœ‰çš„HTTPè¯·æ±‚è½¬å‘äº†æˆ‘ä»¬è‡ªå·±çš„å¤„ç†é€»è¾‘ã€‚è¿˜è®°å¾—å—ï¼Œåœ¨å®ç°Engineä¹‹å‰ï¼Œæˆ‘ä»¬è°ƒç”¨ http.HandleFunc å®ç°äº†è·¯ç”±å’ŒHandlerçš„æ˜ å°„ï¼Œä¹Ÿå°±æ˜¯åªèƒ½é’ˆå¯¹å…·ä½“çš„è·¯ç”±å†™å¤„ç†é€»è¾‘ã€‚æ¯”å¦‚/helloã€‚ä½†æ˜¯åœ¨å®ç°Engineä¹‹åï¼Œæˆ‘ä»¬æ‹¦æˆªäº†æ‰€æœ‰çš„HTTPè¯·æ±‚ï¼Œæ‹¥æœ‰äº†ç»Ÿä¸€çš„æ§åˆ¶å…¥å£ã€‚åœ¨è¿™é‡Œæˆ‘ä»¬å¯ä»¥è‡ªç”±å®šä¹‰è·¯ç”±æ˜ å°„çš„è§„åˆ™ï¼Œä¹Ÿå¯ä»¥ç»Ÿä¸€æ·»åŠ ä¸€äº›å¤„ç†é€»è¾‘ï¼Œä¾‹å¦‚æ—¥å¿—ã€å¼‚å¸¸å¤„ç†ç­‰ã€‚</p>
</li>
<li>
<p>ä»£ç çš„è¿è¡Œç»“æœä¸ä¹‹å‰çš„æ˜¯ä¸€è‡´çš„ã€‚</p>
</li>
</ul>
<h3 id="geeæ¡†æ¶çš„é›å½¢">Geeæ¡†æ¶çš„é›å½¢</h3>
<p>æˆ‘ä»¬æ¥ä¸‹æ¥é‡æ–°ç»„ç»‡ä¸Šé¢çš„ä»£ç ï¼Œæ­å»ºå‡ºæ•´ä¸ªæ¡†æ¶çš„é›å½¢ã€‚</p>
<p>æœ€ç»ˆçš„ä»£ç ç›®å½•ç»“æ„æ˜¯è¿™æ ·çš„ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell">gee/
  <span class="p">|</span>--gee.go
  <span class="p">|</span>--go.mod
main.go
go.mod
</code></pre></div><h5 id="gomod">go.mod</h5>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="nx">module</span> <span class="nx">example</span>

<span class="k">go</span> <span class="mf">1.13</span>

<span class="nx">require</span> <span class="nx">gee</span> <span class="nx">v0</span><span class="mf">.0.0</span>

<span class="nx">replace</span> <span class="nx">gee</span> <span class="p">=&gt;</span> <span class="p">.</span><span class="o">/</span><span class="nx">gee</span>
</code></pre></div><ul>
<li>åœ¨ go.mod ä¸­ä½¿ç”¨ replace å°† gee æŒ‡å‘ ./gee</li>
</ul>
<blockquote>
<p>ä» go 1.11 ç‰ˆæœ¬å¼€å§‹ï¼Œå¼•ç”¨ç›¸å¯¹è·¯å¾„çš„ package éœ€è¦ä½¿ç”¨ä¸Šè¿°æ–¹å¼ã€‚</p>
</blockquote>
<h5 id="maingo">main.go</h5>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
	<span class="s">&#34;fmt&#34;</span>
	<span class="s">&#34;net/http&#34;</span>

	<span class="s">&#34;gee&#34;</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="nx">r</span> <span class="o">:=</span> <span class="nx">gee</span><span class="p">.</span><span class="nf">New</span><span class="p">()</span>
	<span class="nx">r</span><span class="p">.</span><span class="nf">GET</span><span class="p">(</span><span class="s">&#34;/&#34;</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">w</span> <span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span> <span class="nx">req</span> <span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span> <span class="p">{</span>
		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Fprintf</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span> <span class="s">&#34;URL.Path = %qn&#34;</span><span class="p">,</span> <span class="nx">req</span><span class="p">.</span><span class="nx">URL</span><span class="p">.</span><span class="nx">Path</span><span class="p">)</span>
	<span class="p">})</span>

	<span class="nx">r</span><span class="p">.</span><span class="nf">GET</span><span class="p">(</span><span class="s">&#34;/hello&#34;</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">w</span> <span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span> <span class="nx">req</span> <span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">for</span> <span class="nx">k</span><span class="p">,</span> <span class="nx">v</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">req</span><span class="p">.</span><span class="nx">Header</span> <span class="p">{</span>
			<span class="nx">fmt</span><span class="p">.</span><span class="nf">Fprintf</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span> <span class="s">&#34;Header[%q] = %qn&#34;</span><span class="p">,</span> <span class="nx">k</span><span class="p">,</span> <span class="nx">v</span><span class="p">)</span>
		<span class="p">}</span>
	<span class="p">})</span>

	<span class="nx">r</span><span class="p">.</span><span class="nf">Run</span><span class="p">(</span><span class="s">&#34;:9999&#34;</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div><p>çœ‹åˆ°è¿™é‡Œï¼Œå¦‚æœä½ ä½¿ç”¨è¿‡ginæ¡†æ¶çš„è¯ï¼Œè‚¯å®šä¼šè§‰å¾—æ— æ¯”çš„äº²åˆ‡ã€‚geeæ¡†æ¶çš„è®¾è®¡ä»¥åŠAPIå‡å‚è€ƒäº†ginã€‚ä½¿ç”¨New()åˆ›å»º gee çš„å®ä¾‹ï¼Œä½¿ç”¨ GET()æ–¹æ³•æ·»åŠ è·¯ç”±ï¼Œæœ€åä½¿ç”¨Run()å¯åŠ¨WebæœåŠ¡ã€‚è¿™é‡Œçš„è·¯ç”±ï¼Œåªæ˜¯é™æ€è·¯ç”±ï¼Œä¸æ”¯æŒ/hello/:nameè¿™æ ·çš„åŠ¨æ€è·¯ç”±ï¼ŒåŠ¨æ€è·¯ç”±æˆ‘ä»¬å°†åœ¨ä¸‹ä¸€æ¬¡å®ç°ã€‚</p>
<h5 id="geego">gee.go</h5>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="kn">package</span> <span class="nx">gee</span>

<span class="kn">import</span> <span class="p">(</span>
	<span class="s">&#34;fmt&#34;</span>
	<span class="s">&#34;net/http&#34;</span>
<span class="p">)</span>

<span class="c1">// HandlerFunc defines the request handler used by gee
</span><span class="c1"></span><span class="kd">type</span> <span class="nx">HandlerFunc</span> <span class="kd">func</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span> <span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span>

<span class="c1">// Engine implement the interface of ServeHTTP
</span><span class="c1"></span><span class="kd">type</span> <span class="nx">Engine</span> <span class="kd">struct</span> <span class="p">{</span>
	<span class="nx">router</span> <span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="nx">HandlerFunc</span>
<span class="p">}</span>

<span class="c1">// New is the constructor of gee.Engine
</span><span class="c1"></span><span class="kd">func</span> <span class="nf">New</span><span class="p">()</span> <span class="o">*</span><span class="nx">Engine</span> <span class="p">{</span>
	<span class="k">return</span> <span class="o">&amp;</span><span class="nx">Engine</span><span class="p">{</span><span class="nx">router</span><span class="p">:</span> <span class="nb">make</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="nx">HandlerFunc</span><span class="p">)}</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">engine</span> <span class="o">*</span><span class="nx">Engine</span><span class="p">)</span> <span class="nf">addRoute</span><span class="p">(</span><span class="nx">method</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">pattern</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">handler</span> <span class="nx">HandlerFunc</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">key</span> <span class="o">:=</span> <span class="nx">method</span> <span class="o">+</span> <span class="s">&#34;-&#34;</span> <span class="o">+</span> <span class="nx">pattern</span>
	<span class="nx">engine</span><span class="p">.</span><span class="nx">router</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="p">=</span> <span class="nx">handler</span>
<span class="p">}</span>

<span class="c1">// GET defines the method to add GET request
</span><span class="c1"></span><span class="kd">func</span> <span class="p">(</span><span class="nx">engine</span> <span class="o">*</span><span class="nx">Engine</span><span class="p">)</span> <span class="nf">GET</span><span class="p">(</span><span class="nx">pattern</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">handler</span> <span class="nx">HandlerFunc</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">engine</span><span class="p">.</span><span class="nf">addRoute</span><span class="p">(</span><span class="s">&#34;GET&#34;</span><span class="p">,</span> <span class="nx">pattern</span><span class="p">,</span> <span class="nx">handler</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// POST defines the method to add POST request
</span><span class="c1"></span><span class="kd">func</span> <span class="p">(</span><span class="nx">engine</span> <span class="o">*</span><span class="nx">Engine</span><span class="p">)</span> <span class="nf">POST</span><span class="p">(</span><span class="nx">pattern</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">handler</span> <span class="nx">HandlerFunc</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">engine</span><span class="p">.</span><span class="nf">addRoute</span><span class="p">(</span><span class="s">&#34;POST&#34;</span><span class="p">,</span> <span class="nx">pattern</span><span class="p">,</span> <span class="nx">handler</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// Run defines the method to start a http server
</span><span class="c1"></span><span class="kd">func</span> <span class="p">(</span><span class="nx">engine</span> <span class="o">*</span><span class="nx">Engine</span><span class="p">)</span> <span class="nf">Run</span><span class="p">(</span><span class="nx">addr</span> <span class="kt">string</span><span class="p">)</span> <span class="p">(</span><span class="nx">err</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">return</span> <span class="nx">http</span><span class="p">.</span><span class="nf">ListenAndServe</span><span class="p">(</span><span class="nx">addr</span><span class="p">,</span> <span class="nx">engine</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">engine</span> <span class="o">*</span><span class="nx">Engine</span><span class="p">)</span> <span class="nf">ServeHTTP</span><span class="p">(</span><span class="nx">w</span> <span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span> <span class="nx">req</span> <span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">key</span> <span class="o">:=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">Method</span> <span class="o">+</span> <span class="s">&#34;-&#34;</span> <span class="o">+</span> <span class="nx">req</span><span class="p">.</span><span class="nx">URL</span><span class="p">.</span><span class="nx">Path</span>
	<span class="k">if</span> <span class="nx">handler</span><span class="p">,</span> <span class="nx">ok</span> <span class="o">:=</span> <span class="nx">engine</span><span class="p">.</span><span class="nx">router</span><span class="p">[</span><span class="nx">key</span><span class="p">];</span> <span class="nx">ok</span> <span class="p">{</span>
		<span class="nf">handler</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span> <span class="nx">req</span><span class="p">)</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Fprintf</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span> <span class="s">&#34;404 NOT FOUND: %sn&#34;</span><span class="p">,</span> <span class="nx">req</span><span class="p">.</span><span class="nx">URL</span><span class="p">)</span>
	<span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p>é‚£ä¹ˆgee.goå°±æ˜¯é‡å¤´æˆäº†ã€‚æˆ‘ä»¬é‡ç‚¹ä»‹ç»ä¸€ä¸‹è¿™éƒ¨åˆ†çš„å®ç°ã€‚</p>
<ul>
<li>
<p>é¦–å…ˆå®šä¹‰äº†ç±»å‹HandlerFuncï¼Œè¿™æ˜¯æä¾›ç»™æ¡†æ¶ç”¨æˆ·çš„ï¼Œç”¨æ¥å®šä¹‰è·¯ç”±æ˜ å°„çš„å¤„ç†æ–¹æ³•ã€‚æˆ‘ä»¬åœ¨Engineä¸­ï¼Œæ·»åŠ äº†ä¸€å¼ è·¯ç”±æ˜ å°„è¡¨routerï¼Œkey ç”±è¯·æ±‚æ–¹æ³•å’Œé™æ€è·¯ç”±åœ°å€æ„æˆï¼Œä¾‹å¦‚GET-/ã€GET-/helloã€POST-/helloï¼Œè¿™æ ·é’ˆå¯¹ç›¸åŒçš„è·¯ç”±ï¼Œå¦‚æœè¯·æ±‚æ–¹æ³•ä¸åŒ,å¯ä»¥æ˜ å°„ä¸åŒçš„å¤„ç†æ–¹æ³•(Handler)ï¼Œvalue æ˜¯ç”¨æˆ·æ˜ å°„çš„å¤„ç†æ–¹æ³•ã€‚</p>
</li>
<li>
<p>å½“ç”¨æˆ·è°ƒç”¨(*Engine).GET()æ–¹æ³•æ—¶ï¼Œä¼šå°†è·¯ç”±å’Œå¤„ç†æ–¹æ³•æ³¨å†Œåˆ°æ˜ å°„è¡¨ router ä¸­ï¼Œ(*Engine).Run()æ–¹æ³•ï¼Œæ˜¯ ListenAndServe çš„åŒ…è£…ã€‚</p>
</li>
<li>
<p>Engineå®ç°çš„ ServeHTTP æ–¹æ³•çš„ä½œç”¨å°±æ˜¯ï¼Œè§£æè¯·æ±‚çš„è·¯å¾„ï¼ŒæŸ¥æ‰¾è·¯ç”±æ˜ å°„è¡¨ï¼Œå¦‚æœæŸ¥åˆ°ï¼Œå°±æ‰§è¡Œæ³¨å†Œçš„å¤„ç†æ–¹æ³•ã€‚å¦‚æœæŸ¥ä¸åˆ°ï¼Œå°±è¿”å› 404 NOT FOUND ã€‚</p>
</li>
</ul>
<p>æ‰§è¡Œ<code>go run main.go</code>ï¼Œå†ç”¨ curl å·¥å…·è®¿é—®ï¼Œç»“æœä¸æœ€å¼€å§‹çš„ä¸€è‡´ã€‚</p>
<pre><code>$ curl http://localhost:9999/
URL.Path = &quot;/&quot;
$ curl http://localhost:9999/hello
Header[&quot;Accept&quot;] = [&quot;*/*&quot;]
Header[&quot;User-Agent&quot;] = [&quot;curl/7.54.0&quot;]
curl http://localhost:9999/world
404 NOT FOUND: /world
</code></pre><p>è‡³æ­¤ï¼Œæ•´ä¸ªGeeæ¡†æ¶çš„åŸå‹å·²ç»å‡ºæ¥äº†ã€‚å®ç°äº†è·¯ç”±æ˜ å°„è¡¨ï¼Œæä¾›äº†ç”¨æˆ·æ³¨å†Œé™æ€è·¯ç”±çš„æ–¹æ³•ï¼ŒåŒ…è£…äº†å¯åŠ¨æœåŠ¡çš„å‡½æ•°ã€‚å½“ç„¶ï¼Œåˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬è¿˜æ²¡æœ‰å®ç°æ¯”net/httpæ ‡å‡†åº“æ›´å¼ºå¤§çš„èƒ½åŠ›ï¼Œä¸ç”¨æ‹…å¿ƒï¼Œå¾ˆå¿«å°±å¯ä»¥å°†åŠ¨æ€è·¯ç”±ã€ä¸­é—´ä»¶ç­‰åŠŸèƒ½æ·»åŠ ä¸Šå»äº†ã€‚</p>
<h2 id="ä¸Šä¸‹æ–‡context">ä¸Šä¸‹æ–‡Context</h2>
<ul>
<li>å°†è·¯ç”±(router)ç‹¬ç«‹å‡ºæ¥ï¼Œæ–¹ä¾¿ä¹‹åå¢å¼ºã€‚</li>
<li>è®¾è®¡ä¸Šä¸‹æ–‡(Context)ï¼Œå°è£… Request å’Œ Response ï¼Œæä¾›å¯¹ JSONã€HTML ç­‰è¿”å›ç±»å‹çš„æ”¯æŒã€‚</li>
<li>åŠ¨æ‰‹å†™ Gee æ¡†æ¶çš„ç¬¬äºŒå¤©ï¼Œæ¡†æ¶ä»£ç 140è¡Œï¼Œæ–°å¢ä»£ç çº¦90è¡Œ</li>
</ul>
<h3 id="ä½¿ç”¨æ•ˆæœ">ä½¿ç”¨æ•ˆæœ</h3>
<p>ä¸ºäº†å±•ç¤ºç¬¬äºŒå¤©çš„æˆæœï¼Œæˆ‘ä»¬çœ‹ä¸€çœ‹åœ¨ä½¿ç”¨æ—¶çš„æ•ˆæœã€‚</p>
<h5 id="maingo-1">main.go</h5>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="nx">r</span> <span class="o">:=</span> <span class="nx">gee</span><span class="p">.</span><span class="nf">New</span><span class="p">()</span>
	<span class="nx">r</span><span class="p">.</span><span class="nf">GET</span><span class="p">(</span><span class="s">&#34;/&#34;</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">gee</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
		<span class="nx">c</span><span class="p">.</span><span class="nf">HTML</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">,</span> <span class="s">&#34;&lt;h1&gt;Hello Gee&lt;/h1&gt;&#34;</span><span class="p">)</span>
	<span class="p">})</span>
	<span class="nx">r</span><span class="p">.</span><span class="nf">GET</span><span class="p">(</span><span class="s">&#34;/hello&#34;</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">gee</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
		<span class="c1">// expect /hello?name=geektutu
</span><span class="c1"></span>		<span class="nx">c</span><span class="p">.</span><span class="nf">String</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">,</span> <span class="s">&#34;hello %s, you&#39;re at %sn&#34;</span><span class="p">,</span> <span class="nx">c</span><span class="p">.</span><span class="nf">Query</span><span class="p">(</span><span class="s">&#34;name&#34;</span><span class="p">),</span> <span class="nx">c</span><span class="p">.</span><span class="nx">Path</span><span class="p">)</span>
	<span class="p">})</span>

	<span class="nx">r</span><span class="p">.</span><span class="nf">POST</span><span class="p">(</span><span class="s">&#34;/login&#34;</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">gee</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
		<span class="nx">c</span><span class="p">.</span><span class="nf">JSON</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">,</span> <span class="nx">gee</span><span class="p">.</span><span class="nx">H</span><span class="p">{</span>
			<span class="s">&#34;username&#34;</span><span class="p">:</span> <span class="nx">c</span><span class="p">.</span><span class="nf">PostForm</span><span class="p">(</span><span class="s">&#34;username&#34;</span><span class="p">),</span>
			<span class="s">&#34;password&#34;</span><span class="p">:</span> <span class="nx">c</span><span class="p">.</span><span class="nf">PostForm</span><span class="p">(</span><span class="s">&#34;password&#34;</span><span class="p">),</span>
		<span class="p">})</span>
	<span class="p">})</span>

	<span class="nx">r</span><span class="p">.</span><span class="nf">Run</span><span class="p">(</span><span class="s">&#34;:9999&#34;</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div><ul>
<li>Handlerçš„å‚æ•°å˜æˆæˆäº†gee.Contextï¼Œæä¾›äº†æŸ¥è¯¢Query/PostFormå‚æ•°çš„åŠŸèƒ½ã€‚</li>
<li>gee.Contextå°è£…äº†HTML/String/JSONå‡½æ•°ï¼Œèƒ½å¤Ÿå¿«é€Ÿæ„é€ HTTPå“åº”ã€‚</li>
</ul>
<h3 id="è®¾è®¡context">è®¾è®¡Context</h3>
<h5 id="å¿…è¦æ€§">å¿…è¦æ€§</h5>
<ol>
<li>å¯¹WebæœåŠ¡æ¥è¯´ï¼Œæ— éæ˜¯æ ¹æ®è¯·æ±‚<code>*http.Request</code>ï¼Œæ„é€ å“åº”<code>http.ResponseWriter</code>ã€‚ä½†æ˜¯è¿™ä¸¤ä¸ªå¯¹è±¡æä¾›çš„æ¥å£ç²’åº¦å¤ªç»†ï¼Œæ¯”å¦‚æˆ‘ä»¬è¦æ„é€ ä¸€ä¸ªå®Œæ•´çš„å“åº”ï¼Œéœ€è¦è€ƒè™‘æ¶ˆæ¯å¤´(Header)å’Œæ¶ˆæ¯ä½“(Body)ï¼Œè€Œ Header åŒ…å«äº†çŠ¶æ€ç (StatusCode)ï¼Œæ¶ˆæ¯ç±»å‹(ContentType)ç­‰å‡ ä¹æ¯æ¬¡è¯·æ±‚éƒ½éœ€è¦è®¾ç½®çš„ä¿¡æ¯ã€‚å› æ­¤ï¼Œå¦‚æœä¸è¿›è¡Œæœ‰æ•ˆçš„å°è£…ï¼Œé‚£ä¹ˆæ¡†æ¶çš„ç”¨æˆ·å°†éœ€è¦å†™å¤§é‡é‡å¤ï¼Œç¹æ‚çš„ä»£ç ï¼Œè€Œä¸”å®¹æ˜“å‡ºé”™ã€‚é’ˆå¯¹å¸¸ç”¨åœºæ™¯ï¼Œèƒ½å¤Ÿé«˜æ•ˆåœ°æ„é€ å‡º HTTP å“åº”æ˜¯ä¸€ä¸ªå¥½çš„æ¡†æ¶å¿…é¡»è€ƒè™‘çš„ç‚¹ã€‚
ç”¨è¿”å› JSON æ•°æ®ä½œæ¯”è¾ƒï¼Œæ„Ÿå—ä¸‹å°è£…å‰åçš„å·®è·ã€‚</li>
</ol>
<p>å°è£…å‰</p>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="nx">obj</span> <span class="p">=</span> <span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
    <span class="s">&#34;name&#34;</span><span class="p">:</span> <span class="s">&#34;geektutu&#34;</span><span class="p">,</span>
    <span class="s">&#34;password&#34;</span><span class="p">:</span> <span class="s">&#34;1234&#34;</span><span class="p">,</span>
<span class="p">}</span>
<span class="nx">w</span><span class="p">.</span><span class="nf">Header</span><span class="p">().</span><span class="nf">Set</span><span class="p">(</span><span class="s">&#34;Content-Type&#34;</span><span class="p">,</span> <span class="s">&#34;application/json&#34;</span><span class="p">)</span>
<span class="nx">w</span><span class="p">.</span><span class="nf">WriteHeader</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">)</span>
<span class="nx">encoder</span> <span class="o">:=</span> <span class="nx">json</span><span class="p">.</span><span class="nf">NewEncoder</span><span class="p">(</span><span class="nx">w</span><span class="p">)</span>
<span class="k">if</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">encoder</span><span class="p">.</span><span class="nf">Encode</span><span class="p">(</span><span class="nx">obj</span><span class="p">);</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
    <span class="nx">http</span><span class="p">.</span><span class="nf">Error</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span> <span class="nx">err</span><span class="p">.</span><span class="nf">Error</span><span class="p">(),</span> <span class="mi">500</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div><p>VS å°è£…åï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="nx">c</span><span class="p">.</span><span class="nf">JSON</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">,</span> <span class="nx">gee</span><span class="p">.</span><span class="nx">H</span><span class="p">{</span>
    <span class="s">&#34;username&#34;</span><span class="p">:</span> <span class="nx">c</span><span class="p">.</span><span class="nf">PostForm</span><span class="p">(</span><span class="s">&#34;username&#34;</span><span class="p">),</span>
    <span class="s">&#34;password&#34;</span><span class="p">:</span> <span class="nx">c</span><span class="p">.</span><span class="nf">PostForm</span><span class="p">(</span><span class="s">&#34;password&#34;</span><span class="p">),</span>
<span class="p">})</span>
</code></pre></div><ol start="2">
<li>é’ˆå¯¹ä½¿ç”¨åœºæ™¯ï¼Œå°è£…<code>*http.Request</code>å’Œ<code>http.ResponseWriter</code>çš„æ–¹æ³•ï¼Œç®€åŒ–ç›¸å…³æ¥å£çš„è°ƒç”¨ï¼Œåªæ˜¯è®¾è®¡ Context çš„åŸå› ä¹‹ä¸€ã€‚å¯¹äºæ¡†æ¶æ¥è¯´ï¼Œè¿˜éœ€è¦æ”¯æ’‘é¢å¤–çš„åŠŸèƒ½ã€‚ä¾‹å¦‚ï¼Œå°†æ¥è§£æåŠ¨æ€è·¯ç”±<code>/hello/:name</code>ï¼Œå‚æ•°:nameçš„å€¼æ”¾åœ¨å“ªå‘¢ï¼Ÿå†æ¯”å¦‚ï¼Œæ¡†æ¶éœ€è¦æ”¯æŒä¸­é—´ä»¶ï¼Œé‚£ä¸­é—´ä»¶äº§ç”Ÿçš„ä¿¡æ¯æ”¾åœ¨å“ªå‘¢ï¼ŸContext éšç€æ¯ä¸€ä¸ªè¯·æ±‚çš„å‡ºç°è€Œäº§ç”Ÿï¼Œè¯·æ±‚çš„ç»“æŸè€Œé”€æ¯ï¼Œå’Œå½“å‰è¯·æ±‚å¼ºç›¸å…³çš„ä¿¡æ¯éƒ½åº”ç”± Context æ‰¿è½½ã€‚å› æ­¤ï¼Œè®¾è®¡ Context ç»“æ„ï¼Œæ‰©å±•æ€§å’Œå¤æ‚æ€§ç•™åœ¨äº†å†…éƒ¨ï¼Œè€Œå¯¹å¤–ç®€åŒ–äº†æ¥å£ã€‚è·¯ç”±çš„å¤„ç†å‡½æ•°ï¼Œä»¥åŠå°†è¦å®ç°çš„ä¸­é—´ä»¶ï¼Œå‚æ•°éƒ½ç»Ÿä¸€ä½¿ç”¨ Context å®ä¾‹ï¼Œ Context å°±åƒä¸€æ¬¡ä¼šè¯çš„ç™¾å®ç®±ï¼Œå¯ä»¥æ‰¾åˆ°ä»»ä½•ä¸œè¥¿ã€‚</li>
</ol>
<h5 id="å…·ä½“å®ç°-contextgo">å…·ä½“å®ç° context.go</h5>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">type</span> <span class="nx">H</span> <span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}</span>

<span class="kd">type</span> <span class="nx">Context</span> <span class="kd">struct</span> <span class="p">{</span>
	<span class="c1">// origin objects
</span><span class="c1"></span>	<span class="nx">Writer</span> <span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span>
	<span class="nx">Req</span>    <span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span>
	<span class="c1">// request info
</span><span class="c1"></span>	<span class="nx">Path</span>   <span class="kt">string</span>
	<span class="nx">Method</span> <span class="kt">string</span>
	<span class="c1">// response info
</span><span class="c1"></span>	<span class="nx">StatusCode</span> <span class="kt">int</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">newContext</span><span class="p">(</span><span class="nx">w</span> <span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span> <span class="nx">req</span> <span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span> <span class="o">*</span><span class="nx">Context</span> <span class="p">{</span>
	<span class="k">return</span> <span class="o">&amp;</span><span class="nx">Context</span><span class="p">{</span>
		<span class="nx">Writer</span><span class="p">:</span> <span class="nx">w</span><span class="p">,</span>
		<span class="nx">Req</span><span class="p">:</span>    <span class="nx">req</span><span class="p">,</span>
		<span class="nx">Path</span><span class="p">:</span>   <span class="nx">req</span><span class="p">.</span><span class="nx">URL</span><span class="p">.</span><span class="nx">Path</span><span class="p">,</span>
		<span class="nx">Method</span><span class="p">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">Method</span><span class="p">,</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">Context</span><span class="p">)</span> <span class="nf">PostForm</span><span class="p">(</span><span class="nx">key</span> <span class="kt">string</span><span class="p">)</span> <span class="kt">string</span> <span class="p">{</span>
	<span class="k">return</span> <span class="nx">c</span><span class="p">.</span><span class="nx">Req</span><span class="p">.</span><span class="nf">FormValue</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">Context</span><span class="p">)</span> <span class="nf">Query</span><span class="p">(</span><span class="nx">key</span> <span class="kt">string</span><span class="p">)</span> <span class="kt">string</span> <span class="p">{</span>
	<span class="k">return</span> <span class="nx">c</span><span class="p">.</span><span class="nx">Req</span><span class="p">.</span><span class="nx">URL</span><span class="p">.</span><span class="nf">Query</span><span class="p">().</span><span class="nf">Get</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">Context</span><span class="p">)</span> <span class="nf">Status</span><span class="p">(</span><span class="nx">code</span> <span class="kt">int</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">c</span><span class="p">.</span><span class="nx">StatusCode</span> <span class="p">=</span> <span class="nx">code</span>
	<span class="nx">c</span><span class="p">.</span><span class="nx">Writer</span><span class="p">.</span><span class="nf">WriteHeader</span><span class="p">(</span><span class="nx">code</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">Context</span><span class="p">)</span> <span class="nf">SetHeader</span><span class="p">(</span><span class="nx">key</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">value</span> <span class="kt">string</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">c</span><span class="p">.</span><span class="nx">Writer</span><span class="p">.</span><span class="nf">Header</span><span class="p">().</span><span class="nf">Set</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">Context</span><span class="p">)</span> <span class="nf">String</span><span class="p">(</span><span class="nx">code</span> <span class="kt">int</span><span class="p">,</span> <span class="nx">format</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">values</span> <span class="o">...</span><span class="kd">interface</span><span class="p">{})</span> <span class="p">{</span>
	<span class="nx">c</span><span class="p">.</span><span class="nf">SetHeader</span><span class="p">(</span><span class="s">&#34;Content-Type&#34;</span><span class="p">,</span> <span class="s">&#34;text/plain&#34;</span><span class="p">)</span>
	<span class="nx">c</span><span class="p">.</span><span class="nf">Status</span><span class="p">(</span><span class="nx">code</span><span class="p">)</span>
	<span class="nx">c</span><span class="p">.</span><span class="nx">Writer</span><span class="p">.</span><span class="nf">Write</span><span class="p">([]</span><span class="nb">byte</span><span class="p">(</span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Sprintf</span><span class="p">(</span><span class="nx">format</span><span class="p">,</span> <span class="nx">values</span><span class="o">...</span><span class="p">)))</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">Context</span><span class="p">)</span> <span class="nf">JSON</span><span class="p">(</span><span class="nx">code</span> <span class="kt">int</span><span class="p">,</span> <span class="nx">obj</span> <span class="kd">interface</span><span class="p">{})</span> <span class="p">{</span>
	<span class="nx">c</span><span class="p">.</span><span class="nf">SetHeader</span><span class="p">(</span><span class="s">&#34;Content-Type&#34;</span><span class="p">,</span> <span class="s">&#34;application/json&#34;</span><span class="p">)</span>
	<span class="nx">c</span><span class="p">.</span><span class="nf">Status</span><span class="p">(</span><span class="nx">code</span><span class="p">)</span>
	<span class="nx">encoder</span> <span class="o">:=</span> <span class="nx">json</span><span class="p">.</span><span class="nf">NewEncoder</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">Writer</span><span class="p">)</span>
	<span class="k">if</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">encoder</span><span class="p">.</span><span class="nf">Encode</span><span class="p">(</span><span class="nx">obj</span><span class="p">);</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
		<span class="nx">http</span><span class="p">.</span><span class="nf">Error</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">Writer</span><span class="p">,</span> <span class="nx">err</span><span class="p">.</span><span class="nf">Error</span><span class="p">(),</span> <span class="mi">500</span><span class="p">)</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">Context</span><span class="p">)</span> <span class="nf">Data</span><span class="p">(</span><span class="nx">code</span> <span class="kt">int</span><span class="p">,</span> <span class="nx">data</span> <span class="p">[]</span><span class="kt">byte</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">c</span><span class="p">.</span><span class="nf">Status</span><span class="p">(</span><span class="nx">code</span><span class="p">)</span>
	<span class="nx">c</span><span class="p">.</span><span class="nx">Writer</span><span class="p">.</span><span class="nf">Write</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">Context</span><span class="p">)</span> <span class="nf">HTML</span><span class="p">(</span><span class="nx">code</span> <span class="kt">int</span><span class="p">,</span> <span class="nx">html</span> <span class="kt">string</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">c</span><span class="p">.</span><span class="nf">SetHeader</span><span class="p">(</span><span class="s">&#34;Content-Type&#34;</span><span class="p">,</span> <span class="s">&#34;text/html&#34;</span><span class="p">)</span>
	<span class="nx">c</span><span class="p">.</span><span class="nf">Status</span><span class="p">(</span><span class="nx">code</span><span class="p">)</span>
	<span class="nx">c</span><span class="p">.</span><span class="nx">Writer</span><span class="p">.</span><span class="nf">Write</span><span class="p">([]</span><span class="nb">byte</span><span class="p">(</span><span class="nx">html</span><span class="p">))</span>
<span class="p">}</span>
</code></pre></div><ul>
<li>ä»£ç æœ€å¼€å¤´ï¼Œç»™map[string]interface{}èµ·äº†ä¸€ä¸ªåˆ«ågee.Hï¼Œæ„å»ºJSONæ•°æ®æ—¶ï¼Œæ˜¾å¾—æ›´ç®€æ´ã€‚</li>
<li>Contextç›®å‰åªåŒ…å«äº†http.ResponseWriterå’Œ*http.Requestï¼Œå¦å¤–æä¾›äº†å¯¹ Method å’Œ Path è¿™ä¸¤ä¸ªå¸¸ç”¨å±æ€§çš„ç›´æ¥è®¿é—®ã€‚</li>
<li>æä¾›äº†è®¿é—®Queryå’ŒPostFormå‚æ•°çš„æ–¹æ³•ã€‚</li>
<li>æä¾›äº†å¿«é€Ÿæ„é€ String/Data/JSON/HTMLå“åº”çš„æ–¹æ³•ã€‚</li>
</ul>
<h5 id="è·¯ç”±router-routergo">è·¯ç”±(Router) router.go</h5>
<p>æˆ‘ä»¬å°†å’Œè·¯ç”±ç›¸å…³çš„æ–¹æ³•å’Œç»“æ„æå–äº†å‡ºæ¥ï¼Œæ”¾åˆ°äº†ä¸€ä¸ªæ–°çš„æ–‡ä»¶ä¸­router.goï¼Œæ–¹ä¾¿æˆ‘ä»¬ä¸‹ä¸€æ¬¡å¯¹ router çš„åŠŸèƒ½è¿›è¡Œå¢å¼ºï¼Œä¾‹å¦‚æä¾›åŠ¨æ€è·¯ç”±çš„æ”¯æŒã€‚ router çš„ handle æ–¹æ³•ä½œäº†ä¸€ä¸ªç»†å¾®çš„è°ƒæ•´ï¼Œå³ handler çš„å‚æ•°ï¼Œå˜æˆäº† Contextã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">type</span> <span class="nx">router</span> <span class="kd">struct</span> <span class="p">{</span>
	<span class="nx">handlers</span> <span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="nx">HandlerFunc</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">newRouter</span><span class="p">()</span> <span class="o">*</span><span class="nx">router</span> <span class="p">{</span>
	<span class="k">return</span> <span class="o">&amp;</span><span class="nx">router</span><span class="p">{</span><span class="nx">handlers</span><span class="p">:</span> <span class="nb">make</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="nx">HandlerFunc</span><span class="p">)}</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">r</span> <span class="o">*</span><span class="nx">router</span><span class="p">)</span> <span class="nf">addRoute</span><span class="p">(</span><span class="nx">method</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">pattern</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">handler</span> <span class="nx">HandlerFunc</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">log</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;Route %4s - %s&#34;</span><span class="p">,</span> <span class="nx">method</span><span class="p">,</span> <span class="nx">pattern</span><span class="p">)</span>
	<span class="nx">key</span> <span class="o">:=</span> <span class="nx">method</span> <span class="o">+</span> <span class="s">&#34;-&#34;</span> <span class="o">+</span> <span class="nx">pattern</span>
	<span class="nx">r</span><span class="p">.</span><span class="nx">handlers</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="p">=</span> <span class="nx">handler</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">r</span> <span class="o">*</span><span class="nx">router</span><span class="p">)</span> <span class="nf">handle</span><span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">key</span> <span class="o">:=</span> <span class="nx">c</span><span class="p">.</span><span class="nx">Method</span> <span class="o">+</span> <span class="s">&#34;-&#34;</span> <span class="o">+</span> <span class="nx">c</span><span class="p">.</span><span class="nx">Path</span>
	<span class="k">if</span> <span class="nx">handler</span><span class="p">,</span> <span class="nx">ok</span> <span class="o">:=</span> <span class="nx">r</span><span class="p">.</span><span class="nx">handlers</span><span class="p">[</span><span class="nx">key</span><span class="p">];</span> <span class="nx">ok</span> <span class="p">{</span>
		<span class="nf">handler</span><span class="p">(</span><span class="nx">c</span><span class="p">)</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="nx">c</span><span class="p">.</span><span class="nf">String</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusNotFound</span><span class="p">,</span> <span class="s">&#34;404 NOT FOUND: %sn&#34;</span><span class="p">,</span> <span class="nx">c</span><span class="p">.</span><span class="nx">Path</span><span class="p">)</span>
	<span class="p">}</span>
<span class="p">}</span>
</code></pre></div><h5 id="æ¡†æ¶å…¥å£-geego">æ¡†æ¶å…¥å£ gee.go</h5>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="c1">// HandlerFunc defines the request handler used by gee
</span><span class="c1"></span><span class="kd">type</span> <span class="nx">HandlerFunc</span> <span class="kd">func</span><span class="p">(</span><span class="o">*</span><span class="nx">Context</span><span class="p">)</span>

<span class="c1">// Engine implement the interface of ServeHTTP
</span><span class="c1"></span><span class="kd">type</span> <span class="nx">Engine</span> <span class="kd">struct</span> <span class="p">{</span>
	<span class="nx">router</span> <span class="o">*</span><span class="nx">router</span>
<span class="p">}</span>

<span class="c1">// New is the constructor of gee.Engine
</span><span class="c1"></span><span class="kd">func</span> <span class="nf">New</span><span class="p">()</span> <span class="o">*</span><span class="nx">Engine</span> <span class="p">{</span>
	<span class="k">return</span> <span class="o">&amp;</span><span class="nx">Engine</span><span class="p">{</span><span class="nx">router</span><span class="p">:</span> <span class="nf">newRouter</span><span class="p">()}</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">engine</span> <span class="o">*</span><span class="nx">Engine</span><span class="p">)</span> <span class="nf">addRoute</span><span class="p">(</span><span class="nx">method</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">pattern</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">handler</span> <span class="nx">HandlerFunc</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">engine</span><span class="p">.</span><span class="nx">router</span><span class="p">.</span><span class="nf">addRoute</span><span class="p">(</span><span class="nx">method</span><span class="p">,</span> <span class="nx">pattern</span><span class="p">,</span> <span class="nx">handler</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// GET defines the method to add GET request
</span><span class="c1"></span><span class="kd">func</span> <span class="p">(</span><span class="nx">engine</span> <span class="o">*</span><span class="nx">Engine</span><span class="p">)</span> <span class="nf">GET</span><span class="p">(</span><span class="nx">pattern</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">handler</span> <span class="nx">HandlerFunc</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">engine</span><span class="p">.</span><span class="nf">addRoute</span><span class="p">(</span><span class="s">&#34;GET&#34;</span><span class="p">,</span> <span class="nx">pattern</span><span class="p">,</span> <span class="nx">handler</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// POST defines the method to add POST request
</span><span class="c1"></span><span class="kd">func</span> <span class="p">(</span><span class="nx">engine</span> <span class="o">*</span><span class="nx">Engine</span><span class="p">)</span> <span class="nf">POST</span><span class="p">(</span><span class="nx">pattern</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">handler</span> <span class="nx">HandlerFunc</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">engine</span><span class="p">.</span><span class="nf">addRoute</span><span class="p">(</span><span class="s">&#34;POST&#34;</span><span class="p">,</span> <span class="nx">pattern</span><span class="p">,</span> <span class="nx">handler</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// Run defines the method to start a http server
</span><span class="c1"></span><span class="kd">func</span> <span class="p">(</span><span class="nx">engine</span> <span class="o">*</span><span class="nx">Engine</span><span class="p">)</span> <span class="nf">Run</span><span class="p">(</span><span class="nx">addr</span> <span class="kt">string</span><span class="p">)</span> <span class="p">(</span><span class="nx">err</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">return</span> <span class="nx">http</span><span class="p">.</span><span class="nf">ListenAndServe</span><span class="p">(</span><span class="nx">addr</span><span class="p">,</span> <span class="nx">engine</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">engine</span> <span class="o">*</span><span class="nx">Engine</span><span class="p">)</span> <span class="nf">ServeHTTP</span><span class="p">(</span><span class="nx">w</span> <span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span> <span class="nx">req</span> <span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">c</span> <span class="o">:=</span> <span class="nf">newContext</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span> <span class="nx">req</span><span class="p">)</span>
	<span class="nx">engine</span><span class="p">.</span><span class="nx">router</span><span class="p">.</span><span class="nf">handle</span><span class="p">(</span><span class="nx">c</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div><p>å°†routerç›¸å…³çš„ä»£ç ç‹¬ç«‹åï¼Œgee.goç®€å•äº†ä¸å°‘ã€‚æœ€é‡è¦çš„è¿˜æ˜¯é€šè¿‡å®ç°äº† ServeHTTP æ¥å£ï¼Œæ¥ç®¡äº†æ‰€æœ‰çš„ HTTP è¯·æ±‚ã€‚ç›¸æ¯”ç¬¬ä¸€å¤©çš„ä»£ç ï¼Œè¿™ä¸ªæ–¹æ³•ä¹Ÿæœ‰ç»†å¾®çš„è°ƒæ•´ï¼Œåœ¨è°ƒç”¨ router.handle ä¹‹å‰ï¼Œæ„é€ äº†ä¸€ä¸ª Context å¯¹è±¡ã€‚è¿™ä¸ªå¯¹è±¡ç›®å‰è¿˜éå¸¸ç®€å•ï¼Œä»…ä»…æ˜¯åŒ…è£…äº†åŸæ¥çš„ä¸¤ä¸ªå‚æ•°ï¼Œä¹‹åæˆ‘ä»¬ä¼šæ…¢æ…¢åœ°ç»™Contextæ’ä¸Šç¿…è†€ã€‚</p>
<p>å¦‚ä½•ä½¿ç”¨ï¼Œmain.goä¸€å¼€å§‹å°±å·²ç»äº®ç›¸äº†ã€‚è¿è¡Œgo run main.goï¼Œå€ŸåŠ© curl ï¼Œä¸€èµ·çœ‹ä¸€çœ‹ä»Šå¤©çš„æˆæœå§ã€‚</p>
<pre><code>$ curl -i http://localhost:9999/
HTTP/1.1 200 OK
Date: Mon, 12 Aug 2019 16:52:52 GMT
Content-Length: 18
Content-Type: text/html; charset=utf-8
&lt;h1&gt;Hello Gee&lt;/h1&gt;

$ curl &quot;http://localhost:9999/hello?name=geektutu&quot;
hello geektutu, you're at /hello

$ curl &quot;http://localhost:9999/login&quot; -X POST -d 'username=geektutu&amp;password=1234'
{&quot;password&quot;:&quot;1234&quot;,&quot;username&quot;:&quot;geektutu&quot;}

$ curl &quot;http://localhost:9999/xxx&quot;
404 NOT FOUND: /xxx
</code></pre><h2 id="å‰ç¼€æ ‘è·¯ç”±">å‰ç¼€æ ‘è·¯ç”±</h2>
<ul>
<li>ä½¿ç”¨ Trie æ ‘å®ç°åŠ¨æ€è·¯ç”±(dynamic route)è§£æã€‚</li>
<li>æ”¯æŒä¸¤ç§æ¨¡å¼<code>:name</code>å’Œ<code>*filepath</code>ï¼Œ<strong>ä»£ç çº¦150è¡Œ</strong>ã€‚</li>
</ul>
<h3 id="trie-æ ‘ç®€ä»‹">Trie æ ‘ç®€ä»‹</h3>
<p>ä¹‹å‰ï¼Œæˆ‘ä»¬ç”¨äº†ä¸€ä¸ªéå¸¸ç®€å•çš„<code>map</code>ç»“æ„å­˜å‚¨äº†è·¯ç”±è¡¨ï¼Œä½¿ç”¨<code>map</code>å­˜å‚¨é”®å€¼å¯¹ï¼Œç´¢å¼•éå¸¸é«˜æ•ˆï¼Œä½†æ˜¯æœ‰ä¸€ä¸ªå¼Šç«¯ï¼Œé”®å€¼å¯¹çš„å­˜å‚¨çš„æ–¹å¼ï¼Œåªèƒ½ç”¨æ¥ç´¢å¼•é™æ€è·¯ç”±ã€‚é‚£å¦‚æœæˆ‘ä»¬æƒ³æ”¯æŒç±»ä¼¼äº<code>/hello/:name</code>è¿™æ ·çš„åŠ¨æ€è·¯ç”±æ€ä¹ˆåŠå‘¢ï¼Ÿæ‰€è°“åŠ¨æ€è·¯ç”±ï¼Œå³ä¸€æ¡è·¯ç”±è§„åˆ™å¯ä»¥åŒ¹é…æŸä¸€ç±»å‹è€ŒéæŸä¸€æ¡å›ºå®šçš„è·¯ç”±ã€‚ä¾‹å¦‚<code>/hello/:name</code>ï¼Œå¯ä»¥åŒ¹é…<code>/hello/geektutu</code>ã€<code>hello/jack</code>ç­‰ã€‚</p>
<p>åŠ¨æ€è·¯ç”±æœ‰å¾ˆå¤šç§å®ç°æ–¹å¼ï¼Œæ”¯æŒçš„è§„åˆ™ã€æ€§èƒ½ç­‰æœ‰å¾ˆå¤§çš„å·®å¼‚ã€‚ä¾‹å¦‚å¼€æºçš„è·¯ç”±å®ç°<code>gorouter</code>æ”¯æŒåœ¨è·¯ç”±è§„åˆ™ä¸­åµŒå…¥æ­£åˆ™è¡¨è¾¾å¼ï¼Œä¾‹å¦‚<code>/p/[0-9A-Za-z]+</code>ï¼Œå³è·¯å¾„ä¸­çš„å‚æ•°ä»…åŒ¹é…æ•°å­—å’Œå­—æ¯ï¼›å¦ä¸€ä¸ªå¼€æºå®ç°<code>httprouter</code>å°±ä¸æ”¯æŒæ­£åˆ™è¡¨è¾¾å¼ã€‚è‘—åçš„Webå¼€æºæ¡†æ¶<code>gin</code> åœ¨æ—©æœŸçš„ç‰ˆæœ¬ï¼Œå¹¶æ²¡æœ‰å®ç°è‡ªå·±çš„è·¯ç”±ï¼Œè€Œæ˜¯ç›´æ¥ä½¿ç”¨äº†<code>httprouter</code>ï¼Œåæ¥ä¸çŸ¥é“ä»€ä¹ˆåŸå› ï¼Œæ”¾å¼ƒäº†<code>httprouter</code>ï¼Œè‡ªå·±å®ç°äº†ä¸€ä¸ªç‰ˆæœ¬ã€‚</p>
<p><img src="https://geektutu.com/post/gee-day3/trie_eg.jpg" alt="trie tree"></p>
<p>å®ç°åŠ¨æ€è·¯ç”±æœ€å¸¸ç”¨çš„æ•°æ®ç»“æ„ï¼Œè¢«ç§°ä¸ºå‰ç¼€æ ‘(Trieæ ‘)ã€‚çœ‹åˆ°åå­—ä½ å¤§æ¦‚ä¹Ÿèƒ½çŸ¥é“å‰ç¼€æ ‘é•¿å•¥æ ·äº†ï¼šæ¯ä¸€ä¸ªèŠ‚ç‚¹çš„æ‰€æœ‰çš„å­èŠ‚ç‚¹éƒ½æ‹¥æœ‰ç›¸åŒçš„å‰ç¼€ã€‚è¿™ç§ç»“æ„éå¸¸é€‚ç”¨äºè·¯ç”±åŒ¹é…ï¼Œæ¯”å¦‚æˆ‘ä»¬å®šä¹‰äº†å¦‚ä¸‹è·¯ç”±è§„åˆ™ï¼š</p>
<ul>
<li>/:lang/doc</li>
<li>/:lang/tutorial</li>
<li>/:lang/intro</li>
<li>/about</li>
<li>/p/blog</li>
<li>/p/related</li>
</ul>
<p>æˆ‘ä»¬ç”¨å‰ç¼€æ ‘æ¥è¡¨ç¤ºï¼Œæ˜¯è¿™æ ·çš„ã€‚</p>
<p><img src="https://geektutu.com/post/gee-day3/trie_router.jpg" alt="trie tree"></p>
<p>HTTPè¯·æ±‚çš„è·¯å¾„æ°å¥½æ˜¯ç”±<code>/</code>åˆ†éš”çš„å¤šæ®µæ„æˆçš„ï¼Œå› æ­¤ï¼Œæ¯ä¸€æ®µå¯ä»¥ä½œä¸ºå‰ç¼€æ ‘çš„ä¸€ä¸ªèŠ‚ç‚¹ã€‚æˆ‘ä»¬é€šè¿‡æ ‘ç»“æ„æŸ¥è¯¢ï¼Œå¦‚æœä¸­é—´æŸä¸€å±‚çš„èŠ‚ç‚¹éƒ½ä¸æ»¡è¶³æ¡ä»¶ï¼Œé‚£ä¹ˆå°±è¯´æ˜æ²¡æœ‰åŒ¹é…åˆ°çš„è·¯ç”±ï¼ŒæŸ¥è¯¢ç»“æŸã€‚</p>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬å®ç°çš„åŠ¨æ€è·¯ç”±å…·å¤‡ä»¥ä¸‹ä¸¤ä¸ªåŠŸèƒ½ã€‚</p>
<ul>
<li>å‚æ•°åŒ¹é…<code>:</code>ã€‚ä¾‹å¦‚ <code>/p/:lang/doc</code>ï¼Œå¯ä»¥åŒ¹é… <code>/p/c/doc</code> å’Œ <code>/p/go/doc</code>ã€‚</li>
<li>é€šé…<code>*</code>ã€‚ä¾‹å¦‚ <code>/static/*filepath</code>ï¼Œå¯ä»¥åŒ¹é…<code>/static/fav.ico</code>ï¼Œä¹Ÿå¯ä»¥åŒ¹é…<code>/static/js/jQuery.js</code>ï¼Œè¿™ç§æ¨¡å¼å¸¸ç”¨äºé™æ€æœåŠ¡å™¨ï¼Œèƒ½å¤Ÿé€’å½’åœ°åŒ¹é…å­è·¯å¾„ã€‚</li>
</ul>
<h3 id="trie-æ ‘å®ç°">Trie æ ‘å®ç°</h3>
<p>é¦–å…ˆæˆ‘ä»¬éœ€è¦è®¾è®¡æ ‘èŠ‚ç‚¹ä¸Šåº”è¯¥å­˜å‚¨é‚£äº›ä¿¡æ¯ã€‚</p>
<p>trie.go</p>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">type</span> <span class="nx">node</span> <span class="kd">struct</span> <span class="p">{</span>
	<span class="nx">pattern</span>  <span class="kt">string</span>  <span class="c1">// å¾…åŒ¹é…è·¯ç”±ï¼Œä¾‹å¦‚ /p/:lang
</span><span class="c1"></span>	<span class="nx">part</span>     <span class="kt">string</span>  <span class="c1">// è·¯ç”±ä¸­çš„ä¸€éƒ¨åˆ†ï¼Œä¾‹å¦‚ :lang
</span><span class="c1"></span>	<span class="nx">children</span> <span class="p">[]</span><span class="o">*</span><span class="nx">node</span> <span class="c1">// å­èŠ‚ç‚¹ï¼Œä¾‹å¦‚ [doc, tutorial, intro]
</span><span class="c1"></span>	<span class="nx">isWild</span>   <span class="kt">bool</span>    <span class="c1">// æ˜¯å¦ç²¾ç¡®åŒ¹é…ï¼Œpart å«æœ‰ : æˆ– * æ—¶ä¸ºtrue
</span><span class="c1"></span><span class="p">}</span>
</code></pre></div><p>ä¸æ™®é€šçš„æ ‘ä¸åŒï¼Œä¸ºäº†å®ç°åŠ¨æ€è·¯ç”±åŒ¹é…ï¼ŒåŠ ä¸Šäº†<code>isWild</code>è¿™ä¸ªå‚æ•°ã€‚å³å½“æˆ‘ä»¬åŒ¹é… <code>/p/go/doc/</code>è¿™ä¸ªè·¯ç”±æ—¶ï¼Œç¬¬ä¸€å±‚èŠ‚ç‚¹ï¼Œ<code>p</code>ç²¾å‡†åŒ¹é…åˆ°äº†<code>p</code>ï¼Œç¬¬äºŒå±‚èŠ‚ç‚¹ï¼Œ<code>go</code>æ¨¡ç³ŠåŒ¹é…åˆ°<code>:lang</code>ï¼Œé‚£ä¹ˆå°†ä¼šæŠŠ<code>lang</code>è¿™ä¸ªå‚æ•°èµ‹å€¼ä¸º<code>go</code>ï¼Œç»§ç»­ä¸‹ä¸€å±‚åŒ¹é…ã€‚æˆ‘ä»¬å°†åŒ¹é…çš„é€»è¾‘ï¼ŒåŒ…è£…ä¸ºä¸€ä¸ªè¾…åŠ©å‡½æ•°ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="c1">// ç¬¬ä¸€ä¸ªåŒ¹é…æˆåŠŸçš„èŠ‚ç‚¹ï¼Œç”¨äºæ’å…¥
</span><span class="c1"></span><span class="kd">func</span> <span class="p">(</span><span class="nx">n</span> <span class="o">*</span><span class="nx">node</span><span class="p">)</span> <span class="nf">matchChild</span><span class="p">(</span><span class="nx">part</span> <span class="kt">string</span><span class="p">)</span> <span class="o">*</span><span class="nx">node</span> <span class="p">{</span>
	<span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">child</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">n</span><span class="p">.</span><span class="nx">children</span> <span class="p">{</span>
		<span class="k">if</span> <span class="nx">child</span><span class="p">.</span><span class="nx">part</span> <span class="o">==</span> <span class="nx">part</span> <span class="o">||</span> <span class="nx">child</span><span class="p">.</span><span class="nx">isWild</span> <span class="p">{</span>
			<span class="k">return</span> <span class="nx">child</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="kc">nil</span>
<span class="p">}</span>

<span class="c1">// æ‰€æœ‰åŒ¹é…æˆåŠŸçš„èŠ‚ç‚¹ï¼Œç”¨äºæŸ¥æ‰¾
</span><span class="c1"></span><span class="kd">func</span> <span class="p">(</span><span class="nx">n</span> <span class="o">*</span><span class="nx">node</span><span class="p">)</span> <span class="nf">matchChildren</span><span class="p">(</span><span class="nx">part</span> <span class="kt">string</span><span class="p">)</span> <span class="p">[]</span><span class="o">*</span><span class="nx">node</span> <span class="p">{</span>
	<span class="nx">nodes</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">([]</span><span class="o">*</span><span class="nx">node</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
	<span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">child</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">n</span><span class="p">.</span><span class="nx">children</span> <span class="p">{</span>
		<span class="k">if</span> <span class="nx">child</span><span class="p">.</span><span class="nx">part</span> <span class="o">==</span> <span class="nx">part</span> <span class="o">||</span> <span class="nx">child</span><span class="p">.</span><span class="nx">isWild</span> <span class="p">{</span>
			<span class="nx">nodes</span> <span class="p">=</span> <span class="nb">append</span><span class="p">(</span><span class="nx">nodes</span><span class="p">,</span> <span class="nx">child</span><span class="p">)</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="nx">nodes</span>
<span class="p">}</span>
</code></pre></div><p>å¯¹äºè·¯ç”±æ¥è¯´ï¼Œæœ€é‡è¦çš„å½“ç„¶æ˜¯æ³¨å†Œä¸åŒ¹é…äº†ã€‚å¼€å‘æœåŠ¡æ—¶ï¼Œæ³¨å†Œè·¯ç”±è§„åˆ™ï¼Œæ˜ å°„handlerï¼›è®¿é—®æ—¶ï¼ŒåŒ¹é…è·¯ç”±è§„åˆ™ï¼ŒæŸ¥æ‰¾åˆ°å¯¹åº”çš„handlerã€‚å› æ­¤ï¼ŒTrie æ ‘éœ€è¦æ”¯æŒèŠ‚ç‚¹çš„æ’å…¥ä¸æŸ¥è¯¢ã€‚æ’å…¥åŠŸèƒ½å¾ˆç®€å•ï¼Œé€’å½’æŸ¥æ‰¾æ¯ä¸€å±‚çš„èŠ‚ç‚¹ï¼Œå¦‚æœæ²¡æœ‰åŒ¹é…åˆ°å½“å‰<code>part</code>çš„èŠ‚ç‚¹ï¼Œåˆ™æ–°å»ºä¸€ä¸ªï¼Œæœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„ï¼Œ<code>/p/:lang/doc</code>åªæœ‰åœ¨ç¬¬ä¸‰å±‚èŠ‚ç‚¹ï¼Œå³<code>doc</code>èŠ‚ç‚¹ï¼Œ<code>pattern</code>æ‰ä¼šè®¾ç½®ä¸º<code>/p/:lang/doc</code>ã€‚<code>p</code>å’Œ<code>:lang</code>èŠ‚ç‚¹çš„<code>pattern</code>å±æ€§çš†ä¸ºç©ºã€‚å› æ­¤ï¼Œå½“åŒ¹é…ç»“æŸæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>n.pattern == &quot;&quot;</code>æ¥åˆ¤æ–­è·¯ç”±è§„åˆ™æ˜¯å¦åŒ¹é…æˆåŠŸã€‚ä¾‹å¦‚ï¼Œ<code>/p/python</code>è™½èƒ½æˆåŠŸåŒ¹é…åˆ°<code>:lang</code>ï¼Œä½†<code>:lang</code>çš„<code>pattern</code>å€¼ä¸ºç©ºï¼Œå› æ­¤åŒ¹é…å¤±è´¥ã€‚æŸ¥è¯¢åŠŸèƒ½ï¼ŒåŒæ ·ä¹Ÿæ˜¯é€’å½’æŸ¥è¯¢æ¯ä¸€å±‚çš„èŠ‚ç‚¹ï¼Œé€€å‡ºè§„åˆ™æ˜¯ï¼ŒåŒ¹é…åˆ°äº†<code>*</code>ï¼ŒåŒ¹é…å¤±è´¥ï¼Œæˆ–è€…åŒ¹é…åˆ°äº†ç¬¬<code>len(parts)</code>å±‚èŠ‚ç‚¹ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="p">(</span><span class="nx">n</span> <span class="o">*</span><span class="nx">node</span><span class="p">)</span> <span class="nf">insert</span><span class="p">(</span><span class="nx">pattern</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">parts</span> <span class="p">[]</span><span class="kt">string</span><span class="p">,</span> <span class="nx">height</span> <span class="kt">int</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nx">parts</span><span class="p">)</span> <span class="o">==</span> <span class="nx">height</span> <span class="p">{</span>
		<span class="nx">n</span><span class="p">.</span><span class="nx">pattern</span> <span class="p">=</span> <span class="nx">pattern</span>
		<span class="k">return</span>
	<span class="p">}</span>

	<span class="nx">part</span> <span class="o">:=</span> <span class="nx">parts</span><span class="p">[</span><span class="nx">height</span><span class="p">]</span>
	<span class="nx">child</span> <span class="o">:=</span> <span class="nx">n</span><span class="p">.</span><span class="nf">matchChild</span><span class="p">(</span><span class="nx">part</span><span class="p">)</span>
	<span class="k">if</span> <span class="nx">child</span> <span class="o">==</span> <span class="kc">nil</span> <span class="p">{</span>
		<span class="nx">child</span> <span class="p">=</span> <span class="o">&amp;</span><span class="nx">node</span><span class="p">{</span><span class="nx">part</span><span class="p">:</span> <span class="nx">part</span><span class="p">,</span> <span class="nx">isWild</span><span class="p">:</span> <span class="nx">part</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="sc">&#39;:&#39;</span> <span class="o">||</span> <span class="nx">part</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="sc">&#39;*&#39;</span><span class="p">}</span>
		<span class="nx">n</span><span class="p">.</span><span class="nx">children</span> <span class="p">=</span> <span class="nb">append</span><span class="p">(</span><span class="nx">n</span><span class="p">.</span><span class="nx">children</span><span class="p">,</span> <span class="nx">child</span><span class="p">)</span>
	<span class="p">}</span>
	<span class="nx">child</span><span class="p">.</span><span class="nf">insert</span><span class="p">(</span><span class="nx">pattern</span><span class="p">,</span> <span class="nx">parts</span><span class="p">,</span> <span class="nx">height</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">n</span> <span class="o">*</span><span class="nx">node</span><span class="p">)</span> <span class="nf">search</span><span class="p">(</span><span class="nx">parts</span> <span class="p">[]</span><span class="kt">string</span><span class="p">,</span> <span class="nx">height</span> <span class="kt">int</span><span class="p">)</span> <span class="o">*</span><span class="nx">node</span> <span class="p">{</span>
	<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nx">parts</span><span class="p">)</span> <span class="o">==</span> <span class="nx">height</span> <span class="o">||</span> <span class="nx">strings</span><span class="p">.</span><span class="nf">HasPrefix</span><span class="p">(</span><span class="nx">n</span><span class="p">.</span><span class="nx">part</span><span class="p">,</span> <span class="s">&#34;*&#34;</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="nx">n</span><span class="p">.</span><span class="nx">pattern</span> <span class="o">==</span> <span class="s">&#34;&#34;</span> <span class="p">{</span>
			<span class="k">return</span> <span class="kc">nil</span>
		<span class="p">}</span>
		<span class="k">return</span> <span class="nx">n</span>
	<span class="p">}</span>

	<span class="nx">part</span> <span class="o">:=</span> <span class="nx">parts</span><span class="p">[</span><span class="nx">height</span><span class="p">]</span>
	<span class="nx">children</span> <span class="o">:=</span> <span class="nx">n</span><span class="p">.</span><span class="nf">matchChildren</span><span class="p">(</span><span class="nx">part</span><span class="p">)</span>

	<span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">child</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">children</span> <span class="p">{</span>
		<span class="nx">result</span> <span class="o">:=</span> <span class="nx">child</span><span class="p">.</span><span class="nf">search</span><span class="p">(</span><span class="nx">parts</span><span class="p">,</span> <span class="nx">height</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
		<span class="k">if</span> <span class="nx">result</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
			<span class="k">return</span> <span class="nx">result</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="kc">nil</span>
<span class="p">}</span>
</code></pre></div><h3 id="router">Router</h3>
<p>Trie æ ‘çš„æ’å…¥ä¸æŸ¥æ‰¾éƒ½æˆåŠŸå®ç°äº†ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°† Trie æ ‘åº”ç”¨åˆ°è·¯ç”±ä¸­å»å§ã€‚æˆ‘ä»¬ä½¿ç”¨ roots æ¥å­˜å‚¨æ¯ç§è¯·æ±‚æ–¹å¼çš„Trie æ ‘æ ¹èŠ‚ç‚¹ã€‚ä½¿ç”¨ handlers å­˜å‚¨æ¯ç§è¯·æ±‚æ–¹å¼çš„ HandlerFunc ã€‚getRoute å‡½æ•°ä¸­ï¼Œè¿˜è§£æäº†<code>:</code>å’Œ<code>*</code>ä¸¤ç§åŒ¹é…ç¬¦çš„å‚æ•°ï¼Œè¿”å›ä¸€ä¸ª map ã€‚ä¾‹å¦‚<code>/p/go/doc</code>åŒ¹é…åˆ°<code>/p/:lang/doc</code>ï¼Œè§£æç»“æœä¸ºï¼š<code>{lang: &quot;go&quot;}</code>ï¼Œ<code>/static/css/geektutu.css</code>åŒ¹é…åˆ°<code>/static/*filepath</code>ï¼Œè§£æç»“æœä¸º<code>{filepath: &quot;css/geektutu.css&quot;}</code>ã€‚</p>
<p>router.go</p>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">type</span> <span class="nx">router</span> <span class="kd">struct</span> <span class="p">{</span>
	<span class="nx">roots</span>    <span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="o">*</span><span class="nx">node</span>
	<span class="nx">handlers</span> <span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="nx">HandlerFunc</span>
<span class="p">}</span>

<span class="c1">// roots key eg, roots[&#39;GET&#39;] roots[&#39;POST&#39;]
</span><span class="c1">// handlers key eg, handlers[&#39;GET-/p/:lang/doc&#39;], handlers[&#39;POST-/p/book&#39;]
</span><span class="c1"></span>
<span class="kd">func</span> <span class="nf">newRouter</span><span class="p">()</span> <span class="o">*</span><span class="nx">router</span> <span class="p">{</span>
	<span class="k">return</span> <span class="o">&amp;</span><span class="nx">router</span><span class="p">{</span>
		<span class="nx">roots</span><span class="p">:</span>    <span class="nb">make</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="o">*</span><span class="nx">node</span><span class="p">),</span>
		<span class="nx">handlers</span><span class="p">:</span> <span class="nb">make</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="nx">HandlerFunc</span><span class="p">),</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Only one * is allowed
</span><span class="c1"></span><span class="kd">func</span> <span class="nf">parsePattern</span><span class="p">(</span><span class="nx">pattern</span> <span class="kt">string</span><span class="p">)</span> <span class="p">[]</span><span class="kt">string</span> <span class="p">{</span>
	<span class="nx">vs</span> <span class="o">:=</span> <span class="nx">strings</span><span class="p">.</span><span class="nf">Split</span><span class="p">(</span><span class="nx">pattern</span><span class="p">,</span> <span class="s">&#34;/&#34;</span><span class="p">)</span>

	<span class="nx">parts</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">([]</span><span class="kt">string</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
	<span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">item</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">vs</span> <span class="p">{</span>
		<span class="k">if</span> <span class="nx">item</span> <span class="o">!=</span> <span class="s">&#34;&#34;</span> <span class="p">{</span>
			<span class="nx">parts</span> <span class="p">=</span> <span class="nb">append</span><span class="p">(</span><span class="nx">parts</span><span class="p">,</span> <span class="nx">item</span><span class="p">)</span>
			<span class="k">if</span> <span class="nx">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="sc">&#39;*&#39;</span> <span class="p">{</span>
				<span class="k">break</span>
			<span class="p">}</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="nx">parts</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">r</span> <span class="o">*</span><span class="nx">router</span><span class="p">)</span> <span class="nf">addRoute</span><span class="p">(</span><span class="nx">method</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">pattern</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">handler</span> <span class="nx">HandlerFunc</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">parts</span> <span class="o">:=</span> <span class="nf">parsePattern</span><span class="p">(</span><span class="nx">pattern</span><span class="p">)</span>

	<span class="nx">key</span> <span class="o">:=</span> <span class="nx">method</span> <span class="o">+</span> <span class="s">&#34;-&#34;</span> <span class="o">+</span> <span class="nx">pattern</span>
	<span class="nx">_</span><span class="p">,</span> <span class="nx">ok</span> <span class="o">:=</span> <span class="nx">r</span><span class="p">.</span><span class="nx">roots</span><span class="p">[</span><span class="nx">method</span><span class="p">]</span>
	<span class="k">if</span> <span class="p">!</span><span class="nx">ok</span> <span class="p">{</span>
		<span class="nx">r</span><span class="p">.</span><span class="nx">roots</span><span class="p">[</span><span class="nx">method</span><span class="p">]</span> <span class="p">=</span> <span class="o">&amp;</span><span class="nx">node</span><span class="p">{}</span>
	<span class="p">}</span>
	<span class="nx">r</span><span class="p">.</span><span class="nx">roots</span><span class="p">[</span><span class="nx">method</span><span class="p">].</span><span class="nf">insert</span><span class="p">(</span><span class="nx">pattern</span><span class="p">,</span> <span class="nx">parts</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
	<span class="nx">r</span><span class="p">.</span><span class="nx">handlers</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="p">=</span> <span class="nx">handler</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">r</span> <span class="o">*</span><span class="nx">router</span><span class="p">)</span> <span class="nf">getRoute</span><span class="p">(</span><span class="nx">method</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">path</span> <span class="kt">string</span><span class="p">)</span> <span class="p">(</span><span class="o">*</span><span class="nx">node</span><span class="p">,</span> <span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">searchParts</span> <span class="o">:=</span> <span class="nf">parsePattern</span><span class="p">(</span><span class="nx">path</span><span class="p">)</span>
	<span class="nx">params</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span><span class="p">)</span>
	<span class="nx">root</span><span class="p">,</span> <span class="nx">ok</span> <span class="o">:=</span> <span class="nx">r</span><span class="p">.</span><span class="nx">roots</span><span class="p">[</span><span class="nx">method</span><span class="p">]</span>

	<span class="k">if</span> <span class="p">!</span><span class="nx">ok</span> <span class="p">{</span>
		<span class="k">return</span> <span class="kc">nil</span><span class="p">,</span> <span class="kc">nil</span>
	<span class="p">}</span>

	<span class="nx">n</span> <span class="o">:=</span> <span class="nx">root</span><span class="p">.</span><span class="nf">search</span><span class="p">(</span><span class="nx">searchParts</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

	<span class="k">if</span> <span class="nx">n</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
		<span class="nx">parts</span> <span class="o">:=</span> <span class="nf">parsePattern</span><span class="p">(</span><span class="nx">n</span><span class="p">.</span><span class="nx">pattern</span><span class="p">)</span>
		<span class="k">for</span> <span class="nx">index</span><span class="p">,</span> <span class="nx">part</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">parts</span> <span class="p">{</span>
			<span class="k">if</span> <span class="nx">part</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="sc">&#39;:&#39;</span> <span class="p">{</span>
				<span class="nx">params</span><span class="p">[</span><span class="nx">part</span><span class="p">[</span><span class="mi">1</span><span class="p">:]]</span> <span class="p">=</span> <span class="nx">searchParts</span><span class="p">[</span><span class="nx">index</span><span class="p">]</span>
			<span class="p">}</span>
			<span class="k">if</span> <span class="nx">part</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="sc">&#39;*&#39;</span> <span class="o">&amp;&amp;</span> <span class="nb">len</span><span class="p">(</span><span class="nx">part</span><span class="p">)</span> <span class="p">&gt;</span> <span class="mi">1</span> <span class="p">{</span>
				<span class="nx">params</span><span class="p">[</span><span class="nx">part</span><span class="p">[</span><span class="mi">1</span><span class="p">:]]</span> <span class="p">=</span> <span class="nx">strings</span><span class="p">.</span><span class="nf">Join</span><span class="p">(</span><span class="nx">searchParts</span><span class="p">[</span><span class="nx">index</span><span class="p">:],</span> <span class="s">&#34;/&#34;</span><span class="p">)</span>
				<span class="k">break</span>
			<span class="p">}</span>
		<span class="p">}</span>
		<span class="k">return</span> <span class="nx">n</span><span class="p">,</span> <span class="nx">params</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="kc">nil</span><span class="p">,</span> <span class="kc">nil</span>
<span class="p">}</span>
</code></pre></div><h3 id="contextä¸handleçš„å˜åŒ–">Contextä¸handleçš„å˜åŒ–</h3>
<p>åœ¨ HandlerFunc ä¸­ï¼Œå¸Œæœ›èƒ½å¤Ÿè®¿é—®åˆ°è§£æçš„å‚æ•°ï¼Œå› æ­¤ï¼Œéœ€è¦å¯¹ Context å¯¹è±¡å¢åŠ ä¸€ä¸ªå±æ€§å’Œæ–¹æ³•ï¼Œæ¥æä¾›å¯¹è·¯ç”±å‚æ•°çš„è®¿é—®ã€‚æˆ‘ä»¬å°†è§£æåçš„å‚æ•°å­˜å‚¨åˆ°<code>Params</code>ä¸­ï¼Œé€šè¿‡<code>c.Param(&quot;lang&quot;)</code>çš„æ–¹å¼è·å–åˆ°å¯¹åº”çš„å€¼ã€‚</p>
<p>context.go</p>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">type</span> <span class="nx">Context</span> <span class="kd">struct</span> <span class="p">{</span>
	<span class="c1">// origin objects
</span><span class="c1"></span>	<span class="nx">Writer</span> <span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span>
	<span class="nx">Req</span>    <span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span>
	<span class="c1">// request info
</span><span class="c1"></span>	<span class="nx">Path</span>   <span class="kt">string</span>
	<span class="nx">Method</span> <span class="kt">string</span>
	<span class="nx">Params</span> <span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span>
	<span class="c1">// response info
</span><span class="c1"></span>	<span class="nx">StatusCode</span> <span class="kt">int</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">Context</span><span class="p">)</span> <span class="nf">Param</span><span class="p">(</span><span class="nx">key</span> <span class="kt">string</span><span class="p">)</span> <span class="kt">string</span> <span class="p">{</span>
	<span class="nx">value</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">c</span><span class="p">.</span><span class="nx">Params</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span>
	<span class="k">return</span> <span class="nx">value</span>
<span class="p">}</span>
</code></pre></div><p>router.go</p>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="p">(</span><span class="nx">r</span> <span class="o">*</span><span class="nx">router</span><span class="p">)</span> <span class="nf">handle</span><span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">n</span><span class="p">,</span> <span class="nx">params</span> <span class="o">:=</span> <span class="nx">r</span><span class="p">.</span><span class="nf">getRoute</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">Method</span><span class="p">,</span> <span class="nx">c</span><span class="p">.</span><span class="nx">Path</span><span class="p">)</span>
	<span class="k">if</span> <span class="nx">n</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
		<span class="nx">c</span><span class="p">.</span><span class="nx">Params</span> <span class="p">=</span> <span class="nx">params</span>
		<span class="nx">key</span> <span class="o">:=</span> <span class="nx">c</span><span class="p">.</span><span class="nx">Method</span> <span class="o">+</span> <span class="s">&#34;-&#34;</span> <span class="o">+</span> <span class="nx">n</span><span class="p">.</span><span class="nx">pattern</span>
		<span class="nx">r</span><span class="p">.</span><span class="nx">handlers</span><span class="p">[</span><span class="nx">key</span><span class="p">](</span><span class="nx">c</span><span class="p">)</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="nx">c</span><span class="p">.</span><span class="nf">String</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusNotFound</span><span class="p">,</span> <span class="s">&#34;404 NOT FOUND: %sn&#34;</span><span class="p">,</span> <span class="nx">c</span><span class="p">.</span><span class="nx">Path</span><span class="p">)</span>
	<span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p><code>router.go</code>çš„å˜åŒ–æ¯”è¾ƒå°ï¼Œæ¯”è¾ƒé‡è¦çš„ä¸€ç‚¹æ˜¯ï¼Œåœ¨è°ƒç”¨åŒ¹é…åˆ°çš„<code>handler</code>å‰ï¼Œå°†è§£æå‡ºæ¥çš„è·¯ç”±å‚æ•°èµ‹å€¼ç»™äº†<code>c.Params</code>ã€‚è¿™æ ·å°±èƒ½å¤Ÿåœ¨<code>handler</code>ä¸­ï¼Œé€šè¿‡<code>Context</code>å¯¹è±¡è®¿é—®åˆ°å…·ä½“çš„å€¼äº†ã€‚</p>
<h3 id="å•å…ƒæµ‹è¯•">å•å…ƒæµ‹è¯•</h3>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">newTestRouter</span><span class="p">()</span> <span class="o">*</span><span class="nx">router</span> <span class="p">{</span>
	<span class="nx">r</span> <span class="o">:=</span> <span class="nf">newRouter</span><span class="p">()</span>
	<span class="nx">r</span><span class="p">.</span><span class="nf">addRoute</span><span class="p">(</span><span class="s">&#34;GET&#34;</span><span class="p">,</span> <span class="s">&#34;/&#34;</span><span class="p">,</span> <span class="kc">nil</span><span class="p">)</span>
	<span class="nx">r</span><span class="p">.</span><span class="nf">addRoute</span><span class="p">(</span><span class="s">&#34;GET&#34;</span><span class="p">,</span> <span class="s">&#34;/hello/:name&#34;</span><span class="p">,</span> <span class="kc">nil</span><span class="p">)</span>
	<span class="nx">r</span><span class="p">.</span><span class="nf">addRoute</span><span class="p">(</span><span class="s">&#34;GET&#34;</span><span class="p">,</span> <span class="s">&#34;/hello/b/c&#34;</span><span class="p">,</span> <span class="kc">nil</span><span class="p">)</span>
	<span class="nx">r</span><span class="p">.</span><span class="nf">addRoute</span><span class="p">(</span><span class="s">&#34;GET&#34;</span><span class="p">,</span> <span class="s">&#34;/hi/:name&#34;</span><span class="p">,</span> <span class="kc">nil</span><span class="p">)</span>
	<span class="nx">r</span><span class="p">.</span><span class="nf">addRoute</span><span class="p">(</span><span class="s">&#34;GET&#34;</span><span class="p">,</span> <span class="s">&#34;/assets/*filepath&#34;</span><span class="p">,</span> <span class="kc">nil</span><span class="p">)</span>
	<span class="k">return</span> <span class="nx">r</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">TestParsePattern</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">ok</span> <span class="o">:=</span> <span class="nx">reflect</span><span class="p">.</span><span class="nf">DeepEqual</span><span class="p">(</span><span class="nf">parsePattern</span><span class="p">(</span><span class="s">&#34;/p/:name&#34;</span><span class="p">),</span> <span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&#34;p&#34;</span><span class="p">,</span> <span class="s">&#34;:name&#34;</span><span class="p">})</span>
	<span class="nx">ok</span> <span class="p">=</span> <span class="nx">ok</span> <span class="o">&amp;&amp;</span> <span class="nx">reflect</span><span class="p">.</span><span class="nf">DeepEqual</span><span class="p">(</span><span class="nf">parsePattern</span><span class="p">(</span><span class="s">&#34;/p/*&#34;</span><span class="p">),</span> <span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&#34;p&#34;</span><span class="p">,</span> <span class="s">&#34;*&#34;</span><span class="p">})</span>
	<span class="nx">ok</span> <span class="p">=</span> <span class="nx">ok</span> <span class="o">&amp;&amp;</span> <span class="nx">reflect</span><span class="p">.</span><span class="nf">DeepEqual</span><span class="p">(</span><span class="nf">parsePattern</span><span class="p">(</span><span class="s">&#34;/p/*name/*&#34;</span><span class="p">),</span> <span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&#34;p&#34;</span><span class="p">,</span> <span class="s">&#34;*name&#34;</span><span class="p">})</span>
	<span class="k">if</span> <span class="p">!</span><span class="nx">ok</span> <span class="p">{</span>
		<span class="nx">t</span><span class="p">.</span><span class="nf">Fatal</span><span class="p">(</span><span class="s">&#34;test parsePattern failed&#34;</span><span class="p">)</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">TestGetRoute</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">r</span> <span class="o">:=</span> <span class="nf">newTestRouter</span><span class="p">()</span>
	<span class="nx">n</span><span class="p">,</span> <span class="nx">ps</span> <span class="o">:=</span> <span class="nx">r</span><span class="p">.</span><span class="nf">getRoute</span><span class="p">(</span><span class="s">&#34;GET&#34;</span><span class="p">,</span> <span class="s">&#34;/hello/geektutu&#34;</span><span class="p">)</span>

	<span class="k">if</span> <span class="nx">n</span> <span class="o">==</span> <span class="kc">nil</span> <span class="p">{</span>
		<span class="nx">t</span><span class="p">.</span><span class="nf">Fatal</span><span class="p">(</span><span class="s">&#34;nil shouldn&#39;t be returned&#34;</span><span class="p">)</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="nx">n</span><span class="p">.</span><span class="nx">pattern</span> <span class="o">!=</span> <span class="s">&#34;/hello/:name&#34;</span> <span class="p">{</span>
		<span class="nx">t</span><span class="p">.</span><span class="nf">Fatal</span><span class="p">(</span><span class="s">&#34;should match /hello/:name&#34;</span><span class="p">)</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="nx">ps</span><span class="p">[</span><span class="s">&#34;name&#34;</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&#34;geektutu&#34;</span> <span class="p">{</span>
		<span class="nx">t</span><span class="p">.</span><span class="nf">Fatal</span><span class="p">(</span><span class="s">&#34;name should be equal to &#39;geektutu&#39;&#34;</span><span class="p">)</span>
	<span class="p">}</span>

	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;matched path: %s, params[&#39;name&#39;]: %sn&#34;</span><span class="p">,</span> <span class="nx">n</span><span class="p">.</span><span class="nx">pattern</span><span class="p">,</span> <span class="nx">ps</span><span class="p">[</span><span class="s">&#34;name&#34;</span><span class="p">])</span>

<span class="p">}</span>
</code></pre></div><h3 id="ä½¿ç”¨demo">ä½¿ç”¨Demo</h3>
<p>çœ‹çœ‹æ¡†æ¶ä½¿ç”¨çš„æ ·ä¾‹å§ã€‚</p>
<p>main.go</p>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="nx">r</span> <span class="o">:=</span> <span class="nx">gee</span><span class="p">.</span><span class="nf">New</span><span class="p">()</span>
	<span class="nx">r</span><span class="p">.</span><span class="nf">GET</span><span class="p">(</span><span class="s">&#34;/&#34;</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">gee</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
		<span class="nx">c</span><span class="p">.</span><span class="nf">HTML</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">,</span> <span class="s">&#34;&lt;h1&gt;Hello Gee&lt;/h1&gt;&#34;</span><span class="p">)</span>
	<span class="p">})</span>

	<span class="nx">r</span><span class="p">.</span><span class="nf">GET</span><span class="p">(</span><span class="s">&#34;/hello&#34;</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">gee</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
		<span class="c1">// expect /hello?name=geektutu
</span><span class="c1"></span>		<span class="nx">c</span><span class="p">.</span><span class="nf">String</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">,</span> <span class="s">&#34;hello %s, you&#39;re at %sn&#34;</span><span class="p">,</span> <span class="nx">c</span><span class="p">.</span><span class="nf">Query</span><span class="p">(</span><span class="s">&#34;name&#34;</span><span class="p">),</span> <span class="nx">c</span><span class="p">.</span><span class="nx">Path</span><span class="p">)</span>
	<span class="p">})</span>

	<span class="nx">r</span><span class="p">.</span><span class="nf">GET</span><span class="p">(</span><span class="s">&#34;/hello/:name&#34;</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">gee</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
		<span class="c1">// expect /hello/geektutu
</span><span class="c1"></span>		<span class="nx">c</span><span class="p">.</span><span class="nf">String</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">,</span> <span class="s">&#34;hello %s, you&#39;re at %sn&#34;</span><span class="p">,</span> <span class="nx">c</span><span class="p">.</span><span class="nf">Param</span><span class="p">(</span><span class="s">&#34;name&#34;</span><span class="p">),</span> <span class="nx">c</span><span class="p">.</span><span class="nx">Path</span><span class="p">)</span>
	<span class="p">})</span>

	<span class="nx">r</span><span class="p">.</span><span class="nf">GET</span><span class="p">(</span><span class="s">&#34;/assets/*filepath&#34;</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">gee</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
		<span class="nx">c</span><span class="p">.</span><span class="nf">JSON</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">,</span> <span class="nx">gee</span><span class="p">.</span><span class="nx">H</span><span class="p">{</span><span class="s">&#34;filepath&#34;</span><span class="p">:</span> <span class="nx">c</span><span class="p">.</span><span class="nf">Param</span><span class="p">(</span><span class="s">&#34;filepath&#34;</span><span class="p">)})</span>
	<span class="p">})</span>

	<span class="nx">r</span><span class="p">.</span><span class="nf">Run</span><span class="p">(</span><span class="s">&#34;:9999&#34;</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div><p>ä½¿ç”¨<code>curl</code>å·¥å…·ï¼Œæµ‹è¯•ç»“æœã€‚</p>
<pre><code>$ curl &quot;http://localhost:9999/hello/geektutu&quot;  
hello geektutu, you're at /hello/geektutu  
  
$ curl &quot;http://localhost:9999/assets/css/geektutu.css&quot;  
{&quot;filepath&quot;:&quot;css/geektutu.css&quot;}
</code></pre><h2 id="åˆ†ç»„æ§åˆ¶group">åˆ†ç»„æ§åˆ¶Group</h2>
<ul>
<li>å®ç°è·¯ç”±åˆ†ç»„æ§åˆ¶(Route Group Control)ï¼Œ<strong>ä»£ç çº¦50è¡Œ</strong></li>
</ul>
<h3 id="åˆ†ç»„çš„æ„ä¹‰">åˆ†ç»„çš„æ„ä¹‰</h3>
<p>åˆ†ç»„æ§åˆ¶(Group Control)æ˜¯ Web æ¡†æ¶åº”æä¾›çš„åŸºç¡€åŠŸèƒ½ä¹‹ä¸€ã€‚æ‰€è°“åˆ†ç»„ï¼Œæ˜¯æŒ‡è·¯ç”±çš„åˆ†ç»„ã€‚å¦‚æœæ²¡æœ‰è·¯ç”±åˆ†ç»„ï¼Œæˆ‘ä»¬éœ€è¦é’ˆå¯¹æ¯ä¸€ä¸ªè·¯ç”±è¿›è¡Œæ§åˆ¶ã€‚ä½†æ˜¯çœŸå®çš„ä¸šåŠ¡åœºæ™¯ä¸­ï¼Œå¾€å¾€æŸä¸€ç»„è·¯ç”±éœ€è¦ç›¸ä¼¼çš„å¤„ç†ã€‚ä¾‹å¦‚ï¼š</p>
<ul>
<li>ä»¥<code>/post</code>å¼€å¤´çš„è·¯ç”±åŒ¿åå¯è®¿é—®ã€‚</li>
<li>ä»¥<code>/admin</code>å¼€å¤´çš„è·¯ç”±éœ€è¦é‰´æƒã€‚</li>
<li>ä»¥<code>/api</code>å¼€å¤´çš„è·¯ç”±æ˜¯ RESTful æ¥å£ï¼Œå¯ä»¥å¯¹æ¥ç¬¬ä¸‰æ–¹å¹³å°ï¼Œéœ€è¦ä¸‰æ–¹å¹³å°é‰´æƒã€‚</li>
</ul>
<p>å¤§éƒ¨åˆ†æƒ…å†µä¸‹çš„è·¯ç”±åˆ†ç»„ï¼Œæ˜¯ä»¥ç›¸åŒçš„å‰ç¼€æ¥åŒºåˆ†çš„ã€‚å› æ­¤ï¼Œæˆ‘ä»¬ä»Šå¤©å®ç°çš„åˆ†ç»„æ§åˆ¶ä¹Ÿæ˜¯ä»¥å‰ç¼€æ¥åŒºåˆ†ï¼Œå¹¶ä¸”æ”¯æŒåˆ†ç»„çš„åµŒå¥—ã€‚ä¾‹å¦‚<code>/post</code>æ˜¯ä¸€ä¸ªåˆ†ç»„ï¼Œ<code>/post/a</code>å’Œ<code>/post/b</code>å¯ä»¥æ˜¯è¯¥åˆ†ç»„ä¸‹çš„å­åˆ†ç»„ã€‚ä½œç”¨åœ¨<code>/post</code>åˆ†ç»„ä¸Šçš„ä¸­é—´ä»¶(middleware)ï¼Œä¹Ÿéƒ½ä¼šä½œç”¨åœ¨å­åˆ†ç»„ï¼Œå­åˆ†ç»„è¿˜å¯ä»¥åº”ç”¨è‡ªå·±ç‰¹æœ‰çš„ä¸­é—´ä»¶ã€‚</p>
<p>ä¸­é—´ä»¶å¯ä»¥ç»™æ¡†æ¶æä¾›æ— é™çš„æ‰©å±•èƒ½åŠ›ï¼Œåº”ç”¨åœ¨åˆ†ç»„ä¸Šï¼Œå¯ä»¥ä½¿å¾—åˆ†ç»„æ§åˆ¶çš„æ”¶ç›Šæ›´ä¸ºæ˜æ˜¾ï¼Œè€Œä¸æ˜¯å…±äº«ç›¸åŒçš„è·¯ç”±å‰ç¼€è¿™ä¹ˆç®€å•ã€‚ä¾‹å¦‚<code>/admin</code>çš„åˆ†ç»„ï¼Œå¯ä»¥åº”ç”¨é‰´æƒä¸­é—´ä»¶ï¼›<code>/</code>åˆ†ç»„åº”ç”¨æ—¥å¿—ä¸­é—´ä»¶ï¼Œ<code>/</code>æ˜¯é»˜è®¤çš„æœ€é¡¶å±‚çš„åˆ†ç»„ï¼Œä¹Ÿå°±æ„å‘³ç€ç»™æ‰€æœ‰çš„è·¯ç”±ï¼Œå³æ•´ä¸ªæ¡†æ¶å¢åŠ äº†è®°å½•æ—¥å¿—çš„èƒ½åŠ›ã€‚</p>
<p>æä¾›æ‰©å±•èƒ½åŠ›æ”¯æŒä¸­é—´ä»¶çš„å†…å®¹ï¼Œæˆ‘ä»¬å°†åœ¨ä¸‹ä¸€èŠ‚å½“ä¸­ä»‹ç»ã€‚</p>
<h3 id="åˆ†ç»„åµŒå¥—">åˆ†ç»„åµŒå¥—</h3>
<p>ä¸€ä¸ª Group å¯¹è±¡éœ€è¦å…·å¤‡å“ªäº›å±æ€§å‘¢ï¼Ÿé¦–å…ˆæ˜¯å‰ç¼€(prefix)ï¼Œæ¯”å¦‚<code>/</code>ï¼Œæˆ–è€…<code>/api</code>ï¼›è¦æ”¯æŒåˆ†ç»„åµŒå¥—ï¼Œé‚£ä¹ˆéœ€è¦çŸ¥é“å½“å‰åˆ†ç»„çš„çˆ¶äº²(parent)æ˜¯è°ï¼›å½“ç„¶äº†ï¼ŒæŒ‰ç…§æˆ‘ä»¬ä¸€å¼€å§‹çš„åˆ†æï¼Œä¸­é—´ä»¶æ˜¯åº”ç”¨åœ¨åˆ†ç»„ä¸Šçš„ï¼Œé‚£è¿˜éœ€è¦å­˜å‚¨åº”ç”¨åœ¨è¯¥åˆ†ç»„ä¸Šçš„ä¸­é—´ä»¶(middlewares)ã€‚è¿˜è®°å¾—ï¼Œæˆ‘ä»¬ä¹‹å‰è°ƒç”¨å‡½æ•°<code>(*Engine).addRoute()</code>æ¥æ˜ å°„æ‰€æœ‰çš„è·¯ç”±è§„åˆ™å’Œ Handler ã€‚å¦‚æœGroupå¯¹è±¡éœ€è¦ç›´æ¥æ˜ å°„è·¯ç”±è§„åˆ™çš„è¯ï¼Œæ¯”å¦‚æˆ‘ä»¬æƒ³åœ¨ä½¿ç”¨æ¡†æ¶æ—¶ï¼Œè¿™ä¹ˆè°ƒç”¨ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="nx">r</span> <span class="o">:=</span> <span class="nx">gee</span><span class="p">.</span><span class="nf">New</span><span class="p">()</span>  
<span class="nx">v1</span> <span class="o">:=</span> <span class="nx">r</span><span class="p">.</span><span class="nf">Group</span><span class="p">(</span><span class="s">&#34;/v1&#34;</span><span class="p">)</span>  
<span class="nx">v1</span><span class="p">.</span><span class="nf">GET</span><span class="p">(</span><span class="s">&#34;/&#34;</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">gee</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>  
 <span class="nx">c</span><span class="p">.</span><span class="nf">HTML</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">,</span> <span class="s">&#34;&lt;h1&gt;Hello Gee&lt;/h1&gt;&#34;</span><span class="p">)</span>  
<span class="p">})</span>  
</code></pre></div><p>é‚£ä¹ˆGroupå¯¹è±¡ï¼Œè¿˜éœ€è¦æœ‰è®¿é—®<code>Router</code>çš„èƒ½åŠ›ï¼Œä¸ºäº†æ–¹ä¾¿ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨Groupä¸­ï¼Œä¿å­˜ä¸€ä¸ªæŒ‡é’ˆï¼ŒæŒ‡å‘<code>Engine</code>ï¼Œæ•´ä¸ªæ¡†æ¶çš„æ‰€æœ‰èµ„æºéƒ½æ˜¯ç”±<code>Engine</code>ç»Ÿä¸€åè°ƒçš„ï¼Œé‚£ä¹ˆå°±å¯ä»¥é€šè¿‡<code>Engine</code>é—´æ¥åœ°è®¿é—®å„ç§æ¥å£äº†ã€‚</p>
<p>æ‰€ä»¥ï¼Œæœ€åçš„ Group çš„å®šä¹‰æ˜¯è¿™æ ·çš„ï¼š</p>
<p>gee.go</p>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">type</span> <span class="nx">RouterGroup</span> <span class="kd">struct</span> <span class="p">{</span>
	<span class="nx">prefix</span>      <span class="kt">string</span>
	<span class="nx">middlewares</span> <span class="p">[]</span><span class="nx">HandlerFunc</span> <span class="c1">// support middleware
</span><span class="c1"></span>	<span class="nx">parent</span>      <span class="o">*</span><span class="nx">RouterGroup</span>  <span class="c1">// support nesting
</span><span class="c1"></span>	<span class="nx">engine</span>      <span class="o">*</span><span class="nx">Engine</span>       <span class="c1">// all groups share a Engine instance
</span><span class="c1"></span><span class="p">}</span>
</code></pre></div><p>æˆ‘ä»¬è¿˜å¯ä»¥è¿›ä¸€æ­¥åœ°æŠ½è±¡ï¼Œå°†<code>Engine</code>ä½œä¸ºæœ€é¡¶å±‚çš„åˆ†ç»„ï¼Œä¹Ÿå°±æ˜¯è¯´<code>Engine</code>æ‹¥æœ‰<code>RouterGroup</code>æ‰€æœ‰çš„èƒ½åŠ›ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">type</span> <span class="nx">Engine</span> <span class="kd">struct</span> <span class="p">{</span>
	<span class="o">*</span><span class="nx">RouterGroup</span>
	<span class="nx">router</span> <span class="o">*</span><span class="nx">router</span>
	<span class="nx">groups</span> <span class="p">[]</span><span class="o">*</span><span class="nx">RouterGroup</span> <span class="c1">// store all groups
</span><span class="c1"></span><span class="p">}</span>
</code></pre></div><p>é‚£æˆ‘ä»¬å°±å¯ä»¥å°†å’Œè·¯ç”±æœ‰å…³çš„å‡½æ•°ï¼Œéƒ½äº¤ç»™<code>RouterGroup</code>å®ç°äº†ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="c1">// New is the constructor of gee.Engine
</span><span class="c1"></span><span class="kd">func</span> <span class="nf">New</span><span class="p">()</span> <span class="o">*</span><span class="nx">Engine</span> <span class="p">{</span>
	<span class="nx">engine</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="nx">Engine</span><span class="p">{</span><span class="nx">router</span><span class="p">:</span> <span class="nf">newRouter</span><span class="p">()}</span>
	<span class="nx">engine</span><span class="p">.</span><span class="nx">RouterGroup</span> <span class="p">=</span> <span class="o">&amp;</span><span class="nx">RouterGroup</span><span class="p">{</span><span class="nx">engine</span><span class="p">:</span> <span class="nx">engine</span><span class="p">}</span>
	<span class="nx">engine</span><span class="p">.</span><span class="nx">groups</span> <span class="p">=</span> <span class="p">[]</span><span class="o">*</span><span class="nx">RouterGroup</span><span class="p">{</span><span class="nx">engine</span><span class="p">.</span><span class="nx">RouterGroup</span><span class="p">}</span>
	<span class="k">return</span> <span class="nx">engine</span>
<span class="p">}</span>

<span class="c1">// Group is defined to create a new RouterGroup
</span><span class="c1">// remember all groups share the same Engine instance
</span><span class="c1"></span><span class="kd">func</span> <span class="p">(</span><span class="nx">group</span> <span class="o">*</span><span class="nx">RouterGroup</span><span class="p">)</span> <span class="nf">Group</span><span class="p">(</span><span class="nx">prefix</span> <span class="kt">string</span><span class="p">)</span> <span class="o">*</span><span class="nx">RouterGroup</span> <span class="p">{</span>
	<span class="nx">engine</span> <span class="o">:=</span> <span class="nx">group</span><span class="p">.</span><span class="nx">engine</span>
	<span class="nx">newGroup</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="nx">RouterGroup</span><span class="p">{</span>
		<span class="nx">prefix</span><span class="p">:</span> <span class="nx">group</span><span class="p">.</span><span class="nx">prefix</span> <span class="o">+</span> <span class="nx">prefix</span><span class="p">,</span>
		<span class="nx">parent</span><span class="p">:</span> <span class="nx">group</span><span class="p">,</span>
		<span class="nx">engine</span><span class="p">:</span> <span class="nx">engine</span><span class="p">,</span>
	<span class="p">}</span>
	<span class="nx">engine</span><span class="p">.</span><span class="nx">groups</span> <span class="p">=</span> <span class="nb">append</span><span class="p">(</span><span class="nx">engine</span><span class="p">.</span><span class="nx">groups</span><span class="p">,</span> <span class="nx">newGroup</span><span class="p">)</span>
	<span class="k">return</span> <span class="nx">newGroup</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">group</span> <span class="o">*</span><span class="nx">RouterGroup</span><span class="p">)</span> <span class="nf">addRoute</span><span class="p">(</span><span class="nx">method</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">comp</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">handler</span> <span class="nx">HandlerFunc</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">pattern</span> <span class="o">:=</span> <span class="nx">group</span><span class="p">.</span><span class="nx">prefix</span> <span class="o">+</span> <span class="nx">comp</span>
	<span class="nx">log</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;Route %4s - %s&#34;</span><span class="p">,</span> <span class="nx">method</span><span class="p">,</span> <span class="nx">pattern</span><span class="p">)</span>
	<span class="nx">group</span><span class="p">.</span><span class="nx">engine</span><span class="p">.</span><span class="nx">router</span><span class="p">.</span><span class="nf">addRoute</span><span class="p">(</span><span class="nx">method</span><span class="p">,</span> <span class="nx">pattern</span><span class="p">,</span> <span class="nx">handler</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// GET defines the method to add GET request
</span><span class="c1"></span><span class="kd">func</span> <span class="p">(</span><span class="nx">group</span> <span class="o">*</span><span class="nx">RouterGroup</span><span class="p">)</span> <span class="nf">GET</span><span class="p">(</span><span class="nx">pattern</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">handler</span> <span class="nx">HandlerFunc</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">group</span><span class="p">.</span><span class="nf">addRoute</span><span class="p">(</span><span class="s">&#34;GET&#34;</span><span class="p">,</span> <span class="nx">pattern</span><span class="p">,</span> <span class="nx">handler</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// POST defines the method to add POST request
</span><span class="c1"></span><span class="kd">func</span> <span class="p">(</span><span class="nx">group</span> <span class="o">*</span><span class="nx">RouterGroup</span><span class="p">)</span> <span class="nf">POST</span><span class="p">(</span><span class="nx">pattern</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">handler</span> <span class="nx">HandlerFunc</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">group</span><span class="p">.</span><span class="nf">addRoute</span><span class="p">(</span><span class="s">&#34;POST&#34;</span><span class="p">,</span> <span class="nx">pattern</span><span class="p">,</span> <span class="nx">handler</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div><p>å¯ä»¥ä»”ç»†è§‚å¯Ÿä¸‹<code>addRoute</code>å‡½æ•°ï¼Œè°ƒç”¨äº†<code>group.engine.router.addRoute</code>æ¥å®ç°äº†è·¯ç”±çš„æ˜ å°„ã€‚ç”±äº<code>Engine</code>ä»æŸç§æ„ä¹‰ä¸Šç»§æ‰¿äº†<code>RouterGroup</code>çš„æ‰€æœ‰å±æ€§å’Œæ–¹æ³•ï¼Œå› ä¸º (*Engine).engine æ˜¯æŒ‡å‘è‡ªå·±çš„ã€‚è¿™æ ·å®ç°ï¼Œæˆ‘ä»¬æ—¢å¯ä»¥åƒåŸæ¥ä¸€æ ·æ·»åŠ è·¯ç”±ï¼Œä¹Ÿå¯ä»¥é€šè¿‡åˆ†ç»„æ·»åŠ è·¯ç”±ã€‚</p>
<h3 id="ä½¿ç”¨-demo">ä½¿ç”¨ Demo</h3>
<p>æµ‹è¯•æ¡†æ¶çš„Demoå°±å¯ä»¥è¿™æ ·å†™äº†ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="nx">r</span> <span class="o">:=</span> <span class="nx">gee</span><span class="p">.</span><span class="nf">New</span><span class="p">()</span>
	<span class="nx">r</span><span class="p">.</span><span class="nf">GET</span><span class="p">(</span><span class="s">&#34;/index&#34;</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">gee</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
		<span class="nx">c</span><span class="p">.</span><span class="nf">HTML</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">,</span> <span class="s">&#34;&lt;h1&gt;Index Page&lt;/h1&gt;&#34;</span><span class="p">)</span>
	<span class="p">})</span>
	<span class="nx">v1</span> <span class="o">:=</span> <span class="nx">r</span><span class="p">.</span><span class="nf">Group</span><span class="p">(</span><span class="s">&#34;/v1&#34;</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="nx">v1</span><span class="p">.</span><span class="nf">GET</span><span class="p">(</span><span class="s">&#34;/&#34;</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">gee</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">c</span><span class="p">.</span><span class="nf">HTML</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">,</span> <span class="s">&#34;&lt;h1&gt;Hello Gee&lt;/h1&gt;&#34;</span><span class="p">)</span>
		<span class="p">})</span>

		<span class="nx">v1</span><span class="p">.</span><span class="nf">GET</span><span class="p">(</span><span class="s">&#34;/hello&#34;</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">gee</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
			<span class="c1">// expect /hello?name=geektutu
</span><span class="c1"></span>			<span class="nx">c</span><span class="p">.</span><span class="nf">String</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">,</span> <span class="s">&#34;hello %s, you&#39;re at %sn&#34;</span><span class="p">,</span> <span class="nx">c</span><span class="p">.</span><span class="nf">Query</span><span class="p">(</span><span class="s">&#34;name&#34;</span><span class="p">),</span> <span class="nx">c</span><span class="p">.</span><span class="nx">Path</span><span class="p">)</span>
		<span class="p">})</span>
	<span class="p">}</span>
	<span class="nx">v2</span> <span class="o">:=</span> <span class="nx">r</span><span class="p">.</span><span class="nf">Group</span><span class="p">(</span><span class="s">&#34;/v2&#34;</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="nx">v2</span><span class="p">.</span><span class="nf">GET</span><span class="p">(</span><span class="s">&#34;/hello/:name&#34;</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">gee</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
			<span class="c1">// expect /hello/geektutu
</span><span class="c1"></span>			<span class="nx">c</span><span class="p">.</span><span class="nf">String</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">,</span> <span class="s">&#34;hello %s, you&#39;re at %sn&#34;</span><span class="p">,</span> <span class="nx">c</span><span class="p">.</span><span class="nf">Param</span><span class="p">(</span><span class="s">&#34;name&#34;</span><span class="p">),</span> <span class="nx">c</span><span class="p">.</span><span class="nx">Path</span><span class="p">)</span>
		<span class="p">})</span>
		<span class="nx">v2</span><span class="p">.</span><span class="nf">POST</span><span class="p">(</span><span class="s">&#34;/login&#34;</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">gee</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">c</span><span class="p">.</span><span class="nf">JSON</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">,</span> <span class="nx">gee</span><span class="p">.</span><span class="nx">H</span><span class="p">{</span>
				<span class="s">&#34;username&#34;</span><span class="p">:</span> <span class="nx">c</span><span class="p">.</span><span class="nf">PostForm</span><span class="p">(</span><span class="s">&#34;username&#34;</span><span class="p">),</span>
				<span class="s">&#34;password&#34;</span><span class="p">:</span> <span class="nx">c</span><span class="p">.</span><span class="nf">PostForm</span><span class="p">(</span><span class="s">&#34;password&#34;</span><span class="p">),</span>
			<span class="p">})</span>
		<span class="p">})</span>

	<span class="p">}</span>

	<span class="nx">r</span><span class="p">.</span><span class="nf">Run</span><span class="p">(</span><span class="s">&#34;:9999&#34;</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div><p>é€šè¿‡ curl ç®€å•æµ‹è¯•ï¼š</p>
<pre><code>$ curl &quot;http://localhost:9999/v1/hello?name=geektutu&quot;  
hello geektutu, you're at /v1/hello  
  
$ curl &quot;http://localhost:9999/v2/hello/geektutu&quot;  
hello geektutu, you're at /hello/geektutu
</code></pre><ul>
<li>è®¾è®¡å¹¶å®ç° Web æ¡†æ¶çš„ä¸­é—´ä»¶(Middlewares)æœºåˆ¶ã€‚</li>
<li>å®ç°é€šç”¨çš„<code>Logger</code>ä¸­é—´ä»¶ï¼Œèƒ½å¤Ÿè®°å½•è¯·æ±‚åˆ°å“åº”æ‰€èŠ±è´¹çš„æ—¶é—´ï¼Œ<strong>ä»£ç çº¦50è¡Œ</strong></li>
</ul>
<h2 id="ä¸­é—´ä»¶æ˜¯ä»€ä¹ˆ">ä¸­é—´ä»¶æ˜¯ä»€ä¹ˆ</h2>
<p>ä¸­é—´ä»¶(middlewares)ï¼Œç®€å•è¯´ï¼Œå°±æ˜¯éä¸šåŠ¡çš„æŠ€æœ¯ç±»ç»„ä»¶ã€‚Web æ¡†æ¶æœ¬èº«ä¸å¯èƒ½å»ç†è§£æ‰€æœ‰çš„ä¸šåŠ¡ï¼Œå› è€Œä¸å¯èƒ½å®ç°æ‰€æœ‰çš„åŠŸèƒ½ã€‚å› æ­¤ï¼Œæ¡†æ¶éœ€è¦æœ‰ä¸€ä¸ªæ’å£ï¼Œå…è®¸ç”¨æˆ·è‡ªå·±å®šä¹‰åŠŸèƒ½ï¼ŒåµŒå…¥åˆ°æ¡†æ¶ä¸­ï¼Œä»¿ä½›è¿™ä¸ªåŠŸèƒ½æ˜¯æ¡†æ¶åŸç”Ÿæ”¯æŒçš„ä¸€æ ·ã€‚å› æ­¤ï¼Œå¯¹ä¸­é—´ä»¶è€Œè¨€ï¼Œéœ€è¦è€ƒè™‘2ä¸ªæ¯”è¾ƒå…³é”®çš„ç‚¹ï¼š</p>
<ul>
<li>æ’å…¥ç‚¹åœ¨å“ªï¼Ÿä½¿ç”¨æ¡†æ¶çš„äººå¹¶ä¸å…³å¿ƒåº•å±‚é€»è¾‘çš„å…·ä½“å®ç°ï¼Œå¦‚æœæ’å…¥ç‚¹å¤ªåº•å±‚ï¼Œä¸­é—´ä»¶é€»è¾‘å°±ä¼šéå¸¸å¤æ‚ã€‚å¦‚æœæ’å…¥ç‚¹ç¦»ç”¨æˆ·å¤ªè¿‘ï¼Œé‚£å’Œç”¨æˆ·ç›´æ¥å®šä¹‰ä¸€ç»„å‡½æ•°ï¼Œæ¯æ¬¡åœ¨ Handler ä¸­æ‰‹å·¥è°ƒç”¨æ²¡æœ‰å¤šå¤§çš„ä¼˜åŠ¿äº†ã€‚</li>
<li>ä¸­é—´ä»¶çš„è¾“å…¥æ˜¯ä»€ä¹ˆï¼Ÿä¸­é—´ä»¶çš„è¾“å…¥ï¼Œå†³å®šäº†æ‰©å±•èƒ½åŠ›ã€‚æš´éœ²çš„å‚æ•°å¤ªå°‘ï¼Œç”¨æˆ·å‘æŒ¥ç©ºé—´æœ‰é™ã€‚</li>
</ul>
<p>é‚£å¯¹äºä¸€ä¸ª Web æ¡†æ¶è€Œè¨€ï¼Œä¸­é—´ä»¶åº”è¯¥è®¾è®¡æˆä»€ä¹ˆæ ·å‘¢ï¼Ÿæ¥ä¸‹æ¥çš„å®ç°ï¼ŒåŸºæœ¬å‚è€ƒäº† Gin æ¡†æ¶ã€‚</p>
<h3 id="ä¸­é—´ä»¶è®¾è®¡">ä¸­é—´ä»¶è®¾è®¡</h3>
<p>Gee çš„ä¸­é—´ä»¶çš„å®šä¹‰ä¸è·¯ç”±æ˜ å°„çš„ Handler ä¸€è‡´ï¼Œå¤„ç†çš„è¾“å…¥æ˜¯<code>Context</code>å¯¹è±¡ã€‚æ’å…¥ç‚¹æ˜¯æ¡†æ¶æ¥æ”¶åˆ°è¯·æ±‚åˆå§‹åŒ–<code>Context</code>å¯¹è±¡åï¼Œå…è®¸ç”¨æˆ·ä½¿ç”¨è‡ªå·±å®šä¹‰çš„ä¸­é—´ä»¶åšä¸€äº›é¢å¤–çš„å¤„ç†ï¼Œä¾‹å¦‚è®°å½•æ—¥å¿—ç­‰ï¼Œä»¥åŠå¯¹<code>Context</code>è¿›è¡ŒäºŒæ¬¡åŠ å·¥ã€‚å¦å¤–é€šè¿‡è°ƒç”¨<code>(*Context).Next()</code>å‡½æ•°ï¼Œä¸­é—´ä»¶å¯ç­‰å¾…ç”¨æˆ·è‡ªå·±å®šä¹‰çš„ <code>Handler</code>å¤„ç†ç»“æŸåï¼Œå†åšä¸€äº›é¢å¤–çš„æ“ä½œï¼Œä¾‹å¦‚è®¡ç®—æœ¬æ¬¡å¤„ç†æ‰€ç”¨æ—¶é—´ç­‰ã€‚å³ Gee çš„ä¸­é—´ä»¶æ”¯æŒç”¨æˆ·åœ¨è¯·æ±‚è¢«å¤„ç†çš„å‰åï¼Œåšä¸€äº›é¢å¤–çš„æ“ä½œã€‚ä¸¾ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬å¸Œæœ›æœ€ç»ˆèƒ½å¤Ÿæ”¯æŒå¦‚ä¸‹å®šä¹‰çš„ä¸­é—´ä»¶ï¼Œ<code>c.Next()</code>è¡¨ç¤ºç­‰å¾…æ‰§è¡Œå…¶ä»–çš„ä¸­é—´ä»¶æˆ–ç”¨æˆ·çš„<code>Handler</code>ï¼š</p>
<p>logger.go</p>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">Logger</span><span class="p">()</span> <span class="nx">HandlerFunc</span> <span class="p">{</span>
	<span class="k">return</span> <span class="kd">func</span><span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>

		<span class="nx">t</span> <span class="o">:=</span> <span class="nx">time</span><span class="p">.</span><span class="nf">Now</span><span class="p">()</span>

		<span class="nx">c</span><span class="p">.</span><span class="nf">Next</span><span class="p">()</span>

		<span class="nx">log</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;[%d] %s in %v&#34;</span><span class="p">,</span> <span class="nx">c</span><span class="p">.</span><span class="nx">StatusCode</span><span class="p">,</span> <span class="nx">c</span><span class="p">.</span><span class="nx">Req</span><span class="p">.</span><span class="nx">RequestURI</span><span class="p">,</span> <span class="nx">time</span><span class="p">.</span><span class="nf">Since</span><span class="p">(</span><span class="nx">t</span><span class="p">))</span>
	<span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p>å¦å¤–ï¼Œæ”¯æŒè®¾ç½®å¤šä¸ªä¸­é—´ä»¶ï¼Œä¾æ¬¡è¿›è¡Œè°ƒç”¨ã€‚</p>
<p>åˆ†ç»„æ§åˆ¶ä¸­è®²åˆ°ï¼Œä¸­é—´ä»¶æ˜¯åº”ç”¨åœ¨<code>RouterGroup</code>ä¸Šçš„ï¼Œåº”ç”¨åœ¨æœ€é¡¶å±‚çš„ Groupï¼Œç›¸å½“äºä½œç”¨äºå…¨å±€ï¼Œæ‰€æœ‰çš„è¯·æ±‚éƒ½ä¼šè¢«ä¸­é—´ä»¶å¤„ç†ã€‚é‚£ä¸ºä»€ä¹ˆä¸ä½œç”¨åœ¨æ¯ä¸€æ¡è·¯ç”±è§„åˆ™ä¸Šå‘¢ï¼Ÿä½œç”¨åœ¨æŸæ¡è·¯ç”±è§„åˆ™ï¼Œé‚£è¿˜ä¸å¦‚ç”¨æˆ·ç›´æ¥åœ¨ Handler ä¸­è°ƒç”¨ç›´è§‚ã€‚åªä½œç”¨åœ¨æŸæ¡è·¯ç”±è§„åˆ™çš„åŠŸèƒ½é€šç”¨æ€§å¤ªå·®ï¼Œä¸é€‚åˆå®šä¹‰ä¸ºä¸­é—´ä»¶ã€‚</p>
<p>æˆ‘ä»¬ä¹‹å‰çš„æ¡†æ¶è®¾è®¡æ˜¯è¿™æ ·çš„ï¼Œå½“æ¥æ”¶åˆ°è¯·æ±‚åï¼ŒåŒ¹é…è·¯ç”±ï¼Œè¯¥è¯·æ±‚çš„æ‰€æœ‰ä¿¡æ¯éƒ½ä¿å­˜åœ¨<code>Context</code>ä¸­ã€‚ä¸­é—´ä»¶ä¹Ÿä¸ä¾‹å¤–ï¼Œæ¥æ”¶åˆ°è¯·æ±‚åï¼Œåº”æŸ¥æ‰¾æ‰€æœ‰åº”ä½œç”¨äºè¯¥è·¯ç”±çš„ä¸­é—´ä»¶ï¼Œä¿å­˜åœ¨<code>Context</code>ä¸­ï¼Œä¾æ¬¡è¿›è¡Œè°ƒç”¨ã€‚ä¸ºä»€ä¹ˆä¾æ¬¡è°ƒç”¨åï¼Œè¿˜éœ€è¦åœ¨<code>Context</code>ä¸­ä¿å­˜å‘¢ï¼Ÿå› ä¸ºåœ¨è®¾è®¡ä¸­ï¼Œä¸­é—´ä»¶ä¸ä»…ä½œç”¨åœ¨å¤„ç†æµç¨‹å‰ï¼Œä¹Ÿå¯ä»¥ä½œç”¨åœ¨å¤„ç†æµç¨‹åï¼Œå³åœ¨ç”¨æˆ·å®šä¹‰çš„ Handler å¤„ç†å®Œæ¯•åï¼Œè¿˜å¯ä»¥æ‰§è¡Œå‰©ä¸‹çš„æ“ä½œã€‚</p>
<p>ä¸ºæ­¤ï¼Œæˆ‘ä»¬ç»™<code>Context</code>æ·»åŠ äº†2ä¸ªå‚æ•°ï¼Œå®šä¹‰äº†<code>Next</code>æ–¹æ³•ï¼š</p>
<p>context.go</p>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">type</span> <span class="nx">Context</span> <span class="kd">struct</span> <span class="p">{</span>
	<span class="nx">Writer</span> <span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span>
	<span class="nx">Req</span>    <span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span>

	<span class="nx">Path</span>   <span class="kt">string</span>
	<span class="nx">Method</span> <span class="kt">string</span>
	<span class="nx">Params</span> <span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span>

	<span class="nx">StatusCode</span> <span class="kt">int</span>

	<span class="nx">handlers</span> <span class="p">[]</span><span class="nx">HandlerFunc</span>
	<span class="nx">index</span>    <span class="kt">int</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">newContext</span><span class="p">(</span><span class="nx">w</span> <span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span> <span class="nx">req</span> <span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span> <span class="o">*</span><span class="nx">Context</span> <span class="p">{</span>
	<span class="k">return</span> <span class="o">&amp;</span><span class="nx">Context</span><span class="p">{</span>
		<span class="nx">Path</span><span class="p">:</span>   <span class="nx">req</span><span class="p">.</span><span class="nx">URL</span><span class="p">.</span><span class="nx">Path</span><span class="p">,</span>
		<span class="nx">Method</span><span class="p">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">Method</span><span class="p">,</span>
		<span class="nx">Req</span><span class="p">:</span>    <span class="nx">req</span><span class="p">,</span>
		<span class="nx">Writer</span><span class="p">:</span> <span class="nx">w</span><span class="p">,</span>
		<span class="nx">index</span><span class="p">:</span>  <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">Context</span><span class="p">)</span> <span class="nf">Next</span><span class="p">()</span> <span class="p">{</span>
	<span class="nx">c</span><span class="p">.</span><span class="nx">index</span><span class="o">++</span>
	<span class="nx">s</span> <span class="o">:=</span> <span class="nb">len</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">handlers</span><span class="p">)</span>
	<span class="k">for</span> <span class="p">;</span> <span class="nx">c</span><span class="p">.</span><span class="nx">index</span> <span class="p">&lt;</span> <span class="nx">s</span><span class="p">;</span> <span class="nx">c</span><span class="p">.</span><span class="nx">index</span><span class="o">++</span> <span class="p">{</span>
		<span class="nx">c</span><span class="p">.</span><span class="nx">handlers</span><span class="p">[</span><span class="nx">c</span><span class="p">.</span><span class="nx">index</span><span class="p">](</span><span class="nx">c</span><span class="p">)</span>
	<span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p><code>index</code>æ˜¯è®°å½•å½“å‰æ‰§è¡Œåˆ°ç¬¬å‡ ä¸ªä¸­é—´ä»¶ï¼Œå½“åœ¨ä¸­é—´ä»¶ä¸­è°ƒç”¨<code>Next</code>æ–¹æ³•æ—¶ï¼Œæ§åˆ¶æƒäº¤ç»™äº†ä¸‹ä¸€ä¸ªä¸­é—´ä»¶ï¼Œç›´åˆ°è°ƒç”¨åˆ°æœ€åä¸€ä¸ªä¸­é—´ä»¶ï¼Œç„¶åå†ä»åå¾€å‰ï¼Œè°ƒç”¨æ¯ä¸ªä¸­é—´ä»¶åœ¨<code>Next</code>æ–¹æ³•ä¹‹åå®šä¹‰çš„éƒ¨åˆ†ã€‚å¦‚æœæˆ‘ä»¬å°†ç”¨æˆ·åœ¨æ˜ å°„è·¯ç”±æ—¶å®šä¹‰çš„<code>Handler</code>æ·»åŠ åˆ°<code>c.handlers</code>åˆ—è¡¨ä¸­ï¼Œç»“æœä¼šæ€ä¹ˆæ ·å‘¢ï¼Ÿæƒ³å¿…ä½ å·²ç»çŒœåˆ°äº†ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">A</span><span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">part1</span>
	<span class="nx">c</span><span class="p">.</span><span class="nf">Next</span><span class="p">()</span>
	<span class="nx">part2</span>
<span class="p">}</span>
<span class="kd">func</span> <span class="nf">B</span><span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">part3</span>
	<span class="nx">c</span><span class="p">.</span><span class="nf">Next</span><span class="p">()</span>
	<span class="nx">part4</span>
<span class="p">}</span>
</code></pre></div><p>å‡è®¾æˆ‘ä»¬åº”ç”¨äº†ä¸­é—´ä»¶ A å’Œ Bï¼Œå’Œè·¯ç”±æ˜ å°„çš„ Handlerã€‚<code>c.handlers</code>æ˜¯è¿™æ ·çš„[A, B, Handler]ï¼Œ<code>c.index</code>åˆå§‹åŒ–ä¸º-1ã€‚è°ƒç”¨<code>c.Next()</code>ï¼Œæ¥ä¸‹æ¥çš„æµç¨‹æ˜¯è¿™æ ·çš„ï¼š</p>
<ul>
<li>c.index++ï¼Œc.index å˜ä¸º 0</li>
<li>0 &lt; 3ï¼Œè°ƒç”¨ c.handlers[0]ï¼Œå³ A</li>
<li>æ‰§è¡Œ part1ï¼Œè°ƒç”¨ c.Next()</li>
<li>c.index++ï¼Œc.index å˜ä¸º 1</li>
<li>1 &lt; 3ï¼Œè°ƒç”¨ c.handlers[1]ï¼Œå³ B</li>
<li>æ‰§è¡Œ part3ï¼Œè°ƒç”¨ c.Next()</li>
<li>c.index++ï¼Œc.index å˜ä¸º 2</li>
<li>2 &lt; 3ï¼Œè°ƒç”¨ c.handlers[2]ï¼Œå³Handler</li>
<li>Handler è°ƒç”¨å®Œæ¯•ï¼Œè¿”å›åˆ° B ä¸­çš„ part4ï¼Œæ‰§è¡Œ part4</li>
<li>part4 æ‰§è¡Œå®Œæ¯•ï¼Œè¿”å›åˆ° A ä¸­çš„ part2ï¼Œæ‰§è¡Œ part2</li>
<li>part2 æ‰§è¡Œå®Œæ¯•ï¼Œç»“æŸã€‚</li>
</ul>
<p>ä¸€å¥è¯è¯´æ¸…æ¥šé‡ç‚¹ï¼Œæœ€ç»ˆçš„é¡ºåºæ˜¯<code>part1 -&gt; part3 -&gt; Handler -&gt; part 4 -&gt; part2</code>ã€‚æ°æ°æ»¡è¶³äº†æˆ‘ä»¬å¯¹ä¸­é—´ä»¶çš„è¦æ±‚ï¼Œæ¥ä¸‹æ¥çœ‹è°ƒç”¨éƒ¨åˆ†çš„ä»£ç ï¼Œå°±èƒ½å…¨éƒ¨ä¸²èµ·æ¥äº†ã€‚</p>
<h3 id="ä»£ç å®ç°">ä»£ç å®ç°</h3>
<ul>
<li>å®šä¹‰<code>Use</code>å‡½æ•°ï¼Œå°†ä¸­é—´ä»¶åº”ç”¨åˆ°æŸä¸ª Group ã€‚</li>
</ul>
<p>gee.go</p>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="p">(</span><span class="nx">group</span> <span class="o">*</span><span class="nx">RouterGroup</span><span class="p">)</span> <span class="nf">Use</span><span class="p">(</span><span class="nx">middlewares</span> <span class="o">...</span><span class="nx">HandlerFunc</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">group</span><span class="p">.</span><span class="nx">middlewares</span> <span class="p">=</span> <span class="nb">append</span><span class="p">(</span><span class="nx">group</span><span class="p">.</span><span class="nx">middlewares</span><span class="p">,</span> <span class="nx">middlewares</span><span class="o">...</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">engine</span> <span class="o">*</span><span class="nx">Engine</span><span class="p">)</span> <span class="nf">ServeHTTP</span><span class="p">(</span><span class="nx">w</span> <span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span> <span class="nx">req</span> <span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span> <span class="p">{</span>
	<span class="kd">var</span> <span class="nx">middlewares</span> <span class="p">[]</span><span class="nx">HandlerFunc</span>
	<span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">group</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">engine</span><span class="p">.</span><span class="nx">groups</span> <span class="p">{</span>
		<span class="k">if</span> <span class="nx">strings</span><span class="p">.</span><span class="nf">HasPrefix</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">URL</span><span class="p">.</span><span class="nx">Path</span><span class="p">,</span> <span class="nx">group</span><span class="p">.</span><span class="nx">prefix</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">middlewares</span> <span class="p">=</span> <span class="nb">append</span><span class="p">(</span><span class="nx">middlewares</span><span class="p">,</span> <span class="nx">group</span><span class="p">.</span><span class="nx">middlewares</span><span class="o">...</span><span class="p">)</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="nx">c</span> <span class="o">:=</span> <span class="nf">newContext</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span> <span class="nx">req</span><span class="p">)</span>
	<span class="nx">c</span><span class="p">.</span><span class="nx">handlers</span> <span class="p">=</span> <span class="nx">middlewares</span>
	<span class="nx">engine</span><span class="p">.</span><span class="nx">router</span><span class="p">.</span><span class="nf">handle</span><span class="p">(</span><span class="nx">c</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div><p>ServeHTTP å‡½æ•°ä¹Ÿæœ‰å˜åŒ–ï¼Œå½“æˆ‘ä»¬æ¥æ”¶åˆ°ä¸€ä¸ªå…·ä½“è¯·æ±‚æ—¶ï¼Œè¦åˆ¤æ–­è¯¥è¯·æ±‚é€‚ç”¨äºå“ªäº›ä¸­é—´ä»¶ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬ç®€å•é€šè¿‡ URL çš„å‰ç¼€æ¥åˆ¤æ–­ã€‚å¾—åˆ°ä¸­é—´ä»¶åˆ—è¡¨åï¼Œèµ‹å€¼ç»™ <code>c.handlers</code>ã€‚</p>
<ul>
<li>handle å‡½æ•°ä¸­ï¼Œå°†ä»è·¯ç”±åŒ¹é…å¾—åˆ°çš„ Handler æ·»åŠ åˆ° <code>c.handlers</code>åˆ—è¡¨ä¸­ï¼Œæ‰§è¡Œ<code>c.Next()</code>ã€‚</li>
</ul>
<p>router.go</p>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="p">(</span><span class="nx">r</span> <span class="o">*</span><span class="nx">router</span><span class="p">)</span> <span class="nf">handle</span><span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">n</span><span class="p">,</span> <span class="nx">params</span> <span class="o">:=</span> <span class="nx">r</span><span class="p">.</span><span class="nf">getRoute</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">Method</span><span class="p">,</span> <span class="nx">c</span><span class="p">.</span><span class="nx">Path</span><span class="p">)</span>

	<span class="k">if</span> <span class="nx">n</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
		<span class="nx">key</span> <span class="o">:=</span> <span class="nx">c</span><span class="p">.</span><span class="nx">Method</span> <span class="o">+</span> <span class="s">&#34;-&#34;</span> <span class="o">+</span> <span class="nx">n</span><span class="p">.</span><span class="nx">pattern</span>
		<span class="nx">c</span><span class="p">.</span><span class="nx">Params</span> <span class="p">=</span> <span class="nx">params</span>
		<span class="nx">c</span><span class="p">.</span><span class="nx">handlers</span> <span class="p">=</span> <span class="nb">append</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">handlers</span><span class="p">,</span> <span class="nx">r</span><span class="p">.</span><span class="nx">handlers</span><span class="p">[</span><span class="nx">key</span><span class="p">])</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="nx">c</span><span class="p">.</span><span class="nx">handlers</span> <span class="p">=</span> <span class="nb">append</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">handlers</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">c</span><span class="p">.</span><span class="nf">String</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusNotFound</span><span class="p">,</span> <span class="s">&#34;404 NOT FOUND: %sn&#34;</span><span class="p">,</span> <span class="nx">c</span><span class="p">.</span><span class="nx">Path</span><span class="p">)</span>
		<span class="p">})</span>
	<span class="p">}</span>
	<span class="nx">c</span><span class="p">.</span><span class="nf">Next</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div><p>context.go</p>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">Context</span><span class="p">)</span> <span class="nf">Fail</span><span class="p">(</span><span class="nx">code</span> <span class="kt">int</span><span class="p">,</span> <span class="nx">err</span> <span class="kt">string</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">c</span><span class="p">.</span><span class="nx">index</span> <span class="p">=</span> <span class="nb">len</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">handlers</span><span class="p">)</span>
	<span class="nx">c</span><span class="p">.</span><span class="nf">JSON</span><span class="p">(</span><span class="nx">code</span><span class="p">,</span> <span class="nx">H</span><span class="p">{</span><span class="s">&#34;message&#34;</span><span class="p">:</span> <span class="nx">err</span><span class="p">})</span>
<span class="p">}</span>
</code></pre></div><h3 id="ä½¿ç”¨-demo-1">ä½¿ç”¨ Demo</h3>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">onlyForV2</span><span class="p">()</span> <span class="nx">gee</span><span class="p">.</span><span class="nx">HandlerFunc</span> <span class="p">{</span>
	<span class="k">return</span> <span class="kd">func</span><span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">gee</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>

		<span class="nx">t</span> <span class="o">:=</span> <span class="nx">time</span><span class="p">.</span><span class="nf">Now</span><span class="p">()</span>

		<span class="nx">c</span><span class="p">.</span><span class="nf">Fail</span><span class="p">(</span><span class="mi">500</span><span class="p">,</span> <span class="s">&#34;Internal Server Error&#34;</span><span class="p">)</span>

		<span class="nx">log</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;[%d] %s in %v for group v2&#34;</span><span class="p">,</span> <span class="nx">c</span><span class="p">.</span><span class="nx">StatusCode</span><span class="p">,</span> <span class="nx">c</span><span class="p">.</span><span class="nx">Req</span><span class="p">.</span><span class="nx">RequestURI</span><span class="p">,</span> <span class="nx">time</span><span class="p">.</span><span class="nf">Since</span><span class="p">(</span><span class="nx">t</span><span class="p">))</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="nx">r</span> <span class="o">:=</span> <span class="nx">gee</span><span class="p">.</span><span class="nf">New</span><span class="p">()</span>
	<span class="nx">r</span><span class="p">.</span><span class="nf">Use</span><span class="p">(</span><span class="nx">gee</span><span class="p">.</span><span class="nf">Logger</span><span class="p">())</span>
	<span class="nx">r</span><span class="p">.</span><span class="nf">GET</span><span class="p">(</span><span class="s">&#34;/&#34;</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">gee</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
		<span class="nx">c</span><span class="p">.</span><span class="nf">HTML</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">,</span> <span class="s">&#34;&lt;h1&gt;Hello Gee&lt;/h1&gt;&#34;</span><span class="p">)</span>
	<span class="p">})</span>

	<span class="nx">v2</span> <span class="o">:=</span> <span class="nx">r</span><span class="p">.</span><span class="nf">Group</span><span class="p">(</span><span class="s">&#34;/v2&#34;</span><span class="p">)</span>
	<span class="nx">v2</span><span class="p">.</span><span class="nf">Use</span><span class="p">(</span><span class="nf">onlyForV2</span><span class="p">())</span>
	<span class="p">{</span>
		<span class="nx">v2</span><span class="p">.</span><span class="nf">GET</span><span class="p">(</span><span class="s">&#34;/hello/:name&#34;</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">gee</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>

			<span class="nx">c</span><span class="p">.</span><span class="nf">String</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">,</span> <span class="s">&#34;hello %s, you&#39;re at %sn&#34;</span><span class="p">,</span> <span class="nx">c</span><span class="p">.</span><span class="nf">Param</span><span class="p">(</span><span class="s">&#34;name&#34;</span><span class="p">),</span> <span class="nx">c</span><span class="p">.</span><span class="nx">Path</span><span class="p">)</span>
		<span class="p">})</span>
	<span class="p">}</span>

	<span class="nx">r</span><span class="p">.</span><span class="nf">Run</span><span class="p">(</span><span class="s">&#34;:9999&#34;</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div><p><code>gee.Logger()</code>å³æˆ‘ä»¬ä¸€å¼€å§‹å°±ä»‹ç»çš„ä¸­é—´ä»¶ï¼Œæˆ‘ä»¬å°†è¿™ä¸ªä¸­é—´ä»¶å’Œæ¡†æ¶ä»£ç æ”¾åœ¨äº†ä¸€èµ·ï¼Œä½œä¸ºæ¡†æ¶é»˜è®¤æä¾›çš„ä¸­é—´ä»¶ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å°†<code>gee.Logger()</code>åº”ç”¨åœ¨äº†å…¨å±€ï¼Œæ‰€æœ‰çš„è·¯ç”±éƒ½ä¼šåº”ç”¨è¯¥ä¸­é—´ä»¶ã€‚<code>onlyForV2()</code>æ˜¯ç”¨æ¥æµ‹è¯•åŠŸèƒ½çš„ï¼Œä»…åœ¨<code>v2</code>å¯¹åº”çš„ Group ä¸­åº”ç”¨äº†ã€‚</p>
<p>æ¥ä¸‹æ¥ä½¿ç”¨ curl æµ‹è¯•ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œv2 Group 2ä¸ªä¸­é—´ä»¶éƒ½ç”Ÿæ•ˆäº†ã€‚</p>
<pre><code>$ curl http://localhost:9999/  
&gt;&gt;&gt; log  
2019/08/17 01:37:38 [200] / in 3.14Âµs  
  
(2) global + group middleware  
$ curl http://localhost:9999/v2/hello/geektutu  
&gt;&gt;&gt; log  
2019/08/17 01:38:48 [500] /v2/hello/geektutu in 61.467Âµs for group v2  
2019/08/17 01:38:48 [200] /v2/hello/geektutu in 281Âµs  
</code></pre><h2 id="æ¨¡æ¿html-template">æ¨¡æ¿(HTML Template)</h2>
<ul>
<li>å®ç°é™æ€èµ„æºæœåŠ¡(Static Resource)ã€‚</li>
<li>æ”¯æŒHTMLæ¨¡æ¿æ¸²æŸ“ã€‚</li>
</ul>
<h3 id="æœåŠ¡ç«¯æ¸²æŸ“">æœåŠ¡ç«¯æ¸²æŸ“</h3>
<p>ç°åœ¨è¶Šæ¥è¶Šæµè¡Œå‰åç«¯åˆ†ç¦»çš„å¼€å‘æ¨¡å¼ï¼Œå³ Web åç«¯æä¾› RESTful æ¥å£ï¼Œè¿”å›ç»“æ„åŒ–çš„æ•°æ®(é€šå¸¸ä¸º JSON æˆ–è€… XML)ã€‚å‰ç«¯ä½¿ç”¨ AJAX æŠ€æœ¯è¯·æ±‚åˆ°æ‰€éœ€çš„æ•°æ®ï¼Œåˆ©ç”¨ JavaScript è¿›è¡Œæ¸²æŸ“ã€‚Vue/React ç­‰å‰ç«¯æ¡†æ¶æŒç»­ç«çƒ­ï¼Œè¿™ç§å¼€å‘æ¨¡å¼å‰åç«¯è§£è€¦ï¼Œä¼˜åŠ¿éå¸¸çªå‡ºã€‚åç«¯ç«¥é‹ä¸“å¿ƒè§£å†³èµ„æºåˆ©ç”¨ï¼Œå¹¶å‘ï¼Œæ•°æ®åº“ç­‰é—®é¢˜ï¼Œåªéœ€è¦è€ƒè™‘æ•°æ®å¦‚ä½•ç”Ÿæˆï¼›å‰ç«¯ç«¥é‹ä¸“æ³¨äºç•Œé¢è®¾è®¡å®ç°ï¼Œåªéœ€è¦è€ƒè™‘æ‹¿åˆ°æ•°æ®åå¦‚ä½•æ¸²æŸ“å³å¯ã€‚ä½¿ç”¨ JSP å†™è¿‡ç½‘ç«™çš„ç«¥é‹ï¼Œåº”è¯¥èƒ½æ„Ÿå—åˆ°å‰åç«¯è€¦åˆçš„ç—›è‹¦ã€‚JSP çš„è¡¨ç°åŠ›è‚¯å®šæ˜¯è¿œä¸å¦‚ Vue/React ç­‰ä¸“ä¸šåšå‰ç«¯æ¸²æŸ“çš„æ¡†æ¶çš„ã€‚è€Œä¸”å‰åç«¯åˆ†ç¦»åœ¨å½“å‰è¿˜æœ‰å¦å¤–ä¸€ä¸ªä¸å¯å¿½è§†çš„ä¼˜åŠ¿ã€‚å› ä¸ºåç«¯åªå…³æ³¨äºæ•°æ®ï¼Œæ¥å£è¿”å›å€¼æ˜¯ç»“æ„åŒ–çš„ï¼Œä¸å‰ç«¯è§£è€¦ã€‚åŒä¸€å¥—åç«¯æœåŠ¡èƒ½å¤ŸåŒæ—¶æ”¯æ’‘å°ç¨‹åºã€ç§»åŠ¨APPã€PCç«¯ Web é¡µé¢ï¼Œä»¥åŠå¯¹å¤–æä¾›çš„æ¥å£ã€‚éšç€å‰ç«¯å·¥ç¨‹åŒ–çš„ä¸æ–­åœ°å‘å±•ï¼ŒWebpackï¼Œgulp ç­‰å·¥å…·å±‚å‡ºä¸ç©·ï¼Œå‰ç«¯æŠ€æœ¯è¶Šæ¥è¶Šè‡ªæˆä½“ç³»äº†ã€‚</p>
<p>ä½†å‰ååˆ†ç¦»çš„ä¸€å¤§é—®é¢˜åœ¨äºï¼Œé¡µé¢æ˜¯åœ¨å®¢æˆ·ç«¯æ¸²æŸ“çš„ï¼Œæ¯”å¦‚æµè§ˆå™¨ï¼Œè¿™å¯¹äºçˆ¬è™«å¹¶ä¸å‹å¥½ã€‚Google çˆ¬è™«å·²ç»èƒ½å¤Ÿçˆ¬å–æ¸²æŸ“åçš„ç½‘é¡µï¼Œä½†æ˜¯çŸ­æœŸå†…çˆ¬å–æœåŠ¡ç«¯ç›´æ¥æ¸²æŸ“çš„ HTML é¡µé¢ä»æ˜¯ä¸»æµã€‚</p>
<p>ä»Šå¤©çš„å†…å®¹ä¾¿æ˜¯ä»‹ç» Web æ¡†æ¶å¦‚ä½•æ”¯æŒæœåŠ¡ç«¯æ¸²æŸ“çš„åœºæ™¯ã€‚</p>
<h3 id="é™æ€æ–‡ä»¶serve-static-files">é™æ€æ–‡ä»¶(Serve Static Files)</h3>
<p>ç½‘é¡µçš„ä¸‰å‰‘å®¢ï¼ŒJavaScriptã€CSS å’Œ HTMLã€‚è¦åšåˆ°æœåŠ¡ç«¯æ¸²æŸ“ï¼Œç¬¬ä¸€æ­¥ä¾¿æ˜¯è¦æ”¯æŒ JSã€CSS ç­‰é™æ€æ–‡ä»¶ã€‚è¿˜è®°å¾—æˆ‘ä»¬ä¹‹å‰è®¾è®¡åŠ¨æ€è·¯ç”±çš„æ—¶å€™ï¼Œæ”¯æŒé€šé…ç¬¦<code>*</code>åŒ¹é…å¤šçº§å­è·¯å¾„ã€‚æ¯”å¦‚è·¯ç”±è§„åˆ™<code>/assets/*filepath</code>ï¼Œå¯ä»¥åŒ¹é…<code>/assets/</code>å¼€å¤´çš„æ‰€æœ‰çš„åœ°å€ã€‚ä¾‹å¦‚<code>/assets/js/geektutu.js</code>ï¼ŒåŒ¹é…åï¼Œå‚æ•°<code>filepath</code>å°±èµ‹å€¼ä¸º<code>js/geektutu.js</code>ã€‚</p>
<p>æ‰¾åˆ°æ–‡ä»¶åï¼Œå¦‚ä½•è¿”å›è¿™ä¸€æ­¥ï¼Œ<code>net/http</code>åº“å·²ç»å®ç°äº†ã€‚å› æ­¤ï¼Œgee æ¡†æ¶è¦åšçš„ï¼Œä»…ä»…æ˜¯è§£æè¯·æ±‚çš„åœ°å€ï¼Œæ˜ å°„åˆ°æœåŠ¡å™¨ä¸Šæ–‡ä»¶çš„çœŸå®åœ°å€ï¼Œäº¤ç»™<code>http.FileServer</code>å¤„ç†å°±å¥½äº†ã€‚</p>
<h5 id="geego-1">gee.go</h5>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="c1">// create static handler
</span><span class="c1"></span><span class="kd">func</span> <span class="p">(</span><span class="nx">group</span> <span class="o">*</span><span class="nx">RouterGroup</span><span class="p">)</span> <span class="nf">createStaticHandler</span><span class="p">(</span><span class="nx">relativePath</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">fs</span> <span class="nx">http</span><span class="p">.</span><span class="nx">FileSystem</span><span class="p">)</span> <span class="nx">HandlerFunc</span> <span class="p">{</span>
	<span class="nx">absolutePath</span> <span class="o">:=</span> <span class="nx">path</span><span class="p">.</span><span class="nf">Join</span><span class="p">(</span><span class="nx">group</span><span class="p">.</span><span class="nx">prefix</span><span class="p">,</span> <span class="nx">relativePath</span><span class="p">)</span>
	<span class="nx">fileServer</span> <span class="o">:=</span> <span class="nx">http</span><span class="p">.</span><span class="nf">StripPrefix</span><span class="p">(</span><span class="nx">absolutePath</span><span class="p">,</span> <span class="nx">http</span><span class="p">.</span><span class="nf">FileServer</span><span class="p">(</span><span class="nx">fs</span><span class="p">))</span>
	<span class="k">return</span> <span class="kd">func</span><span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
		<span class="nx">file</span> <span class="o">:=</span> <span class="nx">c</span><span class="p">.</span><span class="nf">Param</span><span class="p">(</span><span class="s">&#34;filepath&#34;</span><span class="p">)</span>
		<span class="c1">// Check if file exists and/or if we have permission to access it
</span><span class="c1"></span>		<span class="k">if</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">fs</span><span class="p">.</span><span class="nf">Open</span><span class="p">(</span><span class="nx">file</span><span class="p">);</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
			<span class="nx">c</span><span class="p">.</span><span class="nf">Status</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusNotFound</span><span class="p">)</span>
			<span class="k">return</span>
		<span class="p">}</span>

		<span class="nx">fileServer</span><span class="p">.</span><span class="nf">ServeHTTP</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">Writer</span><span class="p">,</span> <span class="nx">c</span><span class="p">.</span><span class="nx">Req</span><span class="p">)</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="c1">// serve static files
</span><span class="c1"></span><span class="kd">func</span> <span class="p">(</span><span class="nx">group</span> <span class="o">*</span><span class="nx">RouterGroup</span><span class="p">)</span> <span class="nf">Static</span><span class="p">(</span><span class="nx">relativePath</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">root</span> <span class="kt">string</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">handler</span> <span class="o">:=</span> <span class="nx">group</span><span class="p">.</span><span class="nf">createStaticHandler</span><span class="p">(</span><span class="nx">relativePath</span><span class="p">,</span> <span class="nx">http</span><span class="p">.</span><span class="nf">Dir</span><span class="p">(</span><span class="nx">root</span><span class="p">))</span>
	<span class="nx">urlPattern</span> <span class="o">:=</span> <span class="nx">path</span><span class="p">.</span><span class="nf">Join</span><span class="p">(</span><span class="nx">relativePath</span><span class="p">,</span> <span class="s">&#34;/*filepath&#34;</span><span class="p">)</span>
	<span class="c1">// Register GET handlers
</span><span class="c1"></span>	<span class="nx">group</span><span class="p">.</span><span class="nf">GET</span><span class="p">(</span><span class="nx">urlPattern</span><span class="p">,</span> <span class="nx">handler</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div><p>æˆ‘ä»¬ç»™RouterGroupæ·»åŠ äº†2ä¸ªæ–¹æ³•ï¼ŒStaticè¿™ä¸ªæ–¹æ³•æ˜¯æš´éœ²ç»™ç”¨æˆ·çš„ã€‚ç”¨æˆ·å¯ä»¥å°†ç£ç›˜ä¸Šçš„æŸä¸ªæ–‡ä»¶å¤¹rootæ˜ å°„åˆ°è·¯ç”±relativePathã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="nx">r</span> <span class="o">:=</span> <span class="nx">gee</span><span class="p">.</span><span class="nf">New</span><span class="p">()</span>
<span class="nx">r</span><span class="p">.</span><span class="nf">Static</span><span class="p">(</span><span class="s">&#34;/assets&#34;</span><span class="p">,</span> <span class="s">&#34;/usr/geektutu/blog/static&#34;</span><span class="p">)</span>
<span class="c1">// æˆ–ç›¸å¯¹è·¯å¾„ r.Static(&#34;/assets&#34;, &#34;./static&#34;)
</span><span class="c1"></span><span class="nx">r</span><span class="p">.</span><span class="nf">Run</span><span class="p">(</span><span class="s">&#34;:9999&#34;</span><span class="p">)</span>
</code></pre></div><p>ç”¨æˆ·è®¿é—®<code>localhost:9999/assets/js/geektutu.js</code>ï¼Œæœ€ç»ˆè¿”å›<code>/usr/geektutu/blog/static/js/geektutu.js</code>ã€‚</p>
<h3 id="html-æ¨¡æ¿æ¸²æŸ“">HTML æ¨¡æ¿æ¸²æŸ“</h3>
<p>Goè¯­è¨€å†…ç½®äº†<code>text/template</code>å’Œ<code>html/template</code>2ä¸ªæ¨¡æ¿æ ‡å‡†åº“ï¼Œå…¶ä¸­<a href="https://golang.org/pkg/html/template/">html/template</a>ä¸º HTML æä¾›äº†è¾ƒä¸ºå®Œæ•´çš„æ”¯æŒã€‚åŒ…æ‹¬æ™®é€šå˜é‡æ¸²æŸ“ã€åˆ—è¡¨æ¸²æŸ“ã€å¯¹è±¡æ¸²æŸ“ç­‰ã€‚gee æ¡†æ¶çš„æ¨¡æ¿æ¸²æŸ“ç›´æ¥ä½¿ç”¨äº†<code>html/template</code>æä¾›çš„èƒ½åŠ›ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="nx">Engine</span> <span class="kd">struct</span> <span class="p">{</span>
	<span class="o">*</span><span class="nx">RouterGroup</span>
	<span class="nx">router</span>        <span class="o">*</span><span class="nx">router</span>
	<span class="nx">groups</span>        <span class="p">[]</span><span class="o">*</span><span class="nx">RouterGroup</span>     <span class="c1">// store all groups
</span><span class="c1"></span>	<span class="nx">htmlTemplates</span> <span class="o">*</span><span class="nx">template</span><span class="p">.</span><span class="nx">Template</span> <span class="c1">// for html render
</span><span class="c1"></span>	<span class="nx">funcMap</span>       <span class="nx">template</span><span class="p">.</span><span class="nx">FuncMap</span>   <span class="c1">// for html render
</span><span class="c1"></span><span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">engine</span> <span class="o">*</span><span class="nx">Engine</span><span class="p">)</span> <span class="nf">SetFuncMap</span><span class="p">(</span><span class="nx">funcMap</span> <span class="nx">template</span><span class="p">.</span><span class="nx">FuncMap</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">engine</span><span class="p">.</span><span class="nx">funcMap</span> <span class="p">=</span> <span class="nx">funcMap</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">engine</span> <span class="o">*</span><span class="nx">Engine</span><span class="p">)</span> <span class="nf">LoadHTMLGlob</span><span class="p">(</span><span class="nx">pattern</span> <span class="kt">string</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">engine</span><span class="p">.</span><span class="nx">htmlTemplates</span> <span class="p">=</span> <span class="nx">template</span><span class="p">.</span><span class="nf">Must</span><span class="p">(</span><span class="nx">template</span><span class="p">.</span><span class="nf">New</span><span class="p">(</span><span class="s">&#34;&#34;</span><span class="p">).</span><span class="nf">Funcs</span><span class="p">(</span><span class="nx">engine</span><span class="p">.</span><span class="nx">funcMap</span><span class="p">).</span><span class="nf">ParseGlob</span><span class="p">(</span><span class="nx">pattern</span><span class="p">))</span>
<span class="p">}</span>
</code></pre></div><p>é¦–å…ˆä¸º Engine ç¤ºä¾‹æ·»åŠ äº† <code>*template.Template</code> å’Œ <code>template.FuncMap</code>å¯¹è±¡ï¼Œå‰è€…å°†æ‰€æœ‰çš„æ¨¡æ¿åŠ è½½è¿›å†…å­˜ï¼Œåè€…æ˜¯æ‰€æœ‰çš„è‡ªå®šä¹‰æ¨¡æ¿æ¸²æŸ“å‡½æ•°ã€‚</p>
<p>å¦å¤–ï¼Œç»™ç”¨æˆ·åˆ†åˆ«æä¾›äº†è®¾ç½®è‡ªå®šä¹‰æ¸²æŸ“å‡½æ•°funcMapå’ŒåŠ è½½æ¨¡æ¿çš„æ–¹æ³•ã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œå¯¹åŸæ¥çš„ (*Context).HTML()æ–¹æ³•åšäº†äº›å°ä¿®æ”¹ï¼Œä½¿ä¹‹æ”¯æŒæ ¹æ®æ¨¡æ¿æ–‡ä»¶åé€‰æ‹©æ¨¡æ¿è¿›è¡Œæ¸²æŸ“ã€‚</p>
<h5 id="contextgo">context.go</h5>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">type</span> <span class="nx">Context</span> <span class="kd">struct</span> <span class="p">{</span>
    <span class="c1">// ...
</span><span class="c1"></span>	<span class="c1">// engine pointer
</span><span class="c1"></span>	<span class="nx">engine</span> <span class="o">*</span><span class="nx">Engine</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">Context</span><span class="p">)</span> <span class="nf">HTML</span><span class="p">(</span><span class="nx">code</span> <span class="kt">int</span><span class="p">,</span> <span class="nx">name</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">data</span> <span class="kd">interface</span><span class="p">{})</span> <span class="p">{</span>
	<span class="nx">c</span><span class="p">.</span><span class="nf">SetHeader</span><span class="p">(</span><span class="s">&#34;Content-Type&#34;</span><span class="p">,</span> <span class="s">&#34;text/html&#34;</span><span class="p">)</span>
	<span class="nx">c</span><span class="p">.</span><span class="nf">Status</span><span class="p">(</span><span class="nx">code</span><span class="p">)</span>
	<span class="k">if</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">c</span><span class="p">.</span><span class="nx">engine</span><span class="p">.</span><span class="nx">htmlTemplates</span><span class="p">.</span><span class="nf">ExecuteTemplate</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">Writer</span><span class="p">,</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">data</span><span class="p">);</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
		<span class="nx">c</span><span class="p">.</span><span class="nf">Fail</span><span class="p">(</span><span class="mi">500</span><span class="p">,</span> <span class="nx">err</span><span class="p">.</span><span class="nf">Error</span><span class="p">())</span>
	<span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p>æˆ‘ä»¬åœ¨ <code>Context</code> ä¸­æ·»åŠ äº†æˆå‘˜å˜é‡ <code>engine *Engine</code>ï¼Œè¿™æ ·å°±èƒ½å¤Ÿé€šè¿‡ Context è®¿é—® Engine ä¸­çš„ HTML æ¨¡æ¿ã€‚å®ä¾‹åŒ– Context æ—¶ï¼Œè¿˜éœ€è¦ç»™ <code>c.engine</code> èµ‹å€¼ã€‚</p>
<h5 id="geego-2">gee.go</h5>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">type</span> <span class="nx">student</span> <span class="kd">struct</span> <span class="p">{</span>
	<span class="nx">Name</span> <span class="kt">string</span>
	<span class="nx">Age</span>  <span class="kt">int8</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">FormatAsDate</span><span class="p">(</span><span class="nx">t</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Time</span><span class="p">)</span> <span class="kt">string</span> <span class="p">{</span>
	<span class="nx">year</span><span class="p">,</span> <span class="nx">month</span><span class="p">,</span> <span class="nx">day</span> <span class="o">:=</span> <span class="nx">t</span><span class="p">.</span><span class="nf">Date</span><span class="p">()</span>
	<span class="k">return</span> <span class="nx">fmt</span><span class="p">.</span><span class="nf">Sprintf</span><span class="p">(</span><span class="s">&#34;%d-%02d-%02d&#34;</span><span class="p">,</span> <span class="nx">year</span><span class="p">,</span> <span class="nx">month</span><span class="p">,</span> <span class="nx">day</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div><p>ä½¿ç”¨Demo
æœ€ç»ˆçš„ç›®å½•ç»“æ„</p>
<pre><code>---gee/
---static/
   |---css/
        |---geektutu.css
   |---file1.txt
---templates/
   |---arr.tmpl
   |---css.tmpl
   |---custom_func.tmpl
---main.go
</code></pre><div class="highlight"><pre class="chroma"><code class="language-html" data-lang="html"><span class="c">&lt;!-- templates/css.tmpl --&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&#34;stylesheet&#34;</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;/assets/css/geektutu.css&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>geektutu.css is loaded<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre></div><h5 id="maingo-2">main.go</h5>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="nx">r</span> <span class="o">:=</span> <span class="nx">gee</span><span class="p">.</span><span class="nf">New</span><span class="p">()</span>
	<span class="nx">r</span><span class="p">.</span><span class="nf">Use</span><span class="p">(</span><span class="nx">gee</span><span class="p">.</span><span class="nf">Logger</span><span class="p">())</span>
	<span class="nx">r</span><span class="p">.</span><span class="nf">SetFuncMap</span><span class="p">(</span><span class="nx">template</span><span class="p">.</span><span class="nx">FuncMap</span><span class="p">{</span>
		<span class="s">&#34;FormatAsDate&#34;</span><span class="p">:</span> <span class="nx">FormatAsDate</span><span class="p">,</span>
	<span class="p">})</span>
	<span class="nx">r</span><span class="p">.</span><span class="nf">LoadHTMLGlob</span><span class="p">(</span><span class="s">&#34;templates/*&#34;</span><span class="p">)</span>
	<span class="nx">r</span><span class="p">.</span><span class="nf">Static</span><span class="p">(</span><span class="s">&#34;/assets&#34;</span><span class="p">,</span> <span class="s">&#34;./static&#34;</span><span class="p">)</span>

	<span class="nx">stu1</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="nx">student</span><span class="p">{</span><span class="nx">Name</span><span class="p">:</span> <span class="s">&#34;Geektutu&#34;</span><span class="p">,</span> <span class="nx">Age</span><span class="p">:</span> <span class="mi">20</span><span class="p">}</span>
	<span class="nx">stu2</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="nx">student</span><span class="p">{</span><span class="nx">Name</span><span class="p">:</span> <span class="s">&#34;Jack&#34;</span><span class="p">,</span> <span class="nx">Age</span><span class="p">:</span> <span class="mi">22</span><span class="p">}</span>
	<span class="nx">r</span><span class="p">.</span><span class="nf">GET</span><span class="p">(</span><span class="s">&#34;/&#34;</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">gee</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
		<span class="nx">c</span><span class="p">.</span><span class="nf">HTML</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">,</span> <span class="s">&#34;css.tmpl&#34;</span><span class="p">,</span> <span class="kc">nil</span><span class="p">)</span>
	<span class="p">})</span>
	<span class="nx">r</span><span class="p">.</span><span class="nf">GET</span><span class="p">(</span><span class="s">&#34;/students&#34;</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">gee</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
		<span class="nx">c</span><span class="p">.</span><span class="nf">HTML</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">,</span> <span class="s">&#34;arr.tmpl&#34;</span><span class="p">,</span> <span class="nx">gee</span><span class="p">.</span><span class="nx">H</span><span class="p">{</span>
			<span class="s">&#34;title&#34;</span><span class="p">:</span>  <span class="s">&#34;gee&#34;</span><span class="p">,</span>
			<span class="s">&#34;stuArr&#34;</span><span class="p">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="nx">student</span><span class="p">{</span><span class="nx">stu1</span><span class="p">,</span> <span class="nx">stu2</span><span class="p">},</span>
		<span class="p">})</span>
	<span class="p">})</span>

	<span class="nx">r</span><span class="p">.</span><span class="nf">GET</span><span class="p">(</span><span class="s">&#34;/date&#34;</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">gee</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
		<span class="nx">c</span><span class="p">.</span><span class="nf">HTML</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">,</span> <span class="s">&#34;custom_func.tmpl&#34;</span><span class="p">,</span> <span class="nx">gee</span><span class="p">.</span><span class="nx">H</span><span class="p">{</span>
			<span class="s">&#34;title&#34;</span><span class="p">:</span> <span class="s">&#34;gee&#34;</span><span class="p">,</span>
			<span class="s">&#34;now&#34;</span><span class="p">:</span>   <span class="nx">time</span><span class="p">.</span><span class="nf">Date</span><span class="p">(</span><span class="mi">2019</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">time</span><span class="p">.</span><span class="nx">UTC</span><span class="p">),</span>
		<span class="p">})</span>
	<span class="p">})</span>

	<span class="nx">r</span><span class="p">.</span><span class="nf">Run</span><span class="p">(</span><span class="s">&#34;:9999&#34;</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div><p>è®¿é—®ä¸‹ä¸»é¡µï¼Œæ¨¡æ¿æ­£å¸¸æ¸²æŸ“ï¼ŒCSS é™æ€æ–‡ä»¶åŠ è½½æˆåŠŸã€‚</p>
<p><img src="https://geektutu.com/post/gee-day6/static.jpg" alt="demo"></p>
<h2 id="é”™è¯¯æ¢å¤panic-recover">é”™è¯¯æ¢å¤(Panic Recover)</h2>
<ul>
<li>å®ç°é”™è¯¯å¤„ç†æœºåˆ¶ã€‚</li>
</ul>
<h3 id="panic">panic</h3>
<p>Go è¯­è¨€ä¸­ï¼Œæ¯”è¾ƒå¸¸è§çš„é”™è¯¯å¤„ç†æ–¹æ³•æ˜¯è¿”å› errorï¼Œç”±è°ƒç”¨è€…å†³å®šåç»­å¦‚ä½•å¤„ç†ã€‚ä½†æ˜¯å¦‚æœæ˜¯æ— æ³•æ¢å¤çš„é”™è¯¯ï¼Œå¯ä»¥æ‰‹åŠ¨è§¦å‘ panicï¼Œå½“ç„¶å¦‚æœåœ¨ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­å‡ºç°äº†ç±»ä¼¼äºæ•°ç»„è¶Šç•Œçš„é”™è¯¯ï¼Œpanic ä¹Ÿä¼šè¢«è§¦å‘ã€‚panic ä¼šä¸­æ­¢å½“å‰æ‰§è¡Œçš„ç¨‹åºï¼Œé€€å‡ºã€‚</p>
<p>ä¸‹é¢æ˜¯ä¸»åŠ¨è§¦å‘çš„ä¾‹å­ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="c1">// hello.go
</span><span class="c1"></span><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;before panic&#34;</span><span class="p">)</span>
	<span class="nb">panic</span><span class="p">(</span><span class="s">&#34;crash&#34;</span><span class="p">)</span>
	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;after panic&#34;</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div><pre><code>$ go run hello.go

before panic
panic: crash

goroutine 1 [running]:
main.main()
        ~/go_demo/hello/hello.go:7 +0x95
exit status 2
</code></pre><p>ä¸‹é¢æ˜¯æ•°ç»„è¶Šç•Œè§¦å‘çš„ panic</p>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="c1">// hello.go
</span><span class="c1"></span><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="nx">arr</span> <span class="o">:=</span> <span class="p">[]</span><span class="kt">int</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">}</span>
	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">arr</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
<span class="p">}</span>
</code></pre></div><pre><code>$ go run hello.go
panic: runtime error: index out of range [4] with length 3
</code></pre><h3 id="defer">defer</h3>
<p>panic ä¼šå¯¼è‡´ç¨‹åºè¢«ä¸­æ­¢ï¼Œä½†æ˜¯åœ¨é€€å‡ºå‰ï¼Œä¼šå…ˆå¤„ç†å®Œå½“å‰åç¨‹ä¸Šå·²ç»defer çš„ä»»åŠ¡ï¼Œæ‰§è¡Œå®Œæˆåå†é€€å‡ºã€‚æ•ˆæœç±»ä¼¼äº java è¯­è¨€çš„ try&hellip;catchã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="c1">// hello.go
</span><span class="c1"></span><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="k">defer</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;defer func&#34;</span><span class="p">)</span>
	<span class="p">}()</span>

	<span class="nx">arr</span> <span class="o">:=</span> <span class="p">[]</span><span class="kt">int</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">}</span>
	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">arr</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
<span class="p">}</span>
</code></pre></div><pre><code>$ go run hello.go 
defer func
panic: runtime error: index out of range [4] with length 3
</code></pre><p>å¯ä»¥ defer å¤šä¸ªä»»åŠ¡ï¼Œåœ¨åŒä¸€ä¸ªå‡½æ•°ä¸­ defer å¤šä¸ªä»»åŠ¡ï¼Œä¼šé€†åºæ‰§è¡Œã€‚å³å…ˆæ‰§è¡Œæœ€å defer çš„ä»»åŠ¡ã€‚</p>
<p>åœ¨è¿™é‡Œï¼Œdefer çš„ä»»åŠ¡æ‰§è¡Œå®Œæˆä¹‹åï¼Œpanic è¿˜ä¼šç»§ç»­è¢«æŠ›å‡ºï¼Œå¯¼è‡´ç¨‹åºéæ­£å¸¸ç»“æŸã€‚</p>
<h3 id="recover">recover</h3>
<p>Go è¯­è¨€è¿˜æä¾›äº† recover å‡½æ•°ï¼Œå¯ä»¥é¿å…å› ä¸º panic å‘ç”Ÿè€Œå¯¼è‡´æ•´ä¸ªç¨‹åºç»ˆæ­¢ï¼Œrecover å‡½æ•°åªåœ¨ defer ä¸­ç”Ÿæ•ˆã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="c1">// hello.go
</span><span class="c1"></span><span class="kd">func</span> <span class="nf">test_recover</span><span class="p">()</span> <span class="p">{</span>
	<span class="k">defer</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;defer func&#34;</span><span class="p">)</span>
		<span class="k">if</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nb">recover</span><span class="p">();</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
			<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;recover success&#34;</span><span class="p">)</span>
		<span class="p">}</span>
	<span class="p">}()</span>

	<span class="nx">arr</span> <span class="o">:=</span> <span class="p">[]</span><span class="kt">int</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">}</span>
	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">arr</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;after panic&#34;</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="nf">test_recover</span><span class="p">()</span>
	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;after recover&#34;</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div><pre><code>$ go run hello.go 
defer func
recover success
after recover
</code></pre><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œrecover æ•è·äº† panicï¼Œç¨‹åºæ­£å¸¸ç»“æŸã€‚test_recover() ä¸­çš„ after panic æ²¡æœ‰æ‰“å°ï¼Œè¿™æ˜¯æ­£ç¡®çš„ï¼Œå½“ panic è¢«è§¦å‘æ—¶ï¼Œæ§åˆ¶æƒå°±è¢«äº¤ç»™äº† defer ã€‚å°±åƒåœ¨ java ä¸­ï¼Œtryä»£ç å—ä¸­å‘ç”Ÿäº†å¼‚å¸¸ï¼Œæ§åˆ¶æƒäº¤ç»™äº† catchï¼Œæ¥ä¸‹æ¥æ‰§è¡Œ catch ä»£ç å—ä¸­çš„ä»£ç ã€‚è€Œåœ¨ main() ä¸­æ‰“å°äº† after recoverï¼Œè¯´æ˜ç¨‹åºå·²ç»æ¢å¤æ­£å¸¸ï¼Œç»§ç»­å¾€ä¸‹æ‰§è¡Œç›´åˆ°ç»“æŸã€‚</p>
<h3 id="gee-çš„é”™è¯¯å¤„ç†æœºåˆ¶">Gee çš„é”™è¯¯å¤„ç†æœºåˆ¶</h3>
<p>å¯¹ä¸€ä¸ª Web æ¡†æ¶è€Œè¨€ï¼Œé”™è¯¯å¤„ç†æœºåˆ¶æ˜¯éå¸¸å¿…è¦çš„ã€‚å¯èƒ½æ˜¯æ¡†æ¶æœ¬èº«æ²¡æœ‰å®Œå¤‡çš„æµ‹è¯•ï¼Œå¯¼è‡´åœ¨æŸäº›æƒ…å†µä¸‹å‡ºç°ç©ºæŒ‡é’ˆå¼‚å¸¸ç­‰æƒ…å†µã€‚ä¹Ÿæœ‰å¯èƒ½ç”¨æˆ·ä¸æ­£ç¡®çš„å‚æ•°ï¼Œè§¦å‘äº†æŸäº›å¼‚å¸¸ï¼Œä¾‹å¦‚æ•°ç»„è¶Šç•Œï¼Œç©ºæŒ‡é’ˆç­‰ã€‚å¦‚æœå› ä¸ºè¿™äº›åŸå› å¯¼è‡´ç³»ç»Ÿå®•æœºï¼Œå¿…ç„¶æ˜¯ä¸å¯æ¥å—çš„ã€‚</p>
<p>æˆ‘ä»¬åœ¨ç¬¬å…­å¤©å®ç°çš„æ¡†æ¶å¹¶æ²¡æœ‰åŠ å…¥å¼‚å¸¸å¤„ç†æœºåˆ¶ï¼Œå¦‚æœä»£ç ä¸­å­˜åœ¨ä¼šè§¦å‘ panic çš„ BUGï¼Œå¾ˆå®¹æ˜“å®•æ‰ã€‚</p>
<p>ä¾‹å¦‚ä¸‹é¢çš„ä»£ç ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="nx">r</span> <span class="o">:=</span> <span class="nx">gee</span><span class="p">.</span><span class="nf">New</span><span class="p">()</span>
	<span class="nx">r</span><span class="p">.</span><span class="nf">GET</span><span class="p">(</span><span class="s">&#34;/panic&#34;</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">gee</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
		<span class="nx">names</span> <span class="o">:=</span> <span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&#34;geektutu&#34;</span><span class="p">}</span>
		<span class="nx">c</span><span class="p">.</span><span class="nf">String</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">,</span> <span class="nx">names</span><span class="p">[</span><span class="mi">100</span><span class="p">])</span>
	<span class="p">})</span>
	<span class="nx">r</span><span class="p">.</span><span class="nf">Run</span><span class="p">(</span><span class="s">&#34;:9999&#34;</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div><p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬ä¸º gee æ³¨å†Œäº†è·¯ç”± /panicï¼Œè€Œè¿™ä¸ªè·¯ç”±çš„å¤„ç†å‡½æ•°å†…éƒ¨å­˜åœ¨æ•°ç»„è¶Šç•Œ names[100]ï¼Œå¦‚æœè®¿é—® localhost:9999/panicï¼ŒWeb æœåŠ¡å°±ä¼šå®•æ‰ã€‚</p>
<p>ä»Šå¤©ï¼Œæˆ‘ä»¬å°†åœ¨ gee ä¸­æ·»åŠ ä¸€ä¸ªéå¸¸ç®€å•çš„é”™è¯¯å¤„ç†æœºåˆ¶ï¼Œå³åœ¨æ­¤ç±»é”™è¯¯å‘ç”Ÿæ—¶ï¼Œå‘ç”¨æˆ·è¿”å› Internal Server Errorï¼Œå¹¶ä¸”åœ¨æ—¥å¿—ä¸­æ‰“å°å¿…è¦çš„é”™è¯¯ä¿¡æ¯ï¼Œæ–¹ä¾¿è¿›è¡Œé”™è¯¯å®šä½ã€‚</p>
<p>æˆ‘ä»¬ä¹‹å‰å®ç°äº†ä¸­é—´ä»¶æœºåˆ¶ï¼Œé”™è¯¯å¤„ç†ä¹Ÿå¯ä»¥ä½œä¸ºä¸€ä¸ªä¸­é—´ä»¶ï¼Œå¢å¼º gee æ¡†æ¶çš„èƒ½åŠ›ã€‚</p>
<p>æ–°å¢æ–‡ä»¶ gee/recovery.goï¼Œåœ¨è¿™ä¸ªæ–‡ä»¶ä¸­å®ç°ä¸­é—´ä»¶ Recoveryã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">Recovery</span><span class="p">()</span> <span class="nx">HandlerFunc</span> <span class="p">{</span>
	<span class="k">return</span> <span class="kd">func</span><span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">defer</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
			<span class="k">if</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nb">recover</span><span class="p">();</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
				<span class="nx">message</span> <span class="o">:=</span> <span class="nx">fmt</span><span class="p">.</span><span class="nf">Sprintf</span><span class="p">(</span><span class="s">&#34;%s&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
				<span class="nx">log</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;%s\n\n&#34;</span><span class="p">,</span> <span class="nf">trace</span><span class="p">(</span><span class="nx">message</span><span class="p">))</span>
				<span class="nx">c</span><span class="p">.</span><span class="nf">Fail</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusInternalServerError</span><span class="p">,</span> <span class="s">&#34;Internal Server Error&#34;</span><span class="p">)</span>
			<span class="p">}</span>
		<span class="p">}()</span>

		<span class="nx">c</span><span class="p">.</span><span class="nf">Next</span><span class="p">()</span>
	<span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p>Recovery çš„å®ç°éå¸¸ç®€å•ï¼Œä½¿ç”¨ defer æŒ‚è½½ä¸Šé”™è¯¯æ¢å¤çš„å‡½æ•°ï¼Œåœ¨è¿™ä¸ªå‡½æ•°ä¸­è°ƒç”¨ recover()*ï¼Œæ•è· panicï¼Œå¹¶ä¸”å°†å †æ ˆä¿¡æ¯æ‰“å°åœ¨æ—¥å¿—ä¸­ï¼Œå‘ç”¨æˆ·è¿”å› *Internal Server Errorã€‚</p>
<p>ä½ å¯èƒ½æ³¨æ„åˆ°ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ª trace() å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°æ˜¯ç”¨æ¥è·å–è§¦å‘ panic çš„å †æ ˆä¿¡æ¯ï¼Œå®Œæ•´ä»£ç å¦‚ä¸‹ï¼š</p>
<p>recovery.go</p>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="kn">package</span> <span class="nx">gee</span>

<span class="kn">import</span> <span class="p">(</span>
	<span class="s">&#34;fmt&#34;</span>
	<span class="s">&#34;log&#34;</span>
	<span class="s">&#34;net/http&#34;</span>
	<span class="s">&#34;runtime&#34;</span>
	<span class="s">&#34;strings&#34;</span>
<span class="p">)</span>

<span class="c1">// print stack trace for debug
</span><span class="c1"></span><span class="kd">func</span> <span class="nf">trace</span><span class="p">(</span><span class="nx">message</span> <span class="kt">string</span><span class="p">)</span> <span class="kt">string</span> <span class="p">{</span>
	<span class="kd">var</span> <span class="nx">pcs</span> <span class="p">[</span><span class="mi">32</span><span class="p">]</span><span class="kt">uintptr</span>
	<span class="nx">n</span> <span class="o">:=</span> <span class="nx">runtime</span><span class="p">.</span><span class="nf">Callers</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="nx">pcs</span><span class="p">[:])</span> <span class="c1">// skip first 3 caller
</span><span class="c1"></span>
	<span class="kd">var</span> <span class="nx">str</span> <span class="nx">strings</span><span class="p">.</span><span class="nx">Builder</span>
	<span class="nx">str</span><span class="p">.</span><span class="nf">WriteString</span><span class="p">(</span><span class="nx">message</span> <span class="o">+</span> <span class="s">&#34;\nTraceback:&#34;</span><span class="p">)</span>
	<span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">pc</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">pcs</span><span class="p">[:</span><span class="nx">n</span><span class="p">]</span> <span class="p">{</span>
		<span class="nx">fn</span> <span class="o">:=</span> <span class="nx">runtime</span><span class="p">.</span><span class="nf">FuncForPC</span><span class="p">(</span><span class="nx">pc</span><span class="p">)</span>
		<span class="nx">file</span><span class="p">,</span> <span class="nx">line</span> <span class="o">:=</span> <span class="nx">fn</span><span class="p">.</span><span class="nf">FileLine</span><span class="p">(</span><span class="nx">pc</span><span class="p">)</span>
		<span class="nx">str</span><span class="p">.</span><span class="nf">WriteString</span><span class="p">(</span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Sprintf</span><span class="p">(</span><span class="s">&#34;\n\t%s:%d&#34;</span><span class="p">,</span> <span class="nx">file</span><span class="p">,</span> <span class="nx">line</span><span class="p">))</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="nx">str</span><span class="p">.</span><span class="nf">String</span><span class="p">()</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">Recovery</span><span class="p">()</span> <span class="nx">HandlerFunc</span> <span class="p">{</span>
	<span class="k">return</span> <span class="kd">func</span><span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">defer</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
			<span class="k">if</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nb">recover</span><span class="p">();</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
				<span class="nx">message</span> <span class="o">:=</span> <span class="nx">fmt</span><span class="p">.</span><span class="nf">Sprintf</span><span class="p">(</span><span class="s">&#34;%s&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
				<span class="nx">log</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;%s\n\n&#34;</span><span class="p">,</span> <span class="nf">trace</span><span class="p">(</span><span class="nx">message</span><span class="p">))</span>
				<span class="nx">c</span><span class="p">.</span><span class="nf">Fail</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusInternalServerError</span><span class="p">,</span> <span class="s">&#34;Internal Server Error&#34;</span><span class="p">)</span>
			<span class="p">}</span>
		<span class="p">}()</span>

		<span class="nx">c</span><span class="p">.</span><span class="nf">Next</span><span class="p">()</span>
	<span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p>åœ¨ trace() ä¸­ï¼Œè°ƒç”¨äº† runtime.Callers(3, pcs[:])ï¼ŒCallers ç”¨æ¥è¿”å›è°ƒç”¨æ ˆçš„ç¨‹åºè®¡æ•°å™¨, ç¬¬ 0 ä¸ª Caller æ˜¯ Callers æœ¬èº«ï¼Œç¬¬ 1 ä¸ªæ˜¯ä¸Šä¸€å±‚ traceï¼Œç¬¬ 2 ä¸ªæ˜¯å†ä¸Šä¸€å±‚çš„ defer funcã€‚å› æ­¤ï¼Œä¸ºäº†æ—¥å¿—ç®€æ´ä¸€ç‚¹ï¼Œæˆ‘ä»¬è·³è¿‡äº†å‰ 3 ä¸ª Callerã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œé€šè¿‡ runtime.FuncForPC(pc) è·å–å¯¹åº”çš„å‡½æ•°ï¼Œåœ¨é€šè¿‡ fn.FileLine(pc) è·å–åˆ°è°ƒç”¨è¯¥å‡½æ•°çš„æ–‡ä»¶åå’Œè¡Œå·ï¼Œæ‰“å°åœ¨æ—¥å¿—ä¸­ã€‚</p>
<h3 id="åŠ ä¸€ä¸ªå·¥å‚æ–¹æ³•">åŠ ä¸€ä¸ªå·¥å‚æ–¹æ³•</h3>
<p>gee.go</p>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="c1">// Default use Logger() &amp; Recovery middlewares
</span><span class="c1"></span><span class="kd">func</span> <span class="nf">Default</span><span class="p">()</span> <span class="o">*</span><span class="nx">Engine</span> <span class="p">{</span>
	<span class="nx">engine</span> <span class="o">:=</span> <span class="nf">New</span><span class="p">()</span>
	<span class="nx">engine</span><span class="p">.</span><span class="nf">Use</span><span class="p">(</span><span class="nf">Logger</span><span class="p">(),</span> <span class="nf">Recovery</span><span class="p">())</span>
	<span class="k">return</span> <span class="nx">engine</span>
<span class="p">}</span>
</code></pre></div><p>è‡³æ­¤ï¼Œgee æ¡†æ¶çš„é”™è¯¯å¤„ç†æœºåˆ¶å°±å®Œæˆäº†ã€‚</p>
<h3 id="ä½¿ç”¨-demo-2">ä½¿ç”¨ Demo</h3>
<p>main.go</p>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
	<span class="s">&#34;net/http&#34;</span>

	<span class="s">&#34;gee&#34;</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="nx">r</span> <span class="o">:=</span> <span class="nx">gee</span><span class="p">.</span><span class="nf">Default</span><span class="p">()</span>
	<span class="nx">r</span><span class="p">.</span><span class="nf">GET</span><span class="p">(</span><span class="s">&#34;/&#34;</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">gee</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
		<span class="nx">c</span><span class="p">.</span><span class="nf">String</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">,</span> <span class="s">&#34;Hello Geektutu\n&#34;</span><span class="p">)</span>
	<span class="p">})</span>
	<span class="c1">// index out of range for testing Recovery()
</span><span class="c1"></span>	<span class="nx">r</span><span class="p">.</span><span class="nf">GET</span><span class="p">(</span><span class="s">&#34;/panic&#34;</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">gee</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
		<span class="nx">names</span> <span class="o">:=</span> <span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&#34;geektutu&#34;</span><span class="p">}</span>
		<span class="nx">c</span><span class="p">.</span><span class="nf">String</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">,</span> <span class="nx">names</span><span class="p">[</span><span class="mi">100</span><span class="p">])</span>
	<span class="p">})</span>

	<span class="nx">r</span><span class="p">.</span><span class="nf">Run</span><span class="p">(</span><span class="s">&#34;:9999&#34;</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div><p>æ¥ä¸‹æ¥è¿›è¡Œæµ‹è¯•ï¼Œå…ˆè®¿é—®ä¸»é¡µï¼Œè®¿é—®ä¸€ä¸ªæœ‰BUGçš„ /panicï¼ŒæœåŠ¡æ­£å¸¸è¿”å›ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬å†ä¸€æ¬¡æˆåŠŸè®¿é—®äº†ä¸»é¡µï¼Œè¯´æ˜æœåŠ¡å®Œå…¨è¿è½¬æ­£å¸¸ã€‚</p>
<pre><code>$ curl &quot;http://localhost:9999&quot;
Hello Geektutu
$ curl &quot;http://localhost:9999/panic&quot;
{&quot;message&quot;:&quot;Internal Server Error&quot;}
$ curl &quot;http://localhost:9999&quot;
Hello Geektutu
</code></pre><p>æˆ‘ä»¬å¯ä»¥åœ¨åå°æ—¥å¿—ä¸­çœ‹åˆ°å¦‚ä¸‹å†…å®¹ï¼Œå¼•å‘é”™è¯¯çš„åŸå› å’Œå †æ ˆä¿¡æ¯éƒ½è¢«æ‰“å°äº†å‡ºæ¥ï¼Œé€šè¿‡æ—¥å¿—ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“åœ°çŸ¥é“ï¼Œåœ¨day7-panic-recover/main.go:47 çš„åœ°æ–¹å‡ºç°äº† index out of range é”™è¯¯ã€‚</p>
<pre><code>2020/01/09 01:00:10 Route  GET - /
2020/01/09 01:00:10 Route  GET - /panic
2020/01/09 01:00:22 [200] / in 25.364Âµs
2020/01/09 01:00:32 runtime error: index out of range
Traceback:
        /usr/local/Cellar/go/1.12.5/libexec/src/runtime/panic.go:523
        /usr/local/Cellar/go/1.12.5/libexec/src/runtime/panic.go:44
        /tmp/7days-golang/day7-panic-recover/main.go:47
        /tmp/7days-golang/day7-panic-recover/gee/context.go:41
        /tmp/7days-golang/day7-panic-recover/gee/recovery.go:37
        /tmp/7days-golang/day7-panic-recover/gee/context.go:41
        /tmp/7days-golang/day7-panic-recover/gee/logger.go:15
        /tmp/7days-golang/day7-panic-recover/gee/context.go:41
        /tmp/7days-golang/day7-panic-recover/gee/router.go:99
        /tmp/7days-golang/day7-panic-recover/gee/gee.go:130
        /usr/local/Cellar/go/1.12.5/libexec/src/net/http/server.go:2775
        /usr/local/Cellar/go/1.12.5/libexec/src/net/http/server.go:1879
        /usr/local/Cellar/go/1.12.5/libexec/src/runtime/asm_amd64.s:1338

2020/01/09 01:00:32 [500] /panic in 395.846Âµs
2020/01/09 01:00:38 [200] / in 6.985Âµs
</code></pre>]]></content>
		</item>
		
		<item>
			<title>Markdown ä¸­æ–‡è¯´æ˜</title>
			<link>https://aomi.run/posts/document/markdown-readme/</link>
			<pubDate>Thu, 21 Jan 2021 14:33:04 +0800</pubDate>
			
			<guid>https://aomi.run/posts/document/markdown-readme/</guid>
			<description>NOTE: This is Simplelified Chinese Edition Document of Markdown Syntax. If you are seeking for English Edition Document. Please refer to Markdown: Syntax.
 æ¦‚è¿° å®—æ—¨ Markdown çš„ç›®æ ‡æ˜¯å®ç°ã€Œæ˜“è¯»æ˜“å†™ã€ã€‚
å¯è¯»æ€§ï¼Œæ— è®ºå¦‚ä½•ï¼Œéƒ½æ˜¯æœ€é‡è¦çš„ã€‚ä¸€ä»½ä½¿ç”¨ Markdown æ ¼å¼æ’°å†™çš„æ–‡ä»¶åº”è¯¥å¯ä»¥ç›´æ¥ä»¥çº¯æ–‡æœ¬å‘å¸ƒï¼Œå¹¶ä¸”çœ‹èµ·æ¥ä¸ä¼šåƒæ˜¯ç”±è®¸å¤šæ ‡ç­¾æˆ–æ˜¯æ ¼å¼æŒ‡ä»¤æ‰€æ„æˆã€‚Markdown è¯­æ³•å—åˆ°ä¸€äº›æ—¢æœ‰ text-to-HTML æ ¼å¼çš„å½±å“ï¼ŒåŒ…æ‹¬ Setextã€atxã€Textileã€reStructuredTextã€Grutatext å’Œ EtTextï¼Œè€Œæœ€å¤§çµæ„Ÿæ¥æºå…¶å®æ˜¯çº¯æ–‡æœ¬ç”µå­é‚®ä»¶çš„æ ¼å¼ã€‚
æ€»ä¹‹ï¼Œ Markdown çš„è¯­æ³•å…¨ç”±ä¸€äº›ç¬¦å·æ‰€ç»„æˆï¼Œè¿™äº›ç¬¦å·ç»è¿‡ç²¾æŒ‘ç»†é€‰ï¼Œå…¶ä½œç”¨ä¸€ç›®äº†ç„¶ã€‚æ¯”å¦‚ï¼šåœ¨æ–‡å­—ä¸¤æ—åŠ ä¸Šæ˜Ÿå·ï¼Œçœ‹èµ·æ¥å°±åƒ_å¼ºè°ƒ_ã€‚Markdown çš„åˆ—è¡¨çœ‹èµ·æ¥ï¼Œå—¯ï¼Œå°±æ˜¯åˆ—è¡¨ã€‚Markdown çš„åŒºå—å¼•ç”¨çœ‹èµ·æ¥å°±çœŸçš„åƒæ˜¯å¼•ç”¨ä¸€æ®µæ–‡å­—ï¼Œå°±åƒä½ æ›¾åœ¨ç”µå­é‚®ä»¶ä¸­è§è¿‡çš„é‚£æ ·ã€‚
å…¼å®¹ HTML Markdown è¯­æ³•çš„ç›®æ ‡æ˜¯ï¼šæˆä¸ºä¸€ç§é€‚ç”¨äºç½‘ç»œçš„_ä¹¦å†™_è¯­è¨€ã€‚
Markdown ä¸æ˜¯æƒ³è¦å–ä»£ HTMLï¼Œç”šè‡³ä¹Ÿæ²¡æœ‰è¦å’Œå®ƒç›¸è¿‘ï¼Œå®ƒçš„è¯­æ³•ç§ç±»å¾ˆå°‘ï¼Œåªå¯¹åº” HTML æ ‡è®°çš„ä¸€å°éƒ¨åˆ†ã€‚Markdown çš„æ„æƒ³_ä¸æ˜¯_è¦ä½¿å¾— HTML æ–‡æ¡£æ›´å®¹æ˜“ä¹¦å†™ã€‚åœ¨æˆ‘çœ‹æ¥ï¼Œ HTML å·²ç»å¾ˆå®¹æ˜“å†™äº†ã€‚Markdown çš„ç†å¿µæ˜¯ï¼Œèƒ½è®©æ–‡æ¡£æ›´å®¹æ˜“è¯»ã€å†™å’Œéšæ„æ”¹ã€‚HTML æ˜¯ä¸€ç§_å‘å¸ƒ_çš„æ ¼å¼ï¼ŒMarkdown æ˜¯ä¸€ç§_ä¹¦å†™_çš„æ ¼å¼ã€‚å°±è¿™æ ·ï¼ŒMarkdown çš„æ ¼å¼è¯­æ³•åªæ¶µç›–çº¯æ–‡æœ¬å¯ä»¥æ¶µç›–çš„èŒƒå›´ã€‚
ä¸åœ¨ Markdown æ¶µç›–èŒƒå›´ä¹‹å†…çš„æ ‡ç­¾ï¼Œéƒ½å¯ä»¥ç›´æ¥åœ¨æ–‡æ¡£é‡Œé¢ç”¨ HTML æ’°å†™ã€‚ä¸éœ€è¦é¢å¤–æ ‡æ³¨è¿™æ˜¯ HTML æˆ–æ˜¯ Markdownï¼›åªè¦ç›´æ¥åŠ æ ‡ç­¾å°±å¯ä»¥äº†ã€‚
è¦åˆ¶çº¦çš„åªæœ‰ä¸€äº› HTML åŒºå—å…ƒç´ â€•â€•æ¯”å¦‚ ã€ã€ã€ ç­‰æ ‡ç­¾ï¼Œå¿…é¡»åœ¨å‰ååŠ ä¸Šç©ºè¡Œä¸å…¶å®ƒå†…å®¹åŒºéš”å¼€ï¼Œè¿˜è¦æ±‚å®ƒä»¬çš„å¼€å§‹æ ‡ç­¾ä¸ç»“å°¾æ ‡ç­¾ä¸èƒ½ç”¨åˆ¶è¡¨ç¬¦æˆ–ç©ºæ ¼æ¥ç¼©è¿›ã€‚Markdown çš„ç”Ÿæˆå™¨æœ‰è¶³å¤Ÿæ™ºèƒ½ï¼Œä¸ä¼šåœ¨ HTML åŒºå—æ ‡ç­¾å¤–åŠ ä¸Šä¸å¿…è¦çš„ `` æ ‡ç­¾ã€‚</description>
			<content type="html"><![CDATA[<p><strong>NOTE:</strong> This is Simplelified Chinese Edition Document of Markdown Syntax. If you are seeking for English Edition Document. Please refer to <a href="https://daringfireball.net/projects/markdown/syntax">Markdown: Syntax</a>.</p>
<hr>
<h2 id="æ¦‚è¿°">æ¦‚è¿°</h2>
<h3 id="å®—æ—¨">å®—æ—¨</h3>
<p>Markdown çš„ç›®æ ‡æ˜¯å®ç°ã€Œæ˜“è¯»æ˜“å†™ã€ã€‚</p>
<p>å¯è¯»æ€§ï¼Œæ— è®ºå¦‚ä½•ï¼Œéƒ½æ˜¯æœ€é‡è¦çš„ã€‚ä¸€ä»½ä½¿ç”¨ Markdown æ ¼å¼æ’°å†™çš„æ–‡ä»¶åº”è¯¥å¯ä»¥ç›´æ¥ä»¥çº¯æ–‡æœ¬å‘å¸ƒï¼Œå¹¶ä¸”çœ‹èµ·æ¥ä¸ä¼šåƒæ˜¯ç”±è®¸å¤šæ ‡ç­¾æˆ–æ˜¯æ ¼å¼æŒ‡ä»¤æ‰€æ„æˆã€‚Markdown è¯­æ³•å—åˆ°ä¸€äº›æ—¢æœ‰ text-to-HTML æ ¼å¼çš„å½±å“ï¼ŒåŒ…æ‹¬ <a href="http://docutils.sourceforge.net/mirror/setext.html">Setext</a>ã€<a href="http://www.aaronsw.com/2002/atx/">atx</a>ã€<a href="http://textism.com/tools/textile/">Textile</a>ã€<a href="http://docutils.sourceforge.net/rst.html">reStructuredText</a>ã€<a href="http://www.triptico.com/software/grutatxt.html">Grutatext</a> å’Œ <a href="http://ettext.taint.org/doc/">EtText</a>ï¼Œè€Œæœ€å¤§çµæ„Ÿæ¥æºå…¶å®æ˜¯çº¯æ–‡æœ¬ç”µå­é‚®ä»¶çš„æ ¼å¼ã€‚</p>
<p>æ€»ä¹‹ï¼Œ Markdown çš„è¯­æ³•å…¨ç”±ä¸€äº›ç¬¦å·æ‰€ç»„æˆï¼Œè¿™äº›ç¬¦å·ç»è¿‡ç²¾æŒ‘ç»†é€‰ï¼Œå…¶ä½œç”¨ä¸€ç›®äº†ç„¶ã€‚æ¯”å¦‚ï¼šåœ¨æ–‡å­—ä¸¤æ—åŠ ä¸Šæ˜Ÿå·ï¼Œçœ‹èµ·æ¥å°±åƒ_å¼ºè°ƒ_ã€‚Markdown çš„åˆ—è¡¨çœ‹èµ·æ¥ï¼Œå—¯ï¼Œå°±æ˜¯åˆ—è¡¨ã€‚Markdown çš„åŒºå—å¼•ç”¨çœ‹èµ·æ¥å°±çœŸçš„åƒæ˜¯å¼•ç”¨ä¸€æ®µæ–‡å­—ï¼Œå°±åƒä½ æ›¾åœ¨ç”µå­é‚®ä»¶ä¸­è§è¿‡çš„é‚£æ ·ã€‚</p>
<h3 id="å…¼å®¹-html">å…¼å®¹ HTML</h3>
<p>Markdown è¯­æ³•çš„ç›®æ ‡æ˜¯ï¼šæˆä¸ºä¸€ç§é€‚ç”¨äºç½‘ç»œçš„_ä¹¦å†™_è¯­è¨€ã€‚</p>
<p>Markdown ä¸æ˜¯æƒ³è¦å–ä»£ HTMLï¼Œç”šè‡³ä¹Ÿæ²¡æœ‰è¦å’Œå®ƒç›¸è¿‘ï¼Œå®ƒçš„è¯­æ³•ç§ç±»å¾ˆå°‘ï¼Œåªå¯¹åº” HTML æ ‡è®°çš„ä¸€å°éƒ¨åˆ†ã€‚Markdown çš„æ„æƒ³_ä¸æ˜¯_è¦ä½¿å¾— HTML æ–‡æ¡£æ›´å®¹æ˜“ä¹¦å†™ã€‚åœ¨æˆ‘çœ‹æ¥ï¼Œ HTML å·²ç»å¾ˆå®¹æ˜“å†™äº†ã€‚Markdown çš„ç†å¿µæ˜¯ï¼Œèƒ½è®©æ–‡æ¡£æ›´å®¹æ˜“è¯»ã€å†™å’Œéšæ„æ”¹ã€‚HTML æ˜¯ä¸€ç§_å‘å¸ƒ_çš„æ ¼å¼ï¼ŒMarkdown æ˜¯ä¸€ç§_ä¹¦å†™_çš„æ ¼å¼ã€‚å°±è¿™æ ·ï¼ŒMarkdown çš„æ ¼å¼è¯­æ³•åªæ¶µç›–çº¯æ–‡æœ¬å¯ä»¥æ¶µç›–çš„èŒƒå›´ã€‚</p>
<p>ä¸åœ¨ Markdown æ¶µç›–èŒƒå›´ä¹‹å†…çš„æ ‡ç­¾ï¼Œéƒ½å¯ä»¥ç›´æ¥åœ¨æ–‡æ¡£é‡Œé¢ç”¨ HTML æ’°å†™ã€‚ä¸éœ€è¦é¢å¤–æ ‡æ³¨è¿™æ˜¯ HTML æˆ–æ˜¯ Markdownï¼›åªè¦ç›´æ¥åŠ æ ‡ç­¾å°±å¯ä»¥äº†ã€‚</p>
<p>è¦åˆ¶çº¦çš„åªæœ‰ä¸€äº› HTML åŒºå—å…ƒç´ â€•â€•æ¯”å¦‚ <code>ã€</code>ã€<code>ã€</code> ç­‰æ ‡ç­¾ï¼Œå¿…é¡»åœ¨å‰ååŠ ä¸Šç©ºè¡Œä¸å…¶å®ƒå†…å®¹åŒºéš”å¼€ï¼Œè¿˜è¦æ±‚å®ƒä»¬çš„å¼€å§‹æ ‡ç­¾ä¸ç»“å°¾æ ‡ç­¾ä¸èƒ½ç”¨åˆ¶è¡¨ç¬¦æˆ–ç©ºæ ¼æ¥ç¼©è¿›ã€‚Markdown çš„ç”Ÿæˆå™¨æœ‰è¶³å¤Ÿæ™ºèƒ½ï¼Œä¸ä¼šåœ¨ HTML åŒºå—æ ‡ç­¾å¤–åŠ ä¸Šä¸å¿…è¦çš„ `` æ ‡ç­¾ã€‚</p>
<p>ä¾‹å­å¦‚ä¸‹ï¼Œåœ¨ Markdown æ–‡ä»¶é‡ŒåŠ ä¸Šä¸€æ®µ HTML è¡¨æ ¼ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-md" data-lang="md">è¿™æ˜¯ä¸€ä¸ªæ™®é€šæ®µè½ã€‚
â€‹
<span class="p">&lt;</span><span class="nt">table</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>Foo<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">table</span><span class="p">&gt;</span>
â€‹
è¿™æ˜¯å¦ä¸€ä¸ªæ™®é€šæ®µè½ã€‚
</code></pre></div><p>è¯·æ³¨æ„ï¼Œåœ¨ HTML åŒºå—æ ‡ç­¾é—´çš„ Markdown æ ¼å¼è¯­æ³•å°†ä¸ä¼šè¢«å¤„ç†ã€‚æ¯”å¦‚ï¼Œä½ åœ¨ HTML åŒºå—å†…ä½¿ç”¨ Markdown æ ·å¼çš„<code>*å¼ºè°ƒ*</code>ä¼šæ²¡æœ‰æ•ˆæœã€‚</p>
<p>HTML çš„åŒºæ®µï¼ˆè¡Œå†…ï¼‰æ ‡ç­¾å¦‚ <code>ã€</code>ã€<code>~~</code>~~ å¯ä»¥åœ¨ Markdown çš„æ®µè½ã€åˆ—è¡¨æˆ–æ˜¯æ ‡é¢˜é‡Œéšæ„ä½¿ç”¨ã€‚ä¾ç…§ä¸ªäººä¹ æƒ¯ï¼Œç”šè‡³å¯ä»¥ä¸ç”¨ Markdown æ ¼å¼ï¼Œè€Œç›´æ¥é‡‡ç”¨ HTML æ ‡ç­¾æ¥æ ¼å¼åŒ–ã€‚ä¸¾ä¾‹è¯´æ˜ï¼šå¦‚æœæ¯”è¾ƒå–œæ¬¢ HTML çš„ <code>æˆ–</code> æ ‡ç­¾ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨è¿™äº›æ ‡ç­¾ï¼Œè€Œä¸ç”¨ Markdown æä¾›çš„é“¾æ¥æˆ–æ˜¯å›¾åƒæ ‡ç­¾è¯­æ³•ã€‚</p>
<p>å’Œå¤„åœ¨ HTML åŒºå—æ ‡ç­¾é—´ä¸åŒï¼ŒMarkdown è¯­æ³•åœ¨ HTML åŒºæ®µæ ‡ç­¾é—´æ˜¯æœ‰æ•ˆçš„ã€‚</p>
<h3 id="ç‰¹æ®Šå­—ç¬¦è‡ªåŠ¨è½¬æ¢">ç‰¹æ®Šå­—ç¬¦è‡ªåŠ¨è½¬æ¢</h3>
<p>åœ¨ HTML æ–‡ä»¶ä¸­ï¼Œæœ‰ä¸¤ä¸ªå­—ç¬¦éœ€è¦ç‰¹æ®Šå¤„ç†ï¼š <code>&lt;</code> å’Œ <code>&amp;</code> ã€‚ <code>&lt;</code> ç¬¦å·ç”¨äºèµ·å§‹æ ‡ç­¾ï¼Œ<code>&amp;</code> ç¬¦å·åˆ™ç”¨äºæ ‡è®° HTML å®ä½“ï¼Œå¦‚æœä½ åªæ˜¯æƒ³è¦æ˜¾ç¤ºè¿™äº›å­—ç¬¦çš„åŸå‹ï¼Œä½ å¿…é¡»è¦ä½¿ç”¨å®ä½“çš„å½¢å¼ï¼Œåƒæ˜¯ <code>&lt;</code> å’Œ <code>&amp;</code>ã€‚</p>
<p><code>&amp;</code> å­—ç¬¦å°¤å…¶è®©ç½‘ç»œæ–‡æ¡£ç¼–å†™è€…å—æŠ˜ç£¨ï¼Œå¦‚æœä½ è¦æ‰“ã€Œ<code>AT&amp;T</code>ã€ ï¼Œä½ å¿…é¡»è¦å†™æˆã€Œ<code>AT&amp;T</code>ã€ã€‚è€Œç½‘å€ä¸­çš„ <code>&amp;</code> å­—ç¬¦ä¹Ÿè¦è½¬æ¢ã€‚æ¯”å¦‚ä½ è¦é“¾æ¥åˆ°ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-md" data-lang="md">http://images.google.com/images?num=30<span class="err">&amp;</span>q=larry+bird
</code></pre></div><p>ä½ å¿…é¡»è¦æŠŠç½‘å€è½¬æ¢å†™ä¸ºï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-md" data-lang="md">http://images.google.com/images?num=30<span class="ni">&amp;amp;</span>q=larry+bird
</code></pre></div><p>æ‰èƒ½æ”¾åˆ°é“¾æ¥æ ‡ç­¾çš„ <code>href</code> å±æ€§é‡Œã€‚ä¸ç”¨è¯´ä¹ŸçŸ¥é“è¿™å¾ˆå®¹æ˜“å¿½ç•¥ï¼Œè¿™ä¹Ÿå¯èƒ½æ˜¯ HTML æ ‡å‡†æ£€éªŒæ‰€æ£€æŸ¥åˆ°çš„é”™è¯¯ä¸­ï¼Œæ•°é‡æœ€å¤šçš„ã€‚</p>
<p>Markdown è®©ä½ å¯ä»¥è‡ªç„¶åœ°ä¹¦å†™å­—ç¬¦ï¼Œéœ€è¦è½¬æ¢çš„ç”±å®ƒæ¥å¤„ç†å¥½äº†ã€‚å¦‚æœä½ ä½¿ç”¨çš„ <code>&amp;</code> å­—ç¬¦æ˜¯ HTML å­—ç¬¦å®ä½“çš„ä¸€éƒ¨åˆ†ï¼Œå®ƒä¼šä¿ç•™åŸçŠ¶ï¼Œå¦åˆ™å®ƒä¼šè¢«è½¬æ¢æˆ <code>&amp;amp</code>;ã€‚</p>
<p>æ‰€ä»¥ä½ å¦‚æœè¦åœ¨æ–‡æ¡£ä¸­æ’å…¥ä¸€ä¸ªç‰ˆæƒç¬¦å· <code>Â©</code>ï¼Œä½ å¯ä»¥è¿™æ ·å†™ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-md" data-lang="md"><span class="ni">&amp;copy;</span>
</code></pre></div><p>Markdown ä¼šä¿ç•™å®ƒä¸åŠ¨ã€‚è€Œè‹¥ä½ å†™ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-md" data-lang="md">AT<span class="err">&amp;</span>T
</code></pre></div><p>Markdown å°±ä¼šå°†å®ƒè½¬ä¸ºï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-md" data-lang="md">AT<span class="ni">&amp;amp;</span>T
</code></pre></div><p>ç±»ä¼¼çš„çŠ¶å†µä¹Ÿä¼šå‘ç”Ÿåœ¨ <code>&lt;</code> ç¬¦å·ä¸Šï¼Œå› ä¸º Markdown å…è®¸ <a href="https://www.appinn.com/markdown/#html">å…¼å®¹ HTML</a> ï¼Œå¦‚æœä½ æ˜¯æŠŠ <code>&lt;</code> ç¬¦å·ä½œä¸º HTML æ ‡ç­¾çš„å®šç•Œç¬¦ä½¿ç”¨ï¼Œé‚£ Markdown ä¹Ÿä¸ä¼šå¯¹å®ƒåšä»»ä½•è½¬æ¢ï¼Œä½†æ˜¯å¦‚æœä½ å†™ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-md" data-lang="md">4 <span class="p">&lt;</span> <span class="nt">5</span>
</code></pre></div><p>Markdown å°†ä¼šæŠŠå®ƒè½¬æ¢ä¸ºï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-md" data-lang="md">4 <span class="ni">&amp;lt;</span> 5
</code></pre></div><p>ä¸è¿‡éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œcode èŒƒå›´å†…ï¼Œä¸è®ºæ˜¯è¡Œå†…è¿˜æ˜¯åŒºå—ï¼Œ <code>&lt;</code> å’Œ <code>&amp;</code> ä¸¤ä¸ªç¬¦å·éƒ½_ä¸€å®š_ä¼šè¢«è½¬æ¢æˆ HTML å®ä½“ï¼Œè¿™é¡¹ç‰¹æ€§è®©ä½ å¯ä»¥å¾ˆå®¹æ˜“åœ°ç”¨ Markdown å†™ HTML code ï¼ˆå’Œ HTML ç›¸å¯¹è€Œè¨€ï¼Œ HTML è¯­æ³•ä¸­ï¼Œä½ è¦æŠŠæ‰€æœ‰çš„ <code>&lt;</code> å’Œ <code>&amp;</code> éƒ½è½¬æ¢ä¸º HTML å®ä½“ï¼Œæ‰èƒ½åœ¨ HTML æ–‡ä»¶é‡Œé¢å†™å‡º HTML codeã€‚ï¼‰</p>
<hr>
<h2 id="åŒºå—å…ƒç´ ">åŒºå—å…ƒç´ </h2>
<h3 id="æ®µè½å’Œæ¢è¡Œ">æ®µè½å’Œæ¢è¡Œ</h3>
<p>ä¸€ä¸ª Markdown æ®µè½æ˜¯ç”±ä¸€ä¸ªæˆ–å¤šä¸ªè¿ç»­çš„æ–‡æœ¬è¡Œç»„æˆï¼Œå®ƒçš„å‰åè¦æœ‰ä¸€ä¸ªä»¥ä¸Šçš„ç©ºè¡Œï¼ˆç©ºè¡Œçš„å®šä¹‰æ˜¯æ˜¾ç¤ºä¸Šçœ‹èµ·æ¥åƒæ˜¯ç©ºçš„ï¼Œä¾¿ä¼šè¢«è§†ä¸ºç©ºè¡Œã€‚æ¯”æ–¹è¯´ï¼Œè‹¥æŸä¸€è¡ŒåªåŒ…å«ç©ºæ ¼å’Œåˆ¶è¡¨ç¬¦ï¼Œåˆ™è¯¥è¡Œä¹Ÿä¼šè¢«è§†ä¸ºç©ºè¡Œï¼‰ã€‚æ™®é€šæ®µè½ä¸è¯¥ç”¨ç©ºæ ¼æˆ–åˆ¶è¡¨ç¬¦æ¥ç¼©è¿›ã€‚</p>
<p>ã€Œç”±ä¸€ä¸ªæˆ–å¤šä¸ªè¿ç»­çš„æ–‡æœ¬è¡Œç»„æˆã€è¿™å¥è¯å…¶å®æš—ç¤ºäº† Markdown å…è®¸æ®µè½å†…çš„å¼ºè¿«æ¢è¡Œï¼ˆæ’å…¥æ¢è¡Œç¬¦ï¼‰ï¼Œè¿™ä¸ªç‰¹æ€§å’Œå…¶ä»–å¤§éƒ¨åˆ†çš„ text-to-HTML æ ¼å¼ä¸ä¸€æ ·ï¼ˆåŒ…æ‹¬ Movable Type çš„ã€ŒConvert Line Breaksã€é€‰é¡¹ï¼‰ï¼Œå…¶å®ƒçš„æ ¼å¼ä¼šæŠŠæ¯ä¸ªæ¢è¡Œç¬¦éƒ½è½¬æˆ ``æ ‡ç­¾ã€‚</p>
<p>å¦‚æœä½ _ç¡®å®_æƒ³è¦ä¾èµ– Markdown æ¥æ’å…¥ ``æ ‡ç­¾çš„è¯ï¼Œåœ¨æ’å…¥å¤„å…ˆæŒ‰å…¥ä¸¤ä¸ªä»¥ä¸Šçš„ç©ºæ ¼ç„¶åå›è½¦ã€‚</p>
<p>çš„ç¡®ï¼Œéœ€è¦å¤šè´¹ç‚¹äº‹ï¼ˆå¤šåŠ ç©ºæ ¼ï¼‰æ¥äº§ç”Ÿ <code>ï¼Œä½†æ˜¯ç®€å•åœ°ã€Œæ¯ä¸ªæ¢è¡Œéƒ½è½¬æ¢ä¸º</code>ã€çš„æ–¹æ³•åœ¨ Markdown ä¸­å¹¶ä¸é€‚åˆï¼Œ Markdown ä¸­ email å¼çš„ <a href="https://www.appinn.com/markdown/#blockquote">åŒºå—å¼•ç”¨</a> å’Œå¤šæ®µè½çš„ <a href="https://www.appinn.com/markdown/#list">åˆ—è¡¨</a> åœ¨ä½¿ç”¨æ¢è¡Œæ¥æ’ç‰ˆçš„æ—¶å€™ï¼Œä¸ä½†æ›´å¥½ç”¨ï¼Œè¿˜æ›´æ–¹ä¾¿é˜…è¯»ã€‚</p>
<h3 id="æ ‡é¢˜">æ ‡é¢˜</h3>
<p>Markdown æ”¯æŒä¸¤ç§æ ‡é¢˜çš„è¯­æ³•ï¼Œç±» <a href="http://docutils.sourceforge.net/mirror/setext.html">Setext</a> å’Œç±» <a href="http://www.aaronsw.com/2002/atx/">atx</a> å½¢å¼ã€‚</p>
<p>ç±» Setext å½¢å¼æ˜¯ç”¨åº•çº¿çš„å½¢å¼ï¼Œåˆ©ç”¨ <code>=</code> ï¼ˆæœ€é«˜é˜¶æ ‡é¢˜ï¼‰å’Œ <code>-</code> ï¼ˆç¬¬äºŒé˜¶æ ‡é¢˜ï¼‰ï¼Œä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-md" data-lang="md">This is an H1
=============
â€‹
This is an H2
-------------
</code></pre></div><p>ä»»ä½•æ•°é‡çš„ <code>=</code> å’Œ <code>-</code> éƒ½å¯ä»¥æœ‰æ•ˆæœã€‚</p>
<p>ç±» Atx å½¢å¼åˆ™æ˜¯åœ¨è¡Œé¦–æ’å…¥ 1 åˆ° 6 ä¸ª <code>#</code> ï¼Œå¯¹åº”åˆ°æ ‡é¢˜ 1 åˆ° 6 é˜¶ï¼Œä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-md" data-lang="md"><span class="gh"># è¿™æ˜¯ H1
</span><span class="gh"></span>â€‹
<span class="gu">## è¿™æ˜¯ H2
</span><span class="gu"></span>â€‹
<span class="gu">###### è¿™æ˜¯ H6
</span></code></pre></div><p>ä½ å¯ä»¥é€‰æ‹©æ€§åœ°ã€Œé—­åˆã€ç±» atx æ ·å¼çš„æ ‡é¢˜ï¼Œè¿™çº¯ç²¹åªæ˜¯ç¾è§‚ç”¨çš„ï¼Œè‹¥æ˜¯è§‰å¾—è¿™æ ·çœ‹èµ·æ¥æ¯”è¾ƒèˆ’é€‚ï¼Œä½ å°±å¯ä»¥åœ¨è¡Œå°¾åŠ ä¸Š <code>#</code>ï¼Œè€Œè¡Œå°¾çš„ <code>#</code> æ•°é‡ä¹Ÿä¸ç”¨å’Œå¼€å¤´ä¸€æ ·ï¼ˆè¡Œé¦–çš„äº•å­—ç¬¦æ•°é‡å†³å®šæ ‡é¢˜çš„é˜¶æ•°ï¼‰ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-md" data-lang="md"><span class="gh"># è¿™æ˜¯ H1 #
</span><span class="gh"></span>â€‹
<span class="gu">## è¿™æ˜¯ H2 ##
</span><span class="gu"></span>â€‹
<span class="gu">### è¿™æ˜¯ H3 ######
</span></code></pre></div><h3 id="åŒºå—å¼•ç”¨-blockquotes">åŒºå—å¼•ç”¨ Blockquotes</h3>
<p>Markdown æ ‡è®°åŒºå—å¼•ç”¨æ˜¯ä½¿ç”¨ç±»ä¼¼ email ä¸­ç”¨ <code>&gt;</code> çš„å¼•ç”¨æ–¹å¼ã€‚å¦‚æœä½ è¿˜ç†Ÿæ‚‰åœ¨ email ä¿¡ä»¶ä¸­çš„å¼•è¨€éƒ¨åˆ†ï¼Œä½ å°±çŸ¥é“æ€ä¹ˆåœ¨ Markdown æ–‡ä»¶ä¸­å»ºç«‹ä¸€ä¸ªåŒºå—å¼•ç”¨ï¼Œé‚£ä¼šçœ‹èµ·æ¥åƒæ˜¯ä½ è‡ªå·±å…ˆæ–­å¥½è¡Œï¼Œç„¶ååœ¨æ¯è¡Œçš„æœ€å‰é¢åŠ ä¸Š <code>&gt;</code> ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-md" data-lang="md"><span class="k">&gt; </span><span class="ge">This is a blockquote with two paragraphs. Lorem ipsum dolor sit amet,
</span><span class="ge"></span><span class="k">&gt; </span><span class="ge">consectetuer adipiscing elit. Aliquam hendrerit mi posuere lectus.
</span><span class="ge"></span><span class="k">&gt; </span><span class="ge">Vestibulum enim wisi, viverra nec, fringilla in, laoreet vitae, risus.
</span><span class="ge"></span>&gt; 
<span class="k">&gt; </span><span class="ge">Donec sit amet nisl. Aliquam semper ipsum sit amet velit. Suspendisse
</span><span class="ge"></span><span class="k">&gt; </span><span class="ge">id sem consectetuer libero luctus adipiscing.
</span></code></pre></div><p>Markdown ä¹Ÿå…è®¸ä½ å·æ‡’åªåœ¨æ•´ä¸ªæ®µè½çš„ç¬¬ä¸€è¡Œæœ€å‰é¢åŠ ä¸Š <code>&gt;</code> ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-md" data-lang="md"><span class="k">&gt; </span><span class="ge">This is a blockquote with two paragraphs. Lorem ipsum dolor sit amet,
</span><span class="ge"></span>consectetuer adipiscing elit. Aliquam hendrerit mi posuere lectus.
Vestibulum enim wisi, viverra nec, fringilla in, laoreet vitae, risus.
â€‹
<span class="k">&gt; </span><span class="ge">Donec sit amet nisl. Aliquam semper ipsum sit amet velit. Suspendisse
</span><span class="ge"></span>id sem consectetuer libero luctus adipiscing.
</code></pre></div><p>åŒºå—å¼•ç”¨å¯ä»¥åµŒå¥—ï¼ˆä¾‹å¦‚ï¼šå¼•ç”¨å†…çš„å¼•ç”¨ï¼‰ï¼Œåªè¦æ ¹æ®å±‚æ¬¡åŠ ä¸Šä¸åŒæ•°é‡çš„ <code>&gt;</code> ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-md" data-lang="md"><span class="k">&gt; </span><span class="ge">This is the first level of quoting.
</span><span class="ge"></span><span class="k">&gt;
</span><span class="k"></span><span class="ge">&gt; &gt; This is nested blockquote.
</span><span class="ge"></span><span class="k">&gt;
</span><span class="k"></span><span class="ge">&gt; Back to the first level.
</span></code></pre></div><p>å¼•ç”¨çš„åŒºå—å†…ä¹Ÿå¯ä»¥ä½¿ç”¨å…¶ä»–çš„ Markdown è¯­æ³•ï¼ŒåŒ…æ‹¬æ ‡é¢˜ã€åˆ—è¡¨ã€ä»£ç åŒºå—ç­‰ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-md" data-lang="md"><span class="k">&gt; </span><span class="ge">## è¿™æ˜¯ä¸€ä¸ªæ ‡é¢˜ã€‚
</span><span class="ge"></span>&gt; 
<span class="k">&gt; </span><span class="ge">1.   è¿™æ˜¯ç¬¬ä¸€è¡Œåˆ—è¡¨é¡¹ã€‚
</span><span class="ge"></span><span class="k">&gt; </span><span class="ge">2.   è¿™æ˜¯ç¬¬äºŒè¡Œåˆ—è¡¨é¡¹ã€‚
</span><span class="ge"></span>&gt; 
<span class="k">&gt; </span><span class="ge">ç»™å‡ºä¸€äº›ä¾‹å­ä»£ç ï¼š
</span><span class="ge"></span>&gt; 
<span class="k">&gt; </span><span class="ge">    return shell_exec(&#34;echo $input | $markdown_script&#34;);
</span></code></pre></div><p>ä»»ä½•åƒæ ·çš„æ–‡æœ¬ç¼–è¾‘å™¨éƒ½èƒ½è½»æ¾åœ°å»ºç«‹ email å‹çš„å¼•ç”¨ã€‚ä¾‹å¦‚åœ¨ BBEdit ä¸­ï¼Œä½ å¯ä»¥é€‰å–æ–‡å­—åç„¶åä»é€‰å•ä¸­é€‰æ‹©_å¢åŠ å¼•ç”¨é˜¶å±‚_ã€‚</p>
<h3 id="åˆ—è¡¨">åˆ—è¡¨</h3>
<p>Markdown æ”¯æŒæœ‰åºåˆ—è¡¨å’Œæ— åºåˆ—è¡¨ã€‚</p>
<p>æ— åºåˆ—è¡¨ä½¿ç”¨æ˜Ÿå·ã€åŠ å·æˆ–æ˜¯å‡å·ä½œä¸ºåˆ—è¡¨æ ‡è®°ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-md" data-lang="md"><span class="k">*</span>   Red
<span class="k">*</span>   Green
<span class="k">*</span>   Blue
</code></pre></div><p>ç­‰åŒäºï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-md" data-lang="md">+   Red
+   Green
+   Blue
</code></pre></div><p>ä¹Ÿç­‰åŒäºï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-md" data-lang="md"><span class="k">-</span>   Red
<span class="k">-</span>   Green
<span class="k">-</span>   Blue
</code></pre></div><p>æœ‰åºåˆ—è¡¨åˆ™ä½¿ç”¨æ•°å­—æ¥ç€ä¸€ä¸ªè‹±æ–‡å¥ç‚¹ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-md" data-lang="md"><span class="k">1.</span>  Bird
<span class="k">2.</span>  McHale
<span class="k">3.</span>  Parish
</code></pre></div><p>å¾ˆé‡è¦çš„ä¸€ç‚¹æ˜¯ï¼Œä½ åœ¨åˆ—è¡¨æ ‡è®°ä¸Šä½¿ç”¨çš„æ•°å­—å¹¶ä¸ä¼šå½±å“è¾“å‡ºçš„ HTML ç»“æœï¼Œä¸Šé¢çš„åˆ—è¡¨æ‰€äº§ç”Ÿçš„ HTML æ ‡è®°ä¸ºï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-md" data-lang="md"><span class="p">&lt;</span><span class="nt">ol</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>Bird<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>McHale<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>Parish<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">ol</span><span class="p">&gt;</span>
</code></pre></div><p>å¦‚æœä½ çš„åˆ—è¡¨æ ‡è®°å†™æˆï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-md" data-lang="md"><span class="k">1.</span>  Bird
<span class="k">1.</span>  McHale
<span class="k">1.</span>  Parish
</code></pre></div><p>æˆ–ç”šè‡³æ˜¯ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-md" data-lang="md"><span class="k">3.</span> Bird
<span class="k">1.</span> McHale
<span class="k">8.</span> Parish
</code></pre></div><p>ä½ éƒ½ä¼šå¾—åˆ°å®Œå…¨ç›¸åŒçš„ HTML è¾“å‡ºã€‚é‡ç‚¹åœ¨äºï¼Œä½ å¯ä»¥è®© Markdown æ–‡ä»¶çš„åˆ—è¡¨æ•°å­—å’Œè¾“å‡ºçš„ç»“æœç›¸åŒï¼Œæˆ–æ˜¯ä½ æ‡’ä¸€ç‚¹ï¼Œä½ å¯ä»¥å®Œå…¨ä¸ç”¨åœ¨æ„æ•°å­—çš„æ­£ç¡®æ€§ã€‚</p>
<p>å¦‚æœä½ ä½¿ç”¨æ‡’æƒ°çš„å†™æ³•ï¼Œå»ºè®®ç¬¬ä¸€ä¸ªé¡¹ç›®æœ€å¥½è¿˜æ˜¯ä» 1. å¼€å§‹ï¼Œå› ä¸º Markdown æœªæ¥å¯èƒ½ä¼šæ”¯æŒæœ‰åºåˆ—è¡¨çš„ start å±æ€§ã€‚</p>
<p>åˆ—è¡¨é¡¹ç›®æ ‡è®°é€šå¸¸æ˜¯æ”¾åœ¨æœ€å·¦è¾¹ï¼Œä½†æ˜¯å…¶å®ä¹Ÿå¯ä»¥ç¼©è¿›ï¼Œæœ€å¤š 3 ä¸ªç©ºæ ¼ï¼Œé¡¹ç›®æ ‡è®°åé¢åˆ™ä¸€å®šè¦æ¥ç€è‡³å°‘ä¸€ä¸ªç©ºæ ¼æˆ–åˆ¶è¡¨ç¬¦ã€‚</p>
<p>è¦è®©åˆ—è¡¨çœ‹èµ·æ¥æ›´æ¼‚äº®ï¼Œä½ å¯ä»¥æŠŠå†…å®¹ç”¨å›ºå®šçš„ç¼©è¿›æ•´ç†å¥½ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-md" data-lang="md"><span class="k">*</span>   Lorem ipsum dolor sit amet, consectetuer adipiscing elit.
    Aliquam hendrerit mi posuere lectus. Vestibulum enim wisi,
    viverra nec, fringilla in, laoreet vitae, risus.
<span class="k">*</span>   Donec sit amet nisl. Aliquam semper ipsum sit amet velit.
    Suspendisse id sem consectetuer libero luctus adipiscing.
</code></pre></div><p>ä½†æ˜¯å¦‚æœä½ æ‡’ï¼Œé‚£ä¹Ÿè¡Œï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-md" data-lang="md"><span class="k">*</span>   Lorem ipsum dolor sit amet, consectetuer adipiscing elit.
Aliquam hendrerit mi posuere lectus. Vestibulum enim wisi,
viverra nec, fringilla in, laoreet vitae, risus.
<span class="k">*</span>   Donec sit amet nisl. Aliquam semper ipsum sit amet velit.
Suspendisse id sem consectetuer libero luctus adipiscing.
</code></pre></div><p>å¦‚æœåˆ—è¡¨é¡¹ç›®é—´ç”¨ç©ºè¡Œåˆ†å¼€ï¼Œåœ¨è¾“å‡º HTML æ—¶ Markdown å°±ä¼šå°†é¡¹ç›®å†…å®¹ç”¨ `` æ ‡ç­¾åŒ…èµ·æ¥ï¼Œä¸¾ä¾‹æ¥è¯´ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-md" data-lang="md"><span class="k">*</span>   Bird
<span class="k">*</span>   Magic
</code></pre></div><p>ä¼šè¢«è½¬æ¢ä¸ºï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-md" data-lang="md"><span class="p">&lt;</span><span class="nt">ul</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>Bird<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>Magic<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
</code></pre></div><p>ä½†æ˜¯è¿™ä¸ªï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-md" data-lang="md"><span class="k">*</span>   Bird
â€‹
<span class="k">*</span>   Magic
</code></pre></div><p>ä¼šè¢«è½¬æ¢ä¸ºï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-md" data-lang="md"><span class="p">&lt;</span><span class="nt">ul</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Bird<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Magic<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
</code></pre></div><p>åˆ—è¡¨é¡¹ç›®å¯ä»¥åŒ…å«å¤šä¸ªæ®µè½ï¼Œæ¯ä¸ªé¡¹ç›®ä¸‹çš„æ®µè½éƒ½å¿…é¡»ç¼©è¿› 4 ä¸ªç©ºæ ¼æˆ–æ˜¯ 1 ä¸ªåˆ¶è¡¨ç¬¦ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-md" data-lang="md"><span class="k">1.</span>  This is a list item with two paragraphs. Lorem ipsum dolor
    sit amet, consectetuer adipiscing elit. Aliquam hendrerit
    mi posuere lectus.
â€‹
    Vestibulum enim wisi, viverra nec, fringilla in, laoreet
    vitae, risus. Donec sit amet nisl. Aliquam semper ipsum
    sit amet velit.
â€‹
<span class="k">2.</span>  Suspendisse id sem consectetuer libero luctus adipiscing.
</code></pre></div><p>å¦‚æœä½ æ¯è¡Œéƒ½æœ‰ç¼©è¿›ï¼Œçœ‹èµ·æ¥ä¼šçœ‹å¥½å¾ˆå¤šï¼Œå½“ç„¶ï¼Œå†æ¬¡åœ°ï¼Œå¦‚æœä½ å¾ˆæ‡’æƒ°ï¼ŒMarkdown ä¹Ÿå…è®¸ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-md" data-lang="md"><span class="k">*</span>   This is a list item with two paragraphs.
â€‹
    This is the second paragraph in the list item. You&#39;re
only required to indent the first line. Lorem ipsum dolor
sit amet, consectetuer adipiscing elit.
â€‹
<span class="k">*</span>   Another item in the same list.
</code></pre></div><p>å¦‚æœè¦åœ¨åˆ—è¡¨é¡¹ç›®å†…æ”¾è¿›å¼•ç”¨ï¼Œé‚£ <code>&gt;</code> å°±éœ€è¦ç¼©è¿›ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-md" data-lang="md"><span class="k">*</span>   A list item with a blockquote:
â€‹
<span class="k">    &gt; </span><span class="ge">This is a blockquote
</span><span class="ge"></span><span class="k">    &gt; </span><span class="ge">inside a list item.
</span></code></pre></div><p>å¦‚æœè¦æ”¾ä»£ç åŒºå—çš„è¯ï¼Œè¯¥åŒºå—å°±éœ€è¦ç¼©è¿›_ä¸¤æ¬¡_ï¼Œä¹Ÿå°±æ˜¯ 8 ä¸ªç©ºæ ¼æˆ–æ˜¯ 2 ä¸ªåˆ¶è¡¨ç¬¦ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-md" data-lang="md"><span class="k">*</span>   ä¸€åˆ—è¡¨é¡¹åŒ…å«ä¸€ä¸ªåˆ—è¡¨åŒºå—ï¼š
â€‹
        <span class="p">&lt;</span><span class="nt">ä»£ç å†™åœ¨è¿™</span><span class="p">&gt;</span>
</code></pre></div><p>å½“ç„¶ï¼Œé¡¹ç›®åˆ—è¡¨å¾ˆå¯èƒ½ä¼šä¸å°å¿ƒäº§ç”Ÿï¼Œåƒæ˜¯ä¸‹é¢è¿™æ ·çš„å†™æ³•ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-md" data-lang="md"><span class="k">1986.</span> What a great season.
</code></pre></div><p>æ¢å¥è¯è¯´ï¼Œä¹Ÿå°±æ˜¯åœ¨è¡Œé¦–å‡ºç°_æ•°å­—-å¥ç‚¹-ç©ºç™½_ï¼Œè¦é¿å…è¿™æ ·çš„çŠ¶å†µï¼Œä½ å¯ä»¥åœ¨å¥ç‚¹å‰é¢åŠ ä¸Šåæ–œæ ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-md" data-lang="md">1986\. What a great season.
</code></pre></div><h3 id="ä»£ç åŒºå—">ä»£ç åŒºå—</h3>
<p>å’Œç¨‹åºç›¸å…³çš„å†™ä½œæˆ–æ˜¯æ ‡ç­¾è¯­è¨€åŸå§‹ç é€šå¸¸ä¼šæœ‰å·²ç»æ’ç‰ˆå¥½çš„ä»£ç åŒºå—ï¼Œé€šå¸¸è¿™äº›åŒºå—æˆ‘ä»¬å¹¶ä¸å¸Œæœ›å®ƒä»¥ä¸€èˆ¬æ®µè½æ–‡ä»¶çš„æ–¹å¼å»æ’ç‰ˆï¼Œè€Œæ˜¯ç…§åŸæ¥çš„æ ·å­æ˜¾ç¤ºï¼ŒMarkdown ä¼šç”¨ <code>å’Œ</code> æ ‡ç­¾æ¥æŠŠä»£ç åŒºå—åŒ…èµ·æ¥ã€‚</p>
<p>è¦åœ¨ Markdown ä¸­å»ºç«‹ä»£ç åŒºå—å¾ˆç®€å•ï¼Œåªè¦ç®€å•åœ°ç¼©è¿› 4 ä¸ªç©ºæ ¼æˆ–æ˜¯ 1 ä¸ªåˆ¶è¡¨ç¬¦å°±å¯ä»¥ï¼Œä¾‹å¦‚ï¼Œä¸‹é¢çš„è¾“å…¥ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-md" data-lang="md">è¿™æ˜¯ä¸€ä¸ªæ™®é€šæ®µè½ï¼š
â€‹
    è¿™æ˜¯ä¸€ä¸ªä»£ç åŒºå—ã€‚
</code></pre></div><p>Markdown ä¼šè½¬æ¢æˆï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-md" data-lang="md"><span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>è¿™æ˜¯ä¸€ä¸ªæ™®é€šæ®µè½ï¼š<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
â€‹
<span class="p">&lt;</span><span class="nt">pre</span><span class="p">&gt;&lt;</span><span class="nt">code</span><span class="p">&gt;</span>è¿™æ˜¯ä¸€ä¸ªä»£ç åŒºå—ã€‚
<span class="p">&lt;/</span><span class="nt">code</span><span class="p">&gt;&lt;/</span><span class="nt">pre</span><span class="p">&gt;</span>
</code></pre></div><p>è¿™ä¸ªæ¯è¡Œä¸€é˜¶çš„ç¼©è¿›ï¼ˆ4 ä¸ªç©ºæ ¼æˆ–æ˜¯ 1 ä¸ªåˆ¶è¡¨ç¬¦ï¼‰ï¼Œéƒ½ä¼šè¢«ç§»é™¤ï¼Œä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-md" data-lang="md">Here is an example of AppleScript:
â€‹
    tell application &#34;Foo&#34;
        beep
    end tell
</code></pre></div><p>ä¼šè¢«è½¬æ¢ä¸ºï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-md" data-lang="md"><span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Here is an example of AppleScript:<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
â€‹
<span class="p">&lt;</span><span class="nt">pre</span><span class="p">&gt;&lt;</span><span class="nt">code</span><span class="p">&gt;</span>tell application &#34;Foo&#34;
    beep
end tell
<span class="p">&lt;/</span><span class="nt">code</span><span class="p">&gt;&lt;/</span><span class="nt">pre</span><span class="p">&gt;</span>
</code></pre></div><p>ä¸€ä¸ªä»£ç åŒºå—ä¼šä¸€ç›´æŒç»­åˆ°æ²¡æœ‰ç¼©è¿›çš„é‚£ä¸€è¡Œï¼ˆæˆ–æ˜¯æ–‡ä»¶ç»“å°¾ï¼‰ã€‚</p>
<p>åœ¨ä»£ç åŒºå—é‡Œé¢ï¼Œ <code>&amp;</code> ã€ <code>&lt;</code> å’Œ <code>&gt;</code> ä¼šè‡ªåŠ¨è½¬æˆ HTML å®ä½“ï¼Œè¿™æ ·çš„æ–¹å¼è®©ä½ éå¸¸å®¹æ˜“ä½¿ç”¨ Markdown æ’å…¥èŒƒä¾‹ç”¨çš„ HTML åŸå§‹ç ï¼Œåªéœ€è¦å¤åˆ¶è´´ä¸Šï¼Œå†åŠ ä¸Šç¼©è¿›å°±å¯ä»¥äº†ï¼Œå‰©ä¸‹çš„ Markdown éƒ½ä¼šå¸®ä½ å¤„ç†ï¼Œä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-md" data-lang="md">    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;footer&#34;</span><span class="p">&gt;</span>
        <span class="ni">&amp;copy;</span> 2004 Foo Corporation
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</code></pre></div><p>ä¼šè¢«è½¬æ¢ä¸ºï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-md" data-lang="md"><span class="p">&lt;</span><span class="nt">pre</span><span class="p">&gt;&lt;</span><span class="nt">code</span><span class="p">&gt;</span><span class="ni">&amp;lt;</span>div class=&#34;footer&#34;<span class="ni">&amp;gt;</span>
    <span class="ni">&amp;amp;</span>copy; 2004 Foo Corporation
<span class="ni">&amp;lt;</span>/div<span class="ni">&amp;gt;</span>
<span class="p">&lt;/</span><span class="nt">code</span><span class="p">&gt;&lt;/</span><span class="nt">pre</span><span class="p">&gt;</span>
</code></pre></div><p>ä»£ç åŒºå—ä¸­ï¼Œä¸€èˆ¬çš„ Markdown è¯­æ³•ä¸ä¼šè¢«è½¬æ¢ï¼Œåƒæ˜¯æ˜Ÿå·ä¾¿åªæ˜¯æ˜Ÿå·ï¼Œè¿™è¡¨ç¤ºä½ å¯ä»¥å¾ˆå®¹æ˜“åœ°ä»¥ Markdown è¯­æ³•æ’°å†™ Markdown è¯­æ³•ç›¸å…³çš„æ–‡ä»¶ã€‚</p>
<h3 id="åˆ†éš”çº¿">åˆ†éš”çº¿</h3>
<p>ä½ å¯ä»¥åœ¨ä¸€è¡Œä¸­ç”¨ä¸‰ä¸ªä»¥ä¸Šçš„æ˜Ÿå·ã€å‡å·ã€åº•çº¿æ¥å»ºç«‹ä¸€ä¸ªåˆ†éš”çº¿ï¼Œè¡Œå†…ä¸èƒ½æœ‰å…¶ä»–ä¸œè¥¿ã€‚ä½ ä¹Ÿå¯ä»¥åœ¨æ˜Ÿå·æˆ–æ˜¯å‡å·ä¸­é—´æ’å…¥ç©ºæ ¼ã€‚ä¸‹é¢æ¯ç§å†™æ³•éƒ½å¯ä»¥å»ºç«‹åˆ†éš”çº¿ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-md" data-lang="md"><span class="k">*</span> * *
â€‹
***
â€‹
<span class="gs">****</span>*
â€‹
<span class="k">-</span> - -
â€‹
---------------------------------------
</code></pre></div><hr>
<h2 id="åŒºæ®µå…ƒç´ ">åŒºæ®µå…ƒç´ </h2>
<h3 id="é“¾æ¥">é“¾æ¥</h3>
<p>Markdown æ”¯æŒä¸¤ç§å½¢å¼çš„é“¾æ¥è¯­æ³•ï¼š _è¡Œå†…å¼_å’Œ_å‚è€ƒå¼_ä¸¤ç§å½¢å¼ã€‚</p>
<p>ä¸ç®¡æ˜¯å“ªä¸€ç§ï¼Œé“¾æ¥æ–‡å­—éƒ½æ˜¯ç”¨ [æ–¹æ‹¬å·] æ¥æ ‡è®°ã€‚</p>
<p>è¦å»ºç«‹ä¸€ä¸ª_è¡Œå†…å¼_çš„é“¾æ¥ï¼Œåªè¦åœ¨æ–¹å—æ‹¬å·åé¢ç´§æ¥ç€åœ†æ‹¬å·å¹¶æ’å…¥ç½‘å€é“¾æ¥å³å¯ï¼Œå¦‚æœä½ è¿˜æƒ³è¦åŠ ä¸Šé“¾æ¥çš„ title æ–‡å­—ï¼Œåªè¦åœ¨ç½‘å€åé¢ï¼Œç”¨åŒå¼•å·æŠŠ title æ–‡å­—åŒ…èµ·æ¥å³å¯ï¼Œä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-md" data-lang="md">This is [<span class="nt">an example</span>](<span class="na">http://example.com/ &#34;Title&#34;</span>) inline link.
â€‹
[<span class="nt">This link</span>](<span class="na">http://example.net/</span>) has no title attribute.
</code></pre></div><p>ä¼šäº§ç”Ÿï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-md" data-lang="md"><span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>This is <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;http://example.com/&#34;</span> <span class="na">title</span><span class="o">=</span><span class="s">&#34;Title&#34;</span><span class="p">&gt;</span>
an example<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span> inline link.<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
â€‹
<span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;http://example.net/&#34;</span><span class="p">&gt;</span>This link<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span> has no
title attribute.<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
</code></pre></div><p>å¦‚æœä½ æ˜¯è¦é“¾æ¥åˆ°åŒæ ·ä¸»æœºçš„èµ„æºï¼Œä½ å¯ä»¥ä½¿ç”¨ç›¸å¯¹è·¯å¾„ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-md" data-lang="md">See my [<span class="nt">About</span>](<span class="na">/about/</span>) page for details.
</code></pre></div><p>_å‚è€ƒå¼_çš„é“¾æ¥æ˜¯åœ¨é“¾æ¥æ–‡å­—çš„æ‹¬å·åé¢å†æ¥ä¸Šå¦ä¸€ä¸ªæ–¹æ‹¬å·ï¼Œè€Œåœ¨ç¬¬äºŒä¸ªæ–¹æ‹¬å·é‡Œé¢è¦å¡«å…¥ç”¨ä»¥è¾¨è¯†é“¾æ¥çš„æ ‡è®°ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-md" data-lang="md">This is [an example][id] reference-style link.
</code></pre></div><p>ä½ ä¹Ÿå¯ä»¥é€‰æ‹©æ€§åœ°åœ¨ä¸¤ä¸ªæ–¹æ‹¬å·ä¸­é—´åŠ ä¸Šä¸€ä¸ªç©ºæ ¼ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-md" data-lang="md">This is [an example] [id] reference-style link.
</code></pre></div><p>æ¥ç€ï¼Œåœ¨æ–‡ä»¶çš„ä»»æ„å¤„ï¼Œä½ å¯ä»¥æŠŠè¿™ä¸ªæ ‡è®°çš„é“¾æ¥å†…å®¹å®šä¹‰å‡ºæ¥ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-md" data-lang="md">[id]: http://example.com/  &#34;Optional Title Here&#34;
</code></pre></div><p>é“¾æ¥å†…å®¹å®šä¹‰çš„å½¢å¼ä¸ºï¼š</p>
<ul>
<li>æ–¹æ‹¬å·ï¼ˆå‰é¢å¯ä»¥é€‰æ‹©æ€§åœ°åŠ ä¸Šè‡³å¤šä¸‰ä¸ªç©ºæ ¼æ¥ç¼©è¿›ï¼‰ï¼Œé‡Œé¢è¾“å…¥é“¾æ¥æ–‡å­—</li>
<li>æ¥ç€ä¸€ä¸ªå†’å·</li>
<li>æ¥ç€ä¸€ä¸ªä»¥ä¸Šçš„ç©ºæ ¼æˆ–åˆ¶è¡¨ç¬¦</li>
<li>æ¥ç€é“¾æ¥çš„ç½‘å€</li>
<li>é€‰æ‹©æ€§åœ°æ¥ç€ title å†…å®¹ï¼Œå¯ä»¥ç”¨å•å¼•å·ã€åŒå¼•å·æˆ–æ˜¯æ‹¬å¼§åŒ…ç€</li>
</ul>
<p>ä¸‹é¢è¿™ä¸‰ç§é“¾æ¥çš„å®šä¹‰éƒ½æ˜¯ç›¸åŒï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-md" data-lang="md">[foo]: http://example.com/  &#34;Optional Title Here&#34;
[foo]: http://example.com/  &#39;Optional Title Here&#39;
[foo]: http://example.com/  (Optional Title Here)
</code></pre></div><p>**è¯·æ³¨æ„ï¼š**æœ‰ä¸€ä¸ªå·²çŸ¥çš„é—®é¢˜æ˜¯ Markdown.pl 1.0.1 ä¼šå¿½ç•¥å•å¼•å·åŒ…èµ·æ¥çš„é“¾æ¥ titleã€‚</p>
<p>é“¾æ¥ç½‘å€ä¹Ÿå¯ä»¥ç”¨æ–¹æ‹¬å·åŒ…èµ·æ¥ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-md" data-lang="md">[id]: <span class="p">&lt;</span><span class="nt">http:</span><span class="err">//</span><span class="na">example</span><span class="err">.</span><span class="na">com</span><span class="p">/&gt;</span>  &#34;Optional Title Here&#34;
</code></pre></div><p>ä½ ä¹Ÿå¯ä»¥æŠŠ title å±æ€§æ”¾åˆ°ä¸‹ä¸€è¡Œï¼Œä¹Ÿå¯ä»¥åŠ ä¸€äº›ç¼©è¿›ï¼Œè‹¥ç½‘å€å¤ªé•¿çš„è¯ï¼Œè¿™æ ·ä¼šæ¯”è¾ƒå¥½çœ‹ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-md" data-lang="md">[id]: http://example.com/longish/path/to/resource/here
    &#34;Optional Title Here&#34;
</code></pre></div><p>ç½‘å€å®šä¹‰åªæœ‰åœ¨äº§ç”Ÿé“¾æ¥çš„æ—¶å€™ç”¨åˆ°ï¼Œå¹¶ä¸ä¼šç›´æ¥å‡ºç°åœ¨æ–‡ä»¶ä¹‹ä¸­ã€‚</p>
<p>é“¾æ¥è¾¨åˆ«æ ‡ç­¾å¯ä»¥æœ‰å­—æ¯ã€æ•°å­—ã€ç©ºç™½å’Œæ ‡ç‚¹ç¬¦å·ï¼Œä½†æ˜¯å¹¶_ä¸_åŒºåˆ†å¤§å°å†™ï¼Œå› æ­¤ä¸‹é¢ä¸¤ä¸ªé“¾æ¥æ˜¯ä¸€æ ·çš„ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-md" data-lang="md">[link text][a]
[link text][A]
</code></pre></div><p>_éšå¼é“¾æ¥æ ‡è®°_åŠŸèƒ½è®©ä½ å¯ä»¥çœç•¥æŒ‡å®šé“¾æ¥æ ‡è®°ï¼Œè¿™ç§æƒ…å½¢ä¸‹ï¼Œé“¾æ¥æ ‡è®°ä¼šè§†ä¸ºç­‰åŒäºé“¾æ¥æ–‡å­—ï¼Œè¦ç”¨éšå¼é“¾æ¥æ ‡è®°åªè¦åœ¨é“¾æ¥æ–‡å­—åé¢åŠ ä¸Šä¸€ä¸ªç©ºçš„æ–¹æ‹¬å·ï¼Œå¦‚æœä½ è¦è®© &ldquo;Google&rdquo; é“¾æ¥åˆ° google.comï¼Œä½ å¯ä»¥ç®€åŒ–æˆï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-md" data-lang="md">[Google][]
</code></pre></div><p>ç„¶åå®šä¹‰é“¾æ¥å†…å®¹ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-md" data-lang="md">[Google]: http://google.com/
</code></pre></div><p>ç”±äºé“¾æ¥æ–‡å­—å¯èƒ½åŒ…å«ç©ºç™½ï¼Œæ‰€ä»¥è¿™ç§ç®€åŒ–å‹çš„æ ‡è®°å†…ä¹Ÿè®¸åŒ…å«å¤šä¸ªå•è¯ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-md" data-lang="md">Visit [Daring Fireball][] for more information.
</code></pre></div><p>ç„¶åæ¥ç€å®šä¹‰é“¾æ¥ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-md" data-lang="md">[Daring Fireball]: http://daringfireball.net/
</code></pre></div><p>é“¾æ¥çš„å®šä¹‰å¯ä»¥æ”¾åœ¨æ–‡ä»¶ä¸­çš„ä»»ä½•ä¸€ä¸ªåœ°æ–¹ï¼Œæˆ‘æ¯”è¾ƒåå¥½ç›´æ¥æ”¾åœ¨é“¾æ¥å‡ºç°æ®µè½çš„åé¢ï¼Œä½ ä¹Ÿå¯ä»¥æŠŠå®ƒæ”¾åœ¨æ–‡ä»¶æœ€åé¢ï¼Œå°±åƒæ˜¯æ³¨è§£ä¸€æ ·ã€‚</p>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ªå‚è€ƒå¼é“¾æ¥çš„èŒƒä¾‹ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-md" data-lang="md">I get 10 times more traffic from [Google] [1] than from
[Yahoo] [2] or [MSN] [3].
â€‹
  [1]: http://google.com/        &#34;Google&#34;
  [2]: http://search.yahoo.com/  &#34;Yahoo Search&#34;
  [3]: http://search.msn.com/    &#34;MSN Search&#34;
</code></pre></div><p>å¦‚æœæ”¹æˆç”¨é“¾æ¥åç§°çš„æ–¹å¼å†™ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-md" data-lang="md">I get 10 times more traffic from [Google][] than from
[Yahoo][] or [MSN][].
â€‹
  [google]: http://google.com/        &#34;Google&#34;
  [yahoo]:  http://search.yahoo.com/  &#34;Yahoo Search&#34;
  [msn]:    http://search.msn.com/    &#34;MSN Search&#34;
</code></pre></div><p>ä¸Šé¢ä¸¤ç§å†™æ³•éƒ½ä¼šäº§ç”Ÿä¸‹é¢çš„ HTMLã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-md" data-lang="md"><span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>I get 10 times more traffic from <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;http://google.com/&#34;</span>
<span class="na">title</span><span class="o">=</span><span class="s">&#34;Google&#34;</span><span class="p">&gt;</span>Google<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span> than from
<span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;http://search.yahoo.com/&#34;</span> <span class="na">title</span><span class="o">=</span><span class="s">&#34;Yahoo Search&#34;</span><span class="p">&gt;</span>Yahoo<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
or <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;http://search.msn.com/&#34;</span> <span class="na">title</span><span class="o">=</span><span class="s">&#34;MSN Search&#34;</span><span class="p">&gt;</span>MSN<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>.<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
</code></pre></div><p>ä¸‹é¢æ˜¯ç”¨è¡Œå†…å¼å†™çš„åŒæ ·ä¸€æ®µå†…å®¹çš„ Markdown æ–‡ä»¶ï¼Œæä¾›ä½œä¸ºæ¯”è¾ƒä¹‹ç”¨ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-md" data-lang="md">I get 10 times more traffic from [<span class="nt">Google</span>](<span class="na">http://google.com/ &#34;Google&#34;</span>)
than from [<span class="nt">Yahoo</span>](<span class="na">http://search.yahoo.com/ &#34;Yahoo Search&#34;</span>) or
[<span class="nt">MSN</span>](<span class="na">http://search.msn.com/ &#34;MSN Search&#34;</span>).
</code></pre></div><p>å‚è€ƒå¼çš„é“¾æ¥å…¶å®é‡ç‚¹ä¸åœ¨äºå®ƒæ¯”è¾ƒå¥½å†™ï¼Œè€Œæ˜¯å®ƒæ¯”è¾ƒå¥½è¯»ï¼Œæ¯”è¾ƒä¸€ä¸‹ä¸Šé¢çš„èŒƒä¾‹ï¼Œä½¿ç”¨å‚è€ƒå¼çš„æ–‡ç« æœ¬èº«åªæœ‰ 81 ä¸ªå­—ç¬¦ï¼Œä½†æ˜¯ç”¨è¡Œå†…å½¢å¼çš„å´ä¼šå¢åŠ åˆ° 176 ä¸ªå­—å…ƒï¼Œå¦‚æœæ˜¯ç”¨çº¯ HTML æ ¼å¼æ¥å†™ï¼Œä¼šæœ‰ 234 ä¸ªå­—å…ƒï¼Œåœ¨ HTML æ ¼å¼ä¸­ï¼Œæ ‡ç­¾æ¯”æ–‡æœ¬è¿˜è¦å¤šã€‚</p>
<p>ä½¿ç”¨ Markdown çš„å‚è€ƒå¼é“¾æ¥ï¼Œå¯ä»¥è®©æ–‡ä»¶æ›´åƒæ˜¯æµè§ˆå™¨æœ€åäº§ç”Ÿçš„ç»“æœï¼Œè®©ä½ å¯ä»¥æŠŠä¸€äº›æ ‡è®°ç›¸å…³çš„å…ƒæ•°æ®ç§»åˆ°æ®µè½æ–‡å­—ä¹‹å¤–ï¼Œä½ å°±å¯ä»¥å¢åŠ é“¾æ¥è€Œä¸è®©æ–‡ç« çš„é˜…è¯»æ„Ÿè§‰è¢«æ‰“æ–­ã€‚</p>
<h3 id="å¼ºè°ƒ">å¼ºè°ƒ</h3>
<p>Markdown ä½¿ç”¨æ˜Ÿå·ï¼ˆ<code>*</code>ï¼‰å’Œåº•çº¿ï¼ˆ<code>_</code>ï¼‰ä½œä¸ºæ ‡è®°å¼ºè°ƒå­—è¯çš„ç¬¦å·ï¼Œè¢« <code>*</code> æˆ– <code>_</code> åŒ…å›´çš„å­—è¯ä¼šè¢«è½¬æˆç”¨ <code>æ ‡ç­¾åŒ…å›´ï¼Œç”¨ä¸¤ä¸ª</code>*<code>æˆ–</code>_<code>åŒ…èµ·æ¥çš„è¯ï¼Œåˆ™ä¼šè¢«è½¬æˆ</code>ï¼Œä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-md" data-lang="md">*single asterisks*
â€‹
<span class="ge">_single underscores_</span>
â€‹
<span class="gs">**double asterisks**</span>
â€‹
<span class="gs">__double underscores__</span>
</code></pre></div><p>ä¼šè½¬æˆï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-md" data-lang="md"><span class="p">&lt;</span><span class="nt">em</span><span class="p">&gt;</span>single asterisks<span class="p">&lt;/</span><span class="nt">em</span><span class="p">&gt;</span>
â€‹
<span class="p">&lt;</span><span class="nt">em</span><span class="p">&gt;</span>single underscores<span class="p">&lt;/</span><span class="nt">em</span><span class="p">&gt;</span>
â€‹
<span class="p">&lt;</span><span class="nt">strong</span><span class="p">&gt;</span>double asterisks<span class="p">&lt;/</span><span class="nt">strong</span><span class="p">&gt;</span>
â€‹
<span class="p">&lt;</span><span class="nt">strong</span><span class="p">&gt;</span>double underscores<span class="p">&lt;/</span><span class="nt">strong</span><span class="p">&gt;</span>
</code></pre></div><p>ä½ å¯ä»¥éšä¾¿ç”¨ä½ å–œæ¬¢çš„æ ·å¼ï¼Œå”¯ä¸€çš„é™åˆ¶æ˜¯ï¼Œä½ ç”¨ä»€ä¹ˆç¬¦å·å¼€å¯æ ‡ç­¾ï¼Œå°±è¦ç”¨ä»€ä¹ˆç¬¦å·ç»“æŸã€‚</p>
<p>å¼ºè°ƒä¹Ÿå¯ä»¥ç›´æ¥æ’åœ¨æ–‡å­—ä¸­é—´ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-md" data-lang="md">un*frigging*believable
</code></pre></div><p>ä½†æ˜¯<strong>å¦‚æœä½ çš„ <code>\*</code> å’Œ <code>_</code> ä¸¤è¾¹éƒ½æœ‰ç©ºç™½çš„è¯ï¼Œå®ƒä»¬å°±åªä¼šè¢«å½“æˆæ™®é€šçš„ç¬¦å·</strong>ã€‚</p>
<p>å¦‚æœè¦åœ¨æ–‡å­—å‰åç›´æ¥æ’å…¥æ™®é€šçš„æ˜Ÿå·æˆ–åº•çº¿ï¼Œä½ å¯ä»¥ç”¨åæ–œçº¿ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-md" data-lang="md">\*this text is surrounded by literal asterisks\*
</code></pre></div><h3 id="ä»£ç ">ä»£ç </h3>
<p>å¦‚æœè¦æ ‡è®°ä¸€å°æ®µè¡Œå†…ä»£ç ï¼Œä½ å¯ä»¥ç”¨åå¼•å·æŠŠå®ƒåŒ…èµ·æ¥ï¼ˆ```ï¼‰ï¼Œä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-md" data-lang="md">Use the <span class="sb">`printf()`</span> function.
</code></pre></div><p>ä¼šäº§ç”Ÿï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-md" data-lang="md"><span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Use the <span class="p">&lt;</span><span class="nt">code</span><span class="p">&gt;</span>printf()<span class="p">&lt;/</span><span class="nt">code</span><span class="p">&gt;</span> function.<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
</code></pre></div><p>å¦‚æœè¦åœ¨ä»£ç åŒºæ®µå†…æ’å…¥åå¼•å·ï¼Œä½ å¯ä»¥ç”¨å¤šä¸ªåå¼•å·æ¥å¼€å¯å’Œç»“æŸä»£ç åŒºæ®µï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-md" data-lang="md">``There is a literal backtick (`) here.``
</code></pre></div><p>è¿™æ®µè¯­æ³•ä¼šäº§ç”Ÿï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-md" data-lang="md"><span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;&lt;</span><span class="nt">code</span><span class="p">&gt;</span>There is a literal backtick (`) here.<span class="p">&lt;/</span><span class="nt">code</span><span class="p">&gt;&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
</code></pre></div><p>ä»£ç åŒºæ®µçš„èµ·å§‹å’Œç»“æŸç«¯éƒ½å¯ä»¥æ”¾å…¥ä¸€ä¸ªç©ºç™½ï¼Œèµ·å§‹ç«¯åé¢ä¸€ä¸ªï¼Œç»“æŸç«¯å‰é¢ä¸€ä¸ªï¼Œè¿™æ ·ä½ å°±å¯ä»¥åœ¨åŒºæ®µçš„ä¸€å¼€å§‹å°±æ’å…¥åå¼•å·ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-md" data-lang="md">A single backtick in a code span: `` <span class="sb">` ``
</span><span class="sb">â€‹
</span><span class="sb">A backtick-delimited string in a code span: `` `</span>foo` ``
</code></pre></div><p>ä¼šäº§ç”Ÿï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-md" data-lang="md"><span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>A single backtick in a code span: <span class="p">&lt;</span><span class="nt">code</span><span class="p">&gt;</span>`<span class="p">&lt;/</span><span class="nt">code</span><span class="p">&gt;&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
â€‹
<span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>A backtick-delimited string in a code span: <span class="p">&lt;</span><span class="nt">code</span><span class="p">&gt;</span>`foo`<span class="p">&lt;/</span><span class="nt">code</span><span class="p">&gt;&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
</code></pre></div><p>åœ¨ä»£ç åŒºæ®µå†…ï¼Œ<code>&amp;</code> å’Œæ–¹æ‹¬å·<strong>éƒ½</strong>ä¼šè¢«è‡ªåŠ¨åœ°è½¬æˆ HTML å®ä½“ï¼Œè¿™ä½¿å¾—æ’å…¥ HTML åŸå§‹ç å˜å¾—å¾ˆå®¹æ˜“ï¼ŒMarkdown ä¼šæŠŠä¸‹é¢è¿™æ®µï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-md" data-lang="md">Please don&#39;t use any <span class="sb">`&lt;blink&gt;`</span> tags.
</code></pre></div><p>è½¬ä¸ºï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-md" data-lang="md"><span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Please don&#39;t use any <span class="p">&lt;</span><span class="nt">code</span><span class="p">&gt;</span><span class="ni">&amp;lt;</span>blink<span class="ni">&amp;gt;</span><span class="p">&lt;/</span><span class="nt">code</span><span class="p">&gt;</span> tags.<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
</code></pre></div><p>ä½ ä¹Ÿå¯ä»¥è¿™æ ·å†™ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-md" data-lang="md"><span class="sb">`&amp;#8212;`</span> is the decimal-encoded equivalent of <span class="sb">`&amp;mdash;`</span>.
</code></pre></div><p>ä»¥äº§ç”Ÿï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-md" data-lang="md"><span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;&lt;</span><span class="nt">code</span><span class="p">&gt;</span><span class="ni">&amp;amp;</span>#8212;<span class="p">&lt;/</span><span class="nt">code</span><span class="p">&gt;</span> is the decimal-encoded
equivalent of <span class="p">&lt;</span><span class="nt">code</span><span class="p">&gt;</span><span class="ni">&amp;amp;</span>mdash;<span class="p">&lt;/</span><span class="nt">code</span><span class="p">&gt;</span>.<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
</code></pre></div><h3 id="å›¾ç‰‡">å›¾ç‰‡</h3>
<p>å¾ˆæ˜æ˜¾åœ°ï¼Œè¦åœ¨çº¯æ–‡å­—åº”ç”¨ä¸­è®¾è®¡ä¸€ä¸ªã€Œè‡ªç„¶ã€çš„è¯­æ³•æ¥æ’å…¥å›¾ç‰‡æ˜¯æœ‰ä¸€å®šéš¾åº¦çš„ã€‚</p>
<p>Markdown ä½¿ç”¨ä¸€ç§å’Œé“¾æ¥å¾ˆç›¸ä¼¼çš„è¯­æ³•æ¥æ ‡è®°å›¾ç‰‡ï¼ŒåŒæ ·ä¹Ÿå…è®¸ä¸¤ç§æ ·å¼ï¼š <em>è¡Œå†…å¼_å’Œ_å‚è€ƒå¼</em>ã€‚</p>
<p>è¡Œå†…å¼çš„å›¾ç‰‡è¯­æ³•çœ‹èµ·æ¥åƒæ˜¯ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-md" data-lang="md">![<span class="nt">Alt text</span>](<span class="na">/path/to/img.jpg</span>)
â€‹
![<span class="nt">Alt text</span>](<span class="na">/path/to/img.jpg &#34;Optional title&#34;</span>)
</code></pre></div><p>è¯¦ç»†å™è¿°å¦‚ä¸‹ï¼š</p>
<ul>
<li>ä¸€ä¸ªæƒŠå¹å· <code>!</code></li>
<li>æ¥ç€ä¸€ä¸ªæ–¹æ‹¬å·ï¼Œé‡Œé¢æ”¾ä¸Šå›¾ç‰‡çš„æ›¿ä»£æ–‡å­—</li>
<li>æ¥ç€ä¸€ä¸ªæ™®é€šæ‹¬å·ï¼Œé‡Œé¢æ”¾ä¸Šå›¾ç‰‡çš„ç½‘å€ï¼Œæœ€åè¿˜å¯ä»¥ç”¨å¼•å·åŒ…ä½å¹¶åŠ ä¸Š é€‰æ‹©æ€§çš„ &lsquo;title&rsquo; æ–‡å­—ã€‚</li>
</ul>
<p>å‚è€ƒå¼çš„å›¾ç‰‡è¯­æ³•åˆ™é•¿å¾—åƒè¿™æ ·ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-md" data-lang="md">![Alt text][id]
</code></pre></div><p>ã€Œidã€æ˜¯å›¾ç‰‡å‚è€ƒçš„åç§°ï¼Œå›¾ç‰‡å‚è€ƒçš„å®šä¹‰æ–¹å¼åˆ™å’Œè¿ç»“å‚è€ƒä¸€æ ·ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-md" data-lang="md">[id]: url/to/image  &#34;Optional title attribute&#34;
</code></pre></div><p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œ Markdown è¿˜æ²¡æœ‰åŠæ³•æŒ‡å®šå›¾ç‰‡çš„å®½é«˜ï¼Œå¦‚æœä½ éœ€è¦çš„è¯ï¼Œä½ å¯ä»¥ä½¿ç”¨æ™®é€šçš„ `` æ ‡ç­¾ã€‚</p>
<hr>
<h2 id="å…¶å®ƒ">å…¶å®ƒ</h2>
<h3 id="è‡ªåŠ¨é“¾æ¥">è‡ªåŠ¨é“¾æ¥</h3>
<p>Markdown æ”¯æŒä»¥æ¯”è¾ƒç®€çŸ­çš„è‡ªåŠ¨é“¾æ¥å½¢å¼æ¥å¤„ç†ç½‘å€å’Œç”µå­é‚®ä»¶ä¿¡ç®±ï¼Œåªè¦æ˜¯ç”¨æ–¹æ‹¬å·åŒ…èµ·æ¥ï¼Œ Markdown å°±ä¼šè‡ªåŠ¨æŠŠå®ƒè½¬æˆé“¾æ¥ã€‚ä¸€èˆ¬ç½‘å€çš„é“¾æ¥æ–‡å­—å°±å’Œé“¾æ¥åœ°å€ä¸€æ ·ï¼Œä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-md" data-lang="md"><span class="p">&lt;</span><span class="nt">http:</span><span class="err">//</span><span class="na">example</span><span class="err">.</span><span class="na">com</span><span class="p">/&gt;</span>
</code></pre></div><p>Markdown ä¼šè½¬ä¸ºï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-md" data-lang="md"><span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;http://example.com/&#34;</span><span class="p">&gt;</span>http://example.com/<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
</code></pre></div><p>é‚®å€çš„è‡ªåŠ¨é“¾æ¥ä¹Ÿå¾ˆç±»ä¼¼ï¼Œåªæ˜¯ Markdown ä¼šå…ˆåšä¸€ä¸ªç¼–ç è½¬æ¢çš„è¿‡ç¨‹ï¼ŒæŠŠæ–‡å­—å­—ç¬¦è½¬æˆ 16 è¿›ä½ç çš„ HTML å®ä½“ï¼Œè¿™æ ·çš„æ ¼å¼å¯ä»¥ç³Šå¼„ä¸€äº›ä¸å¥½çš„é‚®å€æ”¶é›†æœºå™¨äººï¼Œä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-md" data-lang="md"><span class="p">&lt;</span><span class="nt">address</span><span class="err">@</span><span class="na">example</span><span class="err">.</span><span class="na">com</span><span class="p">&gt;</span>
</code></pre></div><p>Markdown ä¼šè½¬æˆï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-md" data-lang="md"><span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;&amp;#x6D;&amp;#x61;i&amp;#x6C;&amp;#x74;&amp;#x6F;:&amp;#x61;&amp;#x64;&amp;#x64;&amp;#x72;&amp;#x65;
</span><span class="s">&amp;#115;&amp;#115;&amp;#64;&amp;#101;&amp;#120;&amp;#x61;&amp;#109;&amp;#x70;&amp;#x6C;e&amp;#x2E;&amp;#99;&amp;#111;
</span><span class="s">&amp;#109;&#34;</span><span class="p">&gt;</span><span class="ni">&amp;#x61;&amp;#x64;&amp;#x64;&amp;#x72;&amp;#x65;&amp;#115;&amp;#115;&amp;#64;&amp;#101;&amp;#120;&amp;#x61;</span>
<span class="ni">&amp;#109;&amp;#x70;&amp;#x6C;</span>e<span class="ni">&amp;#x2E;&amp;#99;&amp;#111;&amp;#109;</span><span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
</code></pre></div><p>åœ¨æµè§ˆå™¨é‡Œé¢ï¼Œè¿™æ®µå­—ä¸²ï¼ˆå…¶å®æ˜¯ <code>[address@example.com](mailto:address@example.com)</code>ï¼‰ä¼šå˜æˆä¸€ä¸ªå¯ä»¥ç‚¹å‡»çš„ã€Œ<a href="mailto:address@example.com">address@example.com</a>ã€é“¾æ¥ã€‚</p>
<p>ï¼ˆè¿™ç§ä½œæ³•è™½ç„¶å¯ä»¥ç³Šå¼„ä¸å°‘çš„æœºå™¨äººï¼Œä½†å¹¶ä¸èƒ½å…¨éƒ¨æŒ¡ä¸‹æ¥ï¼Œä¸è¿‡æ€»æ¯”ä»€ä¹ˆéƒ½ä¸åšå¥½äº›ã€‚ä¸ç®¡æ€æ ·ï¼Œå…¬å¼€ä½ çš„ä¿¡ç®±ç»ˆç©¶ä¼šå¼•æ¥å¹¿å‘Šä¿¡ä»¶çš„ã€‚ï¼‰</p>
<h3 id="åæ–œæ ">åæ–œæ </h3>
<p>Markdown å¯ä»¥åˆ©ç”¨åæ–œæ æ¥æ’å…¥ä¸€äº›åœ¨è¯­æ³•ä¸­æœ‰å…¶å®ƒæ„ä¹‰çš„ç¬¦å·ï¼Œä¾‹å¦‚ï¼šå¦‚æœä½ æƒ³è¦ç”¨æ˜Ÿå·åŠ åœ¨æ–‡å­—æ—è¾¹çš„æ–¹å¼æ¥åšå‡ºå¼ºè°ƒæ•ˆæœï¼ˆä½†ä¸ç”¨ `` æ ‡ç­¾ï¼‰ï¼Œä½ å¯ä»¥åœ¨æ˜Ÿå·çš„å‰é¢åŠ ä¸Šåæ–œæ ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-md" data-lang="md">\*literal asterisks\*
</code></pre></div><p>Markdown æ”¯æŒä»¥ä¸‹è¿™äº›ç¬¦å·å‰é¢åŠ ä¸Šåæ–œæ æ¥å¸®åŠ©æ’å…¥æ™®é€šçš„ç¬¦å·ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-md" data-lang="md">\   åæ–œçº¿
`   åå¼•å·
<span class="ge">*   æ˜Ÿå·
</span><span class="ge">_</span>   åº•çº¿
{}  èŠ±æ‹¬å·
[]  æ–¹æ‹¬å·
()  æ‹¬å¼§
<span class="gh">#   äº•å­—å·
</span><span class="gh"></span>+   åŠ å·
<span class="k">-</span>   å‡å·
.   è‹±æ–‡å¥ç‚¹
!   æƒŠå¹å·
</code></pre></div>]]></content>
		</item>
		
		<item>
			<title>edgeå¦‚ä½•è§£å†³è·¨åŸŸé—®é¢˜</title>
			<link>https://aomi.run/posts/edge-cors-error/</link>
			<pubDate>Wed, 20 Jan 2021 23:42:51 +0800</pubDate>
			
			<guid>https://aomi.run/posts/edge-cors-error/</guid>
			<description>æ‰¾äº†ä¸€ä¸ªæ¯”è¾ƒç®€å•çš„è§£å†³åŠæ³• å»åº”ç”¨å•†åº—ç›´æ¥ä¸‹è½½ä¸€ä¸ªæ’ä»¶ Access-Control-Allow-Origin,è£…å¥½äº†ä¹‹åç‚¹å›¾æ ‡ï¼Œç‚¹å‡»toggleæŠŠä¸Šé¢çš„logoç‚¹æˆå½©è‰²ï¼Œç„¶ååˆ·æ–°ä¸€ä¸‹éœ€è¦è·¨åŸŸçš„é¡µé¢ï¼Œå®Œæˆ </description>
			<content type="html"><![CDATA[<h2 id="æ‰¾äº†ä¸€ä¸ªæ¯”è¾ƒç®€å•çš„è§£å†³åŠæ³•">æ‰¾äº†ä¸€ä¸ªæ¯”è¾ƒç®€å•çš„è§£å†³åŠæ³•</h2>
<p>å»åº”ç”¨å•†åº—ç›´æ¥ä¸‹è½½ä¸€ä¸ªæ’ä»¶ Access-Control-Allow-Origin,è£…å¥½äº†ä¹‹åç‚¹å›¾æ ‡ï¼Œç‚¹å‡»toggleæŠŠä¸Šé¢çš„logoç‚¹æˆå½©è‰²ï¼Œç„¶ååˆ·æ–°ä¸€ä¸‹éœ€è¦è·¨åŸŸçš„é¡µé¢ï¼Œå®Œæˆ
<img src="https://img-blog.csdnimg.cn/20201102170424596.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3p6X0xYVw==,size_16,color_FFFFFF,t_70#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
]]></content>
		</item>
		
	</channel>
</rss>
